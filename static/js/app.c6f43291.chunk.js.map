{"version":3,"sources":["audio/menu/click.wav","components/utility/icons/assets/stone.png","components/utility/icons/assets/wood.png","components/utility/icons/assets/coins.png","components/utility/icons/assets/mana.png","components/utility/icons/assets/iron.png","components/utility/icons/assets/water.png","components/utility/icons/assets/boost.png","components/utility/icons/assets/temperature.png","components/utility/icons/assets/attack.png","components/utility/icons/assets/attackDelay.png","components/utility/icons/assets/defense.png","components/utility/icons/assets/hp.png","components/utility/icons/assets/hpRegen.png","components/utility/icons/assets/monstium.png","components/utility/icons/assets/debuff.png","components/utility/icons/assets/generic.png","components/utility/icons/assets/accuracy.png","components/utility/icons/assets/dodge.png","components/utility/icons/assets/timepiece.png","components/utility/icons/assets/critChance.png","components/utility/icons/assets/electricity.png","components/utility/icons/assets/about.png","components/utility/icons/assets/apprentices.png","components/utility/icons/assets/campus.png","components/utility/icons/assets/creatures.png","components/utility/icons/assets/ending.png","components/utility/icons/assets/exploration.png","components/utility/icons/assets/help.png","components/utility/icons/assets/inventory.png","components/utility/icons/assets/options.png","components/utility/icons/assets/research.png","components/utility/icons/assets/retirement.png","components/utility/icons/assets/stats.png","components/utility/icons/assets/strengthening.png","components/utility/icons/assets/upgrades.png","node_modules/moment/locale sync /^/.*$","backend/items/other/lightweightChest.png","backend/exploration/enemies/schoolbasement/basementBat.png","backend/exploration/enemies/schoolbasement/mouse.png","backend/exploration/enemies/schoolbasement/skeleton.png","backend/exploration/enemies/schoolbasement/angrySheep.png","backend/exploration/enemies/schoolbasement/littleDevil.png","backend/items/other/crystals/airSpeck.png","backend/items/other/crystals/darknessSpeck.png","backend/items/other/crystals/earthSpeck.png","backend/items/other/crystals/fireSpeck.png","backend/items/other/crystals/lightningSpeck.png","backend/items/other/crystals/natureSpeck.png","backend/items/other/crystals/waterSpeck.png","backend/exploration/enemies/schoolbasement/slime.png","backend/exploration/enemies/schoolbasement/ancientHeadmaster.png","backend/exploration/enemies/schoolbasement/redSlime.png","backend/exploration/enemies/schoolbasement/zombie.png","backend/items/other/batWing.png","backend/items/other/ratTail.png","backend/exploration/enemies/thundertower/enchantedSheep.png","backend/exploration/enemies/wizardsarena/blackSheep.png","backend/exploration/enemies/schoolbasement/mimic.png","backend/items/consumable/defensePotion.png","backend/items/consumable/healthPotion.png","backend/items/consumable/manaPotion.png","backend/items/consumable/medicinalHerb.png","backend/items/consumable/speedPotion.png","backend/items/consumable/strengthPotion.png","backend/items/consumable/vitalityPotion.png","backend/items/equipment/accessory/cloak.png","backend/items/equipment/accessory/cloakOfRegeneration.png","backend/items/equipment/accessory/clothShoes.png","backend/items/equipment/accessory/crystallizedMana.png","backend/items/equipment/accessory/enchantedCloak.png","backend/items/equipment/accessory/woodenSandals.png","backend/items/equipment/body/elderWizardRobe.png","backend/items/equipment/body/ironMail.png","backend/items/equipment/body/wizardRobe.png","backend/items/equipment/hand/airWand.png","backend/items/equipment/hand/assassinsDagger.png","backend/items/equipment/hand/branch.png","backend/items/equipment/hand/club.png","backend/items/equipment/hand/dagger.png","backend/items/equipment/hand/darknessWand.png","backend/items/equipment/hand/earthWand.png","backend/items/equipment/hand/fireWand.png","backend/items/equipment/hand/glaive.png","backend/items/equipment/hand/handAxe.png","backend/items/equipment/hand/lightningWand.png","backend/items/equipment/hand/natureWand.png","backend/items/equipment/hand/scimitar.png","backend/items/equipment/hand/sickle.png","backend/items/equipment/hand/spear.png","backend/items/equipment/hand/spikedClub.png","backend/items/equipment/hand/sword.png","backend/items/equipment/hand/waterWand.png","backend/items/other/cloth.png","backend/items/other/goldNugget.png","backend/items/other/wool.png","backend/calculation/Calculation.tsx","audio/AudioManager.tsx","backend/Demo.tsx","backend/calculation/TransformationTags.tsx","utils/CoreUtils.tsx","backend/PlayerContextListeners.tsx","backend/generic/DataStore.tsx","backend/generic/Identifiable.tsx","backend/timetick/OfflineTickListeners.tsx","backend/timetick/WarpTimeListeners.tsx","backend/timetick/TimeTick.tsx","backend/exploration/ExplorationStatus.tsx","backend/PlayerContext.tsx","backend/timetick/TotalTimePlayed.tsx","backend/events/EmptyEventMessage.tsx","backend/events/Events.tsx","backend/SaveData.tsx","backend/Retire.tsx","backend/spells/ElementsAndSchools.tsx","backend/UICommands.tsx","utils/Versioning.web.tsx","components/utility/Text.tsx","backend/Flags.tsx","backend/items/Items.tsx","components/utility/icons/IconUtils.tsx","components/utility/icons/GameIcon.tsx","components/utility/markdown/MarkdownIconPlugin.tsx","components/utility/Markdown.tsx","components/About.tsx","backend/Resources.tsx","backend/spells/Spells.tsx","backend/autocast/Autocast.tsx","backend/timetick/IncomeOverTime.tsx","utils/FormattingUtils.tsx","backend/items/Inventory.tsx","backend/timetick/TemporaryEffects.tsx","backend/actions/Action.tsx","backend/actions/Actions.tsx","backend/buildings/Buildings.tsx","backend/buildings/Building.tsx","backend/Quickbar.tsx","components/utility/Miscellaneous.tsx","components/utility/Button.tsx","components/utility/CostViewer.tsx","components/utility/PlusMinusAllocator.tsx","components/utility/ActionContainer.tsx","components/utility/Divider.tsx","components/utility/CategoryContainer.tsx","components/utility/UIContext.tsx","components/utility/ActionsContainer.tsx","components/utility/Picker.tsx","components/Autocast.tsx","components/Campus.tsx","backend/exploration/dungeons/Dungeons.tsx","backend/exploration/Creatures.tsx","components/creatures/CreatureMessageLog.tsx","components/utility/Card.tsx","components/Creatures.tsx","backend/Cleanup.tsx","backend/storylines/Storylines.tsx","backend/endings/Endings.tsx","backend/events/autorandom/RandomEventTrigger.tsx","backend/exploration/enemies/Enemies.tsx","backend/exploration/AttackListeners.tsx","backend/exploration/AttackTarget.tsx","backend/exploration/CombatStats.tsx","backend/exploration/PlayerDeathInterceptors.tsx","backend/exploration/Summoning.tsx","backend/exploration/summons/Summons.tsx","backend/exploration/Exploration.tsx","backend/hints/Hints.tsx","backend/items/Equipment.tsx","utils/Analytics.web.tsx","utils/GameAnalytics.tsx","components/Debug.tsx","components/Ending.tsx","components/events/EventList.tsx","components/events/EventMenu.tsx","components/events/EventOverlay.tsx","components/utility/ProgressBar.tsx","components/exploration/EnemyActionDisplay.tsx","components/exploration/HPBar.tsx","components/exploration/EnemyHPBar.tsx","components/exploration/EnemySpriteTile.tsx","components/utility/VisibilityContext.tsx","components/utility/ActiveMark.tsx","components/inventory/ItemTags.tsx","components/inventory/ItemTile.tsx","components/inventory/ItemInfo.tsx","components/inventory/ItemDetails.tsx","components/inventory/ItemGrid.tsx","components/inventory/InventoryItems.tsx","components/utility/SpellView.tsx","components/spells/FavoriteSpellsContainer.tsx","components/spells/SpellsContainer.tsx","components/utility/TemporaryEffectsViewer.tsx","components/exploration/QuickbarContainer.tsx","components/exploration/ExplorationBottomComponent.tsx","components/exploration/ExplorationProgressDisplay.tsx","components/exploration/PlayerActionDisplay.tsx","components/exploration/PlayerHPBar.tsx","components/exploration/PlayerMessageLog.tsx","components/exploration/SummonActionDisplay.tsx","components/exploration/SummonHPBar.tsx","components/exploration/SummonSpriteTile.tsx","components/Exploration.tsx","backend/help/Helps.tsx","components/utility/HelpContainer.tsx","components/Help.tsx","utils/FilesystemSave.web.tsx","components/utility/LoadGameContainer.tsx","components/Intro.tsx","backend/events/SimpleGameEvent.tsx","backend/events/EventMessageBuilder.tsx","backend/events/GameEvent.tsx","backend/events/campus/LevelUp.tsx","components/inventory/CraftingDetails.tsx","components/inventory/Crafting.tsx","backend/items/Item.tsx","backend/items/equipment/EquippableItem.tsx","components/inventory/EquippedItems.tsx","components/Inventory.tsx","components/main/BottomMenu.tsx","components/main/GameTickProcessor.tsx","components/main/ManaBar.tsx","components/utility/CombatStatsViewer.tsx","components/utility/ElementViewer.tsx","components/utility/ResourceViewer.tsx","components/main/Menu.tsx","backend/spells/Spell.tsx","backend/spells/conjuration/ConjureBuilding.tsx","components/Options.tsx","backend/research/Researchers.tsx","components/Research.tsx","backend/actions/campus/UseTimePiecesResearch.tsx","backend/events/storyline/MemoryChamber.tsx","components/Retirement.tsx","components/spells/SpellMenu.tsx","backend/secrets/Secrets.tsx","components/utility/SecretContainer.tsx","components/utility/SecretsContainer.tsx","components/utility/StorylineContainer.tsx","components/utility/StorylinesContainer.tsx","components/Stats.tsx","components/Strengthening.tsx","components/Upgrades.tsx","components/utility/BottomResourceViewer.tsx","components/utility/PlayerContextFreezer.tsx","utils/OrientationLockManager.web.tsx","AppContents.tsx","backend/actions/campus/GatherIron.tsx","backend/actions/campus/GatherMana.tsx","backend/actions/campus/GatherWood.tsx","backend/actions/campus/HireResearcher.tsx","backend/actions/campus/UseTimePiecesWarp.tsx","backend/buildings/campus/ApprenticeDorm.tsx","backend/buildings/campus/Furnace.tsx","backend/buildings/campus/LumberYard.tsx","backend/upgrades/Upgrade.tsx","backend/buildings/campus/Warehouse.tsx","backend/upgrades/storage/ReinforcedWarehouses.tsx","backend/upgrades/storage/ManaCrystals.tsx","backend/buildings/campus/ManaCrystal.tsx","backend/buildings/campus/ManaSpout.tsx","backend/buildings/campus/ManaGeyser.tsx","backend/buildings/campus/ManaShard.tsx","backend/buildings/campus/Mine.tsx","backend/buildings/campus/Monstruarium.tsx","backend/buildings/campus/ResearcherCabin.tsx","backend/buildings/campus/Vault.tsx","backend/buildings/campus/WaterTank.tsx","backend/events/campus/AutocastIntro.tsx","backend/events/campus/CraftingIntro.tsx","backend/events/campus/ExplorationIntro.tsx","backend/events/campus/Researcher.tsx","backend/items/other/LightweightChest.tsx","backend/events/campus/ShopIntro.tsx","backend/events/storyline/AlchemyLab.tsx","backend/exploration/enemies/Enemy.tsx","backend/exploration/enemies/schoolbasement/BasementBat.tsx","backend/exploration/enemies/schoolbasement/Mouse.tsx","backend/exploration/enemies/schoolbasement/Skeleton.tsx","backend/exploration/dungeons/DungeonFloor.tsx","backend/exploration/enemies/schoolbasement/AngrySheep.tsx","backend/exploration/enemies/schoolbasement/LittleDevil.tsx","backend/items/other/crystals/AirSpeck.tsx","backend/items/other/crystals/DarknessSpeck.tsx","backend/items/other/crystals/EarthSpeck.tsx","backend/items/other/crystals/FireSpeck.tsx","backend/items/other/crystals/LightningSpeck.tsx","backend/items/other/crystals/NatureSpeck.tsx","backend/items/other/crystals/WaterSpeck.tsx","backend/items/other/crystals/Crystals.tsx","backend/exploration/enemies/schoolbasement/Slime.tsx","backend/events/campus/DemoEnd.tsx","backend/exploration/enemies/schoolbasement/AncientHeadmaster.tsx","backend/exploration/enemies/schoolbasement/RedSlime.tsx","backend/exploration/enemies/schoolbasement/Zombie.tsx","backend/exploration/dungeons/schoolbasement/SchoolBasementB3.tsx","backend/exploration/dungeons/schoolbasement/SchoolBasementB2.tsx","backend/exploration/dungeons/schoolbasement/SchoolBasementB1.tsx","backend/events/storyline/EvocationIntro.tsx","backend/events/storyline/HeadmastersStaff.tsx","backend/events/storyline/LumberingExpertise.tsx","backend/items/other/BatWing.tsx","backend/items/other/RatTail.tsx","backend/events/storyline/MagicLibrary.tsx","backend/events/storyline/Statue.tsx","backend/spells/illusion/TimeDilation.tsx","backend/events/storyline/TimeRitual.tsx","backend/events/GameEventLoaderDemo.tsx","backend/events/campus/RepeatableCampusEvents.tsx","backend/events/campus/RandomOneTimeCampusEvents.tsx","backend/upgrades/other/WoolFarm.tsx","backend/upgrades/other/WoolFarmExpansion.tsx","backend/exploration/enemies/thundertower/EnchantedSheep.tsx","backend/upgrades/other/WoolFarmRemake.tsx","backend/exploration/enemies/wizardsarena/BlackSheep.tsx","backend/exploration/dungeons/farming/TheSpecialStockade.tsx","backend/exploration/dungeons/farming/TheMagicalPen.tsx","backend/exploration/dungeons/farming/TheCorral.tsx","backend/exploration/dungeons/Dungeon.tsx","backend/exploration/dungeons/farming/WoolFarm.tsx","backend/exploration/dungeons/schoolbasement/SchoolBasement.tsx","backend/exploration/enemies/schoolbasement/Mimic.tsx","backend/spells/conjuration/CreateStone.tsx","backend/spells/conjuration/CreateWater.tsx","backend/hints/HintLoaderDemo.tsx","backend/items/consumable/ConsumableItem.tsx","backend/items/consumable/DefensePotion.tsx","backend/items/consumable/HealthPotion.tsx","backend/items/consumable/ManaPotion.tsx","backend/items/consumable/MedicinalHerb.tsx","backend/items/consumable/SpeedPotion.tsx","backend/items/consumable/StrengthPotion.tsx","backend/items/consumable/VitalityPotion.tsx","backend/items/equipment/accessory/Cloak.tsx","backend/items/equipment/accessory/CloakOfRegeneration.tsx","backend/items/equipment/accessory/ClothShoes.tsx","backend/items/equipment/accessory/CrystallizedMana.tsx","backend/items/equipment/accessory/EnchantedCloak.tsx","backend/items/equipment/accessory/WoodenSandals.tsx","backend/items/equipment/body/ElderWizardRobe.tsx","backend/items/equipment/body/IronMail.tsx","backend/items/equipment/body/WizardRobe.tsx","backend/items/equipment/hand/AirWand.tsx","backend/items/equipment/hand/AssassinsDagger.tsx","backend/items/equipment/hand/Branch.tsx","backend/items/equipment/hand/Club.tsx","backend/items/equipment/hand/Dagger.tsx","backend/items/equipment/hand/DarknessWand.tsx","backend/items/equipment/hand/EarthWand.tsx","backend/items/equipment/hand/FireWand.tsx","backend/items/equipment/hand/Glaive.tsx","backend/items/equipment/hand/HandAxe.tsx","backend/items/equipment/hand/LightningWand.tsx","backend/items/equipment/hand/NatureWand.tsx","backend/items/equipment/hand/Scimitar.tsx","backend/items/equipment/hand/Sickle.tsx","backend/items/equipment/hand/Spear.tsx","backend/items/equipment/hand/SpikedClub.tsx","backend/items/equipment/hand/Sword.tsx","backend/items/equipment/hand/WaterWand.tsx","backend/items/other/Cloth.tsx","backend/items/other/GoldNugget.tsx","backend/items/other/Wool.tsx","backend/items/ItemLoaderDemo.tsx","backend/exploration/Doom.tsx","backend/exploration/Stunning.tsx","backend/timetick/TimePieces.tsx","backend/spells/conjuration/CreateBoulder.tsx","backend/spells/conjuration/CreateIronBar.tsx","backend/spells/conjuration/CreateIronOre.tsx","backend/spells/conjuration/CreateRock.tsx","backend/spells/conjuration/CreateWaterII.tsx","backend/spells/conjuration/CreateWaterIII.tsx","backend/spells/enchantment/EnchantFurnaces.tsx","backend/spells/enchantment/EnchantLumberYards.tsx","backend/spells/enchantment/EnchantManaGeysers.tsx","backend/spells/enchantment/EnchantManaSpouts.tsx","backend/spells/enchantment/EnchantMines.tsx","backend/spells/enchantment/Levitation.tsx","backend/spells/enchantment/Quickness.tsx","backend/spells/enchantment/Stoneskin.tsx","backend/spells/enchantment/Strength.tsx","backend/spells/enchantment/VigorOfHealth.tsx","backend/spells/enchantment/PhysicalAugment.tsx","backend/spells/CombatSpellBase.tsx","backend/spells/Utils.tsx","backend/spells/evocation/AirCutter.tsx","backend/spells/evocation/Blizzard.tsx","backend/spells/evocation/ConeOfFire.tsx","backend/spells/evocation/FireBall.tsx","backend/spells/evocation/Gale.tsx","backend/spells/evocation/IceNeedle.tsx","backend/spells/evocation/InfernalBlaze.tsx","backend/spells/evocation/Landslide.tsx","backend/spells/evocation/ManaSpike.tsx","backend/spells/evocation/RockTomb.tsx","backend/spells/evocation/Stalagmite.tsx","backend/spells/evocation/Twister.tsx","backend/spells/evocation/WaterBomb.tsx","backend/spells/illusion/Blur.tsx","backend/spells/illusion/BubbleShow.tsx","backend/spells/illusion/Dazzle.tsx","backend/spells/illusion/FlameShow.tsx","backend/spells/illusion/Getaway.tsx","backend/spells/illusion/MagicShow.tsx","backend/spells/illusion/RainbowShow.tsx","backend/spells/illusion/Slow.tsx","backend/spells/illusion/WindShow.tsx","backend/spells/protection/DispelSelf.tsx","backend/upgrades/exploration/HealthBoost.tsx","backend/upgrades/exploration/ExplorationTraining.tsx","backend/upgrades/exploration/InnateRegeneration.tsx","backend/upgrades/exploration/LargerHealthBoost.tsx","backend/upgrades/inventory/LargePouch.tsx","backend/upgrades/inventory/EnchantedPouch.tsx","backend/upgrades/research/ResearchFair.tsx","backend/upgrades/research/ResearcherFocus.tsx","backend/upgrades/research/ResearchPublication.tsx","backend/upgrades/storage/ReinforcedLumberYards.tsx","backend/upgrades/storage/ReinforcedWaterTanks.tsx","backend/upgrades/storage/ReinforcedVaults.tsx","DemoLoader.tsx","backend/actions/ActionLoaderDemo.tsx","backend/buildings/BuildingLoaderDemo.tsx","backend/spells/SpellLoaderDemo.tsx","backend/exploration/dungeons/DungeonLoaderDemo.tsx","backend/exploration/enemies/EnemyLoaderDemo.tsx","backend/upgrades/UpgradesLoaderDemo.tsx","backend/timetick/CommonTemporaryEffects.tsx","backend/secrets/SecretLoaderDemo.tsx","backend/help/HelpLoaderDemo.tsx","backend/MiscLoader.tsx","DemoMain.tsx"],"names":["module","exports","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","TransformationType","soundMap","menuClick","require","sampleMap","Audio","setIsEnabledAsync","Promise","all","audioId","audioSample","audioSound","Sound","loadAsync","this","replayAsync","demoMode","transformationDatabase","registerTransformation","tags","transformationId","transformationType","transformation","data","type","Set","flat","forEach","tag","forTag","some","preExisting","push","TransformationTags","getTransformationsThatApply","memoize","allTransformationsThatApply","filter","targetTags","every","targetTag","includes","uniqueTransformations","fromEntries","values","applyTransformations","state","startingValue","params","transformParams","transformations","afterPower","Power","reduce","prev","current","Math","pow","afterAddition","Addition","afterMultiplication","Multiplier","Override","clone","obj","JSON","parse","stringify","listeners","addContextListener","listener","clearContextListener","applyContextListeners","oldState","newState","transform","applyAllTransforms","transforms","length","accumulatedState","currentTransform","DataStore","store","maxId","value","toString","isIdentifiable","getId","OfflineTickListener","OfflineTickListeners","WarpTimeListeners","nextFrame","reject","requestAnimationFrame","registerTimeTickListener","processTimeTick","timeElapsedSec","isWarp","speedMultiplier","GameSpeed","timeElapsedSecAfterTransform","ExplorationStatus","WARP_TIME_PROCESSING_CONFIG_DEFAULT","secsPerTick","warpTimeProcessingConfig","initialState","secsTotal","lastProcessedTime","setPlayerState","currentState","getAll","getListener","onLoadingProgress","warpTimeSecs","secsProcessedSoFar","ticksProcessedSoFar","secsToProcess","min","EXPLORATION_INITIAL_STATE","currentHP","explorationStatus","None","explorationStartTime","currentDungeonFloorId","currentEnemy","currentSummon","undefined","successfulExplorationsPerFloor","playerActionProgress","summonActionProgress","enemyActionProgress","lastPlayerActionResult","lastEnemyActionResult","actionResultQueue","variables","EQUIPMENT_INITIAL_STATE","Hand","Body","Accessory","GLOBAL_INITIAL_STATE","secondsPlayed","flags","maxPrimarySchoolLevels","maxSchoolLevels","unlockedElements","Fire","Earth","Water","Air","unlockedSchools","Conjuration","Enchantment","Illusion","Alchemy","Evocation","Protection","Breeding","Summoning","Divination","researchersHiredLastRun","timeCapsulesLastRun","totalTimesResetted","targetFps","endingsTriggered","startTimestamp","Date","now","allowAnalytics","appVersionTimestamp","isFullVersionSave","Demo","isDemo","themeMode","hideEventTags","automaticallyBuiltBuildingsStartOff","enableSwiping","THIS_RUN_INITIAL_STATE","newFlagsOnRetirement","endingTriggered","PLAYER_INITIAL_STATE","resources","buildings","elementExperience","schoolExperience","schoolExponents","research","totalResearchers","researcherAllocation","schools","autocast","apprenticeAllocation","spellAutocastProgress","apprenticesPaused","loadouts","lastLoadoutUsed","creatures","totalCreatures","creatureAllocation","lastRewardTime","eventQueue","eventOccurrences","pityEnabledAtSeconds","pityCounter","nextEventIsManuallyTriggered","global","thisRun","temporaryEffects","recentSpellsCast","nextRandomEvent","primaryElement","primarySchool","inventory","equipment","exploration","explorationMessageLog","creatureMessageLog","lastSpellCastTimes","uiCommands","lastItemUsedTimes","quickbar","favoriteSpells","skipAheadTime","summoningBlockedUntilTime","strengtheningsBought","MaxHP","Attack","AttackDelay","Defense","HPRegen","Dodge","Accuracy","CritChance","PlayerContext","React","createContext","apply","overwrite","getTotalSecondsPlayed","getSecondsPlayed","EmptyEventMessage","eventMessages","getEventMessageById","gameEvents","registerGameEvent","event","getEventOccurrenceById","executeEventOccurrenceActionImpl","occurrenceId","selectedOption","nextMessage","messageHistory","currentMessageId","isTerminal","timestamp","timestampSecondsPlayed","executeEventOccurrenceAction","bind","addOccurrenceToQueueImpl","addOccurrenceToQueue","removeOccurrenceFromQueueImpl","position","lastIndexOf","splice","triggerEventImpl","extraTags","onTrigger","totalTags","getTags","shouldPopUpEventWithTags","unshift","eventOccurrenceId","eventId","getMainEventMessage","triggerEvent","gzipCompress","promisify","zlib","gzip","gzipDecompress","gunzip","jsonValue","AsyncStorage","getItem","makeCompatible","lastSaveDataTime","Number","parseFloat","saveDataUnsafe","setItem","deepmerge","loadBase64Data","saveData","decodedBuffer","Buffer","from","decodedJSON","decodedData","serializeSaveData","compressedJSON","SpellElement","School","retirementListeners","postRetirementListeners","registerRetirementListener","retire","isMock","listenerId","expTable","Map","getSchoolExp","school","getIncrementalExpRequiredForLevelAndExponent","level","exponent","Infinity","floor","getTotalExpRequiredForLevelByExponent","cachedExp","get","getExponentForSchool","primary","ExpRequirementScale","getIncrementalExpRequiredForLevel","getTotalExpRequiredForLevel","getLevelByExp","exp","getLevelByExpAndExponent","getSchoolLevel","grantSchoolExpImpl","amount","max","grantSchoolExp","getTotalElementAndSchoolExp","totalExp","selectPrimaryElementImpl","element","selectPrimarySchoolImpl","selectPrimarySchool","getUnlockedElements","unlockSchoolImpl","unlockSchool","getUnlockedSchools","Research","getMaxPrimarySchoolLevel","getMaxOfMaxPrimarySchoolLevels","maximumSchoolLevelResearchMultiplier","maxLevel","sumOfLevels","total","getSumOfMaxPrimarySchoolLevels","sqrt","maximumSchoolLevelProductionMultiplierDx","researchMultiplier","meetsRequirements","schoolRequirements","schoolName","Production","Loot","newMaxes","update","previousMax","newLevel","Cost","Spell","cachedExponents","set","getUICommands","addUICommand","command","getCurrentVersionTimestamp","Constants","expoConfig","extra","buildRunTimestamp","Text","memo","props","h1Style","styles","h1","h2Style","h2","h3Style","h3","h4Style","h4","StyleSheet","create","fontSize","hasFlag","flag","setFlagImpl","setFlag","clearFlagImpl","clearFlag","setGlobalFlagForNextRunImpl","setGlobalFlagForNextRun","setGlobalFlagImpl","setGlobalFlag","hasGlobalFlag","hasGlobalFlagIncludingNextRun","resetAllCombatVariables","items","registerItem","item","getItemById","getItemByIdNullable","getCraftableItems","isCraftingUnlocked","isCraftable","isInventoryUnlocked","getAllItemsEverCraftable","modifiedContext","sanitizeImageSourceForElectron","imageSource","default","icons","stone","wood","coins","mana","iron","water","boost","temperature","attack","attackDelay","defense","hp","hpRegen","monstium","debuff","generic","accuracy","dodge","timepiece","critChance","electricity","about","apprentices","campus","ending","help","options","retirement","stats","strengthen","upgrades","GameIcon","icon","style","otherProps","getPicture","computedStyle","width","height","small","Image","source","plugin","Plugin","match","utils","markdownItInstance","MarkdownIt","typographer","use","MarkdownIconPlugin","containerClassName","markdownRules","paragraph","node","children","parent","markdownStyles","View","index","markdownParagraph","getUniqueID","sourceMeta","Platform","select","imageStyleAndroidAttack","imageStyleAndroid","resizeMode","OS","ios","imageContainerStyleiOSAttack","imageContainerStyleiOS","imageStyleiOSAttack","imageStyleiOS","Markdown","replace","_substring","args","theme","useTheme","markdownit","rules","body","justifyContent","minHeight","lineHeight","color","colors","black","bullet_list_icon","marginTop","bullet_list","list_item","alignItems","heading2","markdownTextgroup","flexDirection","flexWrap","padding","margin","text","top","marginLeft","marginRight","alignSelf","right","About","versionText","versionNumber","android","web","container","explanation","explanationText","Resource","flex","spells","registerSpell","spell","getSpellName","getSpellByName","name","getVisibleSpellsBySchool","spellsBySchool","spellName","isVisible","getSchoolLevelRequirements","sort","a","b","getVisibleSpellsForSchool","extraLevels","fakeState","addRecentSpellCastImpl","recentSpellName","slice","setLastCastedTimeImpl","setLastCastedTime","removeFromFavoriteSpells","findIndex","isInFavoriteSpells","onTick","elapsedTimeSec","getApprenticeAllocation","allocatedApprentices","totalProgress","AutocastDelay","getAutocastProgressForSpell","isEnabled","doAction","isAutomatic","getAutocastSchoolLevelRequirements","autocastSchoolLevelRequirements","canAutocast","calculateApprenticeTotal","Apprentice","getFreeApprentices","apprenticesAllocated","allocateApprenticesToSpellImpl","currentAllocation","actualAmountToAllocate","allocateApprenticesToSpell","RESOURCES","Mana","baseCap","Coins","Stone","Wood","Iron","Temperature","Monstium","Electricity","getResourceInfo","resource","getSortedResourceKeys","indexOf","calculateResourceCap","resourceName","Cap","getResourceCap","resourceData","cap","recalculateCaps","newCap","getResourceAmount","grantResourceImpl","grantResource","IncomeOverTimeProducer","calculator","IncomeOverTimeProducers","calculateIncomePerSecond","producer","income","getCalculator","canApply","subResString","subResource","subResourceIncome","resString","existingIncome","formatNumber","num","showDecimals","abs","isInteger","toFixed","formatTime","secs","shortForm","unit","time","formatTimeLong","duration","asDays","hours","padStart","minutes","seconds","getInventory","getItemOccurrenceIndex","itemOccurrence","itemOccurrenceJSON","itemStack","calculateInventoryCap","InventorySlot","addToInventory","previousIndex","removeFromInventory","newAmount","getAmountOfItem","getTotalAmountOfItem","itemId","count","removeFromInventoryWithAnyParams","firstIndex","itemAmount","incomes","appliedTotals","ITEM_TAG_ORDER","ITEM_TAG_LAST_ORDER","hasTag","innerTag","sortInventory","aHasTag","bHasTag","ActionSubcategory","getTemporaryEffectEndTime","endTime","hasTemporaryEffect","getTemporaryEffects","effectName","temporaryEffect","isBeneficial","combatOnly","isEnemyTemporaryEffect","grantTemporaryEffectImpl","durationSec","mode","currentEndTime","newEndTime","dispellable","hidden","grantTemporaryEffect","clearTemporaryEffect","clearCombatTemporaryEffects","effect","ActionBase","getName","baseEffects","getBaseActionEffects","finalEffects","key","baseEffect","ActionEffect","action","Action","getCategoryTag","getAreaTag","subcategoryTag","getSubcategoryTag","getCategory","getSubcategory","getArea","cost","getCost","canAfford","actions","registerAction","getActionsForAreaByCategory","area","filteredActions","actionName","areas","isArray","category","registerBuilding","building","getBuildingName","getBuildingAmount","getBuildingAmountTurnedOn","turnedOn","changeBuildingsTurnedOnImpl","changeBuildingsTurnedOn","buildingAmountsChanged","BuildingActionBase","getResourceCost","currentAmount","baseCost","getBaseResourceCost","scale","getBaseResourceScale","finalCost","baseCostForKey","costScaleForKey","CostScale","ceil","buildingData","canTurnOff","QuickbarItem","occurrence","isActive","cooldown","getCooldownLeftSec","displayName","getPrimaryAction","doActionMemoized","mem","QuickbarActionImpl","getAction","getDisplayName","addActionToQuickbar","addToQuickbar","isInQuickbar","isQuickbarFull","removeFromQuickbar","stringifiedData","disabledColorByTheme","disabled","lighten","string","darken","LIGHT_ELEMENT_COLORS","Nature","Lightning","Darkness","DARK_ELEMENT_COLORS","showImportFromFile","elementColorByTheme","getPrimaryButtonTextColor","DescriptionViewer","grey1","EffectViewer","effectText","createGestureHandler","swipeLeftHandler","swipeRightHandler","leftGesture","Gesture","Fling","direction","Directions","LEFT","onEnd","success","translationX","rightGesture","RIGHT","Race","sharedTouchPosition","x","y","initialX","initialY","initialTimestamp","lastTimestamp","status","Manual","onTouchesDown","manager","allTouches","onTouchesMove","currentTimestamp","timestampDeltaSec","deltaX","deltaY","velocityX","onTouchesUp","numberOfTouches","onTouchesCancelled","fontWeight","Button","disabledTitleStyle","titleStyle","containerStyle","autoRepressConfig","enableAutoRepress","rest","disabledTitleStyleComputed","useMemo","pressed","useRef","disabledRef","currentRepressTimeout","currentRepressHandler","useState","flash","setFlash","useEffect","timeoutHandler","setTimeout","minTimeMs","clearTimeout","rePress","useCallback","onPress","dropoffMultiplier","onPressInCallback","startingRepressTime","startingThreshold","onPressOutCallback","titleStyleFlat","flatten","background","Version","TouchableNativeFeedback","Ripple","alpha","rgb","containerStyleFlat","opacity","disabledTitleStyleArray","onPressIn","onPressOut","title","ResourceRowMemo","row","inlineRow","costValue","error","CostViewer","playerContext","useContext","rows","resourceCost","resourceCap","resourceInfo","itemRows","itemCost","getDefaultParams","notMet","PlusMinusAllocator","disableMinus","disablePlus","onPressMinus","onPressPlus","minusButton","plusMinusAllocatorButton","plusMinusAllocatorButtonInner","iconContainerStyle","buttonStyle","plusButton","borderRadius","marginHorizontal","paddingHorizontal","paddingVertical","ActionContainer","showAddToQuickbar","isFree","capIsEnough","buildingAmount","buildingAmountOn","descriptionContainer","descriptionContents","getDisplayDescription","getDisplayEffect","descriptionTextContainer","collapsed","costContainer","turnOffContainer","amountActiveText","turnOnRow","turnOnQuantityContainer","plusMinusContainer","capTooLowColorBuilder","hsl","hue","capTooLowColor","saturationl","capTooLowBackgroundBuilder","capTooLowBackground","button","buttonTitle","buttonContainer","disabledStyle","backgroundColor","addToQuickbarButton","smallButtonTitle","quickbarButtonContainer","actionContainer","buttonRowContainer","buttonContainerView","showCompact","onPressExpand","TouchableWithoutFeedback","accessibilityLabel","expandContainer","Entypo","size","marginVertical","cursor","textAlign","fontFamily","buttonContainerSmall","capTooLowText","spellButtonTitleContainer","spellButtonTitleOnlyContainer","spellButtonCostContainer","spellManaIcon","Divider","divider","CategoryHeader","categoryTitle","categoryDivider","CategoryContainer","paddingTop","marginBottom","hairlineWidth","UIContext","getUIState","setUIState","useUIStateFromContext","context","initialValue","currentValue","stateValue","setStateValue","ActionCategoryContainer","categories","useSubcategories","subcategory","getActionsForAreaBySubcategory","visibleActionNames","actionContainers","expandedActions","setActionCallback","useButtonsWhenCollapsed","join","underCategoryPadding","idx","ActionsContainer","setExpandedActions","actionCategories","Picker","grey5","dropdownIconColor","dropdownIconRippleColor","Item","label","SpellRow","playerContextRef","currentExtra","canAllocate","hasFreeApprentices","applyAll","plusMinusAllocatorContainer","allocatorExtras","frequencyTextContainer","allocator","allocatorTemp","schoolReqs","allReqs","allocatorText","nameContainer","spellNameContainer","numberOfLines","spellRowContainer","Autocast","slotNumber","setSlotNumber","freeApprentices","toggleApprenticesPaused","loadoutsSlotPicker","i","onValueChange","selectedValue","totalCost","delayThreshold","getEstimatedApprenticeManaConsumptionPerSec","manaIncome","totalApprentices","setApplyAll","toggleApplyAll","apprenticeData","apprenticeDataContainer","borderTopColor","assignAllContainer","checked","textStyle","checkboxText","checkboxContainer","totalApprenticesContainer","manaCostContainer","apprenticeWarningContainer","warning","footer","loadoutsRow","loadoutRest","pickerContainer","loadoutButtons","allocation","saveLoadoutToPosition","parseInt","loadLoadoutFromPosition","spellsBySchoolJSON","listData","entries","renderItem","keyExtractor","renderSectionHeader","info","section","sectionList","SectionList","sections","initialNumToRender","ListFooterComponent","sectionListStyle","contentContainerStyle","sectionListInnerStyle","swipeHandlerGesture","onSwipeLeft","onSwipeRight","nativeGesture","Native","compositeGesture","Simultaneous","swipeHandlerGestureBottom","nativeGestureBottom","compositeGestureBottom","fullContainer","gesture","paddingBottom","paddingRight","topPickerContainer","emptySpaceHeader","spellContainersContainer","emptyCategoryTitle","betweenSpellsDivider","borderTopWidth","Campus","Dungeons","DungeonFloors","getUnlockedDungeons","dungeon","isUnlocked","isDungeonFloorCompletedThisRun","setDungeonFloorCompleted","floorId","pushToCreatureMessageLog","log","random","message","moment","format","isDungeonFloorValidForCreatures","dungeonFloorId","breedingLevel","dungeonFloor","getById","getBreedingLevel","canFightBoss","getBoss","getFreeCreatures","creaturesAllocated","allocateCreaturesToDungeonFloorImpl","allocateCreaturesToDungeonFloor","calculateCreatureCap","Creature","getFloorsAvailableForCreatures","getDungeonFloors","CreatureMessageLog","messageLog","ScrollView","nestedScrollEnabled","logItem","Card","DungeonFloorRow","hasFreeCreatures","floorNameText","getFloorName","plusMinusAllocator","singleFloorContainer","Creatures","dungeons","freeCreatures","Title","unlockedFloors","totalCreaturesContainer","creatureCapacityContainer","messageContainer","borderColor","borderWidth","cleanup","oldEventOccurrenceIds","eventOccurrence","Storyline","order","isCompleted","isBonusActive","hintDescription","getBonusDescription","isHintUnlockable","Storylines","getSortedStorylines","endingDatabase","getEndingData","randomEvents","isInPity","registerPity","nextPitySec","registerRandomEventTrigger","weight","isStorylineEvent","eligible","getParams","debugRandomEvents","eventsThatApply","randomEvent","totalWeight","sumToNow","RandomEventWeight","chancesPerEvent","loadRandomEventTriggers","elapsedSec","periodMultiplier","eventRoll","triggerRandomEvent","Enemies","getCurrentEnemy","AttackTarget","CombatStat","PlayerAttackListeners","EnemyAttackListeners","SummonAttackListeners","calculatePlayerMaxHP","Player","calculatePlayerAttack","calculatePlayerAttackDelaySec","calculatePlayerDefense","calculatePlayerHPRegenPerSec","calculatePlayerDodgeChance","calculatePlayerAccuracy","calculatePlayerCritChance","PlayerDeathInterceptors","hasCurrentActiveSummon","Summons","getCurrentSummon","lastSelectedEnemyAction","lastSelectedSummonAction","startExplorationOnFloor","startExploration","Exploring","startBossExploration","ExploringBoss","getExplorationStartTime","getCurrentDungeonFloor","getExplorationStatus","startCombatImpl","enemy","Combat","getMaxHP","getNextAction","summon","startCombat","getCurrentPlayerHP","getCurrentSummonHP","getCurrentEnemyHP","calculateDamage","calculateIsHit","hitChance","dodgeChance","hitOdds","modifyPlayerCurrentHP","modifySummonCurrentHP","modifyEnemyCurrentHP","calculateAttackTarget","Summon","calculateIsEnemyHit","forcedTarget","modifiedHitChance","Enemy","getDodgeChance","standardEnemyAttackEffect","isHit","damage","isCrit","target","AttackDamageReceived","getDefense","enemyAction","standardPlayerAttackEffect","hitChanceMultiplier","critChanceMultiplier","attackTags","playerAction","getLastPlayerActionResult","getSuccessfulExplorationsForFloor","pushToMessageLog","endExploration","getExplorationTimeRequirementSec","ExplorationDelay","getExplorationRequiredTimeSec","getSummonAttackDelay","delay","getEnemyAttackDelay","enemyDeathListeners","loadExploration","explorationTimeRequirement","nextExplorationTime","doFightBoss","outcome","doExplore","normal","attackDelayPlayer","attackDelayEnemy","attackDelaySummon","extraSec","executePlayerAutoAttack","newAttackDelay","executeSummonAction","executeEnemyAction","interceptor","Reviving","onDeath","hpRegenBase","hpRegenMultiplier","hintsDatabase","pushHint","hint","getFirstHintIndex","EquipmentSlot","canUnequipItem","slot","getEquippedItem","canEquipItem","unequipFromSlotImpl","unequipFromSlot","sendAnalyticsEventAsync","getBaseLogData","totalSecondsPlayed","currentPrimaryLevel","totalRetirements","currentHint","logAnalyticsEventGeneric","eventName","baseLogData","storyline","hintIdx","getCombatDimensions","handEquipment","bodyEquipment","accessoryEquipment","loadAnalytics","logStorylineCompleted","logNewHint","isBoss","logExplorationVictory","logExplorationDefeat","logRetirement","Debug","events","eventButtons","FlatList","newPlayerContextState","setNewPlayerContextState","overridePlayerContext","deserializedJSON","_oldState","transformDebugInput","setTransformDebugInput","transformDebugOutput","setTransformDebugOutput","calculate","output","explainTransformations","split","debugOutput","useThemeMode","result","getDocumentAsync","resultContents","FileSystem","uri","unserialized","console","warn","serializedData","openURL","directoryUri","dirInfo","exists","directoryCreateResults","intermediates","results","shareResults","shareAsync","dialogTitle","UTI","StorageAccessFramework","getUriForDirectoryInRoot","permissions","requestDirectoryPermissionsAsync","granted","permittedUri","fileName","saveDataUri","createFileAsync","setMode","AudioManager","play","testParam","removeItem","endingId","completedStorylines","totalTimePlayed","totalTimePlayedThisRun","totalRealWorldTimePlayed","primarySchoolLevelOnEnding","mpl","productionMultiplier","setGameEnding","onChangeText","onSubmitEditing","multiline","Row","rowCaption","caption","valueText","Ending","endingData","getEnding","totalDuration","thisRunDuration","totalRealDuration","allStorylines","description","dividerContainer","congratsContainer","minWidth","EventListItemMemoized","currentMessageData","getTitle","getDescription","Component","TouchableOpacity","Content","eventTitleContainer","isActionable","actionableIcon","EvilIcons","titleText","Chevron","prevProps","nextProps","EventList","sortedEvents","stringifiedEvents","terminalEvents","ongoingEvents","eventCategories","getFirstHint","categoryKeyExtractor","categoryRenderItem","emptyTitleContainer","MaterialIcons","titleIcon","hintContainer","hintContents","hintContentsText","progress","useNativeDriver","hintProgress","fontStyle","EventMenu","positionAnim","Animated","Value","visible","opacityAnim","timing","toValue","start","onBackgroundPress","backdrop","pointerEvents","translateX","eventList","backdropTouchable","EventOverlay","currentEventOccurrenceId","setCurrentEventOccurrenceId","processUICommand","uiCommand","setCurrentLookbackMessageId","processUICommands","currentEventOccurrenceIdRef","currentLookbackMessageId","newEventOccurrenceId","eventsToRemoveFromQueue","pop","eventToRemove","removeOccurrenceFromQueue","eventMessage","optionDescriptions","totalText","messageInLookbackIdx","messageLength","totalMessageCount","getAllowedOptions","option","useWindowDimensions","disabledIconColor","onRequestClose","disableBackArrow","disableForwardArrow","overlayStyle","overlay","maxWidth","backdropStyle","overlayContainer","overlayCloseButton","overlayCloseButtonInner","titleContainer","titleTextContainer","historyContainer","historyButton","optionRow","optionButton","ProgressBar","progressBar","EnemyActionDisplay","currentEnemyAction","getEnemyActionProgress","progressBarContainer","CombatActionResultDisplay","auxText","auxTextStyle","auxTextCritical","auxTextDamage","auxTextHealing","damageAnim","setValue","sequence","spring","bounciness","auxTextContainer","translateY","HPBar","mountTime","actionTarget","actionKeys","actionResults","lastTime","displays","actionIdx","hpBarForeground","unfilledColor","hpBarBackground","empty","overlaidText","left","EnemyHPBar","inCombat","maxHP","EnemySpriteTile","LinearGradientComponent","LinearGradient","sprite","tile","backdropColor","gradient","image","placeholderStyle","VisibilityContext","ActiveMark","activeMark","ItemTags","tagRow","tagStyle","grey0","tagTextStyle","white","ItemTile","inner","grey4","badgeStyle","ItemInfo","getEffect","itemDetailsContainer","main","ItemDetailsAction","pressedOnce","setPressedOnce","requireConfirm","actionButtonContainer","ItemDetails","disableSelling","getSaleAction","showQuickbar","getQuickbarAction","itemInfo","actionRow","ItemGrid","dummySlots","dummySlotAmount","scrollView","gridContainer","itemGridElement","onPressItem","maxHeight","InventoryItems","selectedIndex","setSelectedIndex","itemGridElements","selectedItemOccurrence","emptySlots","selectedIndexRef","oldInventory","newInventory","oldSelectedItemOccurrence","newSelectedItemOccurrence","itemDetails","detailsContainer","isFullBleed","detailsContainerPadding","SpellViewMemoized","spellElement","getElement","elementText","elementContainer","elementTextContainer","primaryElementText","spellElementBadgeText","cooldownContainer","getCooldown","cooldownText","toggleFavorite","addFavoriteSpell","favoritesButton","Ionicons","buttonTitleStyles","spellDisplayName","spellCost","isMinimal","toggleCollapsed","display","descriptionRow","SpellView","disabledActionText","FavoriteSpellsContainerInside","getFavoriteSpells","spellViewContainer","deleteButton","deleteButtonInner","hitSlop","bottom","FavoriteSpellsContainer","SpellsContainerInside","uiContext","currentSchoolKey","uiKey","currentSchool","setCurrentSchool","expandedSpells","setExpandedSpells","expandedSpellsRef","setCurrentSchoolCallback","fullSpellString","allSpellString","currentSchoolSpells","boundToggleCollapsed","spellActionContainers","onlyBySchool","spellArray","spellSchoolPicker","picker","expandContractAll","expandedSomething","showNUX","SimpleLineIcons","magicWand","schoolRowContainer","tagPickerContainer","nuxText","schoolContainer","noSpellsContainer","noSpellsText","SpellsContainer","hideRecent","spellsContainer","schoolButton","schoolTitleContainer","schoolTitleTextContainer","TemporaryEffectRowMemo","boostText","TemporaryEffectsViewer","isEnemy","QuickbarActionContainer","quickbarAction","getTransform","toQuickbarData","enabled","active","mainButton","QuickbarContainer","quickbarData","emptyText","mappedActions","mainContainer","actionsContainer","infoContainer","ExplorationBottomComponent","openedTab","setOpenedTab","mainComponent","mainScrollView","quickbarScrollView","tabsContainer","tab","selectedTab","borderTopLeftRadius","borderTopRightRadius","ExplorationProgressDisplay","PlayerActionDisplay","getPlayerActionProgress","PlayerHPBar","PlayerMessageLog","SummonActionDisplay","currentSummonAction","getSummonActionProgress","markdownContainer","idleTextContainer","SummonHPBar","SummonSpriteTile","ExplorationRow","isBossUnlocked","isFloorCompleted","noneRow","noneFloorText","noneStatusRow","noneIcon","ExplorationDungeon","noneDungeonContentsContainer","ExplorationNone","allDungeons","noneContent","topRow","ExplorationMain","dungeonTitle","currentEnemySprite","toUnlockBoss","getExplorationSuccessesForBoss","currentEnemyName","checkmark","hasBoss","canMoveToNextFloor","getNextFloor","explorationStatusContainer","centerContent","ActivityIndicator","hasActiveSummon","currentSummonSprite","getBackdropColor","topContainer","enemyContainer","playerContainer","summonContainer","runAway","unlockBossContainer","unlockBossTextContainer","exitButtonContainer","wholeContainer","arrowBack","restOfScreen","playerMessageLogContainer","bottomComponentContainer","Exploration","moveRow","dungeonButton","Helps","HelpContainer","descriptionViewer","helpContainer","topRowContainer","disabledStorylineText","HelpsContainer","expandedHelp","setExpandedHelp","setHelpCallback","allHelps","helpNameString","helpContainers","Help","headerContainer","valueTextLong","captionText","LoadGameContainer","loadMessage","setLoadMessage","loadSaveContents","setLoadSaveContents","loadSaveFromDeserializedData","deserializedData","importSavefile","showByFile","importSavefileFromFile","loadSaveFromFile","inputContainerStyle","inputContainer","loadInputContainer","loadMessageContainer","importByFileContainer","Intro","selectedSchoolIndex","setSelectedSchoolIndex","selectedElementIndex","setSelectedElementIndex","elements","selectedMPL","isFirstTime","showLoadGameContainer","loadText","primarySchoolText","topView","topViewText","borderBottomWidth","buttonGroupContainer","buttonGroupText","vertical","buttons","mplText","startButton","selectedSchool","selectedElement","selectPrimaryElement","SimpleGameEvent","onTriggerTransform","createGameEvent","CONFIRM_OPTION","replaceWithParams","isNaN","replacement","EventTag","EventMessageImpl","EventMessageBuilder","setDescription","EventMessageBuilderDeluxe","eventBuilder","newMessageId","paramsOrNextMessage","build","EventBuilder","messages","lastMessageId","builder","buildRecursive","messageBuilder","optionStub","nextMessageBuilder","buildEvent","buildEventMessage","getConcatenatedRequirementsForCraft","requirements","getCraftingSchoolLevelRequirements","getMarkdownTextForSpell","getConcatenatedRequirements","getMarkdownTextForCraftableItem","loadLevelUpEvents","setSimpleDescription","LEVEL_UP","levelUpLearnedSpells","oldSpells","newSpells","diffSpells","newSpellText","extraSpellText","newSpellsLearnedText","getLevelUpLearnedSpellsText","oldCrafts","newCrafts","levelUpLearnedCrafts","oldItems","newItems","diffItems","newCraftsText","extraItemsText","newCraftsLearnedText","getLevelUpLearnedCraftsTextForSchool","levelUpLearnedFloors","oldFloors","newFloors","diffFloors","newFloorsText","extraFloorsText","newFloorsLearnedText","getLevelUpUnlockedFloorsForCreaturesText","LEVEL_UP_EMPTY","LEVEL_UP_FIRST_FIFTEEN_MINS","CraftingDetails","generateCraftedParams","totalOwnedText","getCraftingMaterials","canCraft","hasCraftingMaterials","inventoryFull","cannotCraftText","craftCallback","craft","craftingDetailsContainer","inventoryFullContainer","Crafting","selectedTag","setSelectedTag","craftableItems","tagSet","add","Array","oldCraftable","newCraftable","oldSelectedItem","newSelectedItem","tagButtons","find","n","hideLocked","setHideLocked","toggleLockedCallback","itemGridElementsJSON","isAnyLocked","itemGridElementsFiltered","itemGridElementsFilteredJSON","selectedItem","itemGrid","details","buttonGroupButtonContainer","saleAction","sellingUnlocked","salePrice","totalAmount","totalCoins","cacheKey","ItemBase","_state","_params","base","getBaseName","itemQuality","getBaseItemEffects","itemTag","ItemEffect","getSalePrice","addItemToQuickbar","materials","fitsInInventory","inventoryLength","inventoryCap","getCraftingMaterialsBase","baseAmount","ItemCost","ItemQuality","memoizedEquip","equipToSlot","EquippableItem","getSlot","randomId","generateEquipmentCraftedParams","getEffectBase","bonuses","getAttackBonus","getDefenseBonus","getMaxHPBonus","getHPRegenBonus","manaRegen","getManaRegenBonus","maxMana","getMaxManaBonus","getAttackDelayBonusPct","getPlayerAccuracyBonusPct","getPlayerDodgeBonusPct","getPlayerCritChanceBonusPct","bonusStrings","stat","prefix","bonusEffect","getEffectExtra","bonusString","forEachEquippedItem","each","additiveTransform","bonusFn","bonus","pctMultiplicativeTransform","totalMultiplier","EquippedItemSlot","equippedItem","unequipAction","getUnequipAction","equipmentRow","onPressEquippedItem","labelStyle","EquippedItems","slotComponents","register","totalIncome","capBonus","maxManaBonus","shouldRecalculate","equipmentSlot","oldItem","newItem","Inventory","isCrafting","setIsCrafting","sortInventoryCallback","handler","BackHandler","addEventListener","remove","fullBleedPadding","topButtons","sortButtonText","craftButton","equippedItemsContainer","SelectedContext","MenuComponent","shouldHighlight","itemContainerStyle","toLowerCase","itemStyle","BottomMenu","showResearch","showAutocast","showInventory","showExploration","showRetirement","showUpgrades","showCreatures","showStrengthening","showEnding","navigationPressCallback","onNavigationPress","menuItems","callbacks","orientation","scrollEnd","setScrollEnd","scrollStart","setScrollStart","onScroll","nativeEvent","contentOffset","isStart","isEnd","contentSize","layoutMeasurement","flatListBackgroundStyle","scrollContentContainer","bottomMenuContainer","chevron","Provider","selected","horizontal","snapToInterval","scrollContainer","scrollEventThrottle","overScrollMode","showsHorizontalScrollIndicator","spellButtonPlaceholder","navigationBlock","spellMenuButtonPlaceholder","overflow","GameTickProcessor","lastTickTime","setLastTickTime","warping","setWarping","timeTickCallback","nowTime","lastTickTimeConsidered","processWarpTime","processOfflineTicks","cleanupCallback","gameSpeed","interval","setInterval","ManaBar","manaCap","ratioFilled","filledAnim","incomeText","filled","scaleX","textOverlay","CombatStatsRowMemo","hideText","CombatStatsViewer","SchoolRowMemo","isPrimary","primaryText","currentExp","toNextLevel","SchoolViewer","isCapped","cappedResource","hideIncome","ResourceViewer","resourceKeys","hasAnyIncome","topDivider","others","navigationRowTitle","MenuContents","navigation","showDebug","hasTemporaryEffects","isSpeedingUp","hasTimePieces","TimePieces","timePieceButtonTitle","timePieceButtonContainer","statViewer","Menu","zIndex","SpellActionBase","_tagArray","_manaCostTags","_cooldownTagArray","getManaCost","lastCastTime","secTillOver","SpellCooldown","getBaseCooldown","CanCastSpell","addRecentSpellCast","doSpellAction","validActions","getValidActions","FPS_DATA","useEventTagToggle","Options","copyToClipboard","Clipboard","targetFpsChange","swipingToggle","darkModeToggle","conjureBuildingAutoOffCallback","eventTagLevelUpFifteenMinutesToggle","eventTagLevelUpEmptyToggle","eventTagLevelUpAllToggle","eventTagInconsequentialRandomEventsToggle","INCONSEQUENTIAL_RANDOM_EVENT","eventTagEarlyGameEventsToggle","EARLY_GAME","eraseText","setEraseText","eraseGame","saveToFileCallback","saveToFile","categoryContainer","targetFpsContainer","targetFpsDropdownContainer","targetFpsPicker","eventPopupsContainer","ConjureBuilding","saveButton","sliderContainer","sliderTextContainer","expPerSec","getResearcherExpPerSecForSchools","totalExpPerSec","allocatedResearchers","researchRatePerResearcher","getBaseResearchRate","getFreeResearchers","researchersAllocated","allocateResearchersToSchoolImpl","allocateResearchersToSchool","grantNewResearcherImpl","grantNewResearcher","calculateResearcherCap","Researcher","ResearchRow","hasFreeResearchers","schoolLevel","schoolText","singleSchoolElementContainer","schoolTextContainer","rightHandSide","freeResearchers","bottomSection","researcherCapacityContainer","timePiecesPerResearchSecond","TimePiecePerResearch","getActionEffects","transformedSecs","expPerResearcherPerSec","memoryChamberEventBuilder","STORYLINE","calculateMemoryChamberExplorationMultiplier","setOnTrigger","createMessage","addOption","ExplorationBossRequirement","isDungeonFloorEverCompleted","expToGrant","memoryChamberEvent","Retirement","newResearchMultiplier","newProductionMultiplier","oldResearchMultiplier","oldProductionMultiplier","researchDeltaPct","productionDeltaPct","newStorylines","memoryChamberMessage","completedMemoryChamber","completedUpgradedMemoryChamber","memoryChamberMultiplierBefore","memoryChamberMultiplierAfter","memoryChamberMultiplierDeltaPct","storylineBonusMessage","hasClicked","setHasClicked","showTimePiecesWarning","UseTimePiecesResearch","showOngoingEventsWarning","SpellMenuContents","magicContainer","SpellMenu","SecretType","Secret","secretType","isUnlockable","_isCompleted","SecretsByType","Basic","SecretContainer","secret","iconContainer","iconName","grey3","SecretsContainer","secrets","secretDisplays","secretDisplay","StorylineContainer","isSecretUnlocked","effectContainer","effectSubcontainer","storylineContainer","StorylinesContainer","expandedStoryline","setExpandedStoryline","setStorylineCallback","storylineName","storylines","storylineNameString","storylineContainers","StatsSingleSchool","allSchoolLevels","eachSchool","newSpellsText","thisLevelSpells","thisLevelCrafts","currentSchoolLevel","nextUnlockLevelAdd","foundNewSpellsOrItems","extraSpells","extraCrafts","nextLevelSpells","nextLevelCrafts","newUnlocks","nextLevelRequiredExp","researchEstimate","insideBlock","StatsSchoolViewer","activeSection","setActiveSection","perSchool","schoolElementContainer","StorylineViewer","StatsOtherViewer","totalRealWorldDuration","thisRunRealWorldDuration","Stats","hasSecrets","Strengthening","Upgrades","ResourceItemMemo","BottomResourceViewer","filteredResourceKeys","PlayerContextFreezer","OrientationLockManager","load","lightCommonColors","grey2","darkCommonColors","primaryColorsByElement","Default","lightColors","darkColors","memoizedThemes","ThemeUpdater","fullTheme","replaceTheme","IntroContents","statusBarProps","translucent","barStyle","maxContainer","borderBottomColor","centerComponent","SafeAreaView","safeAreaContainer","biggerContainer","introContainer","ThemeProvider","prototype","shouldComponentUpdate","nextState","render","stringified","memoizedTheme","updateTheme","SCROLLABLE_SECTIONS","MainAppContents","menuShown","setMenuShown","rightMenuShown","setRightMenuShown","setSection","onMenuPress","onEventMenuPress","onSpellMenuPress","ongoingEventCount","hasFourColumns","hasTwoColumnsOrMore","hasThreeColumnsOrMore","showBottomResourceBar","centerText","bottomOpacityAnim","scrollViewRef","swipeHandlerGestureExploration","nativeGestureExploration","compositeGestureExploration","scrollPositions","setScrollPositions","scrollValue","scrollTo","animated","mainSection","wrapInSection","component","sectionTitle","ref","contentsWide","horizontalContainer","webMenuContainer","webRightMenuContainer","contents","mainContainerPhone","paddingLeft","borderLeftWidth","headerContainerStyle","menuButton","eventButton","rightHeaderContainer","rightHeaderIcon","notificationsBadge","leftComponent","rightComponent","OfflineProgress","offlineProgressContainer","currentTicks","totalTicks","Loading","loadingAnim","easing","Easing","out","poly","initialMetrics","initialWindowMetrics","StatusBar","App","playerState","localUiState","setLocalUiState","processingBigTime","setProcessingBigTime","setTotalTicks","setCurrentTicks","uiContextValue","loading","setLoading","playerStateRef","playerContextValue","loadedState","loadData","fetchData","storeData","useTransition","setTransition","createTheme","shouldShowIntro","showIntro","setShowIntro","centerAligned","headerPadding","gestureRecognizer","menuContainer","GatherIron","ManualGathering","Gather","GatherWood","fractionAddedPerResearcher","timePiecePerWarpedSec","TimePiecePerWarpedSec","totalSecs","apprenticeDorm","Housing","tournamentEventBuilder","tournamentEvent","eventBuilt","furnace","Consumption","temperatureCap","PerBuildingCap","effects","furnaces","woodBase","lumberYard","lumberYards","Upgrade","getMonstiumCost","getItemCost","itemsRequired","isPurchased","getUpgradeRequirements","requirement","isVisibleExtraChecks","warehouse","Storage","resourceEffectMap","calculateStoneCapIncrease","calculateWoodCapIncrease","calculateIronCapIncrease","reinforcedWarehouses","manaCrystals","manaCrystal","manaSpout","manaGeyser","ManaSpout","manaShard","mine","mines","monstruarium","calculateMonstiumCapIncrease","researcherCabin","maxResearchers","vault","calculateVaultCap","Warehouse","waterTank","calculateWaterTankCap","LightweightChest","alchemyLabEvent","Furnace","getBaseStats","getAttackDelay","getAttack","getCriticalChance","isFromCreatures","baseCoinsAwarded","getCoinsAwarded","baseMonstiumAwarded","getMonstiumAwarded","coinsAwarded","FromCreatures","FromExploration","monstiumAwarded","getItemsAwarded","enemyLoot","chance","LootChance","fitsInInventoryText","Skeleton","skeletonDefeatedEvent","encounterEnemy","breeding","DungeonFloor","_getExplorationSuccessesForBoss","possibilities","getExplorationPossibilities","possibility","explorationRoll","boss","LittleDevil","generateSpeckForState","FireSpeck","EarthSpeck","WaterSpeck","AirSpeck","NatureSpeck","LightningSpeck","DarknessSpeck","headmasterDefeatedDemoEvent","AncientHeadmaster","headmasterDefeatedEvent","headmasterDefeatedUnder15MinutesEvent","schoolBasementB3","AngrySheep","Zombie","RedSlime","thirdFloorBossUnlockedEvent","SchoolBasementB3","Mouse","BasementBat","Slime","SchoolBasementB2","evocationEvent","SchoolBasementB1","lumberingExpertiseEventBuilder","lumberingExpertiseEvent","finalMessage","magicLibraryEvent","RatTail","BatWing","statueEvent","timeDilation","TemporaryEffectDuration","timeRitualEventBuilder","TimeDilation","OfflineTimePieceGain","timeRitualEvent","loadGameEventsDemo","AutocastIntro","CraftingIntro","ShopIntro","ExplorationIntro","HeadmastersStaff","staffEventBuilder","Vault","coinCost","stoneCost","loadRepeatableCampusEvents","crystalBallEvent","boughtMessage","rejectMessage","loadRandomOneTimeCampusEvents","woolFarm","woolFarmExpansion","woolFarmRemake","bookOfDivineKnowledge","BlackSheep","EnchantedSheep","TheSpecialStockade","TheMagicalPen","Dungeon","TheCorral","mimic","mimicEventOccurrence","mimicEventMessage","mimicEvent2","CreateStone","loadHintsDemo","CreateWater","memoizedPrimary","cooldownLeft","numberInInventory","isStunned","doConsumableItemEffect","ConsumableItem","getCooldownSec","quality","getItemEffects","commonBuff","magnitude","TemporaryEffectMagnitude","healAmt","actionResult","ActionMagnitude","medicinalHerb","concat","AttackDelayMultiplier","batWing","ratTail","cloth","cloak","crystallizedMana","elderWizardRobe","WizardRobe","wizardRobe","airWand","airSpeck","assassinsDagger","branch","club","darknessWand","darknessSpeck","earthWand","earthSpeck","fireWand","fireSpeck","glaive","lightningWand","lightningSpeck","natureWand","natureSpeck","scimitar","spikedClub","waterWand","waterSpeck","wool","loadItemsDemo","ManaPotion","CrystallizedMana","Club","Dagger","HandAxe","IronArmor","Spear","Sword","ElderWizardRobe","MedicinalHerb","HealthPotion","StrengthPotion","SpeedPotion","Wool","Cloth","Cloak","EnchantedCloak","CloakOfRegeneration","WoodenSandals","ClothShoes","GoldNugget","Sickle","DefensePotion","VitalityPotion","loadDoom","TEMPORARY_EFFECT_DELTA","loadStunning","PostStunProtectionDuration","timePieceEvent","timePieceEventFirstTime","timePieceGranter","oldTimePieces","enchantFurnaces","enchantLumberYards","LumberYard","EnchantManaGeysers","ManaGeyser","enchantManaGeysers","enchantManaSpouts","EnchantMines","Mine","enchantMines","levitation","quickness","stoneskin","strength","vigorOfHealth","hpEffects","defEffects","atkDelayEffects","atkEffects","CombatSpellBase","getStandardRangeEffectText","average","variance","getStandardAttackEffectText","getStandardAirAttackEffect","getStandardWaterAttackEffect","slowDuration","getStandardFireAttackEffect","dotDuration","commonDoTAmount","dotStrength","getStandardSpellAttackEffect","ActionVariance","extraEffect","blur","dazzle","getaway","slow","healthBoost","explorationTraining","innateRegeneration","largerHealthBoost","largePouch","enchantedPouch","researchFair","HireResearcher","researcherFocus","researchPublication","reinforcedLumberYards","reinforcedWaterTanks","reinforcedVaults","loadAllDemo","setDemoMode","GatherMana","UseTimePiecesWarp","ManaShard","ManaCrystal","Monstruarium","WaterTank","ResearcherCabin","ApprenticeDorm","CreateRock","CreateBoulder","CreateWaterII","CreateWaterIII","CreateIronOre","CreateIronBar","EnchantManaSpouts","EnchantLumberYards","EnchantFurnaces","VigorOfHealth","Stoneskin","Quickness","Strength","Levitation","PhysicalAugment","MagicShow","WindShow","BubbleShow","FlameShow","Getaway","Blur","RainbowShow","Dazzle","Slow","ManaSpike","FireBall","ConeOfFire","InfernalBlaze","Stalagmite","RockTomb","Landslide","IceNeedle","WaterBomb","Blizzard","AirCutter","Gale","Twister","SchoolBasement","WoolFarm","totalValue","DispelSelf","isSpellAttack","registerRootComponent"],"mappings":"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","file":"static/js/app.c6f43291.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/click.790b3c0f.wav\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///8wKzuFnqGuw75XZGkUFSn///9rnbxSAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAX0lEQVQoz73OwQ3AMAgDQFbwCl4hK3gF9l+lkKp5tHE/leoXnARyxH/BzAuAo0LBgsYZCyDVR/SgKeQld0j1TYVMA92LUJW3UMV6lQxEj8hyOJgj1s8NRPaaufYnfMwBfSomp3LRKswAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/wood.d9ecccf0.png\";","module.exports = __webpack_public_path__ + \"static/media/coins.d53016da.png\";","module.exports = __webpack_public_path__ + \"static/media/mana.647cb04d.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///8zO08UFSmuw75ug5D///914ehsAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAZ0lEQVQoz62OwQ3AMAgDWcEreAVWYP+ZSghtJErST3kg3SnGEflzAJ4FVI0nEUzuxWC/uheTsTJVABb8hKoAPWHOd3EVUDqbc0aqQPyZnHflLaKSxHpQRVQyi6UXFmJs6cWY3L34nAu44ClxNouvIQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/water.9e69c784.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///8VZEQUFSm58IZjvyP////Gb/X2AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAUUlEQVQoz73O0QkAIAgE0FZwhVvBFdx/prQIVKT6iO7vHojX2rsQDkDM2IJ2CZLBunjJYJ3gJMPo+lavUAOA+VZTw+UOkbTDw+phRwC41PAhHUroIs3wrrJaAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX/////KzyaBAT/pgBhIz7/6Xb///+xkIV3AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAWElEQVQoz63OQQlAMQwD0FiIhVqIhVqofyu/u/wNCtllueVBQ4GX4QWCV5AHLggHQJaFQDYcMoHJohyIKhXTQXX26oCUap0Y4ALt0Qn9lxR/n4CMztEnuHwVpR5JAdiDWwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/attack.28dc7456.png\";","module.exports = __webpack_public_path__ + \"static/media/attackDelay.e1c1436c.png\";","module.exports = __webpack_public_path__ + \"static/media/defense.c8a95e19.png\";","module.exports = __webpack_public_path__ + \"static/media/hp.7245ec10.png\";","module.exports = __webpack_public_path__ + \"static/media/hpRegen.aab27f85.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///9AN0sdGimkPOpgM7vSg+P///+zG2b1AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAY0lEQVQoz73Q0QkAIQwD0K6QFbJCVsgK7r/KWQ9Eeurn9a8PSkIjfhwAvAIkmxdAa12WowMYR4ClATwAMVbPchXY/IL7KbegDB0iYQfBpI6eKRWyGDKTS/UCcnlohWDZv3CdB9mJJoU/PIJRAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///+aBAQUFSn/pgD/Kzz///9+b5d3AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAVElEQVQoz73OwQ3AIAxDUa/ACl6hK2T/mZoIECWRxaESX+LgdyHApdqKAp6RmQAX6xECphAC4r8QegJ8+aOtOxJ0Ybpjg+MdUz67Qsi2K6ClXeFPL24iIiN4fISOAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///8UFSlhIz6YUEbGiGKNqJ/k6Nr////hfI/wAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAcklEQVQoz43R0RHAIAgDUFfIClkhK7iCK7D/CAWvPT2qtvnjfQBiKb8DEHsA6bWGZED1Gqp7oGpE2IL387BNQxIUNDNrPAB9Kc67Z/CxknVcA32nGvBIhnvxb1A0XQO69OdhDXFizfUb4o/ibRgnzHDOBSvxMSXp6jiwAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABHElEQVRYR+2WzRGCQAyFgQbAm9qFR4ZSrAGKoQQK8cZw9EgF/tyACnTYmRz2YcyyjoQDXBxIIO99SYQwUD5C5frBJsCZwC3PX9/aFVWVFT4Mg9OznZLGJ6sJeMSxcb7v+1nz+kwSky+REAmoCSDkx7K0nN+LwjrH3iMpiQRLQE0AV5ickH3OKcbbtjWXdmn6cSYmBNQF4NBJznE1ML9rmnkEVivAt+dE4JplhsS566y2T2aAI7B6AeSUZoKmfjECfxfA7T/tOTq/RJG5dKpr8/vzDKgJoMLcfkvOKe5NYHEBVJB7DSMJyseeS84pzr4N1QUgCVwz6fOI6zne5/xFpCYASVCvJQL4n8/liwRWI0By7Bt3JuBbQLpvE/AGFlceMMXqLnoAAAAASUVORK5CYIIA\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///+58IYUFSk1QEhjvyP///8Ouw5/AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYklEQVQoz6XP2wnAMAxDUa+gFbTCXcH7z1S3hLakeXxUhGAfCCgRLYou6tcVqIEWoBvnEHuwn3JDsOQVxAYqkIbXZ3sgVUmmQIJUz5hADSavizGcvdJ1Xj0+gGzxD1wLHsMBx4cZgVLbW7UAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJFBMVEX///8aJSxTFBSzdUtyExOaVACdnJzf3tJFU3d8boEUFSn////cm99fAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYElEQVQoz63QQQ3AMAiFYSxgYRZqAQtYqAUszEItVOXeSNcsZPTS/Te+E0D0V3wgXgAXj1PgIopkSgTM1VB95AvMTsg2tLYAFfNEcxiLZXCLp/PaCBDv9bEI1DsjWsBeF2U/RKsn+RQvAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX/////pgAUFSk1QEirWlP///9PTK/7AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAbUlEQVQoz33OgQ3AIAgEQFb4FX6FX4H9ZyrYNkFRiUG8hPhmb8GWwvpAxQY5YdqaAHUhHw3+XoYGo8gl6QSSEWDeexCkBMVwBJcz2hEcX/kB4rs0V8mxQAQXoBq+gzPODQQSusDIrCIdqK9t4AFICR0XUBjz/wAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///+rWlNhIz7/9xn/pgD///+yX7YvAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAATElEQVQoz63NsREAIAgDQFZghazACuw/k9gJ4bDQdPkzKPItGsEMZnYFH0G9PnBeKDBALPJRAkQ3lQmA/C3BvnouOiiLDnJnQOkMb1lFoBIROsgdbwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX///9AN0v///YUFSn///+DOuRfAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAHklEQVQoz2NgGAWYQBAC8AkoGYMgPgFjMMQjMBQAAAS8BMlgeYEGAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAIVBMVEX///8jMJ0QWKgUsvoEjfkdGilhIz7/8bG7Z0n/uTX////hqLpHAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAhUlEQVQoz5XPUQ0EMQgEUCyMhbGABSxgAQtnoRbW7Q3b+9q2m9x8NOGlBWr2TwC8AugR+QKlmqgz1Gd0fdUOSCRj6EXafeEJjADDNRNz6BM07a598ABQM3X0cdURPLSVDoC5BTVkaTnVvdoKlvT++FxuC5LeqzOfrGAp6vBXr9A0Y0d4yxdCFkbLzPunxAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAIVBMVEX///9TFBSaVAAUFSmzdUtyExO+x7adnJz7++hAN0v///8+KyF0AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAATklEQVQoz2NgoCIQJCQgqGSMX0DQxQVVBF0AyEcVQRcA85FF0AUElWDAGJdAKAzgEmAQTAODcoQtGAIdHUqhoR1p+AVcKBWYCQG4BSgEAFLINFWWS6VVAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAHlBMVEX///8fZEUUFSkUsX8b5XdhIz7/0EjIewD//3n///91Xz+KAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYUlEQVQoz43PURHAMAgDUCzEQizEAhawMAu1MNnjb125luWPd9wRzP4GQAMU0YAvsgJcEreQJ3MUtgC5+2dhBTEIf+cKjGvQpxIFYtwR6oDzHwUsEuwMefYMKdFAtu/glAeduiIjz+GVRAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///94LE0UFSn//3n/0EjIewD7++j////ldOpNAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAcElEQVQoz63Q0Q2AIAwEUFa4FW4FVrgVuoL7j+BVJVGp/uiFkOYlUGhrPwV7+AQue0YESkB0alkUQQVK6K4cA1SDMIBiBQx5JSBQQiMixdvx+AkanbyS43cTbMdO06gAUFzkDpDH474vkBM+d53gY1aG+y45RKWAOwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/exploration.28dc7456.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///9AN0tug5Cz2tv///YUFSn///9i5Fb6AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAP0lEQVQoz2NgGFRAEAjwCggqGRsrCeIVcBEEInwCoaFAgVB8Agyhgi5KBASMQ1FdiiGA7hUsAsYEBQiaQWMAAO7bDBdlfjE4AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///8UFSlhIz6YUEbGiGKNqJ/k6Nr////hfI/wAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAcklEQVQoz43R0RHAIAgDUFfIClkhK7iCK7D/CAWvPT2qtvnjfQBiKb8DEHsA6bWGZED1Gqp7oGpE2IL387BNQxIUNDNrPAB9Kc67Z/CxknVcA32nGvBIhnvxb1A0XQO69OdhDXFizfUb4o/ibRgnzHDOBSvxMSXp6jiwAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///9AN0sUFSlwl66z2ttkdHr///9FJoxxAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAU0lEQVQoz73QQQ3AMAxD0VAwhU/BFEKh/Kms2nppq1S7bD4+RY6SiP8iBBxAlo0pQTlCBZANWlKC7mGmjgX8gEt4scUjJUS/a752g167fGyDr3MB63Id45GlFzsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAG1BMVEX///9AN0uuw74UFSlkdHqz2ttTFBSzdUv////is9/GAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAUklEQVQoz2NgoB4QBAK8AoJKQGCMR0BQyUVQ0AVJBIuAYGioID4BYyIEgIYqueARSHMBuguJjyGQVp5mDAQMOAVAfJSwQBcgqIDBGI2PKUAHAADxIBtduPotCgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJFBMVEX///9hIz7GiGKYUEbk6NqNqJ9QVVgBAAUUFSnkIxx0ABH///9t5S5AAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAeElEQVQoz63PWw3AIAyF4Vo4FmqhFmoBC1jAwixgAZVr2bIL69jLeCD5v+QkQPTTATAHMMuNRrBmvdIIW/M5GwGyt99OTwCOZtEIJGGfIWkOoEgSgfjLrDWCYuCz3ksARjDog9r7CU4G2mqlN3BCnoN/8guIWm0RrIvxQI0cMNI5AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEX///81QEhsx/63//ErWoMga5wUFSn9/OEjMJ1yExONqJ+zdUuYUEb///+PM8R8AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYklEQVQoz63IQRGAQAiFYSpQYStQgQpUoAIVtoIVqGAFQ4k44+wB14P7X968D2BlGE0BGzXCCeQfZQSOhAQ1KoHNTAgxxjoUsHH+7gn6BuIfYPYXPGLNqWG/O7ISrvSpgAWduk2BXeTApRAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///8QWKj9/OEUFSn/pgD/KzyaBAT///+ND2uIAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYklEQVQoz63Q0QnAMAgE0KzgCl3hVrgVssLtP0K1FNJKYij0/nxEI7Y2Yi0lgx32A6ACYAMgYX0HorQEqXv9aMkgRmBLiGmkYrk5iMAFY0KCeFnD3fWS7+B1XEAFxM++3RROW18wN5fr91YAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///9mIp0UFSn/yfTSg+P////Jt2liAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAUUlEQVQoz73O0QkAIAgE0FZwhVvBFdx/prQIVKT6iO7vHojX2rsQDkDM2IJ2CZLBunjJYJ3gJMPo+lavUAOA+VZTw+UOkbTDw+phRwC41PAhHUroIs3wrrJaAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","var map = {\n\t\"./af\": 312,\n\t\"./af.js\": 312,\n\t\"./ar\": 313,\n\t\"./ar-dz\": 314,\n\t\"./ar-dz.js\": 314,\n\t\"./ar-kw\": 315,\n\t\"./ar-kw.js\": 315,\n\t\"./ar-ly\": 316,\n\t\"./ar-ly.js\": 316,\n\t\"./ar-ma\": 317,\n\t\"./ar-ma.js\": 317,\n\t\"./ar-sa\": 318,\n\t\"./ar-sa.js\": 318,\n\t\"./ar-tn\": 319,\n\t\"./ar-tn.js\": 319,\n\t\"./ar.js\": 313,\n\t\"./az\": 320,\n\t\"./az.js\": 320,\n\t\"./be\": 321,\n\t\"./be.js\": 321,\n\t\"./bg\": 322,\n\t\"./bg.js\": 322,\n\t\"./bm\": 323,\n\t\"./bm.js\": 323,\n\t\"./bn\": 324,\n\t\"./bn-bd\": 325,\n\t\"./bn-bd.js\": 325,\n\t\"./bn.js\": 324,\n\t\"./bo\": 326,\n\t\"./bo.js\": 326,\n\t\"./br\": 327,\n\t\"./br.js\": 327,\n\t\"./bs\": 328,\n\t\"./bs.js\": 328,\n\t\"./ca\": 329,\n\t\"./ca.js\": 329,\n\t\"./cs\": 330,\n\t\"./cs.js\": 330,\n\t\"./cv\": 331,\n\t\"./cv.js\": 331,\n\t\"./cy\": 332,\n\t\"./cy.js\": 332,\n\t\"./da\": 333,\n\t\"./da.js\": 333,\n\t\"./de\": 334,\n\t\"./de-at\": 335,\n\t\"./de-at.js\": 335,\n\t\"./de-ch\": 336,\n\t\"./de-ch.js\": 336,\n\t\"./de.js\": 334,\n\t\"./dv\": 337,\n\t\"./dv.js\": 337,\n\t\"./el\": 338,\n\t\"./el.js\": 338,\n\t\"./en-au\": 339,\n\t\"./en-au.js\": 339,\n\t\"./en-ca\": 340,\n\t\"./en-ca.js\": 340,\n\t\"./en-gb\": 341,\n\t\"./en-gb.js\": 341,\n\t\"./en-ie\": 342,\n\t\"./en-ie.js\": 342,\n\t\"./en-il\": 343,\n\t\"./en-il.js\": 343,\n\t\"./en-in\": 344,\n\t\"./en-in.js\": 344,\n\t\"./en-nz\": 345,\n\t\"./en-nz.js\": 345,\n\t\"./en-sg\": 346,\n\t\"./en-sg.js\": 346,\n\t\"./eo\": 347,\n\t\"./eo.js\": 347,\n\t\"./es\": 348,\n\t\"./es-do\": 349,\n\t\"./es-do.js\": 349,\n\t\"./es-mx\": 350,\n\t\"./es-mx.js\": 350,\n\t\"./es-us\": 351,\n\t\"./es-us.js\": 351,\n\t\"./es.js\": 348,\n\t\"./et\": 352,\n\t\"./et.js\": 352,\n\t\"./eu\": 353,\n\t\"./eu.js\": 353,\n\t\"./fa\": 354,\n\t\"./fa.js\": 354,\n\t\"./fi\": 355,\n\t\"./fi.js\": 355,\n\t\"./fil\": 356,\n\t\"./fil.js\": 356,\n\t\"./fo\": 357,\n\t\"./fo.js\": 357,\n\t\"./fr\": 358,\n\t\"./fr-ca\": 359,\n\t\"./fr-ca.js\": 359,\n\t\"./fr-ch\": 360,\n\t\"./fr-ch.js\": 360,\n\t\"./fr.js\": 358,\n\t\"./fy\": 361,\n\t\"./fy.js\": 361,\n\t\"./ga\": 362,\n\t\"./ga.js\": 362,\n\t\"./gd\": 363,\n\t\"./gd.js\": 363,\n\t\"./gl\": 364,\n\t\"./gl.js\": 364,\n\t\"./gom-deva\": 365,\n\t\"./gom-deva.js\": 365,\n\t\"./gom-latn\": 366,\n\t\"./gom-latn.js\": 366,\n\t\"./gu\": 367,\n\t\"./gu.js\": 367,\n\t\"./he\": 368,\n\t\"./he.js\": 368,\n\t\"./hi\": 369,\n\t\"./hi.js\": 369,\n\t\"./hr\": 370,\n\t\"./hr.js\": 370,\n\t\"./hu\": 371,\n\t\"./hu.js\": 371,\n\t\"./hy-am\": 372,\n\t\"./hy-am.js\": 372,\n\t\"./id\": 373,\n\t\"./id.js\": 373,\n\t\"./is\": 374,\n\t\"./is.js\": 374,\n\t\"./it\": 375,\n\t\"./it-ch\": 376,\n\t\"./it-ch.js\": 376,\n\t\"./it.js\": 375,\n\t\"./ja\": 377,\n\t\"./ja.js\": 377,\n\t\"./jv\": 378,\n\t\"./jv.js\": 378,\n\t\"./ka\": 379,\n\t\"./ka.js\": 379,\n\t\"./kk\": 380,\n\t\"./kk.js\": 380,\n\t\"./km\": 381,\n\t\"./km.js\": 381,\n\t\"./kn\": 382,\n\t\"./kn.js\": 382,\n\t\"./ko\": 383,\n\t\"./ko.js\": 383,\n\t\"./ku\": 384,\n\t\"./ku.js\": 384,\n\t\"./ky\": 385,\n\t\"./ky.js\": 385,\n\t\"./lb\": 386,\n\t\"./lb.js\": 386,\n\t\"./lo\": 387,\n\t\"./lo.js\": 387,\n\t\"./lt\": 388,\n\t\"./lt.js\": 388,\n\t\"./lv\": 389,\n\t\"./lv.js\": 389,\n\t\"./me\": 390,\n\t\"./me.js\": 390,\n\t\"./mi\": 391,\n\t\"./mi.js\": 391,\n\t\"./mk\": 392,\n\t\"./mk.js\": 392,\n\t\"./ml\": 393,\n\t\"./ml.js\": 393,\n\t\"./mn\": 394,\n\t\"./mn.js\": 394,\n\t\"./mr\": 395,\n\t\"./mr.js\": 395,\n\t\"./ms\": 396,\n\t\"./ms-my\": 397,\n\t\"./ms-my.js\": 397,\n\t\"./ms.js\": 396,\n\t\"./mt\": 398,\n\t\"./mt.js\": 398,\n\t\"./my\": 399,\n\t\"./my.js\": 399,\n\t\"./nb\": 400,\n\t\"./nb.js\": 400,\n\t\"./ne\": 401,\n\t\"./ne.js\": 401,\n\t\"./nl\": 402,\n\t\"./nl-be\": 403,\n\t\"./nl-be.js\": 403,\n\t\"./nl.js\": 402,\n\t\"./nn\": 404,\n\t\"./nn.js\": 404,\n\t\"./oc-lnc\": 405,\n\t\"./oc-lnc.js\": 405,\n\t\"./pa-in\": 406,\n\t\"./pa-in.js\": 406,\n\t\"./pl\": 407,\n\t\"./pl.js\": 407,\n\t\"./pt\": 408,\n\t\"./pt-br\": 409,\n\t\"./pt-br.js\": 409,\n\t\"./pt.js\": 408,\n\t\"./ro\": 410,\n\t\"./ro.js\": 410,\n\t\"./ru\": 411,\n\t\"./ru.js\": 411,\n\t\"./sd\": 412,\n\t\"./sd.js\": 412,\n\t\"./se\": 413,\n\t\"./se.js\": 413,\n\t\"./si\": 414,\n\t\"./si.js\": 414,\n\t\"./sk\": 415,\n\t\"./sk.js\": 415,\n\t\"./sl\": 416,\n\t\"./sl.js\": 416,\n\t\"./sq\": 417,\n\t\"./sq.js\": 417,\n\t\"./sr\": 418,\n\t\"./sr-cyrl\": 419,\n\t\"./sr-cyrl.js\": 419,\n\t\"./sr.js\": 418,\n\t\"./ss\": 420,\n\t\"./ss.js\": 420,\n\t\"./sv\": 421,\n\t\"./sv.js\": 421,\n\t\"./sw\": 422,\n\t\"./sw.js\": 422,\n\t\"./ta\": 423,\n\t\"./ta.js\": 423,\n\t\"./te\": 424,\n\t\"./te.js\": 424,\n\t\"./tet\": 425,\n\t\"./tet.js\": 425,\n\t\"./tg\": 426,\n\t\"./tg.js\": 426,\n\t\"./th\": 427,\n\t\"./th.js\": 427,\n\t\"./tk\": 428,\n\t\"./tk.js\": 428,\n\t\"./tl-ph\": 429,\n\t\"./tl-ph.js\": 429,\n\t\"./tlh\": 430,\n\t\"./tlh.js\": 430,\n\t\"./tr\": 431,\n\t\"./tr.js\": 431,\n\t\"./tzl\": 432,\n\t\"./tzl.js\": 432,\n\t\"./tzm\": 433,\n\t\"./tzm-latn\": 434,\n\t\"./tzm-latn.js\": 434,\n\t\"./tzm.js\": 433,\n\t\"./ug-cn\": 435,\n\t\"./ug-cn.js\": 435,\n\t\"./uk\": 436,\n\t\"./uk.js\": 436,\n\t\"./ur\": 437,\n\t\"./ur.js\": 437,\n\t\"./uz\": 438,\n\t\"./uz-latn\": 439,\n\t\"./uz-latn.js\": 439,\n\t\"./uz.js\": 438,\n\t\"./vi\": 440,\n\t\"./vi.js\": 440,\n\t\"./x-pseudo\": 441,\n\t\"./x-pseudo.js\": 441,\n\t\"./yo\": 442,\n\t\"./yo.js\": 442,\n\t\"./zh-cn\": 443,\n\t\"./zh-cn.js\": 443,\n\t\"./zh-hk\": 444,\n\t\"./zh-hk.js\": 444,\n\t\"./zh-mo\": 445,\n\t\"./zh-mo.js\": 445,\n\t\"./zh-tw\": 446,\n\t\"./zh-tw.js\": 446\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 790;","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAG1BMVEX///9sPEpAN0v///adXz7HmVyTk5MUFSn///8qylyOAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAQ0lEQVQoz2NgGEpAUEkQDJQEcQkoGbuEAoGLsRIuAUGYgCD5Akppgi5AIJimhE8AqAOPQDlMSzkuAcFyKBDEJUB7AAA6+ycNP8waowAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/basementBat.03b5b98f.png\";","module.exports = __webpack_public_path__ + \"static/media/mouse.139223ad.png\";","module.exports = __webpack_public_path__ + \"static/media/skeleton.fd7f5027.png\";","module.exports = __webpack_public_path__ + \"static/media/angrySheep.868ded22.png\";","module.exports = __webpack_public_path__ + \"static/media/littleDevil.5b0c08f5.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///8UFSkfZEXs7+kb5XcUsX////9swsgrAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAMUlEQVQoz2NgGHZAUElJSVAQn4CSsbFLqBJeARcXpVBBfAJAU1H5mAIMgmh8TIFBDwDxkgeTCNHXRgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///8UFSlOQVo5LU2+x7aAfYP///8F0SFqAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAALklEQVQoz2NgGHZAUEnJWFAQn4CSi0uoEn6B0FBj/AIMgmh8TAEGQTQ+psCgBwC9xgdPk33szAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/earthSpeck.069668e6.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///8UFSltPUvs7+n/inv/KzysMjL///+EyttnAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAALklEQVQoz2NgGHZAUElJSVAQn4CSsbFLKH4BF5c0/AIMgmh8TAEGQTQ+psCgBwDHhgiBSowpdgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///8UFSlgM7vs7+nxhfWkPOr///8l8MOxAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAMklEQVQoz2NgGHZAUElJSVAQn4CSsbFLqBJeAReX0FBBfAIMgi6ofEwBBiU0PqbAoAcAqfkIXzX2+n4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAq0lEQVRYR2NkGGDAOMD2M4w6YDQERkNgNARGQ4DkEBAR1fwPKr4N/b9hLcXPb+RCEX/z+jpeO4aeA1xT5MEhsLz7FIpP530zAvNPn/kJpj9s5gbTu+c8pG4IDBoHuDb+QQmB3fUsYL6A71cwvT9FFExTPQ3AQmDAHADzNnpuINXnMHNIzgWDxgHoDoHxCcU5euFBdggMGgdQ2qilOARGHTAaAqMhMBoClIYAAElDUiGRTJfvAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///8UFSkyELDs7+lsx/5Oe/D///9l7kv3AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAALklEQVQoz2NgGHZAUElJSVAQn4CSsbFLKH4BFxcl/AJAU1H5mAIMgmh8TIFBDwDLpwdxcKuRhQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/slime.d7b715fc.png\";","module.exports = __webpack_public_path__ + \"static/media/ancientHeadmaster.b7fa7587.png\";","module.exports = __webpack_public_path__ + \"static/media/redSlime.68b597d0.png\";","module.exports = __webpack_public_path__ + \"static/media/zombie.a720d22e.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///9AN0sdGilug5BXZGk7QE3///8/NTpPAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAZ0lEQVQoz63Q0Q3AIAgEUFe4FW4FVmAF9l+lJ2n9oOJPS2LiPYVEx/izwDOAZjjAjB6BDu7oq6kCQuWKLdAUZUsqwDXRcmwDNA1MIX0HyIa5QofcAalAXefzkAKqsLnnAVj/+wVf6wKvTizlX11jPgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///+YUEZhIz4UFSnqt4DGiGL///9lxA6tAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAWklEQVQoz43QUQ3AQAgD0LNQC7WAhVrAv5X1byxkHHy+UCCcsyrwBiFeYNFCJUdgCjGDwBGcYMygBXhooQaRUoLvbR2816R/OIF0pnyggUNg1g80sHyP7zDUA1F8H52JYm82AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = __webpack_public_path__ + \"static/media/enchantedSheep.9e3d62ed.png\";","module.exports = __webpack_public_path__ + \"static/media/blackSheep.0a5a0c4f.png\";","module.exports = __webpack_public_path__ + \"static/media/mimic.b13d0981.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABbklEQVRYR2NkGGDAOMD2M5DsAAdz7/8gR5ucPIbi9gWiEmD+m9fXSTKTJMUgCwbMASUMgmCfm0c5gX0qrccPpp9e+gimTy7bB6ZJDQmiQ2DQOCCoIxAl7mEhABOEhUQPw3uiPEeUIpDhsBAYcAeMvDQAy3ZfOf+Co9n+wEms+R8mqKgtD2bev/qQqHKBYBoYNA7YPxMSAqUG+EPg9cTrYHWi+ZrUDYEBc4Cpgwe4BNR5/A3so3lruVDSAJxzbQeKz335RMH8+XcP4Y1mgmlgwB2QqGwHDgGH2GtgH11ugKQFQuCtsi51QmDQOKB26h+wj6Q1QlE8v2JBK9bAOLBYi7ohMOgdYGuhBvbx4RO3wDTdQ4BuDkCPcJiP0cWLp0LKAUJtRILlACwXwNLAgDkAVg7AghrmELqFwIA5AL0oRo8K9BCApf7Nn15TJw0MuANgcY3uEFx1AbE+h+knmAsGjQMI1X7kyhMdAuRaQEgfAAUWKDCEIdYFAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEX///9AN0tIRWJkdHrAvbGTk5MUFSlQVViaBARhIz7kIxz/WUP5ko////8bpoOqAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAeklEQVQoz43QXQ3GMAiF4Vo4FmYBC7WAhVqYBSxgAQtYqKjRLd9PtpbsveNJoElLeRe2CAmAakRIoDLANYGNz5WWQAhTW0Pc47oTf9+9A0TGUSYRzEHNTUZmuoLe3WPMoVsCEHP3MUtbgH5AF3Dt/DYmUACN/n7sAWkHnkJ6lx4zUsAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJ1BMVEX///9AN0sQWKgUsvr9/OFh1/M1QEgUFSlIRWKxIBv/pgD/0Ej////X3D1IAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAgElEQVQoz4XQbQ3DQAgG4LOABSy8FrCABSxgAQtnoRZqbly7pc062PvnwpNc+BhjhThD48o3EERUb/IAFhBBuYHzSwO2urp7AwZRd+uARdFA8NwitslRgDF47vvMx35D5OBrMgBRgwqQVoABqkfNXgD/g5Q3fC70gLX+ccNRQpsX9xpOO1NXcLEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAIVBMVEX///8dZEBs2CAtoS8UFSk1QEgVZETqt4BsPEr7++j///8v6huhAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAgUlEQVQoz33PUREDIQwE0FhYC2shFmIBC7FwFmLh3HbpR4+W0Aw/vJkNi5kGsO/ZgfgHAJyr7KCbzrN4hxkg/AwBUObjCEAEyXGGeXMnpmS24G/BVZlswUKj5ndps7WgahHXXfl5eYPZripcMo5gSX0gl0wHQ6EzpDqtKxtY0j/wAhXLOYOtg6I4AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEX///9AN0t0ABEUFSmrWlPGiGI1QEj/0Ej/pgAUsEYVZERs2CC58Ib///+1qBE6AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAY0lEQVQoz43NQRHAMAhEUSzEAhawgIVYwAIWYgELsYCFiGrSW9Pppv/4ZliIflaYBQJr1Ye8oVZVhnDaKDa/ihUAvqDJNxi7exMDEDzrCHKMiDhBYsjcTnaII/QFHQDZHQFAXSG/UMHVSD70AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEX///9AN0t0ABEUFSmrWlPGiGI1QEj/0Ej/pgBhIz7kIxz/WUP5ko////80yYgGAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAZklEQVQoz43QUQ3AMAhF0VmoBSxgAQu1gAUs1AIWsICFihr929LsdffzJEDCdf2sETEEki4v2aF3EYJw2tG0rrIyAFswAKib2WD/Bg9aIcg5I+IEiSGzRhhAnEB9gQMoqZ4/3QB1A026VjPkfBZxAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABZElEQVRYR2NkGGDAOMD2M5DsAAdz7/8gR5ucPIbi9gWiEmD+m9fXSTKTJMUgCwbMASUMgmCfm0c5gX0qrccPpp9e+gimTy7bB6ZJDQmiQ2DQOCCoIxAl7mEhABOEhUQPw3uiPEeUIpDhsBAYcAeMvDQAy3ZfOf+Co9n+wEms+R8mqKgtD2bev/qQqHKBYBoYNA7YPxMSAqUG+EPg9cTrYHWi+ZrUDYEBc4Cpgwe4BOT+zgz2EcwhKAkBxLm2A8XnOkpKYP6Bk1vxRjPBNDDgDoAlwisaYZA4PTwfw/PYBBxEuakTAoPGAb+iJoN9FGoujeLh1ukrsIaIzo1V1A2BQe8ANSNbsI9vnTsMpukeAnRzAHqEw3yMkRC2dVC3JISlgQFzAKwcgAU1zCF0C4EBcwB6UYweFeghAEv9V+7do04aGHAHwOIa3SG4KgRifQ7TT7A2HDQOIKoKJEMR0SFAhtlEaQEAbG4iMLG1M3gAAAAASUVORK5CYIIA\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAFVBMVEX///9hIz4dGinGiGKYUEb4xpz///9tG9KaAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAa0lEQVQoz63QwQ3AMAgDQFbwCqzgFViB/VcpplU/hbxqRZG4ByDM/gng9TsOQHiFWMGDobwyQKbqA4CZJJO+Q0lZbICay56MDSiQPF0HeIMRuo5+7FN9QEMD3XUD1JVx7+Y2gawCXdo2OOUCGag0MwUtb40AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJFBMVEX///8dGikjMJ2uw74URjAggFYUsEYckkJs2CDs7+kQWKj///+EABYyAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAgklEQVQoz43QQRUDIQwEUCyMBSzEQizEwlioBSxgoSo7sPSym/R1TpN/ILy09n/Qey9ABUo3s57CLgL3AFJYlbFCbyk0+GssYQkSjkFyEBVAg8KowKEH92avgAv2ZqTgGrfwfC2BYBx0ZIA5LaS6UFgOwNtsKmbnhje4zBV85yf8ygcuh1thU1BKBgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///9hIz4dGinGiGKYUEb///+eqHk9AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAZklEQVQoz63RwQ0AIQhEUVv4LdCCLdB/TeuwmywJyklO5gVH1DEuFaZqgCnBjsBUuTdgPp0UXGCsQCwHV0C7InkPaBHibCHmIoLfcwuoefWCfxEFdCpE5An+F2ggz7mHuF/+mApNPVLRJ9myN+ghAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///8KWK5F0PEEjfn9/OG14O0UFSn////S9Ol9AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAUElEQVQoz83LMRGAQAxE0Vj4FmIhFrCABfxLYK8ilxxQ0LDdfzNr9q/BC+DBI+DbLBXUu2epMFpwyQI8Au24A0OH3B2GEKk7SObuYJTu8GUnXRoTy4+2u4QAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGVSURBVFhHYxjxgBFKUwxkpTT/g2hrO30wHx2sWLECq11MUHrAAIarIiIiwD6BgaOHLkJZ+AHM59nZ2WAaHUydOhVMo4fE4AkBmM8J+QBXiLCJlUBZEPBWgxtM8x5qBNMw8PjZ9UEaArBUDAPoPnoYGwOmeU6vB9OEwBfTQDAtv3gJmL57IRkjvYHAgIcA3AGguEGPHxAAxSUIC6gygjHIZzDfYQOE5NHB4CsHYACWJmBpAZYGQKGADD7cRkk6cABTB5OX7DUA04M3F6AD9FzxvPgClAUB6CGBDmA+h+UaWHkwdEJA2WAu2Au/XvWA+Z/t6sE0rhROqHwQvvEVTKOXB4M/BNBLQEJ5HFdIwPSh54bBFwIwn8MALASoBdDrhgEPAZwOAPkcn+9BcY0tvnGJowNQOQPCgy8NwEpAXPke3XfElgswdTBxWMk4eENg2cpZYD468J36FMoiD2zOlgbTUeFpYHrwhgA6gLULFkxWA9MwYGNjA2VhB0eOHIGyIADm88FbEuIChEIGF4DVpjAwyNoDDAwAqjGezpTvlrkAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///9hIz4dGimYUEbGiGL///9qY/aJAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYUlEQVQoz82QwQ3AIAwDs4JX8ApZwfvP1IRWESXw66N+IOUEF2Sz3wRgJM4TgEuIucgKQAGDeLzbAh+3WeIGKHfO4gZCqlncQf78FovBd8Bem2wPUqwcq4EVPB1xbZH2US5vviE18wktGgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGDSURBVFhHYxjxgBFKw4FAxIr/UCYY8B5qBNOPn13HUIsPwMyB6f9sVw+mP6yIQDGHCUoPGIC7Bt3Fz4svgOnbgTfBtGHVNTCN7iMYQBc/36YFplXXq4NpGOA5vR5Mw0Ji8ISAtYMvOASWzGsF82E+ZokKAtOzBI+A6fzwbDCNC0xcORVMp723AdN/lq0D07AQiUmqBtNHD2weZCEgK6UJDgE5NRUwv7i5EEyHnbIG0wKqEKW4QgLd5x9uQzLTKrOjYLq3th9MP7p1B0zDctXgCQEYgIUEDMBSNSwtwAAsJGAA5nMYgMU9LHfAAHp5MvhCAB3AQgQ93xMCMJ8TKkEHfwjAAHpIwPI1DKCXlMTWHUMvBA4dWQnmo5fxsDrDziYcTA+fEECPe/S6AQbQy/4hkwvIdgDIx8iYXDB40wB63H8xDQTTsFoRF4DVgrCWD6G0MPjTwLxsMTAmFRCrb/CmARiApQVYi8dQWgRM4wLnn74B07AW0/CtDXGBIVcbjnTAwAAAHXOo7cBCkPIAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///87QE3f3tKuw75ug5AdGiltPUv///+S/abuAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAZUlEQVQoz7WP0Q2AQAxCuwIrdAVWYIWu4P4jyCX6ofbOH+WLvoQGIj4RgKu5AyRV9igl0QJSKktiD2zhUImw7UDUVpm0bKIFJhq3zvsJwr0kN4sFcEYrgNHaoTl4/zEGHsNm4G/t7zcwWWTRQhoAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAG1BMVEX///8QWKgdGikEjfkUsvo7QE3f3tKuw77///9Hf6fnAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAdUlEQVQoz43PWRHAIAwEUCzEwlqIBSxgAQux3w3ttByB6Q7D8T5IktKfCMZzAWgWCFdWhFCq3xh6LRGgmLpws4IIEvhdi+CpMgNJWvD2vgBFtX8HoMwJfC6f8Aitry2wqMNXeAW7wbZAqYx1VWa45x+nneCUC4IXMBUswqp1AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADKSURBVFhHYxgFIx4wQmmqgwod3/8getpSHTA/K/oKmO64shnFTiYoPWCA6iGA7vNtelPBtNelbDD9Sb99mIYAzOd+MaJg/qYlr8E0LCTYXDaA6Tevrw/zEIABWEj49R4H0+g+h4GhHwIwnxvrsYH5mbuvgWkYwOVzGBi6IYDL54R8jA6GXgig53dCqZwQGDohQG2fw8DgDwFa+RwGBm8I0NrnMDD4QoBaJRyxYPCEAL19DgODJwRERDXBIQADtPY5DAx4CIx0wMAAAG0cXChWg+PPAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAIVBMVEX///9ug5D9/OHk6NpLWmOuw747QE01QEgUFSmNqJ////9eP8z0AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAASUlEQVQoz2NgoDsQFCQgIKhEQEBQyRi/AEEFLugK0AVcjEPRFKAJpBmHljPgE3AR7EBVgC4A5DMw4BNwmYmuAF2gHNUGLAKUAgBHBhGJfqglBgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///94LE0UFSnGiGKrWlP///9c2lH5AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAOklEQVQoz2NgoDcQVMInoCTIIGgsiE8AyEPhYwooCRqj2oEpgMbHEBB0EWTAK0BYAboVmAJ4A2KQAACkdgdxDRr/9AAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///9sPEqrWlPGiGIUFSn///8eGYHMAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAATElEQVQoz63OsQ0AIAhEUVb4K7ACK7j/TBorPQwWSncPCJh9LaAGPJwKRg5vBcxMAdcBQ3KC+ZQ8oRve1pwA6Scg9n6C64DJhQM8VwdUlBHvFahZogAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAHlBMVEX///8EjfkQWKjL9f/9/OFh1/M1QEirWlMUFSn////qNOrUAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAR0lEQVQoz2NgoDMQVFLCLyBo7IJfAMg3xitAUIFSKJoCdAGCCtJCXUJRFGAKlIemMeATSCvv6GDAJwDkMzDgF0C1AYsAxQAAVxQYC2ENkZAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/darknessWand.80236e6c.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADKSURBVFhHYxgFIx4wQmmqgwod3/8gOs3vC5g/axMPmO64shnFTiYoPWCA6iGA7nPFtwfB9H1hezCt1LZ/mIYAzOd+MaJg/qYlr8E0LCTMZr8A029eXx/mIQADsJDw6z0OptF9DgNDPwRgPjfWYwPzM3dfA9MwgMvnMDB0QwCXzwn5GB0MvRBAz++EUjkhMHRCgNo+h4HBHwK08jkMDN4QoLXPYWDwhQC1SjhiweAJAXr7HAYGTwiIiGqCQwAGaO1zGBjwEBjpgIEBACWoXSipcJDwAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///94LE3kIxz/0EjGiGIUFSmrWlP///8joEw2AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAARElEQVQoz2NgoC4QVBLELyCoZKyEV0DQRVApFL+AoEsoAz4BwbRQNAVoAkA+AwM+AXQbMATooYCgIwkpYEALBiwChAAA10oSd7dMhrcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJFBMVEX///8EjfkQWKjL9f9h1/P9/OFsPEqrWlMUFSnGiGI1QEj///8YtWUlAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAXElEQVQoz6XPQQ3AQAhEUSxgAQtYwMJawMJawMJaQGXTI7PJ9FBuvPwDiIxREw7qysFicbBwDu/uxiA91rgLIXfVDADy1HwDIU8Lhe9gYwDQGPQVlFD4H0jBjvAAe4kqX5EiKlsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJFBMVEX///9sPEqrWlMUFSnGiGJh1/MQWKjL9f/9/OEEjfk1QEj////hOVNWAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAU0lEQVQoz2NgoC8QFCQgIKhkjF9A0MU4NA2fgKCLYGh5x0zcAkB+Wnl5R+hMXAJAviBDWkdHBy6BVWA3pXXA7UUXWAV1dBqqAiQBYzRvYgoMCgAA2HQea/gNacgAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA80lEQVRYR2NkGGDAOMD2M4w6gGYhUKHj+x8UvfpaneBYvnitHEx3XNmMYufwcwC6zyN2fAf7fIUHJ5iOXKVF2xAYMAfALPaLEQX7dNOS12AalgZy9weD+W9eX6dNCAwaB8AKNlhI+PUex+pzmDqq5QJYCNDdATCLjfXYwHZn7r6GUrqjxzl60U9xCAyYA3BZTMjHVAuBAXMAenYjlMoJVfckp4EBcwC1LSa5HBgwB9DKYqJDYMAcQGuLCYbAgDmAWgUMofyPMwQGzAH0thgjBAbcASKimuB2PAyQWqsRG+c4a8MBdwC5PqBUH8m1IaUWousHACeUtiHth9mZAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA8UlEQVRYR2NkGGDAOMD2M4w6gGYhUKHj+x8UvYxLD4Jj+X+0PZjuuLIZxc7h5wB0n7epQZJ51S0I3a7/ibYhMGAOgFnsFyMK9ummJa/BNCwNzHaRBvPfvL5OmxAYNA6AFWywkPDrPY7V5zB1VMsFsBCguwNgFhvrsYHtztx9DaV0R49z9KKf4hAYMAfgspiQj6kWAgPmAPTsRiiVE6ruSU4DA+YAaltMcjkwYA6glcVEh8CAOYDWFhMMgQFzALUKGEL5H2cIDJgD6G0xRggMuANERDXB7XgYILVWIzbOcdaGA+4Acn1AqT6Sa0NKLUTXDwArdLYhH7o63AAAAABJRU5ErkJgggAA\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEX///9h1/MEjfn9/OHL9f8QWKg1QEhsPErgIBj/inv/0Ej5cAsUFSn///91BQiRAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAaklEQVQoz4XOWxHAMAhE0bWAhbUQC1iIhVjAAhZqoRZqoaLa/pFHCX/3MMwAxBECKUjZAHUD1A3UtzWDqjJe9ECV/q0RKEVY8QcNJkXDfgZzxp7B/PDYCzjdkIGd191aAl9jvMh6Adb3BA9s+DOJjowL+QAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAIVBMVEX///9sPErGiGIQWKj9/OHL9f8EjfkUFSlh1/OrWlP///+ZgQA6AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAbElEQVQoz63QQRHAMAgEQCxgAQtnAQuxEAtYwELcNm2GPNqQTmd6v9sXB9GHML8AC7AFFtVSN2ACVfUcrMFLl5qBsfAlGfRuRMhhdIJnYE3GcGjBCmbv4Cs4b6IA0AK4WSwcL3zC7PHLO/yQA0tcL9EQsvdwAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJ1BMVEX///8QWKgEjfnL9f/9/OFh1/NsPErk6NoUFSnGiGI1QEirWlP///92yvn8AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAR0lEQVQoz2NgoDIQVFLCLyBo7CKIVwDID8UvkIbGxxBIK+/oYMAnkDYTVR5DIG3mKga8AtRQQNANhBTsRleALoAWDFgECAAAr6AiRZhVN6oAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAG1BMVEX///9sPEo1QEirWlPGiGL9/OEUFSmuw77////kA0u+AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAWElEQVQoz63OQRXAMAgDUCzEAhawgAUsYGH2l+Moe7ls3Phtk5r9OgAkuEcGJFRmtACALy4BTGRkK6jgPjomMBHPig3OP7UCr3G8gbuZAuRxYcHR8AKf5wZkcR054En5nAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAJ1BMVEX///9ug5AEjfn9/OHL9f8QWKg7QE1h1/M1QEhLWmMUFSmNqJ////9ih8l7AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAYklEQVQoz5XNQRHAMAgEQCxgAQuxgAUsxAIWsBALsVBzpb8QWjK93+3cAMCfIFEN2FoN3rmEpyMUcB7wPthAvAt8QgfRMMhgxLpeSGCkZFBBx9gTDJyeAsY1w4EMFj+8wDE3EoomHwuNbJsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDDxG9wvAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAwgEZkkwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADKSURBVFhHYxgFIx4wQmmqgwod3/8g+rhMPZhv+aQRTHdc2YxiJxOUHjBA9RBA9/nBBHUwbb/gJpg+uMNkmIYAzOd+MaJg/qYlr8E0LCSuno0F029eXx/mIQADsJDw6z0OptF9DgNDPwRgPjfWYwPzM3dfA9MwgMvnMDB0QwCXzwn5GB0MvRBAz++EUjkhMHRCgNo+h4HBHwK08jkMDN4QoLXPYWDwhQC1SjhiweAJAXr7HAYGTwiIiGqCQwAGaO1zGBjwEBjpgIEBABqAXSht1cx6AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEX///9sPErk6Nrqt4AUFSn////tDsucAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAXUlEQVQoz73O0Q2AMAgEUFZgBVa4Fdh/Jg9rtJSif14ICS+EIPJXVD9AzTKtwNkME1WAZdrAkJsKXAJ1TysTDFEeB3QPIbwY1oF4AJzVwSnO1gMlvn/mCuIReYM2B937HvMirh0nAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEX///94LE0UFSn7++j//3n/0EjIewD////HWgnzAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAWElEQVQoz83OywnAAAgDUFfIClnBFbJCVnD/EWoLhULRSy/1IPjwF/GfAHAljMAUYCVncLqUWqBcKXuGgLOHaobzpF1coGsVHite0P3u92cgiZYFbtzhSxz8DCGbL0zUyAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMPEb3C8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMjJUMDg6MDM6NDUrMDA6MDCARmSTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAG1BMVEX///81QEhsPEr4xpz7++jGiGIUFSl4LE3////xzTw9AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAHdElNRQfjDBYIAzYGArEsAAAAY0lEQVQoz7XQUQ3AQAgDUCzUQi1gAQu1gIWzPy5ZliUX+Nr46/spYPbZgJwBHsEBABYI7IAV6BKcA8gV8lsOgMTC4g6Mmbs3nvUPQKa0AR3UbdXrSmshl3OJA1iiXvDKJ/w9F2jcKuf60VilAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTIyVDA4OjAzOjQ1KzAwOjAw8RvcLwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0yMlQwODowMzo0NSswMDowMIBGZJMAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC\"","import memoize from \"fast-memoize\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { Resource } from \"../Resources\";\r\nimport { School, SpellElement } from \"../spells/ElementsAndSchools\";\r\nimport { TransformationTags } from \"./TransformationTags\";\r\n\r\nexport enum TransformationType {\r\n  Addition = \"Addition\",\r\n  Multiplier = \"Multiplier\",\r\n  Power = \"Power\",\r\n  Override = \"Override\",\r\n}\r\n\r\nexport type TransformationTag =\r\n  | TransformationTags\r\n  | Resource\r\n  | School\r\n  | SpellElement\r\n  | CombatStat\r\n  | AttackTarget\r\n  | string;\r\n\r\nexport type Transformation = (\r\n  state: PlayerContextState,\r\n  params: Record<string, any>,\r\n) => number | undefined;\r\n\r\nexport type TransformationData = {\r\n  id: string;\r\n  transformation: Transformation;\r\n  type: TransformationType;\r\n  tags: TransformationTag[][];\r\n};\r\n\r\nconst transformationDatabase: Partial<\r\n  Record<TransformationTag, TransformationData[]>\r\n> = {};\r\n\r\nexport function registerTransformation(\r\n  tags: TransformationTag[][],\r\n  transformationId: string,\r\n  transformationType: TransformationType,\r\n  transformation: Transformation,\r\n) {\r\n  const data = {\r\n    id: transformationId,\r\n    transformation,\r\n    type: transformationType,\r\n    tags,\r\n  };\r\n\r\n  const allTags = new Set(tags.flat(2));\r\n  allTags.forEach((tag) => {\r\n    const forTag = transformationDatabase?.[tag] ?? [];\r\n    if (!forTag.some((preExisting) => preExisting.id === transformationId)) {\r\n      forTag.push(data);\r\n      transformationDatabase[tag] = forTag;\r\n    }\r\n  });\r\n}\r\n\r\nconst getTransformationsThatApply = memoize((tags: TransformationTag[]) => {\r\n  const allTransformations = tags\r\n    .map((tag) => transformationDatabase?.[tag] ?? [])\r\n    .flat();\r\n  const allTransformationsThatApply = allTransformations.filter((data) =>\r\n    data.tags.some((targetTags) =>\r\n      targetTags.every((targetTag) => tags.includes(targetTag)),\r\n    ),\r\n  );\r\n  const uniqueTransformations = [...new Set(allTransformationsThatApply)];\r\n  return Object.fromEntries(\r\n    Object.values(TransformationType).map((type) => [\r\n      type,\r\n      uniqueTransformations.filter((data) => data.type === type),\r\n    ]),\r\n  );\r\n});\r\n\r\nexport function applyTransformations(\r\n  tags: TransformationTag[],\r\n  state: PlayerContextState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n) {\r\n  const transformParams = params ?? {};\r\n\r\n  const transformations = getTransformationsThatApply(tags);\r\n\r\n  // Step 1: apply power transforms (rare)\r\n  const powerTransformations = transformations[TransformationType.Power];\r\n  const afterPower = powerTransformations\r\n    .map((data) => data.transformation(state, transformParams))\r\n    .reduce(\r\n      (prev, current) => Math.pow(prev ?? 1.0, current ?? 1.0),\r\n      startingValue,\r\n    );\r\n\r\n  // Step 2: apply addition transforms\r\n  const additionTransformations = transformations[TransformationType.Addition];\r\n  const afterAddition = additionTransformations\r\n    .map((data) => data.transformation(state, transformParams))\r\n    .reduce((prev, current) => (prev ?? 0) + (current ?? 0), afterPower);\r\n\r\n  // Step 3: apply multiplication transforms\r\n  const multiplicationTransformations =\r\n    transformations[TransformationType.Multiplier];\r\n  const afterMultiplication = multiplicationTransformations\r\n    .map((data) => data.transformation(state, transformParams))\r\n    .reduce((prev, current) => (prev ?? 1.0) * (current ?? 1.0), afterAddition);\r\n\r\n  // Step 4: finally, apply override transforms\r\n  const overrideTransformations = transformations[TransformationType.Override];\r\n  const afterOverride = overrideTransformations\r\n    .map((data) => data.transformation(state, transformParams))\r\n    .reduce((prev, current) => current ?? prev, afterMultiplication);\r\n\r\n  return afterOverride as number;\r\n}\r\n\r\nexport function explainTransformations(\r\n  tags: TransformationTag[],\r\n  state: PlayerContextState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n): Record<\r\n  TransformationType,\r\n  Array<{ id: string; value: number | undefined }>\r\n> {\r\n  const transformParams = params ?? {};\r\n  const output: Record<\r\n    TransformationType,\r\n    Array<{ id: string; value: number | undefined }>\r\n  > = {\r\n    Power: [],\r\n    Addition: [],\r\n    Multiplier: [],\r\n    Override: [],\r\n  };\r\n\r\n  // Step 1: get the transformations that apply\r\n  const allTransformations = tags\r\n    .map((tag) => transformationDatabase?.[tag] ?? [])\r\n    .flat();\r\n  const allTransformationsThatApply = allTransformations.filter((data) =>\r\n    data.tags.some((targetTags) =>\r\n      targetTags.every((targetTag) => tags.includes(targetTag)),\r\n    ),\r\n  );\r\n  const uniqueTransformations = [...new Set(allTransformationsThatApply)];\r\n\r\n  // Step 2: apply power transforms (rare)\r\n  const powerTransformations = uniqueTransformations.filter(\r\n    (data) => data.type === TransformationType.Power,\r\n  );\r\n  const afterPower = powerTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(state, transformParams);\r\n      output.Power.push({ id: data.id, value });\r\n      return value;\r\n    })\r\n    .reduce(\r\n      (prev, current) => Math.pow(prev ?? 1.0, current ?? 1.0),\r\n      startingValue,\r\n    );\r\n\r\n  // Step 3: apply addition transforms\r\n  const additionTransformations = uniqueTransformations.filter(\r\n    (data) => data.type === TransformationType.Addition,\r\n  );\r\n  const afterAddition = additionTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(state, transformParams);\r\n      output.Addition.push({ id: data.id, value });\r\n      return value;\r\n    })\r\n    .reduce((prev, current) => (prev ?? 0) + (current ?? 0), afterPower);\r\n\r\n  // Step 4: apply multiplication transforms\r\n  const multiplicationTransformations = uniqueTransformations.filter(\r\n    (data) => data.type === TransformationType.Multiplier,\r\n  );\r\n  const afterMultiplication = multiplicationTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(state, transformParams);\r\n      output.Multiplier.push({ id: data.id, value });\r\n      return value;\r\n    })\r\n    .reduce((prev, current) => (prev ?? 1.0) * (current ?? 1.0), afterAddition);\r\n\r\n  // Step 5: finally, apply override transforms\r\n  const overrideTransformations = uniqueTransformations.filter(\r\n    (data) => data.type === TransformationType.Override,\r\n  );\r\n  const _afterOverride = overrideTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(state, transformParams);\r\n      output.Override.push({ id: data.id, value });\r\n      return value;\r\n    })\r\n    .reduce((prev, current) => current ?? prev, afterMultiplication);\r\n\r\n  return output;\r\n}\r\n","import { Audio } from \"expo-av\";\r\n\r\nconst soundMap: Record<string, any> = {\r\n  menuClick: require(\"./menu/click.wav\"),\r\n};\r\n\r\nclass AudioManager {\r\n  sampleMap: Record<string, Audio.Sound> = {};\r\n\r\n  async load(): Promise<void> {\r\n    await Audio.setIsEnabledAsync(true);\r\n    await Promise.all(\r\n      Object.keys(soundMap).map(async (audioId) => {\r\n        const audioSample = soundMap[audioId];\r\n        const audioSound = new Audio.Sound();\r\n        await audioSound.loadAsync(audioSample);\r\n        this.sampleMap[audioId] = audioSound;\r\n      }),\r\n    );\r\n  }\r\n\r\n  play(audioId: string) {\r\n    this.sampleMap[audioId].replayAsync();\r\n    this.sampleMap[audioId].replayAsync();\r\n  }\r\n}\r\n\r\nexport default new AudioManager();\r\n","class Demo {\r\n  demoMode = false;\r\n\r\n  setDemoMode(demoMode: boolean): void {\r\n    this.demoMode = demoMode;\r\n  }\r\n\r\n  isDemo(): boolean {\r\n    return this.demoMode;\r\n  }\r\n}\r\n\r\nexport default new Demo();\r\n","export enum TransformationTags {\r\n  Production = \"Production\",\r\n  Consumption = \"Consumption\",\r\n  Cost = \"Cost\",\r\n  ManualGathering = \"ManualGathering\",\r\n  Loot = \"Loot\",\r\n  LootChance = \"LootChance\",\r\n  Cap = \"Cap\",\r\n  PerBuildingCap = \"PerBuildingCap\",\r\n  Researcher = \"Researcher\",\r\n  Apprentice = \"Apprentice\",\r\n  InventorySlot = \"InventorySlot\",\r\n  Creature = \"Creature\",\r\n  Threshold = \"Threshold\",\r\n  CostScale = \"CostScale\",\r\n  Research = \"Research\",\r\n  GameSpeed = \"GameSpeed\",\r\n  ExplorationBossRequirement = \"ExplorationBossRequirement\",\r\n  ExplorationDelay = \"ExplorationDelay\",\r\n  FromExploration = \"FromExploration\",\r\n  FromCreatures = \"FromCreatures\",\r\n  StunResistance = \"StunResistance\",\r\n  AutocastDelay = \"AutocastDelay\",\r\n  RandomEventWeight = \"RandomEventWeight\",\r\n  StorylineTriggerChance = \"StorylineTriggerChance\",\r\n  ExpRequirementScale = \"ExpRequirementScale\",\r\n  TimePiecePerResearch = \"TimePiecePerResearch\",\r\n  TimePiecePerEvent = \"TimePiecePerEvent\",\r\n  TimePiecePerWarpedSec = \"TimePiecePerWarpedSec\",\r\n  TimePiecePerMobMonstium = \"TimePiecePerMobMonstium\",\r\n  TimePiecePerCreaturesSec = \"TimePiecePerCreaturesSec\",\r\n  OfflineTimePieceGain = \"OfflineTimePieceGain\",\r\n  AttackDamageReceived = \"AttackDamageReceived\",\r\n  PostStunProtectionDuration = \"PostStunProtectionDuration\",\r\n  CanCastSpell = \"CanCastSpell\",\r\n\r\n  Action = \"Action\",\r\n  Spell = \"Spell\",\r\n  ActionEffect = \"ActionEffect\",\r\n  SpellCooldown = \"SpellCooldown\",\r\n  ActionMagnitude = \"ActionMagnitude\",\r\n  ActionVariance = \"ActionVariance\",\r\n  TemporaryEffectMagnitude = \"TemporaryEffectMagnitude\",\r\n  TemporaryEffectDuration = \"TemporaryEffectDuration\",\r\n  ItemEffect = \"ItemEffect\",\r\n  ItemQuality = \"ItemQuality\",\r\n  ItemCost = \"ItemCost\",\r\n}\r\n","export function clone<T>(obj: T): T {\r\n  return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\nexport function hashCode(str: string, seed: number = 1): number {\r\n  let h1 = 0xdeadbeef ^ seed,\r\n    h2 = 0x41c6ce57 ^ seed;\r\n  for (let i = 0, ch; i < str.length; i++) {\r\n    ch = str.charCodeAt(i);\r\n    h1 = Math.imul(h1 ^ ch, 2654435761);\r\n    h2 = Math.imul(h2 ^ ch, 1597334677);\r\n  }\r\n\r\n  h1 =\r\n    Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^\r\n    Math.imul(h2 ^ (h2 >>> 13), 3266489909);\r\n  h2 =\r\n    Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^\r\n    Math.imul(h1 ^ (h1 >>> 13), 3266489909);\r\n\r\n  return 4294967296 * (2097151 & h2) + (h1 >>> 0);\r\n}\r\n\r\nexport function getRandomElementFromArray<T>(arr: T[]): T {\r\n  const len = arr.length;\r\n  const idx = Math.floor(Math.random() * len);\r\n  return arr[idx];\r\n}\r\n","import { clone } from \"../utils/CoreUtils\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"./PlayerContext\";\r\n\r\nexport type PlayerContextListener = (\r\n  oldState: PlayerContextState,\r\n  newState: PlayerContextState,\r\n) => PlayerContextTransform | null | undefined | void;\r\n\r\nconst listeners: Record<string, PlayerContextListener> = {};\r\n\r\nexport function addContextListener(\r\n  id: string,\r\n  listener: PlayerContextListener,\r\n) {\r\n  listeners[id] = listener;\r\n}\r\n\r\nexport function clearContextListener(id: string) {\r\n  delete listeners[id];\r\n}\r\n\r\nexport function applyContextListeners(\r\n  oldState: PlayerContextState,\r\n  newState: PlayerContextState,\r\n): PlayerContextTransform[] {\r\n  const transforms = Object.values(listeners).map((listener) =>\r\n    listener(oldState, newState),\r\n  );\r\n\r\n  return transforms.filter(\r\n    (transform) => transform != null,\r\n  ) as PlayerContextTransform[];\r\n}\r\n\r\nexport function applyAllTransforms(\r\n  state: PlayerContextState,\r\n  transform: PlayerContextTransform,\r\n): PlayerContextState {\r\n  let transforms = [transform];\r\n  let oldState = state;\r\n  let newState = oldState;\r\n\r\n  do {\r\n    if (transforms.length > 0) {\r\n      oldState = newState;\r\n      // This needs to be cloned because otherwise the states are the same\r\n      newState = clone(oldState);\r\n      newState = transforms.reduce(\r\n        (accumulatedState, currentTransform) =>\r\n          currentTransform(accumulatedState),\r\n        newState,\r\n      );\r\n    }\r\n\r\n    transforms = applyContextListeners(oldState, newState);\r\n  } while (transforms.length > 0);\r\n\r\n  return newState;\r\n}\r\n","import { isIdentifiable } from \"./Identifiable\";\r\n\r\nexport class DataStore<T> {\r\n  store: Record<string, T> = {};\r\n  maxId: number = 1;\r\n\r\n  register(value: T) {\r\n    let id = (this.maxId++).toString();\r\n    if (isIdentifiable(value)) {\r\n      id = value.getId();\r\n    }\r\n    this.store[id] = value;\r\n  }\r\n\r\n  getById(id: string): T {\r\n    return this.store[id];\r\n  }\r\n\r\n  getAll(): T[] {\r\n    return Object.values(this.store);\r\n  }\r\n}\r\n","export interface Identifiable {\r\n  getId(): string;\r\n}\r\n\r\nexport function isIdentifiable(value: any): value is Identifiable {\r\n  return \"getId\" in value;\r\n}\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { PlayerContextTransform } from \"../PlayerContext\";\r\nimport { PlayerContextListener } from \"../PlayerContextListeners\";\r\n\r\nexport type OfflineTickTransform = (\r\n  secsPassed: number,\r\n) => PlayerContextTransform | null | undefined | void;\r\n\r\nexport class OfflineTickListener implements Identifiable {\r\n  id: string;\r\n  listener: OfflineTickTransform;\r\n\r\n  constructor(id: string, listener: OfflineTickTransform) {\r\n    this.id = id;\r\n    this.listener = listener;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getListener(): OfflineTickTransform {\r\n    return this.listener;\r\n  }\r\n}\r\n\r\nconst OfflineTickListeners = new DataStore<OfflineTickListener>();\r\n\r\nexport { OfflineTickListeners };\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { PlayerContextTransform } from \"../PlayerContext\";\r\n\r\nexport type WarpTimeTransform = (\r\n  secsPassed: number,\r\n) => PlayerContextTransform | null | undefined | void;\r\n\r\nexport class WarpTimeListener implements Identifiable {\r\n  id: string;\r\n  listener: WarpTimeTransform;\r\n\r\n  constructor(id: string, listener: WarpTimeTransform) {\r\n    this.id = id;\r\n    this.listener = listener;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getListener(): WarpTimeTransform {\r\n    return this.listener;\r\n  }\r\n}\r\n\r\nconst WarpTimeListeners = new DataStore<WarpTimeListener>();\r\n\r\nexport { WarpTimeListeners };\r\n","import { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { applyAllTransforms } from \"../PlayerContextListeners\";\r\nimport { OfflineTickListeners } from \"./OfflineTickListeners\";\r\nimport { WarpTimeListeners } from \"./WarpTimeListeners\";\r\n\r\ntype TimeTickListener = (\r\n  state: PlayerContextState,\r\n  timeElapsedSec: number,\r\n  isWarp: boolean,\r\n) => PlayerContextState;\r\n\r\nconst listeners: Record<string, TimeTickListener> = {};\r\n\r\nexport function nextFrame() {\r\n  return new Promise(function (resolve, reject) {\r\n    requestAnimationFrame(function () {\r\n      resolve(null);\r\n    });\r\n  });\r\n}\r\n\r\nexport function registerTimeTickListener(\r\n  id: string,\r\n  listener: TimeTickListener,\r\n) {\r\n  listeners[id] = listener;\r\n}\r\n\r\nexport function processTimeTick(\r\n  this: any,\r\n  timeElapsedSec: number,\r\n  isWarp: boolean,\r\n): PlayerContextTransform {\r\n  return (state) => {\r\n    const speedMultiplier = applyTransformations(\r\n      [TransformationTags.GameSpeed],\r\n      state,\r\n      1.0,\r\n    );\r\n    const timeElapsedSecAfterTransform = timeElapsedSec * speedMultiplier;\r\n    Object.values(listeners).forEach((listener) => {\r\n      state = listener(state, timeElapsedSecAfterTransform, isWarp);\r\n    });\r\n    return state;\r\n  };\r\n}\r\n\r\nconst WARP_TIME_PROCESSING_CONFIG_DEFAULT = {\r\n  secsPerTick: 1.0,\r\n};\r\n\r\nlet warpTimeProcessingConfig = WARP_TIME_PROCESSING_CONFIG_DEFAULT;\r\n\r\nexport function setWarpTimeSecsPerTick(secsPerTick: number): void {\r\n  warpTimeProcessingConfig = { secsPerTick: secsPerTick };\r\n}\r\n\r\nexport async function processOfflineTicks(\r\n  initialState: PlayerContextState,\r\n  secsTotal: number,\r\n  lastProcessedTime: number,\r\n  setPlayerState: (state: PlayerContextState) => void,\r\n): Promise<void> {\r\n  let currentState = initialState;\r\n  currentState.lastProcessedTime = lastProcessedTime;\r\n\r\n  OfflineTickListeners.getAll().forEach((listener) => {\r\n    const transform = listener.getListener()(secsTotal);\r\n    if (transform) {\r\n      currentState = transform(currentState);\r\n    }\r\n  });\r\n\r\n  setPlayerState(currentState);\r\n}\r\n\r\nexport async function processWarpTime(\r\n  initialState: PlayerContextState,\r\n  lastProcessedTime: () => number,\r\n  onLoadingProgress: (secsProcessedSoFar: number, ticksTotal: number) => void,\r\n  setPlayerState: (state: PlayerContextState) => void,\r\n): Promise<void> {\r\n  warpTimeProcessingConfig = WARP_TIME_PROCESSING_CONFIG_DEFAULT;\r\n  const secsTotal = initialState.warpTimeSecs;\r\n  let secsProcessedSoFar = 0;\r\n  let currentState = initialState;\r\n  onLoadingProgress(secsProcessedSoFar, secsTotal);\r\n  let ticksProcessedSoFar = 0;\r\n  while (secsProcessedSoFar < secsTotal) {\r\n    const speedMultiplier = applyTransformations(\r\n      [TransformationTags.GameSpeed],\r\n      currentState,\r\n      1.0,\r\n      { isWarp: true },\r\n    );\r\n    const secsPerTick = warpTimeProcessingConfig.secsPerTick / speedMultiplier;\r\n    const secsToProcess = Math.min(secsPerTick, secsTotal - secsProcessedSoFar);\r\n    const secsToProcessAfterTransform = secsToProcess * speedMultiplier;\r\n    currentState = applyAllTransforms(\r\n      currentState,\r\n      processTimeTick(secsToProcessAfterTransform, true),\r\n    );\r\n    secsProcessedSoFar += secsToProcess;\r\n    ticksProcessedSoFar += 1;\r\n    if ((ticksProcessedSoFar - 1) % 100 == 0) {\r\n      onLoadingProgress(secsProcessedSoFar, secsTotal);\r\n      await nextFrame();\r\n    }\r\n  }\r\n  currentState.lastProcessedTime = lastProcessedTime();\r\n  currentState.warpTimeSecs = 0;\r\n\r\n  WarpTimeListeners.getAll().forEach((listener) => {\r\n    const transform = listener.getListener()(secsTotal);\r\n    if (transform) {\r\n      currentState = transform(currentState);\r\n    }\r\n  });\r\n\r\n  setPlayerState(currentState);\r\n  onLoadingProgress(secsTotal, secsTotal);\r\n}\r\n","export enum ExplorationStatus {\r\n  None = \"None\",\r\n  Exploring = \"Exploring\",\r\n  ExploringBoss = \"ExploringBoss\",\r\n  Reviving = \"Reviving\",\r\n  Combat = \"Combat\",\r\n}\r\n","import React from \"react\";\r\nimport { BuildingData } from \"./buildings/Buildings\";\r\nimport Demo from \"./Demo\";\r\nimport { EventOccurrenceData } from \"./events/Events\";\r\nimport { EventTag } from \"./events/GameEvent\";\r\nimport { AttackTarget } from \"./exploration/AttackTarget\";\r\nimport { CombatStat } from \"./exploration/CombatStats\";\r\nimport { ExplorationStatus } from \"./exploration/ExplorationStatus\";\r\nimport { EquipmentSlot } from \"./items/Equipment\";\r\nimport { ItemOccurrence, ItemStack } from \"./items/Item\";\r\nimport { QuickbarData } from \"./Quickbar\";\r\nimport { Resource, ResourceData } from \"./Resources\";\r\nimport { School, SpellElement } from \"./spells/ElementsAndSchools\";\r\nimport { TemporaryEffectData } from \"./timetick/TemporaryEffects\";\r\n\r\nexport type PlayerContextGlobalState = {\r\n  secondsPlayed: number;\r\n  flags: Record<string, boolean>;\r\n  maxPrimarySchoolLevels: Partial<Record<School, number>>;\r\n  maxSchoolLevels: Partial<Record<School, number>>;\r\n  unlockedElements: Record<string, boolean>;\r\n  unlockedSchools: Record<School, boolean>;\r\n  researchersHiredLastRun: number;\r\n  timeCapsulesLastRun: number;\r\n  totalTimesResetted: number;\r\n  targetFps: number;\r\n  endingsTriggered: string[];\r\n  startTimestamp: number;\r\n  allowAnalytics: boolean;\r\n  appVersionTimestamp: number;\r\n  isFullVersionSave: boolean;\r\n  themeMode: \"light\" | \"dark\";\r\n  hideEventTags: EventTag[];\r\n  automaticallyBuiltBuildingsStartOff: boolean;\r\n  enableSwiping: boolean;\r\n};\r\n\r\nexport type PlayerContextEquipmentState = Record<\r\n  EquipmentSlot,\r\n  ItemOccurrence | undefined\r\n>;\r\n\r\nexport type CombatActionResult = {\r\n  id: string;\r\n  damage: number;\r\n  isHit: boolean;\r\n  isCrit: boolean;\r\n  time: number;\r\n  target: AttackTarget;\r\n  tags: string[];\r\n};\r\n\r\nexport type MessageLog = {\r\n  id: string;\r\n  timestamp: number;\r\n  message: string;\r\n};\r\n\r\nexport type EndingStats = {\r\n  endingId: string;\r\n  totalTimePlayed: number;\r\n  totalTimePlayedThisRun: number;\r\n  totalRealWorldTimePlayed?: number;\r\n  primarySchool: School;\r\n  primaryElement: SpellElement;\r\n  primarySchoolLevelOnEnding: number;\r\n  mpl: number;\r\n  researchMultiplier: number;\r\n  productionMultiplier: number;\r\n  completedStorylines: number;\r\n};\r\n\r\nexport type PlayerContextExplorationState = {\r\n  currentHP: number;\r\n  explorationStatus: ExplorationStatus;\r\n  explorationStartTime: number;\r\n  currentDungeonFloorId: string;\r\n  currentEnemy: {\r\n    id: string;\r\n    currentHP: number;\r\n  };\r\n  currentSummon:\r\n    | {\r\n        id: string;\r\n        currentHP: number;\r\n      }\r\n    | undefined;\r\n  successfulExplorationsPerFloor: Record<string, number>;\r\n  playerActionProgress: number;\r\n  summonActionProgress: number;\r\n  enemyActionProgress: number;\r\n  lastPlayerActionResult: CombatActionResult | undefined;\r\n  lastEnemyActionResult: CombatActionResult | undefined;\r\n  actionResultQueue: CombatActionResult[];\r\n  variables: Record<string, boolean>;\r\n};\r\n\r\nexport type PlayerContextState = {\r\n  resources: Partial<Record<Resource, ResourceData>>;\r\n  buildings: Record<string, BuildingData>;\r\n  flags: Record<string, boolean>;\r\n  elementExperience: Record<string, number>;\r\n  schoolExperience: Partial<Record<School, number>>;\r\n  schoolExponents: Partial<Record<School, number>>;\r\n  research: {\r\n    totalResearchers: number;\r\n    researcherAllocation: {\r\n      schools: Partial<Record<School, number>>;\r\n    };\r\n  };\r\n  autocast: {\r\n    apprenticeAllocation: Record<string, number>;\r\n    spellAutocastProgress: Record<string, number>;\r\n    apprenticesPaused: boolean;\r\n    loadouts: Record<string, Record<string, number>>;\r\n    lastLoadoutUsed: number;\r\n  };\r\n  creatures: {\r\n    totalCreatures: number;\r\n    creatureAllocation: Record<string, number>;\r\n    lastRewardTime: Record<string, number>;\r\n  };\r\n  eventQueue: string[];\r\n  eventOccurrences: Record<string, EventOccurrenceData>;\r\n  pityEnabledAtSeconds: number | undefined;\r\n  pityCounter: number;\r\n  nextEventIsManuallyTriggered: boolean;\r\n  global: PlayerContextGlobalState;\r\n  thisRun: {\r\n    secondsPlayed: number;\r\n    newFlagsOnRetirement: Record<string, boolean>;\r\n    endingTriggered: EndingStats | undefined;\r\n    startTimestamp: number;\r\n  };\r\n  temporaryEffects: Record<string, TemporaryEffectData | number>;\r\n  recentSpellsCast: string[];\r\n  nextRandomEvent: number;\r\n  primaryElement: string | undefined;\r\n  primarySchool: School | undefined;\r\n  inventory: ItemStack[];\r\n  equipment: PlayerContextEquipmentState;\r\n  exploration: PlayerContextExplorationState;\r\n  explorationMessageLog: MessageLog[];\r\n  creatureMessageLog: MessageLog[];\r\n  lastSpellCastTimes: Record<string, number>;\r\n  uiCommands: string[];\r\n  lastProcessedTime: number;\r\n  lastItemUsedTimes: Record<string, number>;\r\n  quickbar: QuickbarData[];\r\n  favoriteSpells: string[];\r\n  skipAheadTime: number;\r\n  warpTimeSecs: number;\r\n  summoningBlockedUntilTime: number;\r\n  strengtheningsBought: Record<CombatStat, number>;\r\n};\r\n\r\nexport type PlayerContextTransform = (\r\n  oldState: PlayerContextState,\r\n) => PlayerContextState;\r\n\r\nexport type PlayerContextValue = PlayerContextState & {\r\n  apply: (transform: PlayerContextTransform) => void;\r\n};\r\n\r\nexport const EXPLORATION_INITIAL_STATE: PlayerContextExplorationState = {\r\n  currentHP: 100,\r\n  explorationStatus: ExplorationStatus.None,\r\n  explorationStartTime: 0,\r\n  currentDungeonFloorId: \"\",\r\n  currentEnemy: {\r\n    id: \"\",\r\n    currentHP: 1,\r\n  },\r\n  currentSummon: undefined,\r\n  successfulExplorationsPerFloor: {},\r\n  playerActionProgress: 0.0,\r\n  summonActionProgress: 0.0,\r\n  enemyActionProgress: 0.0,\r\n  lastPlayerActionResult: undefined,\r\n  lastEnemyActionResult: undefined,\r\n  actionResultQueue: [],\r\n  variables: {},\r\n};\r\n\r\nexport const EQUIPMENT_INITIAL_STATE: PlayerContextEquipmentState = {\r\n  Hand: undefined,\r\n  Body: undefined,\r\n  Accessory: undefined,\r\n};\r\n\r\nexport const GLOBAL_INITIAL_STATE: PlayerContextGlobalState = {\r\n  secondsPlayed: 0,\r\n  flags: {},\r\n  maxPrimarySchoolLevels: {},\r\n  maxSchoolLevels: {},\r\n  unlockedElements: { Fire: true, Earth: true, Water: true, Air: true },\r\n  unlockedSchools: {\r\n    Conjuration: true,\r\n    Enchantment: true,\r\n    Illusion: true,\r\n    Alchemy: false,\r\n    Evocation: false,\r\n    Protection: false,\r\n    Breeding: false,\r\n    Summoning: false,\r\n    Divination: false,\r\n  },\r\n  researchersHiredLastRun: 0,\r\n  timeCapsulesLastRun: 0,\r\n  totalTimesResetted: 0,\r\n  targetFps: 30,\r\n  endingsTriggered: [],\r\n  startTimestamp: Date.now(),\r\n  allowAnalytics: false,\r\n  appVersionTimestamp: 0,\r\n  isFullVersionSave: !Demo.isDemo(),\r\n  themeMode: \"light\",\r\n  hideEventTags: [],\r\n  automaticallyBuiltBuildingsStartOff: false,\r\n  enableSwiping: true,\r\n};\r\n\r\nexport const THIS_RUN_INITIAL_STATE = {\r\n  secondsPlayed: 0,\r\n  newFlagsOnRetirement: {},\r\n  endingTriggered: undefined,\r\n  startTimestamp: Date.now(),\r\n};\r\n\r\nexport const PLAYER_INITIAL_STATE: PlayerContextState = {\r\n  resources: {},\r\n  buildings: {},\r\n  flags: {},\r\n  elementExperience: {\r\n    Fire: 0,\r\n    Earth: 0,\r\n    Water: 0,\r\n    Air: 0,\r\n  },\r\n  schoolExperience: {\r\n    Conjuration: 0,\r\n    Enchantment: 0,\r\n    Illusion: 0,\r\n  },\r\n  schoolExponents: {},\r\n  research: {\r\n    totalResearchers: 0,\r\n    researcherAllocation: {\r\n      schools: {},\r\n    },\r\n  },\r\n  autocast: {\r\n    apprenticeAllocation: {},\r\n    spellAutocastProgress: {},\r\n    apprenticesPaused: false,\r\n    loadouts: {},\r\n    lastLoadoutUsed: 0,\r\n  },\r\n  creatures: {\r\n    totalCreatures: 0,\r\n    creatureAllocation: {},\r\n    lastRewardTime: {},\r\n  },\r\n  eventQueue: [],\r\n  eventOccurrences: {},\r\n  pityEnabledAtSeconds: undefined,\r\n  pityCounter: 0,\r\n  nextEventIsManuallyTriggered: false,\r\n  global: GLOBAL_INITIAL_STATE,\r\n  thisRun: THIS_RUN_INITIAL_STATE,\r\n  temporaryEffects: {},\r\n  recentSpellsCast: [],\r\n  nextRandomEvent: 600,\r\n  primaryElement: undefined,\r\n  primarySchool: undefined,\r\n  inventory: [],\r\n  equipment: EQUIPMENT_INITIAL_STATE,\r\n  exploration: EXPLORATION_INITIAL_STATE,\r\n  explorationMessageLog: [],\r\n  creatureMessageLog: [],\r\n  lastSpellCastTimes: {},\r\n  uiCommands: [],\r\n  lastProcessedTime: Date.now(),\r\n  lastItemUsedTimes: {},\r\n  quickbar: [],\r\n  favoriteSpells: [],\r\n  skipAheadTime: 0,\r\n  warpTimeSecs: 0,\r\n  summoningBlockedUntilTime: 0,\r\n  strengtheningsBought: {\r\n    MaxHP: 0,\r\n    Attack: 0,\r\n    AttackDelay: 0,\r\n    Defense: 0,\r\n    HPRegen: 0,\r\n    Dodge: 0,\r\n    Accuracy: 0,\r\n    CritChance: 0,\r\n  },\r\n};\r\n\r\nexport const PlayerContext = React.createContext({\r\n  ...PLAYER_INITIAL_STATE,\r\n  apply: (transform: PlayerContextTransform) => {},\r\n  overwrite: (transform: PlayerContextTransform) => {},\r\n});\r\n","import { registerTimeTickListener } from \"./TimeTick\";\r\nimport {\r\n  GLOBAL_INITIAL_STATE,\r\n  PlayerContextState,\r\n  THIS_RUN_INITIAL_STATE,\r\n} from \"../PlayerContext\";\r\n\r\nexport function loadTotalTimePlayed() {\r\n  registerTimeTickListener(\"TotalTimePlayed\", (state, timeElapsedSec) => {\r\n    if (!state.global) {\r\n      state.global = GLOBAL_INITIAL_STATE;\r\n    }\r\n    if (!state.thisRun) {\r\n      state.thisRun = THIS_RUN_INITIAL_STATE;\r\n    }\r\n    state.global.secondsPlayed += timeElapsedSec;\r\n    state.thisRun.secondsPlayed += timeElapsedSec;\r\n    return state;\r\n  });\r\n}\r\n\r\nexport function getTotalSecondsPlayed(state: PlayerContextState) {\r\n  return state?.global?.secondsPlayed || 0;\r\n}\r\n\r\nexport function getSecondsPlayed(state: PlayerContextState) {\r\n  return state?.thisRun?.secondsPlayed || 0;\r\n}\r\n","import { PlayerContextState } from \"../PlayerContext\";\r\nimport { EventMessage, EventMessageOption } from \"./GameEvent\";\r\n\r\nclass EmptyEventMessageImpl implements EventMessage {\r\n  constructor() {}\r\n\r\n  getId(): string {\r\n    return \"empty\";\r\n  }\r\n  getTitle(params: any): string {\r\n    return \"[Deleted]\";\r\n  }\r\n  getDescription(state: PlayerContextState, params: any): string {\r\n    return \"This is a deleted game event\";\r\n  }\r\n  getAllowedOptions(\r\n    state: PlayerContextState,\r\n    params: any,\r\n  ): EventMessageOption[] {\r\n    return [];\r\n  }\r\n  isTerminal(): boolean {\r\n    return true;\r\n  }\r\n  isActionable(state: PlayerContextState, params: any): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst EmptyEventMessage = new EmptyEventMessageImpl();\r\n\r\nexport { EmptyEventMessage };\r\n","import { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { EmptyEventMessage } from \"./EmptyEventMessage\";\r\nimport {\r\n  EventMessage,\r\n  EventMessageOption,\r\n  EventTag,\r\n  GameEvent,\r\n} from \"./GameEvent\";\r\n\r\nconst eventMessages: Record<string, EventMessage> = {};\r\n\r\nexport function registerEventMessage(message: EventMessage) {\r\n  eventMessages[message.getId()] = message;\r\n}\r\n\r\nexport function eventMessageExists(id: string): boolean {\r\n  return Boolean(eventMessages?.[id]);\r\n}\r\n\r\nexport function getEventMessageById(id: string): EventMessage {\r\n  return (eventMessages?.[id] || EmptyEventMessage) as EventMessage;\r\n}\r\n\r\nexport type EventOccurrenceData = {\r\n  eventOccurrenceId: string;\r\n  eventId: string;\r\n  currentMessageId: string | null;\r\n  timestamp: number;\r\n  timestampSecondsPlayed: number;\r\n  params: any;\r\n  messageHistory: string[];\r\n};\r\n\r\nconst gameEvents: Record<string, GameEvent> = {};\r\n\r\nexport function registerGameEvent(event: GameEvent) {\r\n  gameEvents[event.getId()] = event;\r\n}\r\n\r\nexport function getGameEventById(id: string): GameEvent {\r\n  return gameEvents?.[id] as GameEvent;\r\n}\r\n\r\nexport function getAllGameEvents(): Record<string, GameEvent> {\r\n  return gameEvents;\r\n}\r\n\r\nexport function getEventOccurrenceById(\r\n  state: PlayerContextState,\r\n  id: string,\r\n): EventOccurrenceData | undefined {\r\n  return state.eventOccurrences?.[id];\r\n}\r\n\r\nfunction executeEventOccurrenceActionImpl(\r\n  occurrenceId: string,\r\n  selectedOption: EventMessageOption,\r\n  state: PlayerContextState,\r\n) {\r\n  const nextMessage = selectedOption.nextMessage;\r\n  if (nextMessage) {\r\n    if (state.eventOccurrences[occurrenceId].messageHistory == null) {\r\n      state.eventOccurrences[occurrenceId].messageHistory = [];\r\n    }\r\n    state.eventOccurrences[occurrenceId].messageHistory.push(\r\n      state.eventOccurrences[occurrenceId].currentMessageId as string,\r\n    );\r\n    state.eventOccurrences[occurrenceId].currentMessageId = nextMessage.getId();\r\n\r\n    // Do this to avoid accidentally cleaning up events after they go terminal\r\n    if (nextMessage.isTerminal()) {\r\n      state.eventOccurrences[occurrenceId].timestamp = Date.now();\r\n      state.eventOccurrences[occurrenceId].timestampSecondsPlayed =\r\n        getSecondsPlayed(state);\r\n    }\r\n  }\r\n\r\n  if (selectedOption.transform) {\r\n    state = selectedOption.transform(\r\n      state,\r\n      state.eventOccurrences[occurrenceId].params,\r\n    );\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function executeEventOccurrenceAction(\r\n  this: any,\r\n  occurrenceId: string,\r\n  selectedOption: EventMessageOption,\r\n): PlayerContextTransform {\r\n  return executeEventOccurrenceActionImpl.bind(\r\n    this,\r\n    occurrenceId,\r\n    selectedOption,\r\n  );\r\n}\r\n\r\nfunction addOccurrenceToQueueImpl(\r\n  occurrenceId: string,\r\n  state: PlayerContextState,\r\n) {\r\n  state.eventQueue.push(occurrenceId);\r\n  return state;\r\n}\r\n\r\nexport function addOccurrenceToQueue(\r\n  this: any,\r\n  occurrenceId: string,\r\n): PlayerContextTransform {\r\n  return addOccurrenceToQueueImpl.bind(this, occurrenceId);\r\n}\r\n\r\nfunction removeOccurrenceFromQueueImpl(\r\n  occurrenceId: string,\r\n  state: PlayerContextState,\r\n) {\r\n  const position = state.eventQueue.lastIndexOf(occurrenceId);\r\n  if (position >= 0) {\r\n    state.eventQueue.splice(position, 1);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function removeOccurrenceFromQueue(\r\n  this: any,\r\n  occurrenceId: string,\r\n): PlayerContextTransform {\r\n  return removeOccurrenceFromQueueImpl.bind(this, occurrenceId);\r\n}\r\n\r\nfunction triggerEventImpl(\r\n  event: GameEvent,\r\n  params: any,\r\n  extraTags: EventTag[],\r\n  state: PlayerContextState,\r\n) {\r\n  const transform = event.onTrigger();\r\n  if (transform) {\r\n    state = transform(state, params);\r\n  }\r\n\r\n  const totalTags = [];\r\n  totalTags.push(...event.getTags());\r\n  totalTags.push(...extraTags);\r\n  const occurrenceId = event.getId() + Date.now();\r\n  if (\r\n    shouldPopUpEventWithTags(state, totalTags) ||\r\n    state.nextEventIsManuallyTriggered\r\n  ) {\r\n    state.eventQueue.unshift(occurrenceId);\r\n  }\r\n  state.eventOccurrences[occurrenceId] = {\r\n    eventOccurrenceId: occurrenceId,\r\n    eventId: event.getId(),\r\n    currentMessageId: event.getMainEventMessage().getId(),\r\n    timestamp: Date.now(),\r\n    timestampSecondsPlayed: getSecondsPlayed(state),\r\n    params,\r\n    messageHistory: [],\r\n  };\r\n  state.nextEventIsManuallyTriggered = false;\r\n  return state;\r\n}\r\n\r\nexport function triggerEvent(\r\n  this: any,\r\n  event: GameEvent,\r\n  params?: any,\r\n  extraTags?: EventTag[],\r\n): PlayerContextTransform {\r\n  return triggerEventImpl.bind(this, event, params || {}, extraTags ?? []);\r\n}\r\n\r\nexport function shouldHideEventsWithTag(\r\n  state: PlayerContextState,\r\n  tag: EventTag,\r\n): boolean {\r\n  return state.global.hideEventTags.includes(tag);\r\n}\r\n\r\nexport function shouldPopUpEventWithTags(\r\n  state: PlayerContextState,\r\n  tags: EventTag[],\r\n): boolean {\r\n  return !state.global.hideEventTags.some((tag) => tags.includes(tag));\r\n}\r\n","import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { Buffer } from \"buffer\";\r\nimport deepmerge from \"deepmerge\";\r\nimport zlib from \"react-zlib-js\";\r\nimport { promisify } from \"util\";\r\nimport { PlayerContextState, PLAYER_INITIAL_STATE } from \"./PlayerContext\";\r\nimport { getTotalSecondsPlayed } from \"./timetick/TotalTimePlayed\";\r\n\r\nconst gzipCompress = promisify(zlib.gzip);\r\nconst gzipDecompress = promisify(zlib.gunzip);\r\n\r\nexport async function loadData(): Promise<PlayerContextState> {\r\n  const jsonValue = await AsyncStorage.getItem(\"PlayerContextState\");\r\n  if (jsonValue !== null) {\r\n    const state = JSON.parse(jsonValue);\r\n\r\n    // Fix all the save compatibility changes\r\n    return makeCompatible(state);\r\n  }\r\n  return PLAYER_INITIAL_STATE;\r\n}\r\n\r\nexport async function saveData(state: PlayerContextState): Promise<void> {\r\n  const lastSaveDataTime = Number.parseFloat(\r\n    (await AsyncStorage.getItem(\"LastSaveSecondsPlayed\")) || \"0\",\r\n  );\r\n  if (getTotalSecondsPlayed(state) > lastSaveDataTime) {\r\n    await saveDataUnsafe(state);\r\n  }\r\n}\r\n\r\nexport async function saveDataUnsafe(state: PlayerContextState): Promise<void> {\r\n  const jsonValue = JSON.stringify(state);\r\n  await AsyncStorage.setItem(\r\n    \"LastSaveSecondsPlayed\",\r\n    getTotalSecondsPlayed(state).toString(),\r\n  );\r\n  await AsyncStorage.setItem(\"PlayerContextState\", jsonValue);\r\n}\r\n\r\nfunction makeCompatible(obj: PlayerContextState): PlayerContextState {\r\n  return deepmerge(PLAYER_INITIAL_STATE, obj);\r\n}\r\n\r\nexport async function loadBase64Data(\r\n  saveData: string,\r\n): Promise<PlayerContextState | null> {\r\n  const decodedBuffer = Buffer.from(\r\n    Buffer.from(saveData, \"base64\").toString(),\r\n    \"base64\",\r\n  );\r\n  const decodedJSON = await gzipDecompress(decodedBuffer);\r\n  const decodedData = JSON.parse(decodedJSON.toString());\r\n  if (decodedData !== null) {\r\n    return makeCompatible(decodedData);\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function serializeSaveData(\r\n  state: PlayerContextState,\r\n): Promise<string> {\r\n  const compressedJSON = await gzipCompress(JSON.stringify(state));\r\n  // Double converting to Base64 so it copies well on Android\r\n  return Buffer.from(compressedJSON.toString(\"base64\")).toString(\"base64\");\r\n}\r\n","import { clone } from \"../utils/CoreUtils\";\r\nimport { PlayerContextState, PLAYER_INITIAL_STATE } from \"./PlayerContext\";\r\n\r\nexport type RetirementListenerTransform = (\r\n  state: PlayerContextState,\r\n  isMock: boolean,\r\n) => PlayerContextState;\r\nconst retirementListeners: Record<string, RetirementListenerTransform> = {};\r\nconst postRetirementListeners: Record<string, RetirementListenerTransform> = {};\r\n\r\nexport function registerRetirementListener(\r\n  id: string,\r\n  listener: RetirementListenerTransform,\r\n) {\r\n  retirementListeners[id] = listener;\r\n}\r\n\r\nexport function registerPostRetirementListener(\r\n  id: string,\r\n  listener: RetirementListenerTransform,\r\n) {\r\n  postRetirementListeners[id] = listener;\r\n}\r\n\r\nexport function retire(state: PlayerContextState, isMock: boolean) {\r\n  Object.keys(retirementListeners).forEach((listenerId) => {\r\n    state = retirementListeners[listenerId](state, isMock);\r\n  });\r\n\r\n  state.global.totalTimesResetted += 1;\r\n\r\n  let newState = clone(PLAYER_INITIAL_STATE);\r\n  newState.lastProcessedTime = Date.now();\r\n  newState.global = state.global;\r\n  Object.keys(postRetirementListeners).forEach((listenerId) => {\r\n    newState = postRetirementListeners[listenerId](newState, isMock);\r\n  });\r\n  return newState;\r\n}\r\n","import memoize from \"fast-memoize\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport {\r\n  GLOBAL_INITIAL_STATE,\r\n  PlayerContextState,\r\n  PlayerContextTransform,\r\n} from \"../PlayerContext\";\r\nimport { addContextListener } from \"../PlayerContextListeners\";\r\nimport { registerRetirementListener } from \"../Retire\";\r\n\r\nexport enum SpellElement {\r\n  Fire = \"Fire\",\r\n  Earth = \"Earth\",\r\n  Air = \"Air\",\r\n  Water = \"Water\",\r\n  Nature = \"Nature\",\r\n  Lightning = \"Lightning\",\r\n  Darkness = \"Darkness\",\r\n}\r\n\r\nexport enum School {\r\n  Conjuration = \"Conjuration\",\r\n  Enchantment = \"Enchantment\",\r\n  Illusion = \"Illusion\",\r\n  Alchemy = \"Alchemy\",\r\n  Evocation = \"Evocation\",\r\n  Protection = \"Protection\",\r\n  Breeding = \"Breeding\",\r\n  Summoning = \"Summoning\",\r\n  Divination = \"Divination\",\r\n}\r\n\r\nexport const SCHOOL_LEVEL_CAP = 60;\r\n\r\nconst expTable = new Map<number, Map<number, number>>();\r\n\r\nexport function getSchoolExp(\r\n  state: PlayerContextState,\r\n  school: School,\r\n): number {\r\n  return state.schoolExperience?.[school] || 0;\r\n}\r\n\r\nconst getIncrementalExpRequiredForLevelAndExponent = memoize(\r\n  (level: number, exponent: number): number => {\r\n    if (level <= 1) {\r\n      return 0;\r\n    }\r\n    if (level > SCHOOL_LEVEL_CAP) {\r\n      return Infinity;\r\n    }\r\n    return Math.floor(1000 * Math.pow(exponent, level - 2));\r\n  },\r\n);\r\n\r\nconst getTotalExpRequiredForLevelByExponent = (\r\n  level: number,\r\n  exponent: number,\r\n): number => {\r\n  if (level <= 1) {\r\n    return 0;\r\n  }\r\n  const cachedExp = expTable.get(exponent)?.get(level);\r\n  if (cachedExp != null) {\r\n    return cachedExp;\r\n  }\r\n  return (\r\n    getTotalExpRequiredForLevelByExponent(level - 1, exponent) +\r\n    getIncrementalExpRequiredForLevelAndExponent(level, exponent)\r\n  );\r\n};\r\n\r\nconst getLevelByExpAndExponent = (exp: number, exponent: number): number => {\r\n  let level = 1;\r\n  while (getTotalExpRequiredForLevelByExponent(level + 1, exponent) <= exp) {\r\n    level += 1;\r\n  }\r\n  return level;\r\n};\r\n\r\nfunction getExponentForSchool(\r\n  state: PlayerContextState,\r\n  school: School,\r\n): number {\r\n  if (state?.schoolExponents?.[school] == null) {\r\n    const primary = state.primarySchool === school;\r\n    const exponent = applyTransformations(\r\n      [TransformationTags.ExpRequirementScale, school],\r\n      state,\r\n      primary ? 1.4 : 1.5,\r\n      { school: school },\r\n    );\r\n    state.schoolExponents[school] = exponent;\r\n  }\r\n  return state.schoolExponents[school] ?? 1.5;\r\n}\r\n\r\nexport function getIncrementalExpRequiredForLevel(\r\n  state: PlayerContextState,\r\n  level: number,\r\n  school: School,\r\n): number {\r\n  const exponent = getExponentForSchool(state, school);\r\n  return getIncrementalExpRequiredForLevelAndExponent(level, exponent);\r\n}\r\n\r\nexport function getTotalExpRequiredForLevel(\r\n  state: PlayerContextState,\r\n  level: number,\r\n  school: School,\r\n): number {\r\n  const exponent = getExponentForSchool(state, school);\r\n  return getTotalExpRequiredForLevelByExponent(level, exponent);\r\n}\r\n\r\nfunction getLevelByExp(\r\n  state: PlayerContextState,\r\n  exp: number,\r\n  school: School,\r\n): number {\r\n  const exponent = getExponentForSchool(state, school);\r\n  return getLevelByExpAndExponent(exp, exponent);\r\n}\r\n\r\nexport function getSchoolLevel(\r\n  state: PlayerContextState,\r\n  school: School,\r\n): number {\r\n  return getLevelByExp(state, state.schoolExperience?.[school] || 0, school);\r\n}\r\n\r\nfunction grantSchoolExpImpl(\r\n  school: School,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n) {\r\n  let current = getSchoolExp(state, school);\r\n  current += amount;\r\n  current = Math.max(current, 0);\r\n  state.schoolExperience[school] = current;\r\n  return state;\r\n}\r\n\r\nexport function grantSchoolExp(\r\n  this: any,\r\n  school: School,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return grantSchoolExpImpl.bind(this, school, amount);\r\n}\r\n\r\nexport function getTotalElementAndSchoolExp(state: PlayerContextState): number {\r\n  let totalExp = 0;\r\n  for (let school in state.schoolExperience) {\r\n    totalExp += getSchoolExp(state, school as School);\r\n  }\r\n  return totalExp;\r\n}\r\n\r\nfunction selectPrimaryElementImpl(element: string, state: PlayerContextState) {\r\n  state.primaryElement = element;\r\n  return state;\r\n}\r\n\r\nexport function selectPrimaryElement(\r\n  this: any,\r\n  element: string,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return selectPrimaryElementImpl.bind(this, element);\r\n}\r\n\r\nfunction selectPrimarySchoolImpl(school: School, state: PlayerContextState) {\r\n  state.primarySchool = school;\r\n  state.schoolExponents = {};\r\n\r\n  // Selecting a primary school means we started the game\r\n  state.thisRun.startTimestamp = Date.now();\r\n  if (state.global.totalTimesResetted == 0) {\r\n    state.global.startTimestamp = Date.now();\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function selectPrimarySchool(\r\n  this: any,\r\n  school: School,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return selectPrimarySchoolImpl.bind(this, school);\r\n}\r\n\r\nexport function getUnlockedElements(state: PlayerContextState): string[] {\r\n  return Object.keys((state?.global || GLOBAL_INITIAL_STATE).unlockedElements);\r\n}\r\n\r\nfunction unlockElementImpl(element: string, state: PlayerContextState) {\r\n  if (!state.global) {\r\n    state.global = GLOBAL_INITIAL_STATE;\r\n  }\r\n  state.global.unlockedElements[element] = true;\r\n  return state;\r\n}\r\n\r\nexport function unlockElement(\r\n  this: any,\r\n  element: string,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return unlockElementImpl.bind(this, element);\r\n}\r\n\r\nfunction unlockSchoolImpl(school: School, state: PlayerContextState) {\r\n  if (!state.global) {\r\n    state.global = GLOBAL_INITIAL_STATE;\r\n  }\r\n  state.global.unlockedSchools[school] = true;\r\n  return state;\r\n}\r\n\r\nexport function unlockSchool(\r\n  this: any,\r\n  school: School,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return unlockSchoolImpl.bind(this, school);\r\n}\r\n\r\nexport function getUnlockedSchools(state: PlayerContextState): School[] {\r\n  return Object.keys(\r\n    (state?.global || GLOBAL_INITIAL_STATE).unlockedSchools,\r\n  ).filter(\r\n    (school) =>\r\n      (state?.global || GLOBAL_INITIAL_STATE).unlockedSchools[school as School],\r\n  ) as School[];\r\n}\r\n\r\nfor (let school in School) {\r\n  registerTransformation(\r\n    [[school, TransformationTags.Research]],\r\n    school + \"PrimarySchoolMultiplier\",\r\n    TransformationType.Multiplier,\r\n    (state) => (state.primarySchool === school ? 2.0 : 1.0),\r\n  );\r\n}\r\n\r\nexport function getMaxPrimarySchoolLevel(\r\n  state: PlayerContextState,\r\n  school: School,\r\n): number {\r\n  return Math.min(\r\n    state?.global?.maxPrimarySchoolLevels?.[school] || 0,\r\n    SCHOOL_LEVEL_CAP,\r\n  );\r\n}\r\n\r\nexport function getMaxOfMaxPrimarySchoolLevels(\r\n  state: PlayerContextState,\r\n): number {\r\n  const maxSchoolLevels = state?.global?.maxPrimarySchoolLevels || {};\r\n  let max = 0;\r\n  for (let school in maxSchoolLevels) {\r\n    max = Math.min(\r\n      Math.max(max, maxSchoolLevels[school as School] || 0),\r\n      SCHOOL_LEVEL_CAP,\r\n    );\r\n  }\r\n  return max;\r\n}\r\n\r\nexport function getSumOfMaxPrimarySchoolLevels(\r\n  state: PlayerContextState,\r\n): number {\r\n  const maxSchoolLevels = state?.global?.maxPrimarySchoolLevels || {};\r\n  let total = 0;\r\n  for (let school in maxSchoolLevels) {\r\n    total += Math.min(maxSchoolLevels[school as School] || 0, SCHOOL_LEVEL_CAP);\r\n  }\r\n  return total;\r\n}\r\n\r\nexport function maximumSchoolLevelResearchMultiplier(\r\n  state: PlayerContextState,\r\n) {\r\n  const maxLevel = Math.max(getMaxOfMaxPrimarySchoolLevels(state), 1);\r\n  const sumOfLevels = getSumOfMaxPrimarySchoolLevels(state);\r\n  const researchMultiplier =\r\n    (1 + (Math.pow(1.12, maxLevel - 1) - 1) / 1.8) *\r\n    (Math.sqrt(16 + sumOfLevels) / 4);\r\n  return researchMultiplier;\r\n}\r\n\r\nexport function maximumSchoolLevelProductionMultiplier(\r\n  state: PlayerContextState,\r\n  multiplier: number,\r\n) {\r\n  return multiplier * maximumSchoolLevelProductionMultiplierDx(state);\r\n}\r\n\r\nexport function maximumSchoolLevelProductionMultiplierDx(\r\n  state: PlayerContextState,\r\n) {\r\n  const researchMultiplier = maximumSchoolLevelResearchMultiplier(state);\r\n  return 1 + (Math.pow(researchMultiplier, 0.4) - 1) / 3.2;\r\n}\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Research]],\r\n  \"MSLResearch\",\r\n  TransformationType.Multiplier,\r\n  maximumSchoolLevelResearchMultiplier,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Production]],\r\n  \"MSLProduction\",\r\n  TransformationType.Multiplier,\r\n  maximumSchoolLevelProductionMultiplierDx,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Loot]],\r\n  \"MSLLoot\",\r\n  TransformationType.Multiplier,\r\n  maximumSchoolLevelProductionMultiplierDx,\r\n);\r\n\r\naddContextListener(\"MaxMaxSchoolLevels\", (oldState, newState) => {\r\n  const schools = getUnlockedSchools(newState);\r\n  const newMaxes = newState.global.maxSchoolLevels;\r\n  let update = false;\r\n  schools.forEach((school) => {\r\n    const previousMax = newState.global.maxSchoolLevels?.[school] ?? 0;\r\n    const newLevel = getSchoolLevel(newState, school);\r\n    if (newLevel > previousMax) {\r\n      newMaxes[school] = newLevel;\r\n      update = true;\r\n    }\r\n  });\r\n  if (update) {\r\n    return (state) => {\r\n      state.global.maxSchoolLevels = newMaxes;\r\n      return state;\r\n    };\r\n  }\r\n});\r\n\r\nObject.keys(SpellElement).forEach((element) => {\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Cost,\r\n        element,\r\n        \"Area:Campus\",\r\n        TransformationTags.Spell,\r\n      ],\r\n    ],\r\n    element + \"SpellCostReducer\",\r\n    TransformationType.Multiplier,\r\n    (state) => (state.primaryElement == element ? 0.5 : 1),\r\n  );\r\n});\r\n\r\nfunction retirementListener(state: PlayerContextState): PlayerContextState {\r\n  const primarySchool = state?.primarySchool;\r\n  if (!state.global) {\r\n    state.global = GLOBAL_INITIAL_STATE;\r\n  }\r\n  if (primarySchool) {\r\n    const level = getSchoolLevel(state, primarySchool);\r\n    state.global.maxPrimarySchoolLevels[primarySchool] = Math.max(\r\n      getMaxPrimarySchoolLevel(state, primarySchool),\r\n      level,\r\n    );\r\n  }\r\n  return state;\r\n}\r\n\r\nregisterRetirementListener(\"mpl\", retirementListener);\r\n\r\nexport function meetsRequirements(\r\n  state: PlayerContextState,\r\n  schoolRequirements: Partial<Record<School, number>>,\r\n): boolean {\r\n  if (\r\n    Object.keys(schoolRequirements).some((schoolName) => {\r\n      const levelRequirement = schoolRequirements[schoolName as School] || 0;\r\n      if (levelRequirement <= 0) {\r\n        return false;\r\n      }\r\n      return (\r\n        getSchoolLevel(state, schoolName as School) <\r\n          (schoolRequirements[schoolName as School] || 0) ||\r\n        !getUnlockedSchools(state).includes(schoolName as School)\r\n      );\r\n    })\r\n  ) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nconst cachedExponents = [1.4, 1.42, 1.5];\r\ncachedExponents.forEach((exponent) => expTable.set(exponent, new Map()));\r\n\r\nfor (let level = 1; level < 100; level++) {\r\n  cachedExponents.forEach((exponent) => {\r\n    expTable\r\n      .get(exponent)\r\n      ?.set(level, getTotalExpRequiredForLevelByExponent(level, exponent));\r\n  });\r\n}\r\n","import { PlayerContextState } from \"./PlayerContext\";\r\n\r\nexport function getUICommands(state: PlayerContextState) {\r\n  return state?.uiCommands || [];\r\n}\r\n\r\nexport function clearUICommands(state: PlayerContextState) {\r\n  state.uiCommands = [];\r\n  return state;\r\n}\r\n\r\nexport function addUICommand(\r\n  state: PlayerContextState,\r\n  command: string,\r\n): PlayerContextState {\r\n  if (!state.uiCommands) {\r\n    state.uiCommands = [];\r\n  }\r\n  state.uiCommands.push(command);\r\n  return state;\r\n}\r\n","import Constants from \"expo-constants\";\r\n\r\nexport function getCurrentVersionTimestamp(): number | undefined {\r\n  return Constants?.expoConfig?.extra?.buildRunTimestamp;\r\n}\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Text as ReactNativeElementsText, Icon } from \"react-native-elements\";\r\n\r\nfunction TextNonMemoized(props: any) {\r\n  return (\r\n    <ReactNativeElementsText\r\n      h1Style={styles.h1}\r\n      h2Style={styles.h2}\r\n      h3Style={styles.h3}\r\n      h4Style={styles.h4}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nconst Text = React.memo(TextNonMemoized);\r\n\r\nexport { Text };\r\n\r\n/*\r\nexport function Text(props: any) {\r\n  let children = props.children || [];\r\n  if (!Array.isArray(children)) {\r\n    children = [children];\r\n  }\r\n  const newChildren = children.map((child: any) => {\r\n    if (typeof child == \"string\") {\r\n      const splitString = child.split(\"{wood}\");\r\n      const newStringChildren = [\r\n        <StyledText props={props}>{splitString[0]}</StyledText>,\r\n      ] as Object[];\r\n      for (let i = 1; i < splitString.length; i++) {\r\n        newStringChildren.push(<Icon name=\"close\" />);\r\n        newStringChildren.push(\r\n          <StyledText props={props}>{splitString[i]}</StyledText>,\r\n        );\r\n      }\r\n      return <View>{newStringChildren}</View>;\r\n    }\r\n    //return child;\r\n  });\r\n  return <View>{newChildren}</View>;\r\n}*/\r\n\r\nconst styles = StyleSheet.create({\r\n  h1: {\r\n    fontSize: 20,\r\n  },\r\n  h2: {\r\n    fontSize: 18,\r\n  },\r\n  h3: {\r\n    fontSize: 16,\r\n  },\r\n  h4: {\r\n    fontSize: 14,\r\n  },\r\n});\r\n","import {\r\n  EXPLORATION_INITIAL_STATE,\r\n  GLOBAL_INITIAL_STATE,\r\n  PlayerContextState,\r\n  PlayerContextTransform,\r\n  THIS_RUN_INITIAL_STATE,\r\n} from \"./PlayerContext\";\r\nimport { registerRetirementListener } from \"./Retire\";\r\n\r\nexport function hasFlag(state: PlayerContextState, flag: string) {\r\n  return state.flags?.[flag] || false;\r\n}\r\n\r\nfunction setFlagImpl(flag: string, state: PlayerContextState) {\r\n  state.flags[flag] = true;\r\n  return state;\r\n}\r\n\r\nexport function setFlag(this: any, flag: string): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return setFlagImpl.bind(this, flag);\r\n}\r\n\r\nfunction clearFlagImpl(flag: string, state: PlayerContextState) {\r\n  state.flags[flag] = false;\r\n  return state;\r\n}\r\n\r\nexport function clearFlag(this: any, flag: string): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return clearFlagImpl.bind(this, flag);\r\n}\r\n\r\nexport function setGlobalFlagForNextRunImpl(\r\n  flag: string,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!state.thisRun) {\r\n    state.thisRun = THIS_RUN_INITIAL_STATE;\r\n  }\r\n  state.thisRun.newFlagsOnRetirement[flag] = true;\r\n  return state;\r\n}\r\n\r\nexport function setGlobalFlagForNextRun(\r\n  this: any,\r\n  flag: string,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return setGlobalFlagForNextRunImpl.bind(this, flag);\r\n}\r\n\r\nexport function setGlobalFlagImpl(\r\n  flag: string,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!state.global) {\r\n    state.global = GLOBAL_INITIAL_STATE;\r\n  }\r\n  state.global.flags[flag] = true;\r\n  return state;\r\n}\r\n\r\nexport function setGlobalFlag(this: any, flag: string): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return setGlobalFlagImpl.bind(this, flag);\r\n}\r\n\r\nexport function hasGlobalFlag(\r\n  state: PlayerContextState,\r\n  flag: string,\r\n): boolean {\r\n  return state?.global?.flags?.[flag] || false;\r\n}\r\n\r\nexport function hasGlobalFlagIncludingNextRun(\r\n  state: PlayerContextState,\r\n  flag: string,\r\n): boolean {\r\n  return (\r\n    state?.global?.flags?.[flag] ||\r\n    state?.thisRun?.newFlagsOnRetirement?.[flag] ||\r\n    false\r\n  );\r\n}\r\n\r\nfunction setCombatVariableImpl(\r\n  variable: string,\r\n  value: any,\r\n  state: PlayerContextState,\r\n) {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.variables[variable] = value;\r\n  return state;\r\n}\r\n\r\nexport function setCombatVariable(\r\n  this: any,\r\n  variable: string,\r\n  value: any,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return setCombatVariableImpl.bind(this, variable, value);\r\n}\r\n\r\nfunction clearCombatVariableImpl(variable: string, state: PlayerContextState) {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  delete state.exploration.variables[variable];\r\n  return state;\r\n}\r\n\r\nexport function clearCombatVariable(\r\n  this: any,\r\n  variable: string,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return clearCombatVariableImpl.bind(this, variable);\r\n}\r\n\r\nexport function resetAllCombatVariables(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.variables = {};\r\n  return state;\r\n}\r\n\r\nexport function getCombatVariable(\r\n  state: PlayerContextState,\r\n  variable: string,\r\n): any {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  return state.exploration?.variables[variable];\r\n}\r\n\r\nfunction onRetirement(state: PlayerContextState): PlayerContextState {\r\n  if (!state.global) {\r\n    state.global = GLOBAL_INITIAL_STATE;\r\n  }\r\n  for (let flag in state?.thisRun?.newFlagsOnRetirement || {}) {\r\n    state.global.flags[flag] = true;\r\n  }\r\n  return state;\r\n}\r\n\r\nregisterRetirementListener(\"new_flags\", onRetirement);\r\n","import { clone } from \"../../utils/CoreUtils\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport {\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedSchools,\r\n} from \"../spells/ElementsAndSchools\";\r\nimport { Item } from \"./Item\";\r\n\r\nconst items: Record<string, Item> = {};\r\n\r\nexport function registerItem(item: Item) {\r\n  items[item.getId()] = item;\r\n}\r\n\r\nexport function getItemById(id: string): Item {\r\n  return items?.[id] as Item;\r\n}\r\n\r\nexport function getItemByIdNullable(id: string): Item | undefined {\r\n  return items?.[id];\r\n}\r\n\r\nexport function getCraftableItems(state: PlayerContextState): Item[] {\r\n  if (!isCraftingUnlocked(state)) {\r\n    return [];\r\n  }\r\n\r\n  return Object.values(items).filter((item) => item.isCraftable(state));\r\n}\r\n\r\nexport function isInventoryUnlocked(state: PlayerContextState): boolean {\r\n  return (\r\n    hasFlag(state, \"new_inventory_unlocked\") ||\r\n    hasFlag(state, \"inventory_unlocked\")\r\n  );\r\n}\r\n\r\nexport function isCraftingUnlocked(state: PlayerContextState): boolean {\r\n  return (\r\n    hasFlag(state, \"crafting_unlocked\") || hasFlag(state, \"inventory_unlocked\")\r\n  );\r\n}\r\n\r\nexport function getAllItemsEverCraftable(state: PlayerContextState): Item[] {\r\n  const modifiedContext = clone(state);\r\n  getUnlockedSchools(modifiedContext).forEach((school) => {\r\n    modifiedContext.schoolExperience[school] = getTotalExpRequiredForLevel(\r\n      modifiedContext,\r\n      state.global.maxSchoolLevels?.[school] ?? 1,\r\n      school,\r\n    );\r\n  });\r\n  return getCraftableItems(modifiedContext);\r\n}\r\n","import { ImageSourcePropType } from \"react-native\";\r\n\r\nexport function sanitizeImageSourceForElectron(\r\n  imageSource?: ImageSourcePropType,\r\n): ImageSourcePropType {\r\n  // @ts-ignore This is done on purpose as it is not really a RN source\r\n  if (imageSource?.default != null) {\r\n    // @ts-ignore This is done on purpose as it is not really a RN source\r\n    return imageSource.default;\r\n  }\r\n  // @ts-ignore Also done on purpose as it can be undefined, but we swallow it\r\n  return imageSource;\r\n}\r\n","import React from \"react\";\r\nimport { Image, ImageProps, ImageSourcePropType } from \"react-native\";\r\nimport { getItemByIdNullable } from \"../../../backend/items/Items\";\r\nimport { sanitizeImageSourceForElectron } from \"./IconUtils\";\r\n\r\ntype IconProps = Omit<ImageProps, \"source\"> & {\r\n  icon: string;\r\n  small?: boolean;\r\n};\r\n\r\nconst icons: Record<string, ImageSourcePropType> = {\r\n  stone: require(\"./assets/stone.png\"),\r\n  wood: require(\"./assets/wood.png\"),\r\n  coins: require(\"./assets/coins.png\"),\r\n  mana: require(\"./assets/mana.png\"),\r\n  iron: require(\"./assets/iron.png\"),\r\n  water: require(\"./assets/water.png\"),\r\n  boost: require(\"./assets/boost.png\"),\r\n  temperature: require(\"./assets/temperature.png\"),\r\n  attack: require(\"./assets/attack.png\"),\r\n  attackDelay: require(\"./assets/attackDelay.png\"),\r\n  defense: require(\"./assets/defense.png\"),\r\n  hp: require(\"./assets/hp.png\"),\r\n  hpRegen: require(\"./assets/hpRegen.png\"),\r\n  monstium: require(\"./assets/monstium.png\"),\r\n  debuff: require(\"./assets/debuff.png\"),\r\n  generic: require(\"./assets/generic.png\"),\r\n  accuracy: require(\"./assets/accuracy.png\"),\r\n  dodge: require(\"./assets/dodge.png\"),\r\n  timepiece: require(\"./assets/timepiece.png\"),\r\n  critChance: require(\"./assets/critChance.png\"),\r\n  electricity: require(\"./assets/electricity.png\"),\r\n\r\n  // =======\r\n\r\n  about: require(\"./assets/about.png\"),\r\n  apprentices: require(\"./assets/apprentices.png\"),\r\n  campus: require(\"./assets/campus.png\"),\r\n  creatures: require(\"./assets/creatures.png\"),\r\n  ending: require(\"./assets/ending.png\"),\r\n  exploration: require(\"./assets/exploration.png\"),\r\n  help: require(\"./assets/help.png\"),\r\n  inventory: require(\"./assets/inventory.png\"),\r\n  options: require(\"./assets/options.png\"),\r\n  research: require(\"./assets/research.png\"),\r\n  retirement: require(\"./assets/retirement.png\"),\r\n  stats: require(\"./assets/stats.png\"),\r\n  strengthen: require(\"./assets/strengthening.png\"),\r\n  upgrades: require(\"./assets/upgrades.png\"),\r\n};\r\n\r\nfunction GameIconNonMemo(props: IconProps) {\r\n  const { icon, style, ...otherProps } = props;\r\n  let imageSource = icons[icon];\r\n  if (!imageSource) {\r\n    // It could be an item\r\n    const item = getItemByIdNullable(icon);\r\n    if (item) {\r\n      imageSource = item.getPicture();\r\n    }\r\n  }\r\n  if (!imageSource) {\r\n    return null;\r\n  }\r\n  const computedStyle = [\r\n    { width: 32, height: 32 },\r\n    style,\r\n    props.small ? { width: 16, height: 16 } : {},\r\n  ];\r\n\r\n  return (\r\n    <Image\r\n      source={sanitizeImageSourceForElectron(imageSource)}\r\n      style={computedStyle}\r\n      {...otherProps}\r\n    />\r\n  );\r\n}\r\n\r\nconst GameIcon = React.memo(GameIconNonMemo);\r\n\r\nexport { GameIcon };\r\n","import Plugin from \"markdown-it-regexp\";\r\n\r\nconst plugin = Plugin(\r\n  // regexp to match\r\n  /\\:([a-zA-Z_-]+)\\:/,\r\n\r\n  // this function will be called when something matches\r\n  (match: any[], utils: any) => {\r\n    const icon = match[1];\r\n\r\n    return icon;\r\n  },\r\n);\r\n\r\nexport default plugin;\r\n","import React from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport LibraryMarkdown, {\r\n  getUniqueID,\r\n  MarkdownIt,\r\n} from \"react-native-markdown-display\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport MarkdownIconPlugin from \"./markdown/MarkdownIconPlugin\";\r\n\r\nconst markdownItInstance = MarkdownIt({ typographer: false }).use(\r\n  MarkdownIconPlugin,\r\n  {\r\n    containerClassName: \"icon-embed\",\r\n  },\r\n);\r\n\r\nconst markdownRules = {\r\n  paragraph: (node: any, children: any, parent: any, markdownStyles: any) => {\r\n    return (\r\n      <View\r\n        key={getUniqueID()}\r\n        style={[node.index > 0 && styles.markdownParagraph]}\r\n      >\r\n        {children}\r\n      </View>\r\n    );\r\n  },\r\n  \"regexp-0\": (node: any, children: any, parent: any, markdownStyles: any) => {\r\n    const icon = node.sourceMeta.match[1];\r\n    // \\u200b is \"zero-width space\". It needs to be added because\r\n    // in devices like the Google Pixel phones and tablets,\r\n    // if a line contains exclusively the icon with no text,\r\n    // the icon gets cut off.\r\n    return Platform.select({\r\n      default: (\r\n        <Text key={getUniqueID()}>\r\n          <GameIcon\r\n            key={getUniqueID()}\r\n            style={\r\n              icon === \"attack\"\r\n                ? styles.imageStyleAndroidAttack\r\n                : styles.imageStyleAndroid\r\n            }\r\n            small={true}\r\n            resizeMode=\"contain\"\r\n            icon={icon}\r\n          />\r\n          {Platform.OS === \"android\" && \"\\u200b\"}\r\n        </Text>\r\n      ),\r\n      ios: (\r\n        <Text key={getUniqueID()}>\r\n          <View\r\n            style={\r\n              icon === \"attack\"\r\n                ? styles.imageContainerStyleiOSAttack\r\n                : styles.imageContainerStyleiOS\r\n            }\r\n          >\r\n            <GameIcon\r\n              key={getUniqueID()}\r\n              style={\r\n                icon === \"attack\"\r\n                  ? styles.imageStyleiOSAttack\r\n                  : styles.imageStyleiOS\r\n              }\r\n              small={true}\r\n              resizeMode=\"contain\"\r\n              icon={icon}\r\n            />\r\n          </View>\r\n        </Text>\r\n      ),\r\n    });\r\n  },\r\n};\r\n\r\nfunction MarkdownImpl(props: any) {\r\n  const style = props?.style || {};\r\n  const children = props.children?.replace?.(\r\n    /((\\d(K|M|B|T)?)|(Max)) :/g,\r\n    (_substring: string, args: string) => args + \":\",\r\n  );\r\n  const theme = useTheme();\r\n  return (\r\n    <LibraryMarkdown\r\n      {...props}\r\n      markdownit={markdownItInstance}\r\n      rules={markdownRules}\r\n      style={{\r\n        body: [\r\n          {\r\n            justifyContent: \"flex-end\",\r\n            minHeight: 21,\r\n            lineHeight: Platform.select({ ios: 19, default: undefined }),\r\n            color: theme.theme.colors.black,\r\n          },\r\n          style,\r\n        ],\r\n        bullet_list_icon: {\r\n          lineHeight: Platform.select({ ios: 20, default: 16 }),\r\n          marginTop: 4,\r\n        },\r\n        bullet_list: { width: \"100%\" },\r\n        list_item: { alignItems: \"center\", justifyContent: \"center\" },\r\n        heading2: {\r\n          lineHeight: 24,\r\n        },\r\n      }}\r\n    >\r\n      {children}\r\n    </LibraryMarkdown>\r\n  );\r\n}\r\n\r\nconst Markdown = React.memo(MarkdownImpl);\r\n\r\nexport { Markdown };\r\n\r\nconst styles = StyleSheet.create({\r\n  markdownParagraph: {\r\n    marginTop: Platform.select({ ios: 8, default: 4 }),\r\n  },\r\n  markdownTextgroup: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    alignItems: \"center\",\r\n    padding: 0,\r\n    margin: 0,\r\n  },\r\n  text: {\r\n    lineHeight: 16,\r\n  },\r\n  imageStyleAndroid: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 2,\r\n    marginLeft: 2,\r\n  },\r\n  imageStyleAndroidAttack: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 2,\r\n    marginLeft: 2,\r\n    marginRight: 2,\r\n  },\r\n  imageContainerStyleiOS: {\r\n    width: 18,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  imageContainerStyleiOSAttack: {\r\n    width: 20,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  imageStyleiOS: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    alignSelf: \"center\",\r\n    top: 2,\r\n  },\r\n  imageStyleiOSAttack: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    alignSelf: \"center\",\r\n    top: 2,\r\n    right: 2,\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport Demo from \"../backend/Demo\";\r\nimport { getCurrentVersionTimestamp } from \"../utils/Versioning\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function About() {\r\n  const versionText = Demo.isDemo() ? \"**Demo Version**\" : \"**Full Version**\";\r\n  const versionNumber = getCurrentVersionTimestamp();\r\n  const versionNumberText =\r\n    versionNumber != null ? \"Version \" + versionNumber.toString() : \"\";\r\n  const demoText = Demo.isDemo()\r\n    ? Platform.select({\r\n        android:\r\n          \"Get the full version for Android in [the Google Play Store](https://play.google.com/store/apps/details?id=com.mcolotto.magicresearchfull&utm_source=demo_about_android)!\",\r\n        web: \"Get the full version for Android in [the Google Play Store](https://play.google.com/store/apps/details?id=com.mcolotto.magicresearchfull&utm_source=demo_about_web) or for iOS in [the App Store](https://apps.apple.com/app/magic-research/id1671272877)!\",\r\n      })\r\n    : \"\";\r\n  const text = `## Magic Research\r\n\r\n  \r\n${versionText}\r\n\r\n${versionNumberText}\r\n\r\n\r\nA game by **@Maticolotto**\r\n\r\n\r\n**Credits**\r\n\r\nAssets from:\r\n  * Pipoya RPG Monster Pack, by Pipoya [(https://pipoya.itch.io/free-rpg-monster-pack)](https://pipoya.itch.io/free-rpg-monster-pack)\r\n  * Aekashics Librarium, by Aekashics [(http://www.akashics.moe)](http://www.akashics.moe)\r\n  * 1000+ Fantasy RPG Icons, by finalbossblues [(https://finalbossblues.itch.io/icons)](https://finalbossblues.itch.io/icons)\r\n\r\nSpecial thanks to **@jpascua93** for pre-launch feedback and development\r\n\r\nCheck out the **[Discord](https://discord.gg/bPhGsaqR9d)** to discuss the game!\r\n\r\n[Privacy Policy](https://mcolotto.github.io/magic-research-demo/privacy-policy)\r\n\r\n${demoText}`;\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>About</Text>\r\n      <View style={styles.explanation}>\r\n        <Markdown style={styles.explanationText}>{text}</Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    width: \"100%\",\r\n  },\r\n  explanationText: {\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import { applyTransformations } from \"./calculation/Calculation\";\r\nimport { TransformationTags } from \"./calculation/TransformationTags\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"./PlayerContext\";\r\n\r\nexport type ResourceData = {\r\n  current: number;\r\n  cap: number;\r\n};\r\n\r\ntype ResourceInfo = {\r\n  baseCap: number;\r\n  icon: string;\r\n};\r\n\r\nexport enum Resource {\r\n  Mana = \"Mana\",\r\n  Stone = \"Stone\",\r\n  Wood = \"Wood\",\r\n  Water = \"Water\",\r\n  Iron = \"Iron\",\r\n  Temperature = \"Temperature\",\r\n  Monstium = \"Monstium\",\r\n  Electricity = \"Electricity\",\r\n  Coins = \"Coins\",\r\n  TimePieces = \"Time Pieces\",\r\n}\r\n\r\nconst RESOURCES: Record<Resource, ResourceInfo> = {\r\n  Mana: {\r\n    baseCap: 100,\r\n    icon: \"mana\",\r\n  },\r\n  Coins: {\r\n    baseCap: 1000,\r\n    icon: \"coins\",\r\n  },\r\n  Stone: {\r\n    baseCap: 50,\r\n    icon: \"stone\",\r\n  },\r\n  Wood: {\r\n    baseCap: 50,\r\n    icon: \"wood\",\r\n  },\r\n  Water: {\r\n    baseCap: 10,\r\n    icon: \"water\",\r\n  },\r\n  Iron: {\r\n    baseCap: 20,\r\n    icon: \"iron\",\r\n  },\r\n  Temperature: {\r\n    baseCap: 500,\r\n    icon: \"temperature\",\r\n  },\r\n  Monstium: {\r\n    baseCap: 200,\r\n    icon: \"monstium\",\r\n  },\r\n  Electricity: {\r\n    baseCap: 1000,\r\n    icon: \"electricity\",\r\n  },\r\n  \"Time Pieces\": {\r\n    baseCap: 30000,\r\n    icon: \"timepiece\",\r\n  },\r\n};\r\n\r\nexport function getResourceInfo(resource: Resource): ResourceInfo {\r\n  return RESOURCES[resource];\r\n}\r\n\r\nexport function getSortedResourceKeys(state: PlayerContextState) {\r\n  return Object.keys(state.resources).sort(\r\n    (a, b) =>\r\n      Object.values(Resource).indexOf(a as Resource) -\r\n      Object.values(Resource).indexOf(b as Resource),\r\n  );\r\n}\r\n\r\nfunction calculateResourceCap(\r\n  state: PlayerContextState,\r\n  resourceName: Resource,\r\n): number {\r\n  return applyTransformations(\r\n    [resourceName, TransformationTags.Cap],\r\n    state,\r\n    RESOURCES[resourceName].baseCap,\r\n  );\r\n}\r\n\r\nexport function getResourceCap(\r\n  state: PlayerContextState,\r\n  resourceName: Resource,\r\n): number {\r\n  const resourceData = state.resources[resourceName] as ResourceData;\r\n  return resourceData?.cap || RESOURCES[resourceName].baseCap;\r\n}\r\n\r\nexport function recalculateCaps(state: PlayerContextState): PlayerContextState {\r\n  const resources = Object.keys(state.resources) as Array<Resource>;\r\n  resources.forEach((resource) => {\r\n    const newCap = calculateResourceCap(state, resource);\r\n    const resourceData = state.resources[resource] as ResourceData;\r\n    resourceData.cap = newCap;\r\n    if (resourceData.current > resourceData.cap) {\r\n      resourceData.current = resourceData.cap;\r\n    }\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function getResourceAmount(\r\n  state: PlayerContextState,\r\n  resource: Resource,\r\n) {\r\n  return state.resources?.[resource]?.current || 0;\r\n}\r\n\r\nfunction grantResourceImpl(\r\n  name: Resource,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n) {\r\n  if (state.resources?.[name] == null) {\r\n    state.resources[name] = {\r\n      current: 0,\r\n      cap: calculateResourceCap(state, name),\r\n    };\r\n  }\r\n  const resource = state.resources[name] as ResourceData;\r\n  resource.current += amount;\r\n  resource.current = Math.min(resource.current, resource.cap);\r\n  resource.current = Math.max(resource.current, 0);\r\n  return state;\r\n}\r\n\r\nexport function grantResource(\r\n  this: any,\r\n  name: Resource,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return grantResourceImpl.bind(this, name, amount);\r\n}\r\n","import { clone } from \"../../utils/CoreUtils\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  getSchoolLevel,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedSchools,\r\n  School,\r\n} from \"./ElementsAndSchools\";\r\nimport { Spell } from \"./Spell\";\r\n\r\nconst spells: Record<string, Spell> = {};\r\n\r\nexport function registerSpell(spell: Spell) {\r\n  spells[spell.getSpellName()] = spell;\r\n}\r\n\r\nexport function getSpellByName(name: string): Spell {\r\n  return spells?.[name] as Spell;\r\n}\r\n\r\nexport function getVisibleSpellsBySchool(\r\n  state: PlayerContextState,\r\n): Record<string, Spell[]> {\r\n  const spellsBySchool: Record<string, Spell[]> = Object.fromEntries(\r\n    Object.values(School).map((school) => [school, []]),\r\n  );\r\n  for (let spellName in spells) {\r\n    const spell = spells[spellName];\r\n    if (spell.isVisible(state)) {\r\n      const schoolRequirements = spell.getSchoolLevelRequirements();\r\n      for (let school in schoolRequirements) {\r\n        if (spellsBySchool?.[school] === undefined) {\r\n          spellsBySchool[school] = [];\r\n        }\r\n        spellsBySchool[school].push(spell);\r\n      }\r\n    }\r\n  }\r\n  for (let school in spellsBySchool) {\r\n    if (spellsBySchool[school].length === 0) {\r\n      delete spellsBySchool[school];\r\n    } else {\r\n      spellsBySchool[school].sort(\r\n        (a, b) =>\r\n          (b.getSchoolLevelRequirements()[school as School] || 0) -\r\n          (a.getSchoolLevelRequirements()[school as School] || 0),\r\n      );\r\n    }\r\n  }\r\n  return spellsBySchool;\r\n}\r\n\r\nexport function getVisibleSpellsForSchool(\r\n  state: PlayerContextState,\r\n  school: School,\r\n  extraLevels?: number,\r\n) {\r\n  if (!extraLevels) {\r\n    return getVisibleSpellsBySchool(state)?.[school] || [];\r\n  }\r\n  const fakeState = clone(state);\r\n  fakeState.schoolExperience[school] = getTotalExpRequiredForLevel(\r\n    fakeState,\r\n    getSchoolLevel(state, school) + extraLevels,\r\n    school,\r\n  );\r\n  return getVisibleSpellsBySchool(fakeState)?.[school] || [];\r\n}\r\n\r\nexport function getSpellsForSchoolThatCanBeLearnedSoon(\r\n  state: PlayerContextState,\r\n  school: School,\r\n) {\r\n  const currentSpells = getVisibleSpellsForSchool(state, school);\r\n  const otherUnlockedSchools = getUnlockedSchools(state).filter(\r\n    (unlockedSchool) => unlockedSchool != school,\r\n  );\r\n\r\n  let learnedSoon: Spell[] = [];\r\n\r\n  for (let schoolIdx in otherUnlockedSchools) {\r\n    const otherSchool = otherUnlockedSchools[schoolIdx];\r\n    const fakeState = clone(state);\r\n    fakeState.schoolExperience[otherSchool] = getTotalExpRequiredForLevel(\r\n      fakeState,\r\n      getSchoolLevel(state, otherSchool) + 1,\r\n      otherSchool,\r\n    );\r\n    const soonVisibleSpells = getVisibleSpellsForSchool(fakeState, school);\r\n    learnedSoon = learnedSoon.concat(\r\n      soonVisibleSpells.filter((spell) => !currentSpells.includes(spell)),\r\n    );\r\n  }\r\n\r\n  return learnedSoon;\r\n}\r\n\r\nexport function getRecentSpellsCast(state: PlayerContextState): Spell[] {\r\n  return (state?.recentSpellsCast || [])\r\n    .map(getSpellByName)\r\n    .filter((spell) => spell != null);\r\n}\r\n\r\nfunction addRecentSpellCastImpl(spell: Spell, state: PlayerContextState) {\r\n  if (!state?.recentSpellsCast) {\r\n    state.recentSpellsCast = [];\r\n  }\r\n  const spellName = spell.getSpellName();\r\n  state.recentSpellsCast = state.recentSpellsCast.filter(\r\n    (recentSpellName) => recentSpellName != spellName,\r\n  );\r\n  state.recentSpellsCast.unshift(spell.getSpellName());\r\n  state.recentSpellsCast = state.recentSpellsCast.slice(0, 3);\r\n  return state;\r\n}\r\n\r\nexport function addRecentSpellCast(\r\n  this: any,\r\n  spell: Spell,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return addRecentSpellCastImpl.bind(this, spell);\r\n}\r\n\r\nfunction setLastCastedTimeImpl(spell: Spell, state: PlayerContextState) {\r\n  if (!state?.lastSpellCastTimes) {\r\n    state.lastSpellCastTimes = {};\r\n  }\r\n  const spellName = spell.getSpellName();\r\n  state.lastSpellCastTimes[spellName] = getSecondsPlayed(state);\r\n  return state;\r\n}\r\n\r\nexport function setLastCastedTime(\r\n  this: any,\r\n  spell: Spell,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return setLastCastedTimeImpl.bind(this, spell);\r\n}\r\n\r\nexport function getFavoriteSpells(state: PlayerContextState): Spell[] {\r\n  return (\r\n    state?.favoriteSpells?.map((spellName) => getSpellByName(spellName)) ?? []\r\n  );\r\n}\r\n\r\nexport function addFavoriteSpell(\r\n  state: PlayerContextState,\r\n  spell: Spell,\r\n): PlayerContextState {\r\n  if (isInFavoriteSpells(state, spell)) {\r\n    return state;\r\n  }\r\n  state.favoriteSpells.push(spell.getName());\r\n  return state;\r\n}\r\n\r\nexport function removeFromFavoriteSpells(\r\n  state: PlayerContextState,\r\n  spell: Spell,\r\n): PlayerContextState {\r\n  const index = state.favoriteSpells.findIndex(\r\n    (spellName) => spell.getSpellName() === spellName,\r\n  );\r\n  if (index < 0) {\r\n    return state;\r\n  }\r\n  state.favoriteSpells.splice(index, 1);\r\n  return state;\r\n}\r\n\r\nexport function isInFavoriteSpells(\r\n  state: PlayerContextState,\r\n  spell: Spell,\r\n): boolean {\r\n  return (\r\n    state.favoriteSpells.findIndex(\r\n      (spellName) => spell.getSpellName() === spellName,\r\n    ) >= 0\r\n  );\r\n}\r\n","import { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { meetsRequirements, School } from \"../spells/ElementsAndSchools\";\r\nimport { Spell } from \"../spells/Spell\";\r\nimport { getSpellByName } from \"../spells/Spells\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\n\r\nfunction onTick(\r\n  state: PlayerContextState,\r\n  elapsedTimeSec: number,\r\n): PlayerContextState {\r\n  if (state.autocast.apprenticesPaused) {\r\n    return state;\r\n  }\r\n\r\n  const apprenticeAllocation = getApprenticeAllocation(state);\r\n  for (let spellName in apprenticeAllocation) {\r\n    const allocatedApprentices = apprenticeAllocation[spellName] || 0;\r\n    if (allocatedApprentices > 0) {\r\n      // Cast once per minute per apprentice\r\n      const baseThreshold = applyTransformations(\r\n        [TransformationTags.AutocastDelay],\r\n        state,\r\n        60.0,\r\n      );\r\n      const toAdd = (elapsedTimeSec / baseThreshold) * allocatedApprentices;\r\n      const currentProgress = getAutocastProgressForSpell(state, spellName);\r\n      const totalProgress = toAdd + currentProgress;\r\n      state.autocast.spellAutocastProgress[spellName] = totalProgress;\r\n      if (totalProgress > 1.0) {\r\n        // Time to cast! (if possible)\r\n        const spell = getSpellByName(spellName);\r\n        if (spell && spell.isEnabled(state)) {\r\n          state.autocast.spellAutocastProgress[spellName] = 0.0;\r\n          state = spell.doAction({ isAutomatic: true }, state);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getApprenticeAllocation(\r\n  state: PlayerContextState,\r\n): Record<string, number> {\r\n  return state?.autocast?.apprenticeAllocation || {};\r\n}\r\n\r\nfunction getAutocastProgressForSpell(\r\n  state: PlayerContextState,\r\n  spellName: string,\r\n): number {\r\n  return state.autocast.spellAutocastProgress?.[spellName] ?? 0.0;\r\n}\r\n\r\nexport function getAutocastSchoolLevelRequirements(\r\n  spell: Spell,\r\n): Record<School, number> {\r\n  const schoolRequirements = spell.getSchoolLevelRequirements();\r\n  let autocastSchoolLevelRequirements: Record<School, number> = {\r\n    Conjuration: 0,\r\n    Enchantment: 0,\r\n    Illusion: 0,\r\n    Alchemy: 0,\r\n    Evocation: 0,\r\n    Protection: 0,\r\n    Breeding: 0,\r\n    Summoning: 0,\r\n    Divination: 0,\r\n  };\r\n  for (let school in schoolRequirements) {\r\n    autocastSchoolLevelRequirements[school as School] =\r\n      (schoolRequirements[school as School] || -1) + 1;\r\n  }\r\n  return autocastSchoolLevelRequirements;\r\n}\r\n\r\nexport function canAutocast(state: PlayerContextState, spell: Spell): boolean {\r\n  return meetsRequirements(state, getAutocastSchoolLevelRequirements(spell));\r\n}\r\n\r\nexport function calculateApprenticeTotal(state: PlayerContextState): number {\r\n  return applyTransformations([TransformationTags.Apprentice], state, 0);\r\n}\r\n\r\nexport function getFreeApprentices(state: PlayerContextState): number {\r\n  const apprenticeAllocation = getApprenticeAllocation(state);\r\n  let apprenticesAllocated = 0;\r\n  for (let spellName in apprenticeAllocation) {\r\n    const spell = getSpellByName(spellName);\r\n    if (spell && spell.isVisible(state)) {\r\n      apprenticesAllocated += apprenticeAllocation[spellName];\r\n    }\r\n  }\r\n  return calculateApprenticeTotal(state) - apprenticesAllocated;\r\n}\r\n\r\nfunction allocateApprenticesToSpellImpl(\r\n  spell: Spell,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n) {\r\n  if (!canAutocast(state, spell)) {\r\n    return state;\r\n  }\r\n\r\n  const spellName = spell.getSpellName();\r\n  const currentAllocation = getApprenticeAllocation(state)?.[spellName] || 0;\r\n  const actualAmountToAllocate =\r\n    amount > 0\r\n      ? Math.min(getFreeApprentices(state), amount)\r\n      : Math.max(-currentAllocation, amount);\r\n  state.autocast.apprenticeAllocation[spellName] =\r\n    currentAllocation + actualAmountToAllocate;\r\n  return state;\r\n}\r\n\r\nexport function allocateApprenticesToSpell(\r\n  this: any,\r\n  spell: Spell,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return allocateApprenticesToSpellImpl.bind(this, spell, amount);\r\n}\r\n\r\nexport function saveLoadoutToPosition(\r\n  state: PlayerContextState,\r\n  position: number,\r\n): PlayerContextState {\r\n  const allocation = JSON.parse(JSON.stringify(getApprenticeAllocation(state)));\r\n  state.autocast.loadouts[position] = allocation;\r\n  state.autocast.lastLoadoutUsed = position;\r\n  return state;\r\n}\r\n\r\nexport function loadLoadoutFromPosition(\r\n  state: PlayerContextState,\r\n  position: number,\r\n): PlayerContextState {\r\n  const allocation = JSON.parse(\r\n    JSON.stringify(state?.autocast?.loadouts?.[position] || {}),\r\n  );\r\n  state.autocast.apprenticeAllocation = allocation;\r\n  state.autocast.lastLoadoutUsed = position;\r\n  return state;\r\n}\r\n\r\nexport function getEstimatedApprenticeManaConsumptionPerSec(\r\n  state: PlayerContextState,\r\n) {\r\n  if (state.autocast.apprenticesPaused) {\r\n    return 0;\r\n  }\r\n\r\n  const delayThreshold = applyTransformations(\r\n    [TransformationTags.AutocastDelay],\r\n    state,\r\n    60.0,\r\n  );\r\n  let totalCost = 0;\r\n  const apprenticeAllocation = getApprenticeAllocation(state);\r\n  for (let spellName in apprenticeAllocation) {\r\n    const allocatedApprentices = apprenticeAllocation[spellName] || 0;\r\n    if (allocatedApprentices > 0) {\r\n      const cost =\r\n        getSpellByName(spellName).getCost(state)?.resources?.Mana || 0;\r\n      totalCost += (cost * allocatedApprentices) / delayThreshold;\r\n    }\r\n  }\r\n  return totalCost;\r\n}\r\n\r\nexport function loadAutocast(): void {\r\n  registerTimeTickListener(\"Autocast\", onTick);\r\n}\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../Resources\";\r\nimport { registerTimeTickListener } from \"./TimeTick\";\r\n\r\nexport type IncomeOverTimeCalculator = (\r\n  state: PlayerContextState,\r\n) => Partial<Record<Resource, number>>;\r\n\r\n// If something produces (or consumes) income over time,\r\n// register it here. This will make it visible in the UI later.\r\nexport class IncomeOverTimeProducer implements Identifiable {\r\n  id: string;\r\n  calculator: IncomeOverTimeCalculator;\r\n\r\n  constructor(id: string, calculator: IncomeOverTimeCalculator) {\r\n    this.id = id;\r\n    this.calculator = calculator;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getCalculator(): IncomeOverTimeCalculator {\r\n    return this.calculator;\r\n  }\r\n}\r\n\r\nconst IncomeOverTimeProducers = new DataStore<IncomeOverTimeProducer>();\r\n\r\n// This method does not apply income if the resource is capped,\r\n// which is a \"smarter\" behavior.\r\nfunction onTick(\r\n  state: PlayerContextState,\r\n  elapsedTimeSec: number,\r\n): PlayerContextState {\r\n  const incomes = IncomeOverTimeProducers.getAll().map((producer) =>\r\n    producer.getCalculator()(state),\r\n  );\r\n\r\n  let changed = false;\r\n  const incomeSet = new Set(incomes);\r\n  const appliedTotals: Partial<Record<Resource, number>> = {};\r\n  const appliedIncomes = new Set<Partial<Record<Resource, number>>>();\r\n  do {\r\n    changed = false;\r\n    for (let resString of Object.values(Resource)) {\r\n      const resource = resString as Resource;\r\n      if (\r\n        getResourceAmount(state, resource) + (appliedTotals?.[resource] ?? 0) <\r\n        getResourceCap(state, resource)\r\n      ) {\r\n        // Apply all incomes for this resource\r\n        const incomesThatHaveResource = Array.from(incomeSet).filter(\r\n          (income) => (income?.[resource] ?? 0) > 0,\r\n        );\r\n        incomesThatHaveResource.forEach((income) => {\r\n          let canApply = true;\r\n          for (let subResString in income) {\r\n            const subResource = subResString as Resource;\r\n            const subResourceIncome =\r\n              (income[subResource] ?? 0) * elapsedTimeSec;\r\n            if (\r\n              subResourceIncome < 0 &&\r\n              getResourceAmount(state, subResource) +\r\n                (appliedTotals?.[subResource] ?? 0) <\r\n                -subResourceIncome\r\n            ) {\r\n              canApply = false;\r\n            }\r\n          }\r\n          if (canApply) {\r\n            appliedIncomes.add(income);\r\n            for (let subResString in income) {\r\n              const subResource = subResString as Resource;\r\n              appliedTotals[subResource] =\r\n                (appliedTotals?.[subResource] ?? 0) +\r\n                (income[subResource] ?? 0) * elapsedTimeSec;\r\n            }\r\n          }\r\n        });\r\n        if (appliedIncomes.size > 0) {\r\n          appliedIncomes.forEach((appliedIncome) =>\r\n            incomeSet.delete(appliedIncome),\r\n          );\r\n          appliedIncomes.clear();\r\n          changed = true;\r\n        }\r\n      }\r\n    }\r\n  } while (changed && incomeSet.size > 0);\r\n\r\n  // Now we have calculated the total incomes, grant the resources\r\n  for (let resString in appliedTotals) {\r\n    if ((appliedTotals?.[resString as Resource] ?? 0) != 0) {\r\n      state = grantResource(\r\n        resString as Resource,\r\n        appliedTotals?.[resString as Resource] ?? 0,\r\n      )(state);\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\n// This method applies all incomes even if resources are capped.\r\nfunction onTickApplyAll(\r\n  state: PlayerContextState,\r\n  elapsedTimeSec: number,\r\n): PlayerContextState {\r\n  const incomes = IncomeOverTimeProducers.getAll().map((producer) =>\r\n    producer.getCalculator()(state),\r\n  );\r\n\r\n  const appliedTotals: Partial<Record<Resource, number>> = {};\r\n  for (let income of incomes) {\r\n    let canApply = true;\r\n    for (let subResString in income) {\r\n      const subResource = subResString as Resource;\r\n      const subResourceIncome = (income[subResource] ?? 0) * elapsedTimeSec;\r\n      if (\r\n        subResourceIncome < 0 &&\r\n        getResourceAmount(state, subResource) < -subResourceIncome\r\n      ) {\r\n        canApply = false;\r\n      }\r\n    }\r\n\r\n    if (canApply) {\r\n      for (let subResString in income) {\r\n        const subResource = subResString as Resource;\r\n        const subResourceIncome = (income[subResource] ?? 0) * elapsedTimeSec;\r\n        appliedTotals[subResource] =\r\n          (appliedTotals?.[subResource] ?? 0) + subResourceIncome;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Now we have calculated the total incomes, grant the resources\r\n  for (let resString in appliedTotals) {\r\n    if ((appliedTotals?.[resString as Resource] ?? 0) != 0) {\r\n      state = grantResource(\r\n        resString as Resource,\r\n        appliedTotals?.[resString as Resource] ?? 0,\r\n      )(state);\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nregisterTimeTickListener(\"IncomeOverTime\", onTickApplyAll);\r\n\r\nexport function calculateIncomePerSecond(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  let total: Partial<Record<Resource, number>> = {};\r\n  IncomeOverTimeProducers.getAll().forEach((producer) => {\r\n    const income = producer.getCalculator()(state);\r\n    let canApply = true;\r\n    for (let subResString in income) {\r\n      const subResource = subResString as Resource;\r\n      const subResourceIncome = (income[subResource] ?? 0) * 0.5;\r\n      if (\r\n        subResourceIncome < 0 &&\r\n        getResourceAmount(state, subResource) < -subResourceIncome\r\n      ) {\r\n        canApply = false;\r\n      }\r\n    }\r\n\r\n    // Skip incomes that cannot be applied\r\n    if (canApply) {\r\n      for (let resString in income) {\r\n        const resource = resString as Resource;\r\n        const existingIncome = total?.[resource] ?? 0;\r\n        total[resource] = existingIncome + (income?.[resource] ?? 0);\r\n      }\r\n    }\r\n  });\r\n  return total;\r\n}\r\n\r\nexport { IncomeOverTimeProducers };\r\n","export function formatNumber(\r\n  num: number,\r\n  options: { showDecimals: boolean } = { showDecimals: false },\r\n): string {\r\n  num = Number(num);\r\n  if (num == Infinity) {\r\n    return \"∞\";\r\n  }\r\n  if (num >= 1000000000000) {\r\n    return formatNumber(num / 1000000000000, { showDecimals: true }) + \"T\";\r\n  }\r\n  if (num >= 1000000000) {\r\n    return formatNumber(num / 1000000000, { showDecimals: true }) + \"B\";\r\n  }\r\n  if (num >= 1000000) {\r\n    return formatNumber(num / 1000000, { showDecimals: true }) + \"M\";\r\n  }\r\n  if (num >= 10000) {\r\n    return formatNumber(num / 1000, { showDecimals: true }) + \"K\";\r\n  }\r\n\r\n  if (options.showDecimals && Math.abs(num) < 10 && !Number.isInteger(num)) {\r\n    return (Math.floor(num * 100) / 100.0).toFixed(2);\r\n  } else if (\r\n    options.showDecimals &&\r\n    Math.abs(num) < 100 &&\r\n    !Number.isInteger(num)\r\n  ) {\r\n    return (Math.floor(num * 10) / 10.0).toFixed(1);\r\n  } else {\r\n    return num.toFixed();\r\n  }\r\n}\r\n\r\nexport function formatTime(\r\n  secs: number,\r\n  options: { shortForm: boolean; showDecimals: boolean } = {\r\n    shortForm: false,\r\n    showDecimals: false,\r\n  },\r\n): string {\r\n  const { shortForm, showDecimals } = options;\r\n  let unit = shortForm ? \"sec\" : \"second(s)\";\r\n  let time = formatNumber(secs, { showDecimals: showDecimals });\r\n  if (secs > 60) {\r\n    unit = shortForm ? \"min\" : \"minute(s)\";\r\n    time = formatNumber(secs / 60, { showDecimals: showDecimals });\r\n  }\r\n  if (secs > 60 * 60) {\r\n    unit = shortForm ? \"hr\" : \"hour(s)\";\r\n    time = formatNumber(secs / (60 * 60), { showDecimals: showDecimals });\r\n  }\r\n  return `${time} ${unit}`;\r\n}\r\n\r\nexport function formatTimeLong(duration: moment.Duration) {\r\n  if (duration.asDays() < 1.0) {\r\n    return `${duration.hours().toFixed().padStart(2, \"0\")}:${duration\r\n      .minutes()\r\n      .toFixed()\r\n      .padStart(2, \"0\")}:${duration.seconds().toFixed().padStart(2, \"0\")}`;\r\n  }\r\n\r\n  return `${Math.floor(duration.asDays()).toFixed()} days, ${duration\r\n    .hours()\r\n    .toFixed()\r\n    .padStart(2, \"0\")}:${duration\r\n    .minutes()\r\n    .toFixed()\r\n    .padStart(2, \"0\")}:${duration.seconds().toFixed().padStart(2, \"0\")}`;\r\n}\r\n","import { clone } from \"../../utils/CoreUtils\";\r\nimport { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { setFlag } from \"../Flags\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { addContextListener } from \"../PlayerContextListeners\";\r\nimport { Item, ItemOccurrence, ItemStack } from \"./Item\";\r\nimport { getItemById, isInventoryUnlocked } from \"./Items\";\r\n\r\nexport function getInventory(state: PlayerContextState): ItemStack[] {\r\n  return state?.inventory || [];\r\n}\r\n\r\nfunction getItemOccurrenceIndex(\r\n  itemOccurrence: ItemOccurrence,\r\n  state: PlayerContextState,\r\n): number {\r\n  const itemOccurrenceJSON = JSON.stringify(itemOccurrence);\r\n  return getInventory(state).findIndex((itemStack) => {\r\n    return itemOccurrenceJSON == JSON.stringify(itemStack.itemOccurrence);\r\n  });\r\n}\r\n\r\nexport function calculateInventoryCap(state: PlayerContextState): number {\r\n  return applyTransformations([TransformationTags.InventorySlot], state, 12);\r\n}\r\n\r\nexport function addToInventory(\r\n  itemOccurrence: ItemOccurrence,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const previousIndex = getItemOccurrenceIndex(itemOccurrence, state);\r\n\r\n  if (previousIndex >= 0) {\r\n    if (!state.inventory) {\r\n      state.inventory = [];\r\n    }\r\n    state.inventory[previousIndex] = {\r\n      itemOccurrence,\r\n      amount: state.inventory[previousIndex].amount + amount,\r\n    };\r\n    return state;\r\n  }\r\n\r\n  const inventorySize = getInventory(state).length;\r\n  if (inventorySize >= calculateInventoryCap(state)) {\r\n    return state;\r\n  }\r\n\r\n  if (!state.inventory) {\r\n    state.inventory = [];\r\n  }\r\n  state.inventory.push({\r\n    itemOccurrence,\r\n    amount,\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\nexport function removeFromInventory(\r\n  itemOccurrence: ItemOccurrence,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const previousIndex = getItemOccurrenceIndex(itemOccurrence, state);\r\n  if (previousIndex < 0) {\r\n    return state;\r\n  }\r\n\r\n  if (!state.inventory) {\r\n    state.inventory = [];\r\n  }\r\n  const newAmount = state.inventory[previousIndex].amount - amount;\r\n  if (newAmount > 0) {\r\n    state.inventory[previousIndex] = {\r\n      itemOccurrence,\r\n      amount: newAmount,\r\n    };\r\n  } else {\r\n    state.inventory.splice(previousIndex, 1);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getAmountOfItem(\r\n  itemOccurrence: ItemOccurrence,\r\n  state: PlayerContextState,\r\n): number {\r\n  const index = getItemOccurrenceIndex(itemOccurrence, state);\r\n  if (index === -1) {\r\n    return 0;\r\n  }\r\n  return getInventory(state)[index].amount;\r\n}\r\n\r\nexport function getTotalAmountOfItem(\r\n  item: Item,\r\n  state: PlayerContextState,\r\n): number {\r\n  return getInventory(state)\r\n    .filter((itemStack) => itemStack.itemOccurrence.itemId == item.getId())\r\n    .reduce((count, current) => count + current.amount, 0);\r\n}\r\n\r\nexport function removeFromInventoryWithAnyParams(\r\n  item: Item,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  let newState = clone(state);\r\n\r\n  while (amount > 0) {\r\n    const inventory = getInventory(newState);\r\n    const firstIndex = inventory.findIndex(\r\n      (itemStack) => itemStack.itemOccurrence.itemId == item.getId(),\r\n    );\r\n    if (firstIndex < 0) {\r\n      return state; // abort\r\n    }\r\n    const itemAmount = inventory[firstIndex].amount;\r\n    newState = removeFromInventory(\r\n      inventory[firstIndex].itemOccurrence,\r\n      Math.min(itemAmount, amount),\r\n      newState,\r\n    );\r\n    amount -= itemAmount;\r\n  }\r\n\r\n  return newState;\r\n}\r\n\r\n// Place items with those tags in order\r\nconst ITEM_TAG_ORDER = [\"Consumable\", \"Hand\", \"Body\", \"Accessory\"];\r\n// Then if two items have the same tags from the above list, put those who\r\n// have this tag in the back of that sub-category\r\nconst ITEM_TAG_LAST_ORDER = [\"Material\"];\r\n\r\nfunction hasTag(\r\n  itemOccurrence: ItemOccurrence,\r\n  state: PlayerContextState,\r\n  tag: string,\r\n): boolean {\r\n  const item = getItemById(itemOccurrence.itemId);\r\n  return item\r\n    .getTags(state, itemOccurrence.params)\r\n    .some((innerTag) => innerTag.tag === tag);\r\n}\r\n\r\nexport function sortInventory(state: PlayerContextState): PlayerContextState {\r\n  state.inventory.sort((a, b) => {\r\n    for (let tag of ITEM_TAG_ORDER) {\r\n      const aHasTag = hasTag(a.itemOccurrence, state, tag);\r\n      const bHasTag = hasTag(b.itemOccurrence, state, tag);\r\n      if (aHasTag && !bHasTag) {\r\n        return -1;\r\n      }\r\n      if (bHasTag && !aHasTag) {\r\n        return 1;\r\n      }\r\n    }\r\n    for (let tag of ITEM_TAG_LAST_ORDER) {\r\n      const aHasTag = hasTag(a.itemOccurrence, state, tag);\r\n      const bHasTag = hasTag(b.itemOccurrence, state, tag);\r\n      if (aHasTag && !bHasTag) {\r\n        return 1;\r\n      }\r\n      if (bHasTag && !aHasTag) {\r\n        return -1;\r\n      }\r\n    }\r\n    return 0;\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function loadInventoryListener() {\r\n  addContextListener(\"InventoryUnlockerListener\", (oldState, newState) => {\r\n    if (getInventory(newState).length > 0 && !isInventoryUnlocked(newState)) {\r\n      return setFlag(\"new_inventory_unlocked\");\r\n    }\r\n  });\r\n}\r\n","import { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { getSecondsPlayed } from \"./TotalTimePlayed\";\r\n\r\nconst TEMPORARY_EFFECT_DELTA = 1e10;\r\nconst CLEAR_EPSILON = TEMPORARY_EFFECT_DELTA / 2;\r\n\r\nexport type TemporaryEffectData = {\r\n  id: string;\r\n  name: string;\r\n  endTime: number;\r\n  isBeneficial: boolean;\r\n  combatOnly: boolean;\r\n  isEnemyTemporaryEffect: boolean;\r\n  dispellable?: boolean;\r\n  hidden?: boolean;\r\n  params: Record<string, any>;\r\n};\r\n\r\nexport function getTemporaryEffectEndTime(\r\n  state: PlayerContextState,\r\n  id: string,\r\n): number {\r\n  return (state.temporaryEffects?.[id] as TemporaryEffectData)?.endTime || 0;\r\n}\r\n\r\nexport function wasTemporaryEffectCleared(\r\n  state: PlayerContextState,\r\n  id: string,\r\n): boolean {\r\n  const endTime = getTemporaryEffectEndTime(state, id);\r\n  return (\r\n    endTime < getSecondsPlayed(state) - TEMPORARY_EFFECT_DELTA + CLEAR_EPSILON\r\n  );\r\n}\r\n\r\nexport function hasTemporaryEffect(\r\n  state: PlayerContextState,\r\n  id: string,\r\n): boolean {\r\n  return getTemporaryEffectEndTime(state, id) > getSecondsPlayed(state);\r\n}\r\n\r\nexport function getTemporaryEffects(\r\n  state: PlayerContextState,\r\n): Array<TemporaryEffectData> {\r\n  let temporaryEffects = [];\r\n  for (let effectName in state.temporaryEffects) {\r\n    if (hasTemporaryEffect(state, effectName)) {\r\n      const temporaryEffect = state.temporaryEffects[effectName];\r\n      if (typeof temporaryEffect === \"number\") {\r\n        temporaryEffects.push({\r\n          id: effectName,\r\n          name: effectName,\r\n          endTime: state.temporaryEffects[effectName] as number,\r\n          isBeneficial: true,\r\n          combatOnly: false,\r\n          isEnemyTemporaryEffect: false,\r\n          params: {},\r\n        });\r\n      } else {\r\n        temporaryEffects.push(temporaryEffect);\r\n      }\r\n    }\r\n  }\r\n  return temporaryEffects;\r\n}\r\n\r\nfunction grantTemporaryEffectImpl(\r\n  id: string,\r\n  name: string,\r\n  durationSec: number,\r\n  extra: {\r\n    mode?: \"replace\" | \"add\";\r\n    isBeneficial?: boolean;\r\n    combatOnly?: boolean;\r\n    isEnemyTemporaryEffect?: boolean;\r\n    dispellable?: boolean;\r\n    hidden?: boolean;\r\n    params?: Record<string, any>;\r\n  },\r\n  state: PlayerContextState,\r\n) {\r\n  const mode = extra.mode || \"replace\";\r\n  const isBeneficial = extra.isBeneficial ?? true;\r\n  const combatOnly = extra.combatOnly ?? false;\r\n  const isEnemyTemporaryEffect = extra.isEnemyTemporaryEffect ?? false;\r\n  const params = extra.params ?? {};\r\n  const currentEndTime = getTemporaryEffectEndTime(state, id);\r\n  const newEndTime =\r\n    mode === \"add\"\r\n      ? Math.max(\r\n          currentEndTime + durationSec,\r\n          getSecondsPlayed(state) + durationSec,\r\n        )\r\n      : getSecondsPlayed(state) + durationSec;\r\n  if (!state.temporaryEffects) {\r\n    state.temporaryEffects = {};\r\n  }\r\n  state.temporaryEffects[id] = {\r\n    id: id,\r\n    name: name,\r\n    endTime: newEndTime,\r\n    isBeneficial: isBeneficial,\r\n    combatOnly: combatOnly,\r\n    isEnemyTemporaryEffect: isEnemyTemporaryEffect,\r\n    dispellable: extra.dispellable ?? true,\r\n    hidden: extra.hidden ?? false,\r\n    params: params,\r\n  };\r\n  return state;\r\n}\r\n\r\nexport function grantTemporaryEffect(\r\n  this: any,\r\n  id: string,\r\n  name: string,\r\n  durationSec: number,\r\n  extra: {\r\n    mode?: \"replace\" | \"add\";\r\n    isBeneficial?: boolean;\r\n    combatOnly?: boolean;\r\n    isEnemyTemporaryEffect?: boolean;\r\n    dispellable?: boolean;\r\n    hidden?: boolean;\r\n    params?: any;\r\n  },\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return grantTemporaryEffectImpl.bind(this, id, name, durationSec, extra);\r\n}\r\n\r\nexport function clearTemporaryEffect(\r\n  this: any,\r\n  id: string,\r\n): PlayerContextTransform {\r\n  return grantTemporaryEffectImpl.bind(\r\n    this,\r\n    id,\r\n    \"\",\r\n    -TEMPORARY_EFFECT_DELTA,\r\n    {},\r\n  );\r\n}\r\n\r\nexport function clearCombatTemporaryEffects(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const effects = getTemporaryEffects(state);\r\n  effects.forEach((effect) => {\r\n    if (effect.combatOnly) {\r\n      state = clearTemporaryEffect(effect.id)(state);\r\n    }\r\n  });\r\n  return state;\r\n}\r\n","import {\r\n  applyTransformations,\r\n  TransformationTag,\r\n} from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { getTotalAmountOfItem } from \"../items/Inventory\";\r\nimport { getItemById } from \"../items/Items\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { getResourceAmount, Resource } from \"../Resources\";\r\nimport { hasTemporaryEffect } from \"../timetick/TemporaryEffects\";\r\n\r\nexport type DoActionArgs = { isAutomatic: boolean };\r\n\r\nexport enum ActionSubcategory {\r\n  Gather = \"Gather\",\r\n  Mana = \"Mana\",\r\n  Production = \"Production\",\r\n  Storage = \"Storage\",\r\n  Electricity = \"Electricity\",\r\n  Ancient = \"Ancient\",\r\n  Housing = \"Housing\",\r\n  \"Use Time Pieces\" = \"Use Time Pieces\",\r\n}\r\n\r\nexport interface Action {\r\n  getName(): string;\r\n  getArea(): string | string[];\r\n  getCategory(): string;\r\n  getSubcategory(): ActionSubcategory | undefined;\r\n  getDisplayName(state: PlayerContextState): string;\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  };\r\n  isEnabled(state: PlayerContextState): boolean;\r\n  isActive(state: PlayerContextState): boolean;\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState;\r\n  isVisible(state: PlayerContextState): boolean;\r\n  getDisplayDescription(state: PlayerContextState): string;\r\n  getDisplayEffect(state: PlayerContextState): string;\r\n}\r\n\r\nexport type ActionEffect = {\r\n  value: number;\r\n  tags?: TransformationTag[];\r\n};\r\n\r\nexport abstract class ActionBase implements Action {\r\n  constructor() {}\r\n\r\n  abstract getName(): string;\r\n  abstract getArea(): string | string[];\r\n  abstract getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  };\r\n  abstract doAction(\r\n    args: DoActionArgs,\r\n    state: PlayerContextState,\r\n  ): PlayerContextState;\r\n  abstract isVisible(state: PlayerContextState): boolean;\r\n  abstract getDisplayDescription(state: PlayerContextState): string;\r\n  abstract getDisplayEffect(state: PlayerContextState): string;\r\n\r\n  getId(): string {\r\n    return this.getName();\r\n  }\r\n\r\n  getDisplayName(state: PlayerContextState): string {\r\n    return this.getName();\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getActionEffects(state: PlayerContextState): Record<string, number> {\r\n    const baseEffects = this.getBaseActionEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = applyTransformations(\r\n        [\r\n          ...this.getTags(),\r\n          ...(baseEffect.tags ?? []),\r\n          TransformationTags.ActionEffect,\r\n        ],\r\n        state,\r\n        baseEffect.value,\r\n        {\r\n          action: this,\r\n        },\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getTags(): TransformationTag[] {\r\n    const tags = [\r\n      TransformationTags.Action,\r\n      this.getCategoryTag(),\r\n      this.getAreaTag(),\r\n      this.getId(),\r\n    ];\r\n    const subcategoryTag = this.getSubcategoryTag();\r\n    if (subcategoryTag != null) {\r\n      tags.push(subcategoryTag);\r\n    }\r\n    return tags;\r\n  }\r\n\r\n  getCategory(): string {\r\n    return \"Actions\";\r\n  }\r\n\r\n  getCategoryTag(): string {\r\n    return \"Category:\" + this.getCategory();\r\n  }\r\n\r\n  getSubcategoryTag(): string | undefined {\r\n    if (this.getSubcategory() != null) {\r\n      return \"Subcategory:\" + this.getSubcategory();\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  getAreaTag(): string {\r\n    return \"Area:\" + this.getArea();\r\n  }\r\n\r\n  canAfford(state: PlayerContextState): boolean {\r\n    const cost = this.getCost(state);\r\n    return (\r\n      (Object.keys(cost.resources) as Array<Resource>).every(\r\n        (resource) =>\r\n          getResourceAmount(state, resource) >= (cost.resources[resource] ?? 0),\r\n      ) &&\r\n      (Object.keys(cost.items) as Array<string>).every(\r\n        (itemId) =>\r\n          getTotalAmountOfItem(getItemById(itemId), state) >=\r\n          cost.items[itemId],\r\n      )\r\n    );\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return this.canAfford(state);\r\n  }\r\n\r\n  // Returns true if the action is considered \"active\".\r\n  // Used mainly for spells that give buffs, to display a visual aid.\r\n  isActive(state: PlayerContextState): boolean {\r\n    return hasTemporaryEffect(state, this.getName());\r\n  }\r\n}\r\n","import { isArray } from \"util\";\r\nimport { Action } from \"./Action\";\r\n\r\nconst actions: Record<string, Action> = {};\r\n\r\nexport function registerAction(action: Action) {\r\n  actions[action.getName()] = action;\r\n}\r\n\r\nexport function getActionByName(name: string): Action {\r\n  return actions?.[name] as Action;\r\n}\r\n\r\nexport function getAllActions(): Record<string, Action> {\r\n  return actions;\r\n}\r\n\r\nexport function getActionsForAreaByCategory(\r\n  area: string,\r\n): Record<string, Record<string, Action>> {\r\n  let filteredActions: Record<string, Record<string, Action>> = {};\r\n  Object.keys(actions)\r\n    .filter((actionName) => {\r\n      const areas = actions[actionName].getArea();\r\n      if (isArray(areas)) {\r\n        return areas.includes(area);\r\n      }\r\n      return areas === area;\r\n    })\r\n    .forEach((actionName: string) => {\r\n      const category = actions[actionName].getCategory();\r\n      if (!filteredActions?.[category]) {\r\n        filteredActions[category] = {};\r\n      }\r\n      filteredActions[category][actionName] = actions[actionName];\r\n    });\r\n  return filteredActions;\r\n}\r\n\r\nexport function getActionsForAreaBySubcategory(\r\n  area: string,\r\n): Record<string, Record<string, Action>> {\r\n  let filteredActions: Record<string, Record<string, Action>> = {};\r\n  Object.keys(actions)\r\n    .filter((actionName) => {\r\n      const areas = actions[actionName].getArea();\r\n      if (isArray(areas)) {\r\n        return areas.includes(area);\r\n      }\r\n      return areas === area;\r\n    })\r\n    .forEach((actionName: string) => {\r\n      const subcategory = actions[actionName].getSubcategory() ?? \"Other\";\r\n      if (!filteredActions?.[subcategory]) {\r\n        filteredActions[subcategory] = {};\r\n      }\r\n      filteredActions[subcategory][actionName] = actions[actionName];\r\n    });\r\n  return filteredActions;\r\n}\r\n","import { registerAction } from \"../actions/Actions\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { Building, BuildingActionBase } from \"./Building\";\r\n\r\nexport type BuildingData = {\r\n  current: number;\r\n  turnedOn?: number;\r\n};\r\n\r\nconst buildings: Record<string, Building> = {};\r\n\r\nexport function registerBuilding(building: BuildingActionBase) {\r\n  buildings[building.getBuildingName()] = building;\r\n  registerAction(building);\r\n}\r\n\r\nexport function getBuildingByName(name: string): Building {\r\n  return buildings?.[name] as Building;\r\n}\r\n\r\nexport function getBuildingAmount(\r\n  state: PlayerContextState,\r\n  building: Building,\r\n): number {\r\n  return state.buildings?.[building.getBuildingName()]?.current || 0;\r\n}\r\n\r\nexport function getBuildingAmountTurnedOn(\r\n  state: PlayerContextState,\r\n  building: Building,\r\n): number {\r\n  return state.buildings?.[building.getBuildingName()]?.turnedOn || 0;\r\n}\r\n\r\nfunction changeBuildingsTurnedOnImpl(\r\n  building: Building,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const name = building.getBuildingName();\r\n\r\n  if (state.buildings?.[name] == null) {\r\n    state.buildings[name] = {\r\n      current: 0,\r\n      turnedOn: 0,\r\n    };\r\n  }\r\n\r\n  const newAmount = getBuildingAmountTurnedOn(state, building) + amount;\r\n  if (newAmount < 0 || newAmount > getBuildingAmount(state, building)) {\r\n    return state;\r\n  }\r\n  state.buildings[name].turnedOn = newAmount;\r\n\r\n  return state;\r\n}\r\n\r\nexport function changeBuildingsTurnedOn(\r\n  this: any,\r\n  building: Building,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  return changeBuildingsTurnedOnImpl.bind(this, building, amount);\r\n}\r\n\r\nexport function buildingAmountsChanged(\r\n  oldState: PlayerContextState,\r\n  newState: PlayerContextState,\r\n  building: Building,\r\n): boolean {\r\n  const oldBuildings = getBuildingAmount(oldState, building);\r\n  const newBuildings = getBuildingAmount(newState, building);\r\n  return oldBuildings != newBuildings;\r\n}\r\n","import { ActionBase, DoActionArgs } from \"../actions/Action\";\r\nimport { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { grantResource, Resource } from \"../Resources\";\r\nimport {\r\n  BuildingData,\r\n  getBuildingAmount,\r\n  getBuildingAmountTurnedOn,\r\n} from \"./Buildings\";\r\n\r\nexport interface Building {\r\n  getBuildingName(): string;\r\n  canAfford(state: PlayerContextState): boolean;\r\n  canTurnOff(): boolean;\r\n}\r\n\r\nexport abstract class BuildingActionBase\r\n  extends ActionBase\r\n  implements Building\r\n{\r\n  abstract getBaseResourceCost(): Record<string, number>;\r\n  abstract getBaseResourceScale(): Record<string, number>;\r\n  abstract getBuildingName(): string;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getName(): string {\r\n    return this.getBuildingName();\r\n  }\r\n\r\n  getDisplayName(state: PlayerContextState): string {\r\n    const amount = getBuildingAmount(state, this);\r\n    if (amount > 0) {\r\n      return this.getName() + \" (\" + getBuildingAmount(state, this) + \")\";\r\n    }\r\n    return this.getName();\r\n  }\r\n\r\n  getCategory(): string {\r\n    return \"Buildings\";\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: this.getResourceCost(state),\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getResourceCost(state: PlayerContextState): Record<string, number> {\r\n    const currentAmount = getBuildingAmount(state, this);\r\n    const baseCost = this.getBaseResourceCost();\r\n    const scale = this.getBaseResourceScale();\r\n    const finalCost: Record<string, number> = {};\r\n    Object.keys(baseCost).forEach((key) => {\r\n      const baseCostForKey = applyTransformations(\r\n        [...this.getTags(), TransformationTags.Cost, key],\r\n        state,\r\n        baseCost[key],\r\n      );\r\n      const costScaleForKey = applyTransformations(\r\n        [...this.getTags(), TransformationTags.CostScale, key],\r\n        state,\r\n        scale[key] - 1,\r\n      );\r\n\r\n      finalCost[key] = Math.ceil(\r\n        baseCostForKey * Math.pow(1 + costScaleForKey, currentAmount),\r\n      );\r\n    });\r\n    return finalCost;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    const name = this.getBuildingName();\r\n    const cost = this.getResourceCost(state);\r\n    if (state.buildings?.[name] == null) {\r\n      state.buildings[name] = {\r\n        current: 0,\r\n        turnedOn: 0,\r\n      };\r\n    }\r\n    const buildingData = state.buildings[name] as BuildingData;\r\n    buildingData.current += 1;\r\n    buildingData.turnedOn =\r\n      getBuildingAmountTurnedOn(state, this) +\r\n      (args.isAutomatic &&\r\n      state.global.automaticallyBuiltBuildingsStartOff &&\r\n      this.canTurnOff()\r\n        ? 0\r\n        : 1);\r\n    (Object.keys(cost) as Array<Resource>).forEach((resourceName) => {\r\n      state = grantResource(resourceName, -cost[resourceName])(state);\r\n    });\r\n    return state;\r\n  }\r\n}\r\n","import mem from \"mem\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { Action } from \"./actions/Action\";\r\nimport { getActionByName } from \"./actions/Actions\";\r\nimport { ConsumableItem } from \"./items/consumable/ConsumableItem\";\r\nimport { getAmountOfItem } from \"./items/Inventory\";\r\nimport { Item, ItemOccurrence } from \"./items/Item\";\r\nimport { getItemById } from \"./items/Items\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"./PlayerContext\";\r\n\r\nexport interface QuickbarItemData {\r\n  type: \"item\";\r\n  occurrence: ItemOccurrence;\r\n}\r\n\r\nexport interface QuickbarActionData {\r\n  type: \"action\";\r\n  name: string;\r\n}\r\n\r\nexport type QuickbarData = QuickbarItemData | QuickbarActionData;\r\n\r\nexport interface QuickbarAction {\r\n  getDisplayName(state: PlayerContextState): string;\r\n  isEnabled(state: PlayerContextState): boolean;\r\n  isActive(state: PlayerContextState): boolean;\r\n  getTransform(state: PlayerContextState): PlayerContextTransform;\r\n  toQuickbarData(): QuickbarData;\r\n}\r\n\r\nclass QuickbarItem {\r\n  data: QuickbarItemData;\r\n\r\n  constructor(data: QuickbarItemData) {\r\n    this.data = data;\r\n  }\r\n\r\n  getItem(): Item {\r\n    const itemOccurrence = this.data.occurrence;\r\n    const item = getItemById(itemOccurrence.itemId);\r\n    return item;\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    const item = this.getItem();\r\n    return item.isActive(state);\r\n  }\r\n\r\n  getDisplayName(state: PlayerContextState): string {\r\n    const item = this.getItem();\r\n    const name = item.getName(this.data.occurrence.params);\r\n    const amount = getAmountOfItem(this.data.occurrence, state);\r\n    let cooldown = 0;\r\n    if (\r\n      item\r\n        .getTags(state, this.data.occurrence.params)\r\n        .findIndex((item) => item.tag == \"Consumable\") >= 0\r\n    ) {\r\n      cooldown = (item as ConsumableItem).getCooldownLeftSec(state);\r\n    }\r\n    let displayName = name;\r\n    if (amount != 1) {\r\n      displayName += ` (${amount})`;\r\n    }\r\n    if (cooldown > 0) {\r\n      displayName += ` (${formatNumber(cooldown, { showDecimals: true })} sec)`;\r\n    }\r\n    return displayName;\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return (\r\n      this.getItem().getPrimaryAction(state, this.data.occurrence.params)\r\n        ?.isEnabled || false\r\n    );\r\n  }\r\n\r\n  getTransform(state: PlayerContextState): PlayerContextTransform {\r\n    return (\r\n      this.getItem().getPrimaryAction(state, this.data.occurrence.params)\r\n        ?.transform || ((state) => state)\r\n    );\r\n  }\r\n\r\n  toQuickbarData(): QuickbarData {\r\n    return this.data;\r\n  }\r\n}\r\n\r\nconst doActionMemoized = mem((action: Action) => {\r\n  return action.doAction.bind(action, {\r\n    isAutomatic: false,\r\n  });\r\n});\r\n\r\nclass QuickbarActionImpl {\r\n  data: QuickbarActionData;\r\n\r\n  constructor(data: QuickbarActionData) {\r\n    this.data = data;\r\n  }\r\n\r\n  getAction(): Action {\r\n    return getActionByName(this.data.name);\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return this.getAction().isActive(state);\r\n  }\r\n\r\n  getDisplayName(state: PlayerContextState): string {\r\n    return this.getAction().getDisplayName(state);\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return this.getAction().isEnabled(state);\r\n  }\r\n\r\n  getTransform(state: PlayerContextState): PlayerContextTransform {\r\n    return doActionMemoized(this.getAction());\r\n  }\r\n\r\n  toQuickbarData(): QuickbarData {\r\n    return this.data;\r\n  }\r\n}\r\n\r\nexport function getQuickbarActions(\r\n  state: PlayerContextState,\r\n): QuickbarAction[] {\r\n  return state.quickbar.map((quickbarData) => {\r\n    if (quickbarData.type == \"item\") {\r\n      return new QuickbarItem(quickbarData);\r\n    } else {\r\n      return new QuickbarActionImpl(quickbarData);\r\n    }\r\n  });\r\n}\r\n\r\nexport function addActionToQuickbar(\r\n  state: PlayerContextState,\r\n  action: Action,\r\n): PlayerContextState {\r\n  return addToQuickbar(state, {\r\n    type: \"action\",\r\n    name: action.getName(),\r\n  });\r\n}\r\n\r\nexport function addItemToQuickbar(\r\n  state: PlayerContextState,\r\n  itemOccurrence: ItemOccurrence,\r\n): PlayerContextState {\r\n  return addToQuickbar(state, {\r\n    type: \"item\",\r\n    occurrence: itemOccurrence,\r\n  });\r\n}\r\n\r\nexport function addToQuickbar(\r\n  state: PlayerContextState,\r\n  data: QuickbarData,\r\n): PlayerContextState {\r\n  if (isInQuickbar(state, data)) {\r\n    return state;\r\n  }\r\n  if (isQuickbarFull(state)) {\r\n    return state;\r\n  }\r\n  state.quickbar.push(data);\r\n  return state;\r\n}\r\n\r\nexport function removeFromQuickbar(\r\n  state: PlayerContextState,\r\n  data: QuickbarData,\r\n): PlayerContextState {\r\n  const stringifiedData = JSON.stringify(data);\r\n  const index = state.quickbar.findIndex(\r\n    (element) => JSON.stringify(element) == stringifiedData,\r\n  );\r\n  if (index < 0) {\r\n    return state;\r\n  }\r\n  state.quickbar.splice(index, 1);\r\n  return state;\r\n}\r\n\r\nexport function isQuickbarFull(state: PlayerContextState): boolean {\r\n  return state.quickbar.length >= 10;\r\n}\r\n\r\nexport function isInQuickbar(\r\n  state: PlayerContextState,\r\n  data: QuickbarData,\r\n): boolean {\r\n  const stringifiedData = JSON.stringify(data);\r\n  return (\r\n    state.quickbar.findIndex(\r\n      (element) => JSON.stringify(element) == stringifiedData,\r\n    ) >= 0\r\n  );\r\n}\r\n","import { ThemeMode } from \"@rneui/themed\";\r\nimport React from \"react\";\r\nimport { Platform, StyleSheet } from \"react-native\";\r\nimport { ThemeOptions, useTheme } from \"react-native-elements\";\r\nimport { color } from \"react-native-elements/dist/config\";\r\nimport { Directions, Gesture } from \"react-native-gesture-handler\";\r\nimport { SpellElement } from \"../../backend/spells/ElementsAndSchools\";\r\nimport { Markdown } from \"./Markdown\";\r\n\r\nexport function disabledColorByTheme(theme: ThemeOptions) {\r\n  return theme.mode === \"dark\"\r\n    ? color(theme?.colors?.disabled).lighten(1.2).string()\r\n    : color(theme?.colors?.disabled).darken(0.3).string();\r\n}\r\n\r\nconst LIGHT_ELEMENT_COLORS = {\r\n  Fire: \"#c30\",\r\n  Earth: \"#740\",\r\n  Water: \"#08f\",\r\n  Air: \"#0b4\",\r\n  Nature: \"#5b0\",\r\n  Lightning: \"#80f\",\r\n  Darkness: \"#444\",\r\n};\r\n\r\nconst DARK_ELEMENT_COLORS = {\r\n  Fire: \"#820\",\r\n  Earth: \"#630\",\r\n  Water: \"#048\",\r\n  Air: \"#063\",\r\n  Nature: \"#360\",\r\n  Lightning: \"#408\",\r\n  Darkness: \"#444\",\r\n};\r\n\r\nexport function showImportFromFile(): boolean {\r\n  return Platform.select({\r\n    ios: true,\r\n    android: true,\r\n    default: false,\r\n  });\r\n}\r\n\r\nexport function showExportToFile(): boolean {\r\n  return Platform.select({\r\n    ios: true,\r\n    android: true,\r\n    web: true,\r\n    default: false,\r\n  });\r\n}\r\n\r\nexport function elementColorByTheme(\r\n  themeMode: ThemeMode,\r\n  element: SpellElement,\r\n) {\r\n  return themeMode === \"dark\"\r\n    ? DARK_ELEMENT_COLORS[element]\r\n    : LIGHT_ELEMENT_COLORS[element];\r\n}\r\n\r\nexport function getPrimaryButtonTextColor(\r\n  theme: ThemeOptions,\r\n  disabled: boolean,\r\n): string {\r\n  if (disabled) {\r\n    return disabledColorByTheme(theme);\r\n  }\r\n  return \"white\";\r\n}\r\n\r\nexport function DescriptionViewer(props: any) {\r\n  const theme = useTheme();\r\n  return (\r\n    <Markdown style={[{ color: theme.theme.colors.grey1 }, props.style || {}]}>\r\n      {props.children}\r\n    </Markdown>\r\n  );\r\n}\r\n\r\nexport function EffectViewer(props: any) {\r\n  const theme = useTheme();\r\n  return (\r\n    <Markdown\r\n      style={[\r\n        styles.effectText,\r\n        { color: theme.theme.colors.grey1 },\r\n        props.style || {},\r\n      ]}\r\n    >\r\n      {props.children}\r\n    </Markdown>\r\n  );\r\n}\r\n\r\nexport function createGestureHandler(\r\n  swipeLeftHandler: () => void,\r\n  swipeRightHandler: () => void,\r\n) {\r\n  if (Platform.OS === \"web\") {\r\n    const leftGesture = Gesture.Fling()\r\n      .direction(Directions.LEFT)\r\n      .onEnd((e: any, success) => {\r\n        if (success && e.translationX < 0) {\r\n          swipeLeftHandler();\r\n        }\r\n      });\r\n    const rightGesture = Gesture.Fling()\r\n      .direction(Directions.RIGHT)\r\n      .onEnd((e: any, success) => {\r\n        if (success && e.translationX > 0) {\r\n          swipeRightHandler();\r\n        }\r\n      });\r\n\r\n    return Gesture.Race(leftGesture, rightGesture);\r\n  }\r\n\r\n  let sharedTouchPosition = {\r\n    x: 0,\r\n    y: 0,\r\n    initialX: 0,\r\n    initialY: 0,\r\n    initialTimestamp: 0,\r\n    lastTimestamp: 0,\r\n    status: \"end\",\r\n  };\r\n  const POSITION_THRESHOLD = 80;\r\n  const VELOCITY_THRESHOLD = 300;\r\n  const Y_POSITION_THRESHOLD = 65;\r\n  return Gesture.Manual()\r\n    .onTouchesDown((e, manager) => {\r\n      if (sharedTouchPosition.status == \"begin\") {\r\n        // Do nothing\r\n        return;\r\n      }\r\n\r\n      sharedTouchPosition.initialX = e.allTouches[0].x;\r\n      sharedTouchPosition.initialY = e.allTouches[0].y;\r\n\r\n      sharedTouchPosition.x = e.allTouches[0].x;\r\n      sharedTouchPosition.y = e.allTouches[0].y;\r\n\r\n      sharedTouchPosition.initialTimestamp = Date.now();\r\n      sharedTouchPosition.lastTimestamp = Date.now();\r\n      sharedTouchPosition.status = \"begin\";\r\n    })\r\n    .onTouchesMove((e, manager) => {\r\n      if (sharedTouchPosition.status != \"begin\") {\r\n        return;\r\n      }\r\n      const currentTimestamp = Date.now();\r\n      const timestampDeltaSec =\r\n        Math.max(currentTimestamp - sharedTouchPosition.initialTimestamp, 1) /\r\n        1000.0;\r\n      const deltaX = e.allTouches[0].x - sharedTouchPosition.initialX;\r\n      const deltaY = e.allTouches[0].y - sharedTouchPosition.initialY;\r\n      const velocityX = deltaX / timestampDeltaSec;\r\n      const velocityY = deltaY / timestampDeltaSec;\r\n      const tooVertical = Math.abs(deltaY) > Y_POSITION_THRESHOLD;\r\n      if (tooVertical) {\r\n        sharedTouchPosition.status = \"end\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        Math.abs(deltaY) * 2.5 > Math.abs(deltaX) &&\r\n        Math.abs(deltaX) > POSITION_THRESHOLD\r\n      ) {\r\n        sharedTouchPosition.status = \"end\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        velocityX < -VELOCITY_THRESHOLD &&\r\n        e.allTouches[0].x - sharedTouchPosition.initialX < -POSITION_THRESHOLD\r\n      ) {\r\n        swipeLeftHandler();\r\n        sharedTouchPosition.status = \"end\";\r\n      } else if (\r\n        velocityX > VELOCITY_THRESHOLD &&\r\n        e.allTouches[0].x - sharedTouchPosition.initialX > POSITION_THRESHOLD\r\n      ) {\r\n        swipeRightHandler();\r\n        sharedTouchPosition.status = \"end\";\r\n      }\r\n      sharedTouchPosition.x = e.allTouches[0].x;\r\n      sharedTouchPosition.y = e.allTouches[0].y;\r\n      sharedTouchPosition.lastTimestamp = currentTimestamp;\r\n    })\r\n    .onTouchesUp((e, manager) => {\r\n      if (e.numberOfTouches === 0) {\r\n        const currentTimestamp = Date.now();\r\n        const timestampDeltaSec =\r\n          Math.max(currentTimestamp - sharedTouchPosition.initialTimestamp, 1) /\r\n          1000.0;\r\n        const velocityX =\r\n          (e.allTouches[0].x - sharedTouchPosition.initialX) /\r\n          timestampDeltaSec;\r\n        const velocityY =\r\n          (e.allTouches[0].y - sharedTouchPosition.initialY) /\r\n          timestampDeltaSec;\r\n        const deltaX = e.allTouches[0].x - sharedTouchPosition.initialX;\r\n        sharedTouchPosition.status = \"end\";\r\n      }\r\n    })\r\n    .onTouchesCancelled((e, manager) => {\r\n      sharedTouchPosition.status = \"end\";\r\n    });\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  effectText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n});\r\n","import { color } from \"@rneui/base\";\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleProp,\r\n  StyleSheet,\r\n  TextStyle,\r\n  TouchableNativeFeedback,\r\n} from \"react-native\";\r\nimport {\r\n  Button as RNEButton,\r\n  ButtonProps,\r\n  useTheme,\r\n} from \"react-native-elements\";\r\nimport { getPrimaryButtonTextColor } from \"./Miscellaneous\";\r\n\r\nexport function Button(\r\n  props: Omit<ButtonProps, \"onPress\"> & {\r\n    onPress: () => void;\r\n    enableAutoRepress?: boolean;\r\n    autoRepressConfig?: {\r\n      minTimeMs?: number;\r\n      startingThreshold?: number;\r\n      startingRepressTime?: number;\r\n      dropoffMultiplier?: number;\r\n    };\r\n  },\r\n) {\r\n  const theme = useTheme();\r\n  const {\r\n    disabled,\r\n    disabledTitleStyle,\r\n    titleStyle,\r\n    containerStyle,\r\n    autoRepressConfig,\r\n    enableAutoRepress,\r\n    ...rest\r\n  } = props;\r\n  const disabledTitleStyleComputed = useMemo(\r\n    () => ({\r\n      color: getPrimaryButtonTextColor(theme.theme, true),\r\n    }),\r\n    [theme],\r\n  );\r\n  const pressed = useRef(false);\r\n  const disabledRef = useRef(disabled);\r\n  disabledRef.current = disabled;\r\n  const currentRepressTimeout = useRef(300);\r\n  const currentRepressHandler = useRef<NodeJS.Timeout | null>(null);\r\n  const [flash, setFlash] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (flash) {\r\n      const timeoutHandler = setTimeout(\r\n        () => setFlash(false),\r\n        (autoRepressConfig?.minTimeMs ?? 100) / 3,\r\n      );\r\n      return () => clearTimeout(timeoutHandler);\r\n    }\r\n  }, [flash]);\r\n  const rePress = useCallback(() => {\r\n    if (pressed.current && !disabledRef.current) {\r\n      props.onPress && props.onPress();\r\n      setFlash(true);\r\n      currentRepressTimeout.current = Math.max(\r\n        autoRepressConfig?.minTimeMs ?? 100,\r\n        currentRepressTimeout.current *\r\n          (autoRepressConfig?.dropoffMultiplier ?? 0.94),\r\n      );\r\n      currentRepressHandler.current = setTimeout(\r\n        rePress,\r\n        currentRepressTimeout.current,\r\n      );\r\n    }\r\n  }, [props.onPress]);\r\n  const onPressInCallback = useCallback(() => {\r\n    pressed.current = true;\r\n    currentRepressHandler.current = setTimeout(() => {\r\n      if (pressed.current && !disabledRef.current) {\r\n        currentRepressTimeout.current =\r\n          autoRepressConfig?.startingRepressTime ?? 300;\r\n        rePress();\r\n      }\r\n    }, autoRepressConfig?.startingThreshold ?? 600);\r\n  }, [rePress]);\r\n  const onPressOutCallback = useCallback(() => {\r\n    pressed.current = false;\r\n    if (currentRepressHandler.current != null) {\r\n      clearTimeout(currentRepressHandler.current);\r\n      currentRepressHandler.current = null;\r\n    }\r\n  }, [rePress]);\r\n  useEffect(() => {\r\n    return () => {\r\n      onPressOutCallback();\r\n    };\r\n  }, [onPressOutCallback, disabledRef.current]);\r\n  const titleStyleFlat: StyleProp<TextStyle> = useMemo(\r\n    () =>\r\n      StyleSheet.flatten([\r\n        {\r\n          color: getPrimaryButtonTextColor(theme.theme, false),\r\n        },\r\n        titleStyle,\r\n      ]),\r\n    [titleStyle, theme],\r\n  );\r\n  const background = useMemo(\r\n    () =>\r\n      Platform.OS === \"android\" && Platform.Version >= 21 && !flash\r\n        ? TouchableNativeFeedback.Ripple(\r\n            color(titleStyleFlat?.color?.toString())\r\n              .alpha(theme.theme.mode === \"dark\" ? 0.1 : 0.2)\r\n              .rgb()\r\n              .string(),\r\n            true,\r\n          )\r\n        : undefined,\r\n    [titleStyleFlat, flash, theme],\r\n  );\r\n  const containerStyleFlat = useMemo(\r\n    () =>\r\n      StyleSheet.flatten([\r\n        containerStyle,\r\n        flash && Platform.OS != \"android\" && { opacity: 0.9 },\r\n      ]),\r\n    [containerStyle, theme, flash],\r\n  );\r\n  const disabledTitleStyleArray = useMemo(\r\n    () => [disabledTitleStyleComputed, disabledTitleStyle],\r\n    [disabledTitleStyleComputed, disabledTitleStyle],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <RNEButton\r\n        disabledTitleStyle={disabledTitleStyleArray}\r\n        onPressIn={enableAutoRepress ? onPressInCallback : undefined}\r\n        onPressOut={enableAutoRepress ? onPressOutCallback : undefined}\r\n        disabled={disabled}\r\n        titleStyle={titleStyleFlat}\r\n        background={background}\r\n        containerStyle={containerStyleFlat}\r\n        {...rest}\r\n      />\r\n    ),\r\n    [\r\n      disabledTitleStyleArray,\r\n      enableAutoRepress,\r\n      onPressInCallback,\r\n      onPressOutCallback,\r\n      background,\r\n      rest.onPress,\r\n      rest.title,\r\n      containerStyleFlat,\r\n      titleStyleFlat,\r\n      disabled,\r\n      flash,\r\n    ],\r\n  );\r\n}\r\n","import React, { useContext } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { getTotalAmountOfItem } from \"../../backend/items/Inventory\";\r\nimport { getItemById } from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  getResourceInfo,\r\n  Resource,\r\n} from \"../../backend/Resources\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Text } from \"./Text\";\r\n\r\ntype Props = {\r\n  resources: Partial<Record<Resource, number>>;\r\n  items?: Record<string, number>;\r\n};\r\n\r\nfunction ResourceRow(props: {\r\n  name: string;\r\n  icon: string;\r\n  current: number;\r\n  cost: number;\r\n  cap: number;\r\n}) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View style={styles.row}>\r\n      <View style={styles.inlineRow}>\r\n        <GameIcon icon={props.icon} style={styles.icon} small />\r\n        <Text>{props.name}: </Text>\r\n      </View>\r\n      <View style={styles.costValue}>\r\n        <Text\r\n          style={\r\n            props.current < props.cost && { color: theme.theme.colors.error }\r\n          }\r\n        >\r\n          {formatNumber(props.current, { showDecimals: true })}\r\n        </Text>\r\n        <Text>/</Text>\r\n        <Text\r\n          style={props.cap < props.cost && { color: theme.theme.colors.error }}\r\n        >\r\n          {formatNumber(props.cost)}\r\n        </Text>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst ResourceRowMemo = React.memo(ResourceRow);\r\n\r\nexport function CostViewer(props: Props) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const resourceKeys = Object.keys(props.resources) as Array<Resource>;\r\n  const rows = resourceKeys.map((resourceName) => {\r\n    const resourceCost = props.resources[resourceName] as number;\r\n    const resourceCap = getResourceCap(playerContext, resourceName);\r\n    const currentAmount = getResourceAmount(playerContext, resourceName);\r\n    const resourceInfo = getResourceInfo(resourceName);\r\n    return (\r\n      <ResourceRowMemo\r\n        name={resourceName}\r\n        icon={resourceInfo.icon}\r\n        current={currentAmount}\r\n        cost={resourceCost}\r\n        cap={resourceCap}\r\n        key={resourceName}\r\n      />\r\n    );\r\n  });\r\n  const itemRows = props.items\r\n    ? Object.keys(props.items).map((itemId) => {\r\n        const itemCost = props?.items?.[itemId] as number;\r\n        const item = getItemById(itemId);\r\n        const itemAmount = getTotalAmountOfItem(item, playerContext);\r\n        return (\r\n          <ResourceRowMemo\r\n            name={item.getName(item.getDefaultParams())}\r\n            icon={item.getId()}\r\n            current={itemAmount}\r\n            cost={itemCost}\r\n            cap={1e10}\r\n            key={itemId}\r\n          />\r\n        );\r\n      })\r\n    : [];\r\n  return (\r\n    <View style={styles.container}>\r\n      {rows}\r\n      {itemRows}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  costValue: {\r\n    flexDirection: \"row\",\r\n  },\r\n  notMet: {\r\n    color: \"red\",\r\n  },\r\n});\r\n","import React, { useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Button } from \"./Button\";\r\n\r\ntype PlusMinusAllocatorProps = {\r\n  disableMinus: boolean;\r\n  disablePlus: boolean;\r\n  onPressMinus: () => void;\r\n  onPressPlus: () => void;\r\n};\r\n\r\nexport function PlusMinusAllocator(\r\n  props: PlusMinusAllocatorProps = {\r\n    disableMinus: false,\r\n    disablePlus: false,\r\n    onPressMinus: () => {},\r\n    onPressPlus: () => {},\r\n  },\r\n) {\r\n  const minusButton = useMemo(\r\n    () => (\r\n      <Button\r\n        enableAutoRepress={true}\r\n        containerStyle={styles.plusMinusAllocatorButton}\r\n        style={styles.plusMinusAllocatorButtonInner}\r\n        iconContainerStyle={styles.plusMinusAllocatorButtonInner}\r\n        buttonStyle={styles.plusMinusAllocatorButtonInner}\r\n        title=\"-\"\r\n        onPress={props.onPressMinus}\r\n        disabled={props.disableMinus}\r\n        autoRepressConfig={{ minTimeMs: 50 }}\r\n      />\r\n    ),\r\n    [props.onPressMinus, props.disableMinus],\r\n  );\r\n  const plusButton = useMemo(\r\n    () => (\r\n      <Button\r\n        enableAutoRepress={true}\r\n        containerStyle={styles.plusMinusAllocatorButton}\r\n        style={styles.plusMinusAllocatorButtonInner}\r\n        iconContainerStyle={styles.plusMinusAllocatorButtonInner}\r\n        buttonStyle={styles.plusMinusAllocatorButtonInner}\r\n        title=\"+\"\r\n        onPress={props.onPressPlus}\r\n        disabled={props.disablePlus}\r\n        autoRepressConfig={{ minTimeMs: 50 }}\r\n      />\r\n    ),\r\n    [props.onPressPlus, props.disablePlus],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        {minusButton}\r\n        {plusButton}\r\n      </View>\r\n    ),\r\n    [minusButton, plusButton],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  plusMinusAllocatorButton: {\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n    marginHorizontal: 4,\r\n  },\r\n  plusMinusAllocatorButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { color } from \"react-native-elements/dist/config\";\r\nimport { Action } from \"../../backend/actions/Action\";\r\nimport { BuildingActionBase } from \"../../backend/buildings/Building\";\r\nimport {\r\n  changeBuildingsTurnedOn,\r\n  getBuildingAmount,\r\n  getBuildingAmountTurnedOn,\r\n} from \"../../backend/buildings/Buildings\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  addActionToQuickbar,\r\n  isInQuickbar,\r\n  isQuickbarFull,\r\n} from \"../../backend/Quickbar\";\r\nimport { getResourceCap, Resource } from \"../../backend/Resources\";\r\nimport { Button } from \"./Button\";\r\n\r\nimport { CostViewer } from \"./CostViewer\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { DescriptionViewer, disabledColorByTheme } from \"./Miscellaneous\";\r\nimport { PlusMinusAllocator } from \"./PlusMinusAllocator\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function ActionContainer(props: {\r\n  action: Action;\r\n  showCompact: boolean;\r\n  showAddToQuickbar?: boolean;\r\n  collapsed?: boolean;\r\n  onPressExpand?: () => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const action = props.action;\r\n  const showAddToQuickbar = props.showAddToQuickbar || false;\r\n  const cost = action.getCost(playerContext);\r\n  const isFree =\r\n    Object.keys(cost.resources).length === 0 &&\r\n    Object.keys(cost.items).length === 0;\r\n  const capIsEnough = (Object.keys(cost.resources) as Array<Resource>).every(\r\n    (resource: Resource) => {\r\n      return (\r\n        (cost.resources[resource] ?? 0) <=\r\n        getResourceCap(playerContext, resource)\r\n      );\r\n    },\r\n  );\r\n  const canTurnOff =\r\n    action instanceof BuildingActionBase && action.canTurnOff();\r\n  const buildingAmount =\r\n    action instanceof BuildingActionBase &&\r\n    getBuildingAmount(playerContext, action);\r\n  const buildingAmountOn =\r\n    action instanceof BuildingActionBase &&\r\n    getBuildingAmountTurnedOn(playerContext, action);\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    const descriptionContents = `${action.getDisplayDescription(\r\n      playerContext,\r\n    )} **${action.getDisplayEffect(playerContext)}**`;\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <DescriptionViewer style={{ flex: 1 }}>\r\n          {descriptionContents}\r\n        </DescriptionViewer>\r\n      </View>\r\n    );\r\n  }, [\r\n    !props.collapsed && action.getDisplayDescription(playerContext),\r\n    !props.collapsed && action.getDisplayEffect(playerContext),\r\n  ]);\r\n\r\n  const costContainer = useMemo(() => {\r\n    return (\r\n      <View style={styles.costContainer}>\r\n        <Markdown>Cost:</Markdown>\r\n        <CostViewer\r\n          resources={action.getCost(playerContext).resources}\r\n          items={action.getCost(playerContext).items}\r\n        />\r\n      </View>\r\n    );\r\n  }, [!props.collapsed && JSON.stringify(action.getCost(playerContext))]);\r\n\r\n  const turnOffContainer = useMemo(() => {\r\n    if (!canTurnOff) {\r\n      return null;\r\n    }\r\n    const amountActiveText = `${buildingAmountOn}/${buildingAmount}`;\r\n    return (\r\n      <View style={styles.turnOnRow}>\r\n        <Markdown>Amount active:</Markdown>\r\n        <View style={styles.turnOnQuantityContainer}>\r\n          <Markdown>{amountActiveText}</Markdown>\r\n          <View style={styles.plusMinusContainer}>\r\n            <PlusMinusAllocator\r\n              disableMinus={buildingAmountOn === 0}\r\n              disablePlus={buildingAmountOn === buildingAmount}\r\n              onPressMinus={() =>\r\n                playerContext.apply(\r\n                  changeBuildingsTurnedOn(action as BuildingActionBase, -1),\r\n                )\r\n              }\r\n              onPressPlus={() =>\r\n                playerContext.apply(\r\n                  changeBuildingsTurnedOn(action as BuildingActionBase, 1),\r\n                )\r\n              }\r\n            />\r\n          </View>\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [canTurnOff, buildingAmount, buildingAmountOn]);\r\n  const theme = useTheme();\r\n\r\n  const disabled = !action.isEnabled(playerContext);\r\n\r\n  return useMemo(() => {\r\n    const capTooLowColorBuilder = color(disabledColorByTheme(theme.theme))\r\n      .hsl()\r\n      .hue(0);\r\n    const capTooLowColor =\r\n      theme.theme.mode === \"dark\"\r\n        ? capTooLowColorBuilder.saturationl(32).lighten(0.3).string()\r\n        : capTooLowColorBuilder.saturationl(48).lighten(0.05).string();\r\n    const capTooLowBackgroundBuilder = color(theme.theme.colors.disabled)\r\n      .hsl()\r\n      .hue(0);\r\n    const capTooLowBackground =\r\n      theme.theme.mode === \"dark\"\r\n        ? capTooLowBackgroundBuilder.darken(0.2).string()\r\n        : capTooLowBackgroundBuilder.darken(0.1).string();\r\n    const button = (\r\n      <Button\r\n        key={action.getName()}\r\n        onPress={() =>\r\n          playerContext.apply(\r\n            action.doAction.bind(action, { isAutomatic: false }),\r\n          )\r\n        }\r\n        enableAutoRepress={true}\r\n        title={action.getDisplayName(playerContext)}\r\n        titleStyle={styles.buttonTitle}\r\n        containerStyle={[styles.buttonContainer]}\r\n        disabledStyle={!capIsEnough && { backgroundColor: capTooLowBackground }}\r\n        disabledTitleStyle={!capIsEnough && { color: capTooLowColor }}\r\n        disabled={disabled}\r\n      />\r\n    );\r\n    const addToQuickbarButton = (\r\n      <Button\r\n        onPress={() =>\r\n          playerContext.apply((state) => addActionToQuickbar(state, action))\r\n        }\r\n        title=\"Add to Quickbar\"\r\n        titleStyle={styles.smallButtonTitle}\r\n        containerStyle={[styles.quickbarButtonContainer]}\r\n        disabled={\r\n          isInQuickbar(playerContext, {\r\n            type: \"action\",\r\n            name: action.getName(),\r\n          }) || isQuickbarFull(playerContext)\r\n        }\r\n      />\r\n    );\r\n    return (\r\n      <View style={styles.actionContainer} key={action.getName()}>\r\n        <View style={styles.buttonRowContainer}>\r\n          <View style={styles.buttonContainerView}>\r\n            {props.showCompact && props.collapsed && (\r\n              <Text\r\n                h3\r\n                key={action.getName()}\r\n                onPress={props.onPressExpand}\r\n                style={[\r\n                  styles.buttonContainer,\r\n                  disabled && { color: disabledColorByTheme(theme.theme) },\r\n                  !capIsEnough && { color: capTooLowColor },\r\n                ]}\r\n              >\r\n                {action.getDisplayName(playerContext)}\r\n              </Text>\r\n            )}\r\n            {(!props.collapsed || !props.showCompact) && button}\r\n            {showAddToQuickbar && addToQuickbarButton}\r\n          </View>\r\n          <TouchableWithoutFeedback\r\n            onPress={props.onPressExpand}\r\n            accessibilityLabel={props.collapsed ? \"Expand\" : \"Contract\"}\r\n          >\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.theme.colors.black}\r\n              />\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n        </View>\r\n        {!props.collapsed && (\r\n          <View>\r\n            {descriptionContainer}\r\n            {!isFree && costContainer}\r\n            {canTurnOff && turnOffContainer}\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    action.getName(),\r\n    action.getDisplayName(playerContext),\r\n    disabled,\r\n    canTurnOff,\r\n    turnOffContainer,\r\n    !props.collapsed && costContainer,\r\n    !props.collapsed && descriptionContainer,\r\n    capIsEnough,\r\n    showAddToQuickbar,\r\n    showAddToQuickbar && JSON.stringify(playerContext.quickbar),\r\n    props.collapsed,\r\n    props.onPressExpand,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  actionContainer: { marginVertical: 8 },\r\n  buttonRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  quickbarButtonContainer: {\r\n    marginLeft: 8,\r\n  },\r\n  expandContainer: {\r\n    width: 64,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    alignSelf: \"stretch\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginTop: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  buttonTitle: {\r\n    fontSize: 16,\r\n    textAlign: \"center\",\r\n    paddingVertical: 1,\r\n    ...Platform.select({\r\n      android: {\r\n        fontFamily: \"sans-serif-medium\",\r\n      },\r\n      default: {\r\n        fontSize: 18,\r\n      },\r\n    }),\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  buttonContainerView: {\r\n    flexDirection: \"row\",\r\n    flex: 1,\r\n  },\r\n  buttonContainer: {\r\n    flex: 1,\r\n  },\r\n  buttonContainerSmall: {\r\n    marginRight: 0,\r\n  },\r\n  capTooLowText: {\r\n    color: \"#d99\",\r\n  },\r\n  turnOnRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  turnOnQuantityContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusContainer: {\r\n    marginLeft: 8,\r\n  },\r\n  spellButtonTitleContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n  },\r\n  spellButtonTitleOnlyContainer: {\r\n    flex: 1,\r\n  },\r\n  spellButtonCostContainer: {\r\n    flexDirection: \"row\",\r\n    width: 40,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  spellManaIcon: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 1,\r\n    marginLeft: 2,\r\n  },\r\n});\r\n","import { Divider as RNEDivider, useTheme } from \"react-native-elements\";\r\n\r\nexport default function Divider(props: any) {\r\n  const theme = useTheme();\r\n  return <RNEDivider color={theme.theme.colors.divider} {...props} />;\r\n}\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport Divider from \"./Divider\";\r\nimport { Text } from \"./Text\";\r\n\r\ntype CategoryContainerProps = {\r\n  title: string;\r\n  titleStyle?: any;\r\n  containerStyle?: any;\r\n  children: any;\r\n};\r\n\r\nexport function CategoryHeader(\r\n  props: Omit<CategoryContainerProps, \"children\">,\r\n) {\r\n  return (\r\n    <View style={[styles.category, props.containerStyle]}>\r\n      <Text style={[styles.categoryTitle, props.titleStyle]} h4>\r\n        {props.title}\r\n      </Text>\r\n      <Divider style={styles.categoryDivider} />\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default function CategoryContainer(props: CategoryContainerProps) {\r\n  return (\r\n    <View style={styles.category}>\r\n      <Text style={[styles.categoryTitle, props.titleStyle]} h4>\r\n        {props.title}\r\n      </Text>\r\n      <Divider style={styles.categoryDivider} />\r\n      {props.children}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  category: { paddingTop: 16 },\r\n  categoryTitle: { marginBottom: 4, fontWeight: \"bold\" },\r\n  categoryDivider: { height: StyleSheet.hairlineWidth * 2 },\r\n});\r\n","import React, { useCallback, useState } from \"react\";\r\n\r\nexport type UIContextValue = {\r\n  getUIState: (id: string) => any;\r\n  setUIState: (id: string, value: any) => void;\r\n};\r\n\r\nexport const UIContext = React.createContext<UIContextValue>({\r\n  getUIState: (id: string) => null,\r\n  setUIState: (id: string, value: any) => {},\r\n});\r\n\r\nexport function useUIStateFromContext<T>(\r\n  context: UIContextValue,\r\n  key: string,\r\n  initialValue: T,\r\n): [T, (value: T) => void] {\r\n  const currentValue = context.getUIState(key) ?? initialValue;\r\n  const [stateValue, setStateValue] = useState<T>(currentValue);\r\n  const setCurrentValue = useCallback(\r\n    (value: T) => {\r\n      setStateValue(value);\r\n      context.setUIState(key, value);\r\n    },\r\n    [context, key, setStateValue],\r\n  );\r\n\r\n  return [stateValue as T, setCurrentValue];\r\n}\r\n","import React, { useCallback, useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ActionSubcategory } from \"../../backend/actions/Action\";\r\nimport {\r\n  getActionsForAreaByCategory,\r\n  getActionsForAreaBySubcategory,\r\n} from \"../../backend/actions/Actions\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { clone } from \"../../utils/CoreUtils\";\r\nimport { ActionContainer } from \"./ActionContainer\";\r\nimport CategoryContainer from \"./CategoryContainer\";\r\nimport Divider from \"./Divider\";\r\nimport { UIContext, useUIStateFromContext } from \"./UIContext\";\r\n\r\ntype ActionsContainerProps = {\r\n  area: string;\r\n  useSubcategories?: boolean;\r\n  showAddToQuickbar?: boolean;\r\n};\r\n\r\nfunction ActionCategoryContainer(\r\n  props: ActionsContainerProps & {\r\n    category: string;\r\n    useSubcategories: boolean;\r\n    expandedActions: Record<string, boolean>;\r\n    useButtonsWhenCollapsed: boolean;\r\n    setActionCallback: (actionName: string) => void;\r\n  },\r\n) {\r\n  const categories = props.useSubcategories\r\n    ? getActionsForAreaBySubcategory(props.area)\r\n    : getActionsForAreaByCategory(props.area);\r\n  const category = props.category;\r\n  const playerContext = useContext(PlayerContext);\r\n  const actionNames = Object.keys(categories[category] || {});\r\n  const visibleActionNames = actionNames.filter((actionName) => {\r\n    return categories[category][actionName].isVisible(playerContext);\r\n  });\r\n\r\n  const actionContainers = useMemo(() => {\r\n    return visibleActionNames.map((actionName) => {\r\n      const action = categories[category][actionName];\r\n      return (\r\n        <ActionContainer\r\n          key={actionName}\r\n          action={action}\r\n          collapsed={!props.expandedActions?.[actionName]}\r\n          onPressExpand={props.setActionCallback.bind(null, actionName)}\r\n          showAddToQuickbar={props.showAddToQuickbar}\r\n          showCompact={!props.useButtonsWhenCollapsed}\r\n        />\r\n      );\r\n    });\r\n  }, [\r\n    visibleActionNames.join(\",\"),\r\n    category,\r\n    JSON.stringify(props.expandedActions),\r\n    props.setActionCallback,\r\n    props.showAddToQuickbar,\r\n  ]);\r\n\r\n  return useMemo(() => {\r\n    if (visibleActionNames.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <CategoryContainer title={category} key={category}>\r\n        {props.useButtonsWhenCollapsed && (\r\n          <View style={styles.underCategoryPadding} />\r\n        )}\r\n        <View key={visibleActionNames[0]}>{actionContainers[0]}</View>\r\n        {actionContainers.slice(1).map((actionContainer, idx) => {\r\n          return (\r\n            <View key={visibleActionNames[idx]}>\r\n              {!props.useButtonsWhenCollapsed && <Divider />}\r\n              {actionContainer}\r\n            </View>\r\n          );\r\n        })}\r\n      </CategoryContainer>\r\n    );\r\n  }, [visibleActionNames.join(\",\"), actionContainers, category]);\r\n}\r\n\r\nexport default function ActionsContainer(props: ActionsContainerProps) {\r\n  const uiContext = useContext(UIContext);\r\n  const contextKey = \"ActionsContainer.\" + props.area;\r\n  const [expandedActions, setExpandedActions] = useUIStateFromContext<\r\n    Record<string, boolean>\r\n  >(uiContext, contextKey + \".ExpandedActions\", {});\r\n  const allowMaxOne = false;\r\n  const setActionCallback = useCallback(\r\n    (actionName: string) => {\r\n      if (allowMaxOne) {\r\n        if (expandedActions?.[actionName]) {\r\n          setExpandedActions({});\r\n        } else {\r\n          const newExpandedActions: Record<string, boolean> = {};\r\n          newExpandedActions[actionName] = true;\r\n          setExpandedActions(newExpandedActions);\r\n        }\r\n      } else {\r\n        expandedActions[actionName] = !expandedActions?.[actionName];\r\n        setExpandedActions(clone(expandedActions));\r\n      }\r\n    },\r\n    [expandedActions, allowMaxOne],\r\n  );\r\n\r\n  let actionCategories = [];\r\n\r\n  if (!props.useSubcategories) {\r\n    actionCategories = [\"Actions\", \"Buildings\"].map((category) => (\r\n      <ActionCategoryContainer\r\n        {...props}\r\n        category={category}\r\n        expandedActions={expandedActions}\r\n        key={category}\r\n        useSubcategories={false}\r\n        useButtonsWhenCollapsed={true}\r\n        setActionCallback={setActionCallback}\r\n      />\r\n    ));\r\n  } else {\r\n    actionCategories = Object.keys(ActionSubcategory).map((category) => (\r\n      <ActionCategoryContainer\r\n        {...props}\r\n        category={category}\r\n        expandedActions={expandedActions}\r\n        key={category}\r\n        useSubcategories={true}\r\n        useButtonsWhenCollapsed={/*category === ActionSubcategory.Gather*/ true}\r\n        setActionCallback={setActionCallback}\r\n      />\r\n    ));\r\n  }\r\n\r\n  return <View>{actionCategories}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  underCategoryPadding: {\r\n    height: 8,\r\n  },\r\n});\r\n","import { Picker as RNPicker } from \"@react-native-picker/picker\";\r\nimport { StyleProp, TextStyle } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\n\r\nexport function Picker(props: {\r\n  selectedValue: string;\r\n  onValueChange: (itemValue: string, itemIndex: number) => void;\r\n  data: { key: string; label: string; value: string }[];\r\n  style?: StyleProp<TextStyle>;\r\n}) {\r\n  const { style, ...rest } = props;\r\n  const theme = useTheme();\r\n  return (\r\n    <RNPicker\r\n      {...rest}\r\n      style={[\r\n        {\r\n          color: theme.theme.colors.black,\r\n          backgroundColor: theme.theme.colors.grey5,\r\n        },\r\n        style,\r\n      ]}\r\n      dropdownIconColor={theme.theme.colors.black}\r\n      dropdownIconRippleColor={theme.theme.colors.black}\r\n    >\r\n      {props.data.map((data) => (\r\n        <RNPicker.Item label={data.label} value={data.value} key={data.key} />\r\n      ))}\r\n    </RNPicker>\r\n  );\r\n}\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, SectionList, StyleSheet, View } from \"react-native\";\r\nimport { Button, CheckBox, useTheme } from \"react-native-elements\";\r\nimport { Gesture, GestureDetector } from \"react-native-gesture-handler\";\r\nimport {\r\n  allocateApprenticesToSpell,\r\n  calculateApprenticeTotal,\r\n  canAutocast,\r\n  getApprenticeAllocation,\r\n  getAutocastSchoolLevelRequirements,\r\n  getEstimatedApprenticeManaConsumptionPerSec,\r\n  getFreeApprentices,\r\n  loadLoadoutFromPosition,\r\n  saveLoadoutToPosition,\r\n} from \"../backend/autocast/Autocast\";\r\nimport { applyTransformations } from \"../backend/calculation/Calculation\";\r\nimport { TransformationTags } from \"../backend/calculation/TransformationTags\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport { getSchoolLevel, School } from \"../backend/spells/ElementsAndSchools\";\r\nimport { Spell } from \"../backend/spells/Spell\";\r\nimport { getVisibleSpellsBySchool } from \"../backend/spells/Spells\";\r\nimport { calculateIncomePerSecond } from \"../backend/timetick/IncomeOverTime\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport { CategoryHeader } from \"./utility/CategoryContainer\";\r\nimport { createGestureHandler } from \"./utility/Miscellaneous\";\r\nimport { Picker as UtilityPicker } from \"./utility/Picker\";\r\nimport { PlusMinusAllocator } from \"./utility/PlusMinusAllocator\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"./utility/UIContext\";\r\n\r\nfunction SpellRow(props: { spell: Spell; applyAll: boolean }) {\r\n  const spell = props.spell;\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const spellName = spell.getSpellName();\r\n  const apprenticeAllocation = getApprenticeAllocation(playerContext);\r\n  const current = apprenticeAllocation?.[spellName] || 0;\r\n  const secs = applyTransformations(\r\n    [TransformationTags.AutocastDelay],\r\n    playerContext,\r\n    60.0,\r\n  );\r\n  const currentExtra =\r\n    current > 0\r\n      ? `(${formatNumber(secs / current, {\r\n          showDecimals: true,\r\n        })}s/cast)`\r\n      : \"\";\r\n  const canAllocate = canAutocast(playerContext, spell);\r\n  const freeApprentices = getFreeApprentices(playerContext);\r\n  const hasFreeApprentices = freeApprentices > 0;\r\n  const onPressMinus = useCallback(\r\n    () =>\r\n      playerContextRef.current.apply(\r\n        allocateApprenticesToSpell(spell, props.applyAll ? -Infinity : -1),\r\n      ),\r\n    [spell, props.applyAll],\r\n  );\r\n  const onPressPlus = useCallback(\r\n    () =>\r\n      playerContextRef.current.apply(\r\n        allocateApprenticesToSpell(spell, props.applyAll ? Infinity : 1),\r\n      ),\r\n    [spell, props.applyAll],\r\n  );\r\n  const plusMinusContainer = useMemo(\r\n    () => (\r\n      <View style={styles.plusMinusAllocatorContainer}>\r\n        <PlusMinusAllocator\r\n          disableMinus={current === 0}\r\n          disablePlus={!hasFreeApprentices}\r\n          onPressMinus={onPressMinus}\r\n          onPressPlus={onPressPlus}\r\n        />\r\n      </View>\r\n    ),\r\n    [current, hasFreeApprentices, onPressMinus, onPressPlus],\r\n  );\r\n  const allocatorExtras = useMemo(\r\n    () => (\r\n      <>\r\n        <View style={styles.frequencyTextContainer}>\r\n          <Text>{currentExtra}</Text>\r\n        </View>\r\n        <Text>{current}</Text>\r\n      </>\r\n    ),\r\n    [currentExtra, current],\r\n  );\r\n  const allocator = useMemo(() => {\r\n    let allocatorTemp = (\r\n      <View style={styles.row}>\r\n        {allocatorExtras}\r\n        {plusMinusContainer}\r\n      </View>\r\n    );\r\n    if (!canAllocate) {\r\n      const schoolReqs = getAutocastSchoolLevelRequirements(spell);\r\n      let allReqs = [];\r\n      for (let school in schoolReqs) {\r\n        if (\r\n          getSchoolLevel(playerContext, school as School) <\r\n          schoolReqs[school as School]\r\n        ) {\r\n          allReqs.push(`${school} Lv${schoolReqs[school as School]}`);\r\n        }\r\n      }\r\n      allocatorTemp = (\r\n        <Text style={styles.allocatorText}>Requires: {allReqs.join(\", \")}</Text>\r\n      );\r\n    }\r\n    return allocatorTemp;\r\n  }, [allocatorExtras, canAllocate, spell, plusMinusContainer]);\r\n\r\n  const nameContainer = useMemo(\r\n    () => (\r\n      <View style={styles.spellNameContainer}>\r\n        <Text numberOfLines={3}>{spellName}:</Text>\r\n      </View>\r\n    ),\r\n    [spellName],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={[styles.row, styles.spellRowContainer]}>\r\n        {nameContainer}\r\n        {allocator}\r\n      </View>\r\n    ),\r\n    [spellName, allocator],\r\n  );\r\n}\r\n\r\n// function SpellRowMemoized(props: { spell: Spell }) {\r\n//   const playerContext = useContext(PlayerContext);\r\n//   const uiContext = useContext(UIContext);\r\n\r\n//   return useMemo(\r\n//     () => (\r\n//       <SpellRow\r\n//         playerContext={playerContext}\r\n//         spell={props.spell}\r\n//       />\r\n//     ),\r\n//     [props.spell.getName(), visible === true ? playerContext : false],\r\n//   );\r\n// }\r\n\r\nconst VIEWABILITY_CONFIG = {\r\n  minimumViewTime: 0,\r\n  itemVisiblePercentThreshold: 1,\r\n  waitForInteraction: false,\r\n};\r\n\r\nfunction emptySpaceHeader() {\r\n  return <View style={styles.emptySpaceHeader} />;\r\n}\r\n\r\nexport function Autocast(props: {\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const loadoutAmount = 4;\r\n  const [slotNumber, setSlotNumber] = useState(\r\n    playerContext?.autocast?.lastLoadoutUsed?.toString() ?? \"0\",\r\n  );\r\n\r\n  const spellsBySchool = getVisibleSpellsBySchool(playerContext);\r\n  const freeApprentices = getFreeApprentices(playerContext);\r\n\r\n  const toggleApprenticesPaused = useCallback(() => {\r\n    playerContextRef.current.apply((state) => {\r\n      state.autocast.apprenticesPaused = !state.autocast.apprenticesPaused;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const loadoutsSlotPicker = useMemo(() => {\r\n    const items = [];\r\n    for (let i = 0; i < loadoutAmount; i++) {\r\n      items.push({\r\n        key: i.toString(),\r\n        value: i.toString(),\r\n        label: `Slot ${i + 1}`,\r\n      });\r\n    }\r\n    return (\r\n      <UtilityPicker\r\n        onValueChange={setSlotNumber}\r\n        selectedValue={slotNumber}\r\n        data={items}\r\n      />\r\n    );\r\n  }, [loadoutAmount, setSlotNumber, slotNumber]);\r\n\r\n  const totalCost = getEstimatedApprenticeManaConsumptionPerSec(playerContext);\r\n  const manaIncome = calculateIncomePerSecond(playerContext)?.Mana ?? 0;\r\n  const totalApprentices = calculateApprenticeTotal(playerContext);\r\n  const theme = useTheme();\r\n\r\n  const uiContext = useContext(UIContext);\r\n\r\n  const [applyAll, setApplyAll] = useUIStateFromContext(\r\n    uiContext,\r\n    \"autocast_applyall\",\r\n    false,\r\n  );\r\n\r\n  const toggleApplyAll = useCallback(() => {\r\n    setApplyAll(!applyAll);\r\n  }, [applyAll, setApplyAll]);\r\n\r\n  const apprenticeData = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.apprenticeDataContainer,\r\n          { borderTopColor: theme.theme.colors.divider },\r\n        ]}\r\n      >\r\n        <View style={styles.assignAllContainer}>\r\n          <CheckBox\r\n            title=\"Assign / unassign all at once\"\r\n            checked={applyAll}\r\n            textStyle={styles.checkboxText}\r\n            containerStyle={styles.checkboxContainer}\r\n            onPress={toggleApplyAll}\r\n          />\r\n        </View>\r\n        <View style={[styles.row, styles.totalApprenticesContainer]}>\r\n          <Text>Apprentices Available: </Text>\r\n          <Text>\r\n            {formatNumber(freeApprentices)}/{formatNumber(totalApprentices)}\r\n          </Text>\r\n        </View>\r\n        <View style={[styles.row, styles.manaCostContainer]}>\r\n          <Text>Estimated Mana consumption: </Text>\r\n          <Text>{formatNumber(totalCost, { showDecimals: true })}/sec</Text>\r\n        </View>\r\n        <View style={[styles.apprenticeWarningContainer]}>\r\n          {totalCost > manaIncome && (\r\n            <Text style={{ color: theme.theme.colors.warning }}>\r\n              Warning: Your Mana income may not be enough to sustain the\r\n              Apprentices!\r\n            </Text>\r\n          )}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      totalCost,\r\n      manaIncome,\r\n      freeApprentices,\r\n      totalApprentices,\r\n      toggleApplyAll,\r\n      applyAll,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  const footer = useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={[styles.marginBottom, styles.marginTop]}>\r\n          {playerContext.autocast.apprenticesPaused ? (\r\n            <Button\r\n              title=\"Unpause Apprentices\"\r\n              onPress={toggleApprenticesPaused}\r\n            />\r\n          ) : (\r\n            <Button\r\n              title=\"Pause Apprentices\"\r\n              onPress={toggleApprenticesPaused}\r\n            />\r\n          )}\r\n        </View>\r\n        <View style={[styles.loadoutsRow, styles.marginBottom]}>\r\n          <Text>Loadouts:</Text>\r\n          <View style={styles.loadoutRest}>\r\n            <View style={styles.pickerContainer}>{loadoutsSlotPicker}</View>\r\n            <Button\r\n              containerStyle={styles.loadoutButtons}\r\n              title=\"Save\"\r\n              onPress={() => {\r\n                saveLoadoutToPosition(\r\n                  playerContextRef.current,\r\n                  Number.parseInt(slotNumber),\r\n                );\r\n              }}\r\n            />\r\n            <Button\r\n              containerStyle={styles.loadoutButtons}\r\n              title=\"Load\"\r\n              onPress={() => {\r\n                loadLoadoutFromPosition(\r\n                  playerContextRef.current,\r\n                  Number.parseInt(slotNumber),\r\n                );\r\n              }}\r\n            />\r\n          </View>\r\n        </View>\r\n        <ActionsContainer area=\"Autocast\" />\r\n      </View>\r\n    ),\r\n    [\r\n      slotNumber,\r\n      loadoutsSlotPicker,\r\n      playerContext.autocast.apprenticesPaused,\r\n      toggleApprenticesPaused,\r\n      freeApprentices,\r\n      totalApprentices,\r\n      totalCost,\r\n      manaIncome,\r\n      applyAll,\r\n      toggleApplyAll,\r\n    ],\r\n  );\r\n\r\n  const spellsBySchoolJSON = JSON.stringify(spellsBySchool);\r\n  const listData = useMemo(\r\n    () =>\r\n      Object.entries(spellsBySchool).map((item) => ({\r\n        title: item[0],\r\n        data: item[1],\r\n      })),\r\n    [spellsBySchoolJSON],\r\n  );\r\n  const renderItem = useCallback(\r\n    (item: { item: Spell }) => (\r\n      <SpellRow\r\n        key={item.item.getName()}\r\n        spell={item.item}\r\n        applyAll={applyAll}\r\n      />\r\n    ),\r\n    [applyAll],\r\n  );\r\n  const keyExtractor = useCallback((item: Spell) => item?.getName?.(), []);\r\n  const renderSectionHeader = useCallback(\r\n    (info: { section: { title: string; data: Spell[] } }) => (\r\n      <CategoryHeader\r\n        title={info.section.title}\r\n        containerStyle={{ backgroundColor: theme.theme.colors.background }}\r\n      />\r\n    ),\r\n    [theme],\r\n  );\r\n  const sectionList = useMemo(\r\n    () => (\r\n      <SectionList\r\n        sections={listData}\r\n        initialNumToRender={30}\r\n        renderItem={renderItem}\r\n        keyExtractor={keyExtractor}\r\n        renderSectionHeader={renderSectionHeader}\r\n        ListFooterComponent={footer}\r\n        style={styles.sectionListStyle}\r\n        contentContainerStyle={styles.sectionListInnerStyle}\r\n      />\r\n    ),\r\n    [listData, renderItem, keyExtractor, renderSectionHeader, footer],\r\n  );\r\n\r\n  const swipeHandlerGesture = useMemo(\r\n    () => createGestureHandler(props.onSwipeLeft, props.onSwipeRight),\r\n    [props.onSwipeLeft, props.onSwipeRight],\r\n  );\r\n  const nativeGesture = useMemo(() => Gesture.Native(), []);\r\n  const compositeGesture = useMemo(\r\n    () => Gesture.Simultaneous(swipeHandlerGesture, nativeGesture),\r\n    [swipeHandlerGesture, nativeGesture],\r\n  );\r\n\r\n  const swipeHandlerGestureBottom = useMemo(\r\n    () => createGestureHandler(props.onSwipeLeft, props.onSwipeRight),\r\n    [props.onSwipeLeft, props.onSwipeRight],\r\n  );\r\n  const nativeGestureBottom = useMemo(() => Gesture.Native(), []);\r\n  const compositeGestureBottom = useMemo(\r\n    () => Gesture.Simultaneous(swipeHandlerGestureBottom, nativeGestureBottom),\r\n    [swipeHandlerGestureBottom, nativeGestureBottom],\r\n  );\r\n\r\n  const contents = useMemo(\r\n    () => (\r\n      <View style={styles.fullContainer}>\r\n        <GestureDetector key=\"autocastGesture\" gesture={compositeGesture}>\r\n          {sectionList}\r\n        </GestureDetector>\r\n        <GestureDetector key=\"dataGesture\" gesture={compositeGestureBottom}>\r\n          {apprenticeData}\r\n        </GestureDetector>\r\n      </View>\r\n    ),\r\n    [sectionList, apprenticeData, compositeGesture, compositeGestureBottom],\r\n  );\r\n\r\n  return contents;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  fullContainer: {\r\n    flex: 1,\r\n    paddingHorizontal: 8,\r\n  },\r\n  sectionListStyle: {\r\n    flex: 1,\r\n  },\r\n  sectionListInnerStyle: {\r\n    paddingBottom: 16,\r\n  },\r\n  marginBottom: {\r\n    marginBottom: 20,\r\n  },\r\n  marginTop: {\r\n    marginTop: 40,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusAllocatorContainer: {\r\n    marginLeft: 16,\r\n  },\r\n  totalApprenticesContainer: {\r\n    marginBottom: 8,\r\n    paddingRight: 8,\r\n  },\r\n  manaCostContainer: {\r\n    marginBottom: 4,\r\n    paddingRight: 8,\r\n  },\r\n  spellRowContainer: {\r\n    marginVertical: 4,\r\n    minHeight: 32,\r\n  },\r\n  allocatorText: {\r\n    marginLeft: 0,\r\n    flex: 1,\r\n    textAlign: \"right\",\r\n  },\r\n  spellNameContainer: {\r\n    flex: 1,\r\n    marginRight: 8,\r\n  },\r\n  loadoutsRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  loadoutRest: { flexDirection: \"row\", alignItems: \"center\" },\r\n  topPickerContainer: {\r\n    marginTop: 8,\r\n  },\r\n  emptySpaceHeader: {\r\n    height: 40,\r\n  },\r\n  pickerContainer: {\r\n    width: 128,\r\n    marginLeft: 8,\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n  },\r\n  loadoutButtons: {\r\n    marginLeft: 8,\r\n  },\r\n  frequencyTextContainer: {\r\n    marginRight: 8,\r\n  },\r\n  apprenticeWarningContainer: {\r\n    height: 40,\r\n    marginBottom: 8,\r\n  },\r\n  spellContainersContainer: {\r\n    marginTop: 16,\r\n  },\r\n  emptyCategoryTitle: {\r\n    opacity: 0,\r\n  },\r\n  betweenSpellsDivider: {\r\n    opacity: 0.4,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n  assignAllContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  apprenticeDataContainer: {\r\n    borderTopWidth: 1,\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\n\r\nexport default function Campus() {\r\n  return (\r\n    <View style={styles.container}>\r\n      <ActionsContainer area=\"Campus\" useSubcategories={true} />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import { hasFlag, hasGlobalFlag, setFlag, setGlobalFlag } from \"../../Flags\";\r\nimport { DataStore } from \"../../generic/DataStore\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Dungeon } from \"./Dungeon\";\r\nimport { DungeonFloor } from \"./DungeonFloor\";\r\n\r\nconst Dungeons = new DataStore<Dungeon>();\r\nconst DungeonFloors = new DataStore<DungeonFloor>();\r\n\r\nexport { Dungeons, DungeonFloors };\r\n\r\nexport function getUnlockedDungeons(state: PlayerContextState): Dungeon[] {\r\n  return Dungeons.getAll().filter((dungeon) => dungeon.isUnlocked(state));\r\n}\r\n\r\nexport function isDungeonFloorCompletedThisRun(\r\n  state: PlayerContextState,\r\n  floor: DungeonFloor | string,\r\n): boolean {\r\n  return hasFlag(\r\n    state,\r\n    (typeof floor === \"string\" ? floor : floor.getId()) +\r\n      \"_dungeon_floor_completed\",\r\n  );\r\n}\r\n\r\nexport function isDungeonFloorEverCompleted(\r\n  state: PlayerContextState,\r\n  floor: DungeonFloor | string,\r\n): boolean {\r\n  return hasGlobalFlag(\r\n    state,\r\n    (typeof floor === \"string\" ? floor : floor.getId()) +\r\n      \"_dungeon_floor_completed\",\r\n  );\r\n}\r\n\r\nexport function setDungeonFloorCompleted(\r\n  state: PlayerContextState,\r\n  floorId: string,\r\n): PlayerContextState {\r\n  state = setFlag(floorId + \"_dungeon_floor_completed\")(state);\r\n  return setGlobalFlag(floorId + \"_dungeon_floor_completed\")(state);\r\n}\r\n","import moment from \"moment\";\r\nimport { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { Resource } from \"../Resources\";\r\nimport { getSchoolLevel, School } from \"../spells/ElementsAndSchools\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { DungeonFloors, getUnlockedDungeons } from \"./dungeons/Dungeons\";\r\n\r\nfunction onTick(\r\n  state: PlayerContextState,\r\n  elapsedTimeSec: number,\r\n): PlayerContextState {\r\n  const breedingLevel = getSchoolLevel(state, School.Breeding);\r\n  for (let dungeonFloorId in state.creatures.creatureAllocation) {\r\n    const dungeonFloor = DungeonFloors.getById(dungeonFloorId);\r\n    const targetLevel = dungeonFloor.getBreedingLevel();\r\n\r\n    if (!isDungeonFloorValidForCreatures(state, dungeonFloorId)) {\r\n      continue;\r\n    }\r\n\r\n    const allocatedCreatures =\r\n      state.creatures.creatureAllocation[dungeonFloorId] || 0;\r\n    if (allocatedCreatures > 0) {\r\n      const lastTime = getLastRewardTimeForDungeonFloor(state, dungeonFloorId);\r\n      // Assignment needed so it starts working\r\n      state.creatures.lastRewardTime[dungeonFloorId] = lastTime;\r\n\r\n      const threshold = getThresholdSec(\r\n        state,\r\n        breedingLevel,\r\n        targetLevel,\r\n        allocatedCreatures,\r\n      );\r\n      if (getSecondsPlayed(state) - lastTime > threshold) {\r\n        // Get a reward!\r\n        state.creatures.lastRewardTime[dungeonFloorId] =\r\n          getSecondsPlayed(state);\r\n        const outcome = dungeonFloor.doExplore(state);\r\n        if (outcome != null) {\r\n          state = outcome.breeding(state);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function getCreatureMessageLog(state: PlayerContextState) {\r\n  return state?.creatureMessageLog || [];\r\n}\r\n\r\nexport function pushToCreatureMessageLog(\r\n  state: PlayerContextState,\r\n  log: string,\r\n): PlayerContextState {\r\n  if (!state.creatureMessageLog) {\r\n    state.creatureMessageLog = [];\r\n  }\r\n  state.creatureMessageLog.unshift({\r\n    id: Math.random().toString(),\r\n    timestamp: getSecondsPlayed(state),\r\n    message: `[${moment(Date.now()).format(\"h:mm:ss A\")}] ${log}`,\r\n  });\r\n  state.creatureMessageLog = state.creatureMessageLog.slice(0, 40);\r\n  return state;\r\n}\r\n\r\nexport function isDungeonFloorValidForCreatures(\r\n  state: PlayerContextState,\r\n  dungeonFloorId: string,\r\n): boolean {\r\n  const breedingLevel = getSchoolLevel(state, School.Breeding);\r\n  const dungeonFloor = DungeonFloors.getById(dungeonFloorId);\r\n  const targetLevel = dungeonFloor.getBreedingLevel();\r\n\r\n  if (breedingLevel < targetLevel) {\r\n    return false;\r\n  }\r\n\r\n  if (!dungeonFloor.isUnlocked(state)) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    !dungeonFloor.canFightBoss(state) &&\r\n    dungeonFloor.getBoss(state) !== undefined\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction getLastRewardTimeForDungeonFloor(\r\n  state: PlayerContextState,\r\n  dungeonFloorId: string,\r\n): number {\r\n  return (\r\n    state?.creatures?.lastRewardTime?.[dungeonFloorId] ||\r\n    getSecondsPlayed(state)\r\n  );\r\n}\r\n\r\nexport function getFreeCreatures(state: PlayerContextState): number {\r\n  const creatureAllocation = state.creatures.creatureAllocation;\r\n  let creaturesAllocated = 0;\r\n  for (let dungeonFloor in creatureAllocation) {\r\n    creaturesAllocated += creatureAllocation[dungeonFloor] || 0;\r\n  }\r\n  return state.creatures.totalCreatures - creaturesAllocated;\r\n}\r\n\r\nfunction allocateCreaturesToDungeonFloorImpl(\r\n  dungeonFloorId: string,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n) {\r\n  const currentAllocation =\r\n    state.creatures.creatureAllocation?.[dungeonFloorId] || 0;\r\n  const actualAmountToAllocate =\r\n    amount > 0\r\n      ? Math.min(getFreeCreatures(state), amount)\r\n      : Math.max(-currentAllocation, amount);\r\n  state.creatures.creatureAllocation[dungeonFloorId] =\r\n    currentAllocation + actualAmountToAllocate;\r\n  return state;\r\n}\r\n\r\nexport function allocateCreaturesToDungeonFloor(\r\n  this: any,\r\n  dungeonFloorId: string,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return allocateCreaturesToDungeonFloorImpl.bind(this, dungeonFloorId, amount);\r\n}\r\n\r\nfunction grantNewCreatureImpl(amount: number, state: PlayerContextState) {\r\n  state.creatures.totalCreatures = Math.max(\r\n    0,\r\n    Math.min(\r\n      calculateCreatureCap(state),\r\n      state.creatures.totalCreatures + amount,\r\n    ),\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function grantNewCreature(\r\n  this: any,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return grantNewCreatureImpl.bind(this, amount);\r\n}\r\n\r\nexport function calculateCreatureCap(state: PlayerContextState): number {\r\n  return applyTransformations(\r\n    [TransformationTags.Creature, TransformationTags.Cap],\r\n    state,\r\n    0,\r\n  );\r\n}\r\n\r\nexport function getFloorsAvailableForCreatures(state: PlayerContextState) {\r\n  const dungeons = getUnlockedDungeons(state);\r\n  const floors = dungeons\r\n    .map((dungeon) => {\r\n      return dungeon\r\n        .getDungeonFloors()\r\n        .filter((floor) =>\r\n          isDungeonFloorValidForCreatures(state, floor.getId()),\r\n        );\r\n    })\r\n    .flat();\r\n  return floors;\r\n}\r\n\r\nfunction getAverageMonstiumGainForFloor(\r\n  state: PlayerContextState,\r\n  dungeonFloorId: string,\r\n): number {\r\n  const dungeonFloor = DungeonFloors.getById(dungeonFloorId);\r\n  const possibilities = dungeonFloor.getExplorationPossibilities(state);\r\n  let totalMonstiumEarned = 0,\r\n    totalWeight = 0;\r\n  for (let possibility of possibilities) {\r\n    const enemy = possibility.transforms?.enemy;\r\n    if (enemy != null) {\r\n      const enemyMonstium = applyTransformations(\r\n        [\r\n          TransformationTags.Loot,\r\n          Resource.Monstium,\r\n          TransformationTags.FromCreatures,\r\n        ],\r\n        state,\r\n        enemy.getMonstiumAwarded(state),\r\n      );\r\n      totalMonstiumEarned += enemyMonstium * possibility.weight;\r\n    }\r\n    totalWeight += possibility.weight;\r\n  }\r\n  return totalMonstiumEarned / totalWeight;\r\n}\r\n\r\nfunction getThresholdSec(\r\n  state: PlayerContextState,\r\n  breedingLevel: number,\r\n  targetLevel: number,\r\n  allocatedCreatures: number,\r\n) {\r\n  // Give reward once per minute per creature allocated + 10% more multiplicative rewards\r\n  // for every 1 level above the target breeding level.\r\n  // Example: Exploring School Basement B1 (target level 2) with a breeding level of 17,\r\n  // with 2 creatures at the same time, results in a reward every 7.18 seconds.\r\n  let threshold =\r\n    60.0 / (allocatedCreatures * Math.pow(1.1, breedingLevel - targetLevel));\r\n  threshold = applyTransformations(\r\n    [TransformationTags.Creature, TransformationTags.Threshold],\r\n    state,\r\n    threshold,\r\n  );\r\n  return threshold;\r\n}\r\n\r\nexport function getMonstiumGainPerSecFromCreatures(\r\n  state: PlayerContextState,\r\n): number {\r\n  let totalGainPerSec = 0;\r\n  const breedingLevel = getSchoolLevel(state, School.Breeding);\r\n  for (let dungeonFloorId in state.creatures.creatureAllocation) {\r\n    const dungeonFloor = DungeonFloors.getById(dungeonFloorId);\r\n    const targetLevel = dungeonFloor.getBreedingLevel();\r\n\r\n    if (!isDungeonFloorValidForCreatures(state, dungeonFloorId)) {\r\n      continue;\r\n    }\r\n\r\n    const allocatedCreatures =\r\n      state.creatures.creatureAllocation[dungeonFloorId] || 0;\r\n    if (allocatedCreatures > 0) {\r\n      const threshold = getThresholdSec(\r\n        state,\r\n        breedingLevel,\r\n        targetLevel,\r\n        allocatedCreatures,\r\n      );\r\n      const gainPerKill = getAverageMonstiumGainForFloor(state, dungeonFloorId);\r\n      totalGainPerSec += gainPerKill / threshold;\r\n    }\r\n  }\r\n\r\n  return totalGainPerSec;\r\n}\r\n\r\nexport function loadCreatures() {\r\n  registerTimeTickListener(\"Creatures\", onTick);\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { ScrollView } from \"react-native\";\r\nimport { getCreatureMessageLog } from \"../../backend/exploration/Creatures\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\n\r\nexport function CreatureMessageLog() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const messageLog = getCreatureMessageLog(playerContext);\r\n  return useMemo(\r\n    () => (\r\n      <ScrollView nestedScrollEnabled={true}>\r\n        {messageLog.map((logItem) => (\r\n          <Markdown key={logItem?.id ?? logItem}>\r\n            {logItem?.message ?? logItem}\r\n          </Markdown>\r\n        ))}\r\n      </ScrollView>\r\n    ),\r\n    [messageLog.map((logItem) => logItem?.id ?? logItem).join()],\r\n  );\r\n}\r\n","import { ReactNode } from \"react\";\r\nimport { Card as RNECard, CardProps, useTheme } from \"react-native-elements\";\r\n\r\nexport function Card(props: CardProps & { children?: ReactNode }) {\r\n  const theme = useTheme();\r\n  return (\r\n    <RNECard\r\n      {...props}\r\n      containerStyle={[\r\n        { backgroundColor: theme.theme.colors.background },\r\n        props?.containerStyle,\r\n      ]}\r\n    >\r\n      {props.children}\r\n    </RNECard>\r\n  );\r\n}\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Card } from \"react-native-elements\";\r\nimport {\r\n  allocateCreaturesToDungeonFloor,\r\n  calculateCreatureCap,\r\n  getFreeCreatures,\r\n  isDungeonFloorValidForCreatures,\r\n} from \"../backend/exploration/Creatures\";\r\nimport { DungeonFloor } from \"../backend/exploration/dungeons/DungeonFloor\";\r\nimport { getUnlockedDungeons } from \"../backend/exploration/dungeons/Dungeons\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport {\r\n  getTemporaryEffectEndTime,\r\n  hasTemporaryEffect,\r\n} from \"../backend/timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../backend/timetick/TotalTimePlayed\";\r\nimport { formatNumber, formatTime } from \"../utils/FormattingUtils\";\r\nimport { CreatureMessageLog } from \"./creatures/CreatureMessageLog\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { PlusMinusAllocator } from \"./utility/PlusMinusAllocator\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction DungeonFloorRow(props: { floor: DungeonFloor }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const freeCreatures = getFreeCreatures(playerContext);\r\n  const hasFreeCreatures = freeCreatures > 0;\r\n  const floor = props.floor;\r\n  const current =\r\n    playerContext.creatures?.creatureAllocation?.[floor.getId()] ?? 0;\r\n\r\n  const onPressMinus = useCallback(\r\n    () =>\r\n      playerContextRef.current.apply(\r\n        allocateCreaturesToDungeonFloor(floor.getId(), -1),\r\n      ),\r\n    [floor],\r\n  );\r\n  const onPressPlus = useCallback(\r\n    () =>\r\n      playerContextRef.current.apply(\r\n        allocateCreaturesToDungeonFloor(floor.getId(), 1),\r\n      ),\r\n    [floor],\r\n  );\r\n\r\n  const floorNameText = useMemo(\r\n    () => (\r\n      <Text numberOfLines={2} style={styles.floorNameText}>\r\n        {floor.getFloorName()} (Lv.{floor.getBreedingLevel()})\r\n      </Text>\r\n    ),\r\n    [floor],\r\n  );\r\n\r\n  const plusMinusAllocator = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text>{current}</Text>\r\n        <View style={styles.plusMinusAllocatorContainer}>\r\n          <PlusMinusAllocator\r\n            disableMinus={current === 0}\r\n            disablePlus={!hasFreeCreatures}\r\n            onPressMinus={onPressMinus}\r\n            onPressPlus={onPressPlus}\r\n          />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [current, hasFreeCreatures, onPressMinus, onPressPlus],\r\n  );\r\n\r\n  return (\r\n    <View key={floor.getId()} style={[styles.row, styles.singleFloorContainer]}>\r\n      {floorNameText}\r\n      {plusMinusAllocator}\r\n    </View>\r\n  );\r\n}\r\n\r\nexport function Creatures() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  return useMemo(() => {\r\n    const dungeons = getUnlockedDungeons(playerContext);\r\n    const freeCreatures = getFreeCreatures(playerContext);\r\n\r\n    return (\r\n      <View>\r\n        <UtilityCard>\r\n          <Card.Title>Dungeons</Card.Title>\r\n          {dungeons.map((dungeon) => {\r\n            const unlockedFloors = dungeon\r\n              .getDungeonFloors()\r\n              .filter((floor) =>\r\n                isDungeonFloorValidForCreatures(playerContext, floor.getId()),\r\n              );\r\n            if (unlockedFloors.length === 0) {\r\n              return null;\r\n            }\r\n            return (\r\n              <CategoryContainer\r\n                key={dungeon.getId()}\r\n                title={dungeon.getName()}\r\n              >\r\n                {unlockedFloors.map((floor) => {\r\n                  return <DungeonFloorRow key={floor.getId()} floor={floor} />;\r\n                })}\r\n              </CategoryContainer>\r\n            );\r\n          })}\r\n        </UtilityCard>\r\n        <View style={[styles.row, styles.totalCreaturesContainer]}>\r\n          <Text>Creatures available: </Text>\r\n          <Text>\r\n            {formatNumber(freeCreatures)}/\r\n            {formatNumber(playerContext.creatures.totalCreatures)}\r\n          </Text>\r\n        </View>\r\n        <View style={[styles.row, styles.creatureCapacityContainer]}>\r\n          <Text>Creature capacity: </Text>\r\n          <Text>\r\n            {formatNumber(playerContext.creatures.totalCreatures)}/\r\n            {formatNumber(calculateCreatureCap(playerContext))}\r\n          </Text>\r\n        </View>\r\n        {hasTemporaryEffect(playerContext, \"Monster Candy\") ? (\r\n          <View style={[styles.row, styles.creatureCapacityContainer]}>\r\n            <Text>Monster Candy time left: </Text>\r\n            <Text>\r\n              {formatTime(\r\n                getTemporaryEffectEndTime(playerContext, \"Monster Candy\") -\r\n                  getSecondsPlayed(playerContext),\r\n                { shortForm: false, showDecimals: false },\r\n              )}\r\n            </Text>\r\n          </View>\r\n        ) : null}\r\n        <View>\r\n          <ActionsContainer area=\"Creatures\" />\r\n        </View>\r\n        <View style={styles.messageContainer}>\r\n          <CreatureMessageLog />\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [JSON.stringify(playerContext.creatures)]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusAllocatorContainer: {\r\n    marginLeft: 16,\r\n  },\r\n  totalCreaturesContainer: {\r\n    marginTop: 16,\r\n    paddingHorizontal: 16,\r\n  },\r\n  creatureCapacityContainer: {\r\n    marginTop: 4,\r\n    paddingHorizontal: 16,\r\n  },\r\n  singleFloorContainer: {\r\n    marginVertical: 4,\r\n  },\r\n  messageContainer: {\r\n    height: 300,\r\n    padding: 8,\r\n    borderColor: \"#444\",\r\n    borderWidth: 1,\r\n    marginTop: 8,\r\n  },\r\n  floorNameText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { getEventMessageById } from \"./events/Events\";\r\nimport { PlayerContextState } from \"./PlayerContext\";\r\nimport { hasTemporaryEffect } from \"./timetick/TemporaryEffects\";\r\n\r\nexport function cleanup(state: PlayerContextState): PlayerContextState {\r\n  // Cleanup events\r\n  const events = Object.values(state.eventOccurrences).sort(\r\n    (a, b) => b.timestamp - a.timestamp,\r\n  );\r\n  const terminalEvents = events.filter((event) => {\r\n    return (\r\n      event.currentMessageId &&\r\n      getEventMessageById(event.currentMessageId).isTerminal()\r\n    );\r\n  });\r\n  const oldEventOccurrenceIds = terminalEvents\r\n    .slice(20)\r\n    .map((eventOccurrence) => eventOccurrence.eventOccurrenceId);\r\n  oldEventOccurrenceIds.forEach((eventOccurrenceId) => {\r\n    delete state.eventOccurrences[eventOccurrenceId];\r\n  });\r\n\r\n  // Cleanup old temporary effect\r\n  for (const key in state.temporaryEffects) {\r\n    if (!hasTemporaryEffect(state, key)) {\r\n      delete state.temporaryEffects[key];\r\n    }\r\n  }\r\n\r\n  // Cleanup old action results\r\n  state.exploration.actionResultQueue =\r\n    state.exploration.actionResultQueue.slice(-10);\r\n\r\n  return state;\r\n}\r\n","import memoize from \"fast-memoize\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\n\r\nexport class Storyline {\r\n  name: string;\r\n  // Order semantics\r\n  // Generally 4 digit number.\r\n  // Start with intended approximate progression location:\r\n  // 1000 : before School Basement\r\n  // 2000 : at School Basement\r\n  // 3000 : at Living Forest\r\n  // 4000 : at Thunder Tower\r\n  // 5000 : at Elemental Dungeons\r\n  // 6000 : at Palace of Darkness\r\n  // 7000 : at Wizard's Arena\r\n  // Increment by 10 per storyline \"group\" and by 1 per outcome on that\r\n  // storyline.\r\n  order: number;\r\n  hintDescription: (state: PlayerContextState) => string;\r\n  getBonusDescription: (state: PlayerContextState) => string;\r\n  isBonusActive: (state: PlayerContextState) => boolean;\r\n  isCompleted: (state: PlayerContextState) => boolean;\r\n  isHintUnlockable: (state: PlayerContextState) => boolean;\r\n\r\n  constructor(\r\n    name: string,\r\n    order: number,\r\n    isCompleted: (state: PlayerContextState) => boolean,\r\n    isBonusActive: (state: PlayerContextState) => boolean,\r\n    hintDescription: string | ((state: PlayerContextState) => string),\r\n    getBonusDescription: string | ((state: PlayerContextState) => string),\r\n    isHintUnlockable: (state: PlayerContextState) => boolean,\r\n  ) {\r\n    this.name = name;\r\n    this.order = order;\r\n    this.isCompleted = isCompleted;\r\n    this.isBonusActive = isBonusActive;\r\n    this.hintDescription =\r\n      typeof hintDescription === \"string\"\r\n        ? (state) => hintDescription\r\n        : hintDescription;\r\n    this.getBonusDescription =\r\n      typeof getBonusDescription === \"string\"\r\n        ? (state) => getBonusDescription\r\n        : getBonusDescription;\r\n    this.isHintUnlockable = isHintUnlockable;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.name;\r\n  }\r\n}\r\n\r\nconst Storylines = new DataStore<Storyline>();\r\n\r\nfunction _getSortedStorylines(): Storyline[] {\r\n  return Storylines.getAll().sort((a, b) => a.order - b.order);\r\n}\r\n\r\nconst getSortedStorylines = memoize(_getSortedStorylines);\r\n\r\nexport { Storylines, getSortedStorylines };\r\n","import { EndingStats, PlayerContextState } from \"../PlayerContext\";\r\nimport {\r\n  getMaxOfMaxPrimarySchoolLevels,\r\n  getSchoolLevel,\r\n  maximumSchoolLevelProductionMultiplierDx,\r\n  maximumSchoolLevelResearchMultiplier,\r\n  School,\r\n  SpellElement,\r\n} from \"../spells/ElementsAndSchools\";\r\nimport { Storylines } from \"../storylines/Storylines\";\r\nimport {\r\n  getSecondsPlayed,\r\n  getTotalSecondsPlayed,\r\n} from \"../timetick/TotalTimePlayed\";\r\nimport { addUICommand } from \"../UICommands\";\r\n\r\nexport type Ending = {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n};\r\n\r\nlet endingDatabase: Record<string, Ending> = {};\r\n\r\nexport function clearAllEndings(): void {\r\n  endingDatabase = {};\r\n}\r\n\r\nexport function addEnding(id: string, title: string, contents: string): void {\r\n  endingDatabase[id] = { id, description: contents, title };\r\n}\r\n\r\nexport function getEnding(id: string): Ending | undefined {\r\n  return endingDatabase?.[id];\r\n}\r\n\r\nexport function getEndingData(\r\n  state: PlayerContextState,\r\n): EndingStats | undefined {\r\n  return state.thisRun.endingTriggered;\r\n}\r\n\r\nexport function hasEverTriggeredEnding(\r\n  state: PlayerContextState,\r\n  id: string,\r\n): boolean {\r\n  return state.global.endingsTriggered.includes(id);\r\n}\r\n\r\nexport function setGameEnding(\r\n  state: PlayerContextState,\r\n  id: string,\r\n): PlayerContextState {\r\n  if (\r\n    state.thisRun.endingTriggered != null &&\r\n    state.thisRun.endingTriggered.endingId === id\r\n  ) {\r\n    // Do nothing\r\n    return state;\r\n  }\r\n\r\n  const allStorylines = Storylines.getAll();\r\n  const completedStorylines = allStorylines.filter((storyline) => {\r\n    return storyline.isCompleted(state);\r\n  });\r\n  state.thisRun.endingTriggered = {\r\n    endingId: id,\r\n    totalTimePlayed: getTotalSecondsPlayed(state),\r\n    totalTimePlayedThisRun: getSecondsPlayed(state),\r\n    totalRealWorldTimePlayed:\r\n      (Date.now() - state.global?.startTimestamp ?? 0) / 1000,\r\n    primarySchool: state.primarySchool as School,\r\n    primaryElement: state.primaryElement as SpellElement,\r\n    primarySchoolLevelOnEnding: getSchoolLevel(\r\n      state,\r\n      state.primarySchool as School,\r\n    ),\r\n    mpl: getMaxOfMaxPrimarySchoolLevels(state),\r\n    researchMultiplier: maximumSchoolLevelResearchMultiplier(state),\r\n    productionMultiplier: maximumSchoolLevelProductionMultiplierDx(state),\r\n    completedStorylines: completedStorylines.length,\r\n  };\r\n  const endingsTriggered = state.global.endingsTriggered;\r\n  endingsTriggered.push(id);\r\n  state.global.endingsTriggered = [...new Set(endingsTriggered)];\r\n  state = addUICommand(state, \"goToEnding\");\r\n  state = addUICommand(state, \"closeAllMenus\");\r\n  state = addUICommand(state, \"closeEventOverlay\");\r\n  return state;\r\n}\r\n","import {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { registerTimeTickListener } from \"../../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { GameEvent } from \"../GameEvent\";\r\n\r\ntype RandomEvent = {\r\n  event: GameEvent;\r\n  weight: number;\r\n  isStorylineEvent: boolean;\r\n  eligible?: (state: PlayerContextState) => boolean;\r\n  getParams?: (state: PlayerContextState) => any;\r\n};\r\n\r\nconst randomEvents: Record<string, RandomEvent> = {};\r\n\r\nconst PITY_COUNTER_THRESHOLD = 60 * 60 * 3; // 3 hours\r\nconst PITY_COUNTER_SECOND_THRESHOLD = 60 * 60 * 6; // 6 hours\r\nconst PITY_COUNTER_VARIANCE = 0.3;\r\nconst PITY_MULTIPLIER = 40;\r\n\r\naddContextListener(\"PityCounterInitialTrigger\", (oldState, newState) => {\r\n  if (newState.pityEnabledAtSeconds === undefined) {\r\n    return (state) => {\r\n      const nextPitySec =\r\n        PITY_COUNTER_THRESHOLD +\r\n        (Math.random() - 0.5) *\r\n          (PITY_COUNTER_THRESHOLD * PITY_COUNTER_VARIANCE);\r\n      state.pityEnabledAtSeconds = getSecondsPlayed(state) + nextPitySec;\r\n      return state;\r\n    };\r\n  }\r\n});\r\n\r\nexport function isInPity(state: PlayerContextState): boolean {\r\n  return (\r\n    state.pityCounter < 2 &&\r\n    getSecondsPlayed(state) > (state.pityEnabledAtSeconds ?? Infinity)\r\n  );\r\n}\r\n\r\nfunction registerPity(state: PlayerContextState): PlayerContextState {\r\n  state.pityCounter += 1;\r\n  const nextPitySec =\r\n    PITY_COUNTER_SECOND_THRESHOLD +\r\n    (Math.random() - 0.5) *\r\n      (PITY_COUNTER_SECOND_THRESHOLD * PITY_COUNTER_VARIANCE);\r\n  state.pityEnabledAtSeconds = getSecondsPlayed(state) + nextPitySec;\r\n  return state;\r\n}\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.RandomEventWeight]],\r\n  \"PityEventChance\",\r\n  TransformationType.Multiplier,\r\n  (state, params) => {\r\n    const randomEvent: RandomEvent = params.randomEvent;\r\n    if (randomEvent.isStorylineEvent && isInPity(state)) {\r\n      return PITY_MULTIPLIER;\r\n    }\r\n    return 1.0;\r\n  },\r\n);\r\n\r\nexport function registerRandomEventTrigger(\r\n  event: GameEvent,\r\n  weight: number,\r\n  isStorylineEvent: boolean,\r\n  eligible?: (state: PlayerContextState) => boolean,\r\n  getParams?: (state: PlayerContextState) => any,\r\n): void {\r\n  randomEvents[event.getId()] = {\r\n    event,\r\n    weight,\r\n    isStorylineEvent,\r\n    eligible,\r\n    getParams,\r\n  };\r\n}\r\n\r\nfunction triggerRandomEvent(state: PlayerContextState): PlayerContextState {\r\n  const eventsThatApply = Object.values(randomEvents).filter(\r\n    (randomEvent) => !randomEvent.eligible || randomEvent.eligible(state),\r\n  );\r\n  if (eventsThatApply.length === 0) {\r\n    return state;\r\n  }\r\n  const totalWeight = eventsThatApply.reduce((sumToNow, randomEvent) => {\r\n    const weight = applyTransformations(\r\n      [TransformationTags.RandomEventWeight],\r\n      state,\r\n      randomEvent.weight,\r\n      { randomEvent: randomEvent },\r\n    );\r\n    return sumToNow + weight;\r\n  }, 0);\r\n  let eventRoll = Math.random() * totalWeight;\r\n  for (let idx in eventsThatApply) {\r\n    const event = eventsThatApply[idx];\r\n    const weight = applyTransformations(\r\n      [TransformationTags.RandomEventWeight],\r\n      state,\r\n      event.weight,\r\n      { randomEvent: event },\r\n    );\r\n    eventRoll -= weight;\r\n    if (eventRoll < 0) {\r\n      const params = event.getParams ? event.getParams(state) : {};\r\n      if (event.isStorylineEvent && isInPity(state)) {\r\n        state = registerPity(state);\r\n      }\r\n      return triggerEvent(event.event, params)(state);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function debugRandomEvents(\r\n  state: PlayerContextState,\r\n): Record<string, number> {\r\n  const eventsThatApply = Object.values(randomEvents).filter(\r\n    (randomEvent) => !randomEvent.eligible || randomEvent.eligible(state),\r\n  );\r\n  const totalWeight = eventsThatApply.reduce((sumToNow, randomEvent) => {\r\n    const weight = applyTransformations(\r\n      [TransformationTags.RandomEventWeight],\r\n      state,\r\n      randomEvent.weight,\r\n      { randomEvent: randomEvent },\r\n    );\r\n    return sumToNow + weight;\r\n  }, 0);\r\n  const chancesPerEvent: Record<string, number> = {};\r\n  eventsThatApply.forEach((event) => {\r\n    const weight = applyTransformations(\r\n      [TransformationTags.RandomEventWeight],\r\n      state,\r\n      event.weight,\r\n      { randomEvent: event },\r\n    );\r\n    chancesPerEvent[event.event.getId()] = weight / totalWeight;\r\n  });\r\n  return chancesPerEvent;\r\n}\r\n\r\nexport function loadRandomEventTriggers(): void {\r\n  registerTimeTickListener(\r\n    \"RandomEventTriggers\",\r\n    (state: PlayerContextState, elapsedSec: number) => {\r\n      if (getSecondsPlayed(state) > (state?.nextRandomEvent || 0)) {\r\n        state = triggerRandomEvent(state);\r\n\r\n        // The next random event will occur in 8 to 16 minutes. However,\r\n        // this period becomes longer and longer as more seconds have been played\r\n        // in the current run: 40 to 80 mins after 24 hours, 72 to 144 mins after 48,\r\n        // about 3 and a half hours after 3 days.\r\n        // This rewards quickly triggering random events after retirement and\r\n        // prevents low quality random event spam later in the game.\r\n        const periodMultiplier = 1.0 + getSecondsPlayed(state) / (60 * 60 * 6);\r\n        state.nextRandomEvent =\r\n          (8 + Math.random() * 8) * 60 * periodMultiplier +\r\n          getSecondsPlayed(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { DataStore } from \"../../generic/DataStore\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Enemy } from \"./Enemy\";\r\n\r\nconst Enemies = new DataStore<Enemy>();\r\n\r\nexport { Enemies };\r\n\r\nexport function getCurrentEnemy(state: PlayerContextState): Enemy {\r\n  return Enemies.getById(state.exploration?.currentEnemy?.id || \"\");\r\n}\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\n\r\n/**\r\n * AttackListeners are a generic way to add effects or actions when\r\n * an auto-attack gauge is full.\r\n */\r\n\r\nexport type AttackListener = (\r\n  oldState: PlayerContextState,\r\n  newState: PlayerContextState,\r\n) => PlayerContextState;\r\n\r\nconst PlayerAttackListeners = new DataStore<AttackListener>();\r\nconst EnemyAttackListeners = new DataStore<AttackListener>();\r\nconst SummonAttackListeners = new DataStore<AttackListener>();\r\n\r\nexport { PlayerAttackListeners, EnemyAttackListeners, SummonAttackListeners };\r\n","export enum AttackTarget {\r\n  Player = \"Player\",\r\n  Enemy = \"Enemy\",\r\n  Summon = \"Summon\",\r\n}\r\n","import {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../calculation/Calculation\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\n\r\nexport enum CombatStat {\r\n  MaxHP = \"MaxHP\",\r\n  Attack = \"Attack\",\r\n  AttackDelay = \"AttackDelay\",\r\n  Defense = \"Defense\",\r\n  HPRegen = \"HPRegen\",\r\n  Dodge = \"Dodge\",\r\n  Accuracy = \"Accuracy\",\r\n  CritChance = \"CritChance\",\r\n}\r\n\r\nexport function calculatePlayerMaxHP(state: PlayerContextState) {\r\n  return applyTransformations(\r\n    [AttackTarget.Player, CombatStat.MaxHP],\r\n    state,\r\n    100,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerAttack(state: PlayerContextState) {\r\n  return Math.max(\r\n    applyTransformations([AttackTarget.Player, CombatStat.Attack], state, 5),\r\n    1,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerAttackDelaySec(state: PlayerContextState) {\r\n  return applyTransformations(\r\n    [AttackTarget.Player, CombatStat.AttackDelay],\r\n    state,\r\n    2.5,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerDefense(state: PlayerContextState) {\r\n  return Math.max(\r\n    applyTransformations([AttackTarget.Player, CombatStat.Defense], state, 0),\r\n    0,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerHPRegenPerSec(state: PlayerContextState) {\r\n  return applyTransformations(\r\n    [AttackTarget.Player, CombatStat.HPRegen],\r\n    state,\r\n    0.1,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerDodgeChance(state: PlayerContextState) {\r\n  return applyTransformations(\r\n    [AttackTarget.Player, CombatStat.Dodge],\r\n    state,\r\n    0,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerAccuracy(state: PlayerContextState) {\r\n  return applyTransformations(\r\n    [AttackTarget.Player, CombatStat.Accuracy],\r\n    state,\r\n    1.0,\r\n  );\r\n}\r\n\r\nexport function calculatePlayerCritChance(state: PlayerContextState) {\r\n  return applyTransformations(\r\n    [AttackTarget.Player, CombatStat.CritChance],\r\n    state,\r\n    0.0,\r\n  );\r\n}\r\n\r\nregisterTransformation(\r\n  [\r\n    [AttackTarget.Player, CombatStat.MaxHP],\r\n    [AttackTarget.Player, CombatStat.HPRegen],\r\n  ],\r\n  \"DebugInvincibility\",\r\n  TransformationType.Addition,\r\n  (state) => {\r\n    if (hasFlag(state, \"debug_invincibility\")) {\r\n      return 99999999;\r\n    }\r\n    return 0;\r\n  },\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"DebugInsvincibility\",\r\n  TransformationType.Addition,\r\n  (state) => {\r\n    if (hasFlag(state, \"debug_invincibility\")) {\r\n      return 9999;\r\n    }\r\n    return 0;\r\n  },\r\n);\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\n\r\n/**\r\n * PlayerDeathInterceptors return true if player death is to be prevented.\r\n * Use in conjunction with some ContextListener that does some action.\r\n */\r\n\r\nexport type PlayerDeathInterceptor = (state: PlayerContextState) => boolean;\r\n\r\nconst PlayerDeathInterceptors = new DataStore<PlayerDeathInterceptor>();\r\n\r\nexport { PlayerDeathInterceptors };\r\n","import {\r\n  EXPLORATION_INITIAL_STATE,\r\n  PlayerContextState,\r\n} from \"../PlayerContext\";\r\nimport { Summon } from \"./summons/Summon\";\r\n\r\nexport function hasCurrentActiveSummon(state: PlayerContextState): boolean {\r\n  return (\r\n    state.exploration.currentSummon != null &&\r\n    state.exploration.currentSummon.currentHP > 0\r\n  );\r\n}\r\n\r\nexport function activateSummon(\r\n  state: PlayerContextState,\r\n  summon: Summon,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.currentSummon = {\r\n    id: summon.getId(),\r\n    currentHP: summon.getMaxHP(state),\r\n  };\r\n  state.exploration.summonActionProgress = 0.0;\r\n  return state;\r\n}\r\n","import { DataStore } from \"../../generic/DataStore\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Summon } from \"./Summon\";\r\n\r\nconst Summons = new DataStore<Summon>();\r\n\r\nexport { Summons };\r\n\r\nexport function getCurrentSummon(\r\n  state: PlayerContextState,\r\n): Summon | undefined {\r\n  return Summons.getById(state.exploration?.currentSummon?.id || \"\");\r\n}\r\n","import moment from \"moment\";\r\nimport { clone } from \"../../utils/CoreUtils\";\r\nimport { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { resetAllCombatVariables } from \"../Flags\";\r\nimport {\r\n  CombatActionResult,\r\n  EXPLORATION_INITIAL_STATE,\r\n  PlayerContextState,\r\n  PlayerContextTransform,\r\n} from \"../PlayerContext\";\r\nimport { addContextListener } from \"../PlayerContextListeners\";\r\nimport {\r\n  clearCombatTemporaryEffects,\r\n  clearTemporaryEffect,\r\n  getTemporaryEffects,\r\n} from \"../timetick/TemporaryEffects\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  EnemyAttackListeners,\r\n  PlayerAttackListeners,\r\n  SummonAttackListeners,\r\n} from \"./AttackListeners\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\nimport {\r\n  calculatePlayerAccuracy,\r\n  calculatePlayerAttack,\r\n  calculatePlayerAttackDelaySec,\r\n  calculatePlayerCritChance,\r\n  calculatePlayerDefense,\r\n  calculatePlayerDodgeChance,\r\n  calculatePlayerHPRegenPerSec,\r\n  calculatePlayerMaxHP,\r\n  CombatStat,\r\n} from \"./CombatStats\";\r\nimport { DungeonFloor } from \"./dungeons/DungeonFloor\";\r\nimport { DungeonFloors } from \"./dungeons/Dungeons\";\r\nimport { getCurrentEnemy } from \"./enemies/Enemies\";\r\nimport { BattlerAction, Enemy } from \"./enemies/Enemy\";\r\nimport { ExplorationStatus } from \"./ExplorationStatus\";\r\nimport { PlayerDeathInterceptors } from \"./PlayerDeathInterceptors\";\r\nimport { hasCurrentActiveSummon } from \"./Summoning\";\r\nimport { Summon } from \"./summons/Summon\";\r\nimport { getCurrentSummon } from \"./summons/Summons\";\r\n\r\nlet lastSelectedEnemyAction: BattlerAction | undefined = undefined;\r\nlet lastSelectedSummonAction: BattlerAction | undefined = undefined;\r\n\r\nexport function startExplorationOnFloor(\r\n  state: PlayerContextState,\r\n  dungeonFloor: DungeonFloor,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.currentDungeonFloorId = dungeonFloor.getId();\r\n  return startExploration(state);\r\n}\r\n\r\nexport function startExploration(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.explorationStartTime = getSecondsPlayed(state);\r\n  state.exploration.explorationStatus = ExplorationStatus.Exploring;\r\n  return state;\r\n}\r\n\r\nexport function startBossExploration(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.explorationStartTime = getSecondsPlayed(state);\r\n  state.exploration.explorationStatus = ExplorationStatus.ExploringBoss;\r\n  return state;\r\n}\r\n\r\nexport function getExplorationStartTime(state: PlayerContextState): number {\r\n  return state.exploration?.explorationStartTime || 0;\r\n}\r\n\r\nexport function getCurrentDungeonFloor(\r\n  state: PlayerContextState,\r\n): DungeonFloor {\r\n  return DungeonFloors.getById(state.exploration?.currentDungeonFloorId || \"\");\r\n}\r\n\r\nexport function getExplorationStatus(\r\n  state: PlayerContextState,\r\n): ExplorationStatus {\r\n  return state.exploration?.explorationStatus || ExplorationStatus.None;\r\n}\r\n\r\nfunction startCombatImpl(\r\n  enemy: Enemy,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.explorationStatus = ExplorationStatus.Combat;\r\n  state.exploration.currentEnemy = {\r\n    id: enemy.getId(),\r\n    currentHP: enemy.getMaxHP(state),\r\n  };\r\n  lastSelectedEnemyAction = enemy.getNextAction(state);\r\n  lastSelectedSummonAction = undefined;\r\n  const hasSummon = hasCurrentActiveSummon(state);\r\n  if (hasSummon) {\r\n    const summon = getCurrentSummon(state) as Summon;\r\n    lastSelectedSummonAction = summon.getNextAction(state);\r\n    state.exploration.summonActionProgress = 0.0;\r\n  }\r\n  state.exploration.playerActionProgress = 0.0;\r\n  state.exploration.enemyActionProgress = 0.0;\r\n  return state;\r\n}\r\n\r\nexport function getPlayerActionProgress(state: PlayerContextState): number {\r\n  return state.exploration?.playerActionProgress || 0.0;\r\n}\r\n\r\nexport function getEnemyActionProgress(state: PlayerContextState): number {\r\n  return state.exploration?.enemyActionProgress || 0.0;\r\n}\r\n\r\nexport function getSummonActionProgress(state: PlayerContextState): number {\r\n  return state.exploration?.summonActionProgress || 0.0;\r\n}\r\n\r\nexport function startCombat(this: any, enemy: Enemy): PlayerContextTransform {\r\n  return startCombatImpl.bind(this, enemy);\r\n}\r\n\r\nexport function getCurrentPlayerHP(state: PlayerContextState): number {\r\n  return state.exploration?.currentHP || 0;\r\n}\r\n\r\nexport function getCurrentSummonHP(state: PlayerContextState): number {\r\n  return state.exploration?.currentSummon?.currentHP || 0;\r\n}\r\n\r\nexport function getCurrentEnemyHP(state: PlayerContextState): number {\r\n  return state.exploration?.currentEnemy?.currentHP || 0;\r\n}\r\n\r\nexport function calculateDamage(attack: number, defense: number): number {\r\n  return Math.max(attack - defense / 2, 1);\r\n}\r\n\r\nexport function calculateIsHit(\r\n  hitChance: number,\r\n  dodgeChance: number,\r\n): boolean {\r\n  const hitOdds = hitChance - dodgeChance;\r\n  return Math.random() < hitOdds;\r\n}\r\n\r\nexport function modifyPlayerCurrentHP(\r\n  state: PlayerContextState,\r\n  amount: number,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n\r\n  state.exploration.currentHP = Math.min(\r\n    calculatePlayerMaxHP(state),\r\n    Math.max(state.exploration.currentHP + amount, 0),\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function modifySummonCurrentHP(\r\n  state: PlayerContextState,\r\n  amount: number,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n\r\n  if (state.exploration.currentSummon == null) {\r\n    return state;\r\n  }\r\n\r\n  const currentSummon = getCurrentSummon(state) as Summon;\r\n  state.exploration.currentSummon.currentHP = Math.min(\r\n    currentSummon.getMaxHP(state),\r\n    Math.max(state.exploration.currentSummon.currentHP + amount, 0),\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function modifyEnemyCurrentHP(\r\n  state: PlayerContextState,\r\n  amount: number,\r\n): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n\r\n  const currentEnemy = getCurrentEnemy(state);\r\n  state.exploration.currentEnemy.currentHP = Math.min(\r\n    currentEnemy.getMaxHP(state),\r\n    state.exploration.currentEnemy.currentHP + amount,\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function executePlayerAutoAttack(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const oldState = clone(state);\r\n  state = standardPlayerAttackEffect(\r\n    state,\r\n    calculatePlayerAttack(state),\r\n    1.0,\r\n    1.0,\r\n  );\r\n  const listeners = PlayerAttackListeners.getAll();\r\n  listeners.forEach((listener) => {\r\n    state = listener(oldState, state);\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function executeSummonAction(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (\r\n    lastSelectedSummonAction &&\r\n    state.exploration.currentSummon != null &&\r\n    state.exploration.currentSummon.currentHP > 0\r\n  ) {\r\n    const oldState = clone(state);\r\n    state = lastSelectedSummonAction.transform(state);\r\n    const listeners = SummonAttackListeners.getAll();\r\n    listeners.forEach((listener) => {\r\n      state = listener(oldState, state);\r\n    });\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function executeEnemyAction(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (lastSelectedEnemyAction) {\r\n    const oldState = clone(state);\r\n    state = lastSelectedEnemyAction.transform(state);\r\n    const listeners = EnemyAttackListeners.getAll();\r\n    listeners.forEach((listener) => {\r\n      state = listener(oldState, state);\r\n    });\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function calculateAttackTarget(state: PlayerContextState): AttackTarget {\r\n  if (hasCurrentActiveSummon(state)) {\r\n    return AttackTarget.Summon;\r\n  }\r\n  return AttackTarget.Player;\r\n}\r\n\r\nexport function calculateIsEnemyHit(\r\n  state: PlayerContextState,\r\n  hitChance: number,\r\n  forcedTarget?: AttackTarget,\r\n): boolean {\r\n  const modifiedHitChance = applyTransformations(\r\n    [AttackTarget.Enemy, CombatStat.Accuracy],\r\n    state,\r\n    hitChance,\r\n  );\r\n  const target = forcedTarget ?? calculateAttackTarget(state);\r\n  let dodgeChance = 0;\r\n  if (target === AttackTarget.Summon) {\r\n    const summon = getCurrentSummon(state) as Summon;\r\n    if (summon != null) {\r\n      dodgeChance = summon.getDodgeChance(state);\r\n    }\r\n  } else {\r\n    dodgeChance = calculatePlayerDodgeChance(state);\r\n  }\r\n  return calculateIsHit(modifiedHitChance, dodgeChance);\r\n}\r\n\r\nexport function standardEnemyAttackEffect(\r\n  state: PlayerContextState,\r\n  hitChance: number,\r\n  attack: number,\r\n  critChance?: number,\r\n  forcedTarget?: AttackTarget,\r\n): PlayerContextState {\r\n  const isHit = calculateIsEnemyHit(state, hitChance, forcedTarget);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  const target = forcedTarget ?? calculateAttackTarget(state);\r\n  if (isHit) {\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n    const critMultiplier = 1.5;\r\n\r\n    if (target === AttackTarget.Player) {\r\n      damage = calculateDamage(\r\n        isCrit ? attack * critMultiplier : attack,\r\n        isCrit ? 0 : calculatePlayerDefense(state),\r\n      );\r\n      damage = applyTransformations(\r\n        [TransformationTags.AttackDamageReceived, target],\r\n        state,\r\n        damage,\r\n      );\r\n      state = modifyPlayerCurrentHP(state, -damage);\r\n    } else {\r\n      const summon = getCurrentSummon(state) as Summon;\r\n      if (summon != null) {\r\n        damage = calculateDamage(\r\n          isCrit ? attack * critMultiplier : attack,\r\n          isCrit ? 0 : summon.getDefense(state),\r\n        );\r\n        damage = applyTransformations(\r\n          [TransformationTags.AttackDamageReceived, target],\r\n          state,\r\n          damage,\r\n        );\r\n        state = modifySummonCurrentHP(state, -damage);\r\n      }\r\n    }\r\n  }\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    target,\r\n    tags: [],\r\n  };\r\n  state.exploration.lastEnemyActionResult = enemyAction;\r\n  state.exploration.actionResultQueue.push(enemyAction);\r\n  return state;\r\n}\r\n\r\nexport function aoeEnemyAttackEffect(\r\n  state: PlayerContextState,\r\n  hitChance: number,\r\n  attack: number,\r\n  critChance?: number,\r\n) {\r\n  if (hasCurrentActiveSummon(state)) {\r\n    state = standardEnemyAttackEffect(\r\n      state,\r\n      hitChance,\r\n      attack,\r\n      critChance,\r\n      AttackTarget.Summon,\r\n    );\r\n  }\r\n  state = standardEnemyAttackEffect(\r\n    state,\r\n    hitChance,\r\n    attack,\r\n    critChance,\r\n    AttackTarget.Player,\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function fractionEnemyAttackEffect(\r\n  state: PlayerContextState,\r\n  hitChance: number,\r\n  fraction: number,\r\n  forcedTarget?: AttackTarget,\r\n): PlayerContextState {\r\n  const isHit = calculateIsEnemyHit(state, hitChance, forcedTarget);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  const target = forcedTarget ?? calculateAttackTarget(state);\r\n  if (isHit) {\r\n    if (target === AttackTarget.Player) {\r\n      damage = getCurrentPlayerHP(state) * fraction;\r\n      state = modifyPlayerCurrentHP(state, -damage);\r\n    } else {\r\n      const summon = getCurrentSummon(state) as Summon;\r\n      damage = getCurrentSummonHP(state) * fraction;\r\n      state = modifySummonCurrentHP(state, -damage);\r\n    }\r\n  }\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    target,\r\n    tags: [],\r\n  };\r\n  state.exploration.lastEnemyActionResult = enemyAction;\r\n  state.exploration.actionResultQueue.push(enemyAction);\r\n  return state;\r\n}\r\n\r\nexport function drainingEnemyAttackEffect(\r\n  state: PlayerContextState,\r\n  attack: number,\r\n): PlayerContextState {\r\n  const target = calculateAttackTarget(state);\r\n  let damage;\r\n  if (target === AttackTarget.Player) {\r\n    damage = calculateDamage(attack, calculatePlayerDefense(state));\r\n    damage = applyTransformations(\r\n      [TransformationTags.AttackDamageReceived, AttackTarget.Player],\r\n      state,\r\n      damage,\r\n    );\r\n    state = modifyPlayerCurrentHP(state, -damage);\r\n    state = modifyEnemyCurrentHP(state, +damage);\r\n  } else {\r\n    const summon = getCurrentSummon(state) as Summon;\r\n    damage = calculateDamage(attack, summon.getDefense(state));\r\n\r\n    damage = applyTransformations(\r\n      [TransformationTags.AttackDamageReceived, AttackTarget.Summon],\r\n      state,\r\n      damage,\r\n    );\r\n    state = modifySummonCurrentHP(state, -damage);\r\n    state = modifyEnemyCurrentHP(state, +damage);\r\n  }\r\n\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit: true,\r\n    isCrit: false,\r\n    time: getSecondsPlayed(state),\r\n    target: AttackTarget.Player,\r\n    tags: [],\r\n  };\r\n  const playerAction = {\r\n    id: Math.random().toString(),\r\n    damage: -damage,\r\n    isHit: true,\r\n    isCrit: false,\r\n    time: getSecondsPlayed(state),\r\n    target: AttackTarget.Enemy,\r\n    tags: [],\r\n  };\r\n  state.exploration.lastEnemyActionResult = enemyAction;\r\n  state.exploration.lastPlayerActionResult = playerAction;\r\n  state.exploration.actionResultQueue.push(enemyAction, playerAction);\r\n\r\n  return state;\r\n}\r\n\r\nexport function dispelPlayerEnemyAttackEffect(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const tempEffects = getTemporaryEffects(state);\r\n  tempEffects.forEach((tempEffect) => {\r\n    if (\r\n      tempEffect.isBeneficial &&\r\n      !tempEffect.isEnemyTemporaryEffect &&\r\n      (tempEffect.dispellable ?? true)\r\n    ) {\r\n      state = clearTemporaryEffect(tempEffect.id)(state);\r\n    }\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function dispelAllEnemyAttackEffect(\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  const tempEffects = getTemporaryEffects(state);\r\n  tempEffects.forEach((tempEffect) => {\r\n    if (tempEffect.dispellable ?? true) {\r\n      state = clearTemporaryEffect(tempEffect.id)(state);\r\n    }\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function standardSummonAttackEffect(\r\n  state: PlayerContextState,\r\n  hitChance: number,\r\n  attack: number,\r\n  critChance?: number,\r\n): PlayerContextState {\r\n  const dodgeChance = getCurrentEnemy(state).getDodgeChance(state);\r\n  const isHit = calculateIsHit(hitChance, dodgeChance);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n    const critMultiplier = 1.5;\r\n\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit ? 0 : getCurrentEnemy(state).getDefense(state),\r\n    );\r\n    damage = applyTransformations(\r\n      [TransformationTags.AttackDamageReceived, AttackTarget.Enemy],\r\n      state,\r\n      damage,\r\n    );\r\n    state = modifyEnemyCurrentHP(state, -damage);\r\n  }\r\n  const summonAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    target: AttackTarget.Enemy,\r\n    tags: [],\r\n  };\r\n  state.exploration.lastPlayerActionResult = summonAction;\r\n  state.exploration.actionResultQueue.push(summonAction);\r\n  return state;\r\n}\r\n\r\nexport function drainingSummonAttackEffect(\r\n  state: PlayerContextState,\r\n  attack: number,\r\n): PlayerContextState {\r\n  let damage = calculateDamage(\r\n    attack,\r\n    getCurrentEnemy(state).getDefense(state),\r\n  );\r\n  damage = applyTransformations(\r\n    [TransformationTags.AttackDamageReceived, AttackTarget.Enemy],\r\n    state,\r\n    damage,\r\n  );\r\n  state = modifyEnemyCurrentHP(state, -damage);\r\n  state = modifySummonCurrentHP(state, +damage);\r\n\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit: true,\r\n    isCrit: false,\r\n    time: getSecondsPlayed(state),\r\n    target: AttackTarget.Enemy,\r\n    tags: [],\r\n  };\r\n  const summonAction = {\r\n    id: Math.random().toString(),\r\n    damage: -damage,\r\n    isHit: true,\r\n    isCrit: false,\r\n    time: getSecondsPlayed(state),\r\n    target: AttackTarget.Summon,\r\n    tags: [],\r\n  };\r\n  state.exploration.actionResultQueue.push(enemyAction, summonAction);\r\n\r\n  return state;\r\n}\r\n\r\nexport function standardPlayerAttackEffect(\r\n  state: PlayerContextState,\r\n  attack: number,\r\n  hitChanceMultiplier?: number,\r\n  critChanceMultiplier?: number,\r\n  attackTags?: string[],\r\n): PlayerContextState {\r\n  const hitChance =\r\n    calculatePlayerAccuracy(state) * (hitChanceMultiplier ?? 1.0);\r\n  const dodgeChance = getCurrentEnemy(state).getDodgeChance(state);\r\n  const isHit = calculateIsHit(hitChance, dodgeChance);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChance = calculatePlayerCritChance(state);\r\n    isCrit = Math.random() < critChance * (critChanceMultiplier ?? 0.0);\r\n    const critMultiplier = 1.5;\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit ? 0 : getCurrentEnemy(state).getDefense(state),\r\n    );\r\n    damage = applyTransformations(\r\n      [TransformationTags.AttackDamageReceived, AttackTarget.Enemy],\r\n      state,\r\n      damage,\r\n    );\r\n    state = modifyEnemyCurrentHP(state, -damage);\r\n  }\r\n  const playerAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    target: AttackTarget.Enemy,\r\n    tags: attackTags ?? [],\r\n  };\r\n  state.exploration.lastPlayerActionResult = playerAction;\r\n  state.exploration.actionResultQueue.push(playerAction);\r\n  return state;\r\n}\r\n\r\nexport function getLastEnemyActionResult(\r\n  state: PlayerContextState,\r\n): CombatActionResult | undefined {\r\n  return state.exploration.lastEnemyActionResult;\r\n}\r\n\r\nexport function getLastPlayerActionResult(\r\n  state: PlayerContextState,\r\n): CombatActionResult | undefined {\r\n  return state.exploration.lastPlayerActionResult;\r\n}\r\n\r\nexport function getCurrentEnemyAction(state: PlayerContextState) {\r\n  return lastSelectedEnemyAction;\r\n}\r\n\r\nexport function getCurrentSummonAction(state: PlayerContextState) {\r\n  return lastSelectedSummonAction;\r\n}\r\n\r\nexport function getMessageLog(state: PlayerContextState) {\r\n  return state?.explorationMessageLog || [];\r\n}\r\n\r\nexport function getSuccessfulExplorationsForFloor(\r\n  state: PlayerContextState,\r\n  dungeonFloorId: string,\r\n) {\r\n  return (\r\n    state?.exploration?.successfulExplorationsPerFloor?.[dungeonFloorId] || 0\r\n  );\r\n}\r\n\r\nexport function pushToMessageLog(\r\n  state: PlayerContextState,\r\n  log: string,\r\n): PlayerContextState {\r\n  if (!state.explorationMessageLog) {\r\n    state.explorationMessageLog = [];\r\n  }\r\n  state.explorationMessageLog.unshift({\r\n    id: Math.random().toString(),\r\n    timestamp: getSecondsPlayed(state),\r\n    message: `[${moment(Date.now()).format(\"h:mm:ss A\")}] ${log}`,\r\n  });\r\n  state.explorationMessageLog = state.explorationMessageLog.slice(0, 40);\r\n  return state;\r\n}\r\n\r\nexport function endExploration(state: PlayerContextState): PlayerContextState {\r\n  if (!state.exploration) {\r\n    state.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.exploration.explorationStatus = ExplorationStatus.None;\r\n  state = pushToMessageLog(state, `You stop exploring.`);\r\n  return state;\r\n}\r\n\r\nexport function getExplorationTimeRequirementSec(\r\n  state: PlayerContextState,\r\n): number {\r\n  const explorationStatus = getExplorationStatus(state);\r\n  if (\r\n    explorationStatus != ExplorationStatus.Exploring &&\r\n    explorationStatus != ExplorationStatus.ExploringBoss\r\n  ) {\r\n    return 0;\r\n  }\r\n  const dungeonFloor = getCurrentDungeonFloor(state);\r\n  return applyTransformations(\r\n    [TransformationTags.ExplorationDelay],\r\n    state,\r\n    dungeonFloor.getExplorationRequiredTimeSec(),\r\n  );\r\n}\r\n\r\nexport function getSummonAttackDelay(\r\n  state: PlayerContextState,\r\n): number | undefined {\r\n  const currentSummon = getCurrentSummon(state);\r\n  if (\r\n    !currentSummon ||\r\n    state.exploration?.explorationStatus != ExplorationStatus.Combat\r\n  ) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!lastSelectedSummonAction) {\r\n    lastSelectedSummonAction = currentSummon.getNextAction(state);\r\n  }\r\n\r\n  return applyTransformations(\r\n    [AttackTarget.Summon, CombatStat.AttackDelay],\r\n    state,\r\n    lastSelectedSummonAction.delay,\r\n  );\r\n}\r\n\r\nexport function getEnemyAttackDelay(state: PlayerContextState): number {\r\n  const currentEnemy = getCurrentEnemy(state);\r\n  if (!lastSelectedEnemyAction) {\r\n    lastSelectedEnemyAction = currentEnemy.getNextAction(state);\r\n  }\r\n\r\n  return applyTransformations(\r\n    [AttackTarget.Enemy, CombatStat.AttackDelay],\r\n    state,\r\n    lastSelectedEnemyAction.delay,\r\n  );\r\n}\r\n\r\nexport function resetEnemyNextAction(): void {\r\n  lastSelectedEnemyAction = undefined;\r\n}\r\n\r\nexport type EnemyDeathListener = (\r\n  state: PlayerContextState,\r\n  enemy: Enemy,\r\n) => PlayerContextState;\r\n\r\nconst enemyDeathListeners: EnemyDeathListener[] = [];\r\n\r\nexport function addEnemyDeathListener(listener: EnemyDeathListener) {\r\n  enemyDeathListeners.push(listener);\r\n}\r\n\r\nexport function loadExploration() {\r\n  registerTimeTickListener(\r\n    \"Exploration\",\r\n    (state: PlayerContextState, timeElapsedSec: number) => {\r\n      const explorationStatus = getExplorationStatus(state);\r\n      if (\r\n        explorationStatus != ExplorationStatus.Exploring &&\r\n        explorationStatus != ExplorationStatus.ExploringBoss\r\n      ) {\r\n        return state;\r\n      }\r\n\r\n      const dungeonFloor = getCurrentDungeonFloor(state);\r\n      const explorationTimeRequirement =\r\n        getExplorationTimeRequirementSec(state);\r\n\r\n      const nextExplorationTime =\r\n        getExplorationStartTime(state) + explorationTimeRequirement;\r\n      if (getSecondsPlayed(state) > nextExplorationTime) {\r\n        if (!state.exploration) {\r\n          state.exploration = EXPLORATION_INITIAL_STATE;\r\n        }\r\n        state.exploration.explorationStartTime = nextExplorationTime;\r\n        if (explorationStatus == ExplorationStatus.Exploring) {\r\n          const outcome = dungeonFloor.doExplore(state);\r\n          if (outcome != null) {\r\n            return outcome.normal(state);\r\n          }\r\n        } else {\r\n          const transform = dungeonFloor.doFightBoss(state);\r\n          return transform ? transform(state) : state;\r\n        }\r\n      }\r\n\r\n      return state;\r\n    },\r\n  );\r\n\r\n  registerTimeTickListener(\r\n    \"Combat\",\r\n    (state: PlayerContextState, timeElapsedSec: number) => {\r\n      const explorationStatus = getExplorationStatus(state);\r\n      if (explorationStatus != ExplorationStatus.Combat) {\r\n        return state;\r\n      }\r\n\r\n      if (!state.exploration) {\r\n        state.exploration = EXPLORATION_INITIAL_STATE;\r\n      }\r\n\r\n      const currentEnemy = getCurrentEnemy(state);\r\n      const currentSummon = getCurrentSummon(state);\r\n\r\n      // First, pass the time\r\n      const attackDelayPlayer = calculatePlayerAttackDelaySec(state);\r\n      const attackDelayEnemy = getEnemyAttackDelay(state);\r\n      const attackDelaySummon = getSummonAttackDelay(state);\r\n\r\n      state.exploration.playerActionProgress +=\r\n        timeElapsedSec / attackDelayPlayer;\r\n      state.exploration.enemyActionProgress +=\r\n        timeElapsedSec / attackDelayEnemy;\r\n      if (attackDelaySummon != null) {\r\n        state.exploration.summonActionProgress +=\r\n          timeElapsedSec / attackDelaySummon;\r\n      }\r\n\r\n      if (state.exploration.playerActionProgress > 1.0) {\r\n        state.exploration.playerActionProgress -= 1.0;\r\n        let extraSec =\r\n          state.exploration.playerActionProgress * attackDelayPlayer;\r\n        if (extraSec == Infinity) {\r\n          // Guard against stunning\r\n          extraSec = 0;\r\n        }\r\n        state = executePlayerAutoAttack(state);\r\n        if (!state.exploration) {\r\n          state.exploration = EXPLORATION_INITIAL_STATE;\r\n        }\r\n        const newAttackDelay = calculatePlayerAttackDelaySec(state);\r\n        state.exploration.playerActionProgress = extraSec / newAttackDelay;\r\n      }\r\n\r\n      if (\r\n        lastSelectedSummonAction != null &&\r\n        attackDelaySummon != null &&\r\n        state.exploration.summonActionProgress > 1.0\r\n      ) {\r\n        state.exploration.summonActionProgress -= 1.0;\r\n        const extraSec =\r\n          state.exploration.summonActionProgress * attackDelaySummon;\r\n        state = executeSummonAction(state);\r\n        lastSelectedSummonAction = currentSummon?.getNextAction(state);\r\n        if (!state.exploration) {\r\n          state.exploration = EXPLORATION_INITIAL_STATE;\r\n        }\r\n        const newAttackDelay = getSummonAttackDelay(state);\r\n        if (newAttackDelay != null) {\r\n          state.exploration.summonActionProgress = extraSec / newAttackDelay;\r\n        }\r\n      }\r\n\r\n      if (state.exploration.enemyActionProgress > 1.0) {\r\n        state.exploration.enemyActionProgress -= 1.0;\r\n        let extraSec = state.exploration.enemyActionProgress * attackDelayEnemy;\r\n        if (extraSec == Infinity) {\r\n          // Guard against stunning\r\n          extraSec = 0;\r\n        }\r\n        state = executeEnemyAction(state);\r\n        lastSelectedEnemyAction = currentEnemy.getNextAction(state);\r\n        if (!state.exploration) {\r\n          state.exploration = EXPLORATION_INITIAL_STATE;\r\n        }\r\n        const newAttackDelay = getEnemyAttackDelay(state);\r\n        state.exploration.enemyActionProgress = extraSec / newAttackDelay;\r\n      }\r\n\r\n      return state;\r\n    },\r\n  );\r\n\r\n  addContextListener(\r\n    \"CombatSummonDeathListener\",\r\n    (oldState: PlayerContextState, newState: PlayerContextState) => {\r\n      if (getExplorationStatus(newState) != ExplorationStatus.Combat) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        getCurrentSummonHP(oldState) > 0 &&\r\n        getCurrentSummonHP(newState) <= 0\r\n      ) {\r\n        return (state) => {\r\n          if (!state.exploration) {\r\n            state.exploration = EXPLORATION_INITIAL_STATE;\r\n          }\r\n          const currentSummon = getCurrentSummon(state) as Summon;\r\n          state = pushToMessageLog(\r\n            state,\r\n            `Your summoned ` + currentSummon.getName() + \" has died!\",\r\n          );\r\n          state.exploration.currentSummon = undefined;\r\n          lastSelectedSummonAction = undefined;\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n  );\r\n\r\n  addContextListener(\r\n    \"CombatCleaningCrew\",\r\n    (oldState: PlayerContextState, newState: PlayerContextState) => {\r\n      if (\r\n        getExplorationStatus(oldState) === ExplorationStatus.Combat &&\r\n        getExplorationStatus(newState) !== ExplorationStatus.Combat\r\n      ) {\r\n        return (state) => {\r\n          state = clearCombatTemporaryEffects(state);\r\n          state = resetAllCombatVariables(state);\r\n          lastSelectedSummonAction = undefined;\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n  );\r\n\r\n  addContextListener(\r\n    \"CombatDeathListener\",\r\n    (oldState: PlayerContextState, newState: PlayerContextState) => {\r\n      if (getExplorationStatus(newState) != ExplorationStatus.Combat) {\r\n        return;\r\n      }\r\n\r\n      if (getCurrentPlayerHP(newState) <= 0) {\r\n        const shouldPreventDeath = PlayerDeathInterceptors.getAll()\r\n          .map((interceptor) => interceptor(newState))\r\n          .some((value) => value);\r\n        if (!shouldPreventDeath) {\r\n          // Player death occurred\r\n          return (state) => {\r\n            state = clearCombatTemporaryEffects(state);\r\n            state = resetAllCombatVariables(state);\r\n            lastSelectedSummonAction = undefined;\r\n            if (!state.exploration) {\r\n              state.exploration = EXPLORATION_INITIAL_STATE;\r\n            }\r\n            state.exploration.explorationStatus = ExplorationStatus.Reviving;\r\n            state = pushToMessageLog(\r\n              state,\r\n              `You run away to recover from your injuries...`,\r\n            );\r\n            return state;\r\n          };\r\n        }\r\n      }\r\n\r\n      if (getCurrentEnemyHP(newState) <= 0) {\r\n        return (state) => {\r\n          const currentEnemy = getCurrentEnemy(state);\r\n          state = pushToMessageLog(\r\n            state,\r\n            `You defeated ${currentEnemy.getName()}!`,\r\n          );\r\n          state = currentEnemy.onDeath(state, false);\r\n          enemyDeathListeners.forEach((listener) => {\r\n            state = listener(state, currentEnemy);\r\n          });\r\n          if (!state.exploration) {\r\n            state.exploration = EXPLORATION_INITIAL_STATE;\r\n          }\r\n          const floor = state.exploration.currentDungeonFloorId;\r\n          state.exploration.successfulExplorationsPerFloor[floor] =\r\n            getSuccessfulExplorationsForFloor(state, floor) + 1;\r\n\r\n          return startExploration(state);\r\n        };\r\n      }\r\n    },\r\n  );\r\n\r\n  registerTimeTickListener(\r\n    \"PlayerHPRegen\",\r\n    (state: PlayerContextState, timeElapsedSec: number) => {\r\n      const explorationStatus = getExplorationStatus(state);\r\n\r\n      // This is necessary or else the player never dies because they regenerate HP\r\n      // in the same update\r\n      if (\r\n        explorationStatus == ExplorationStatus.Combat &&\r\n        getCurrentPlayerHP(state) <= 0\r\n      ) {\r\n        return state;\r\n      }\r\n\r\n      const hpRegenBase = calculatePlayerHPRegenPerSec(state);\r\n      let hpRegenMultiplier = 1.0;\r\n      if (explorationStatus != ExplorationStatus.Combat) {\r\n        hpRegenMultiplier = 10.0;\r\n      }\r\n      state = modifyPlayerCurrentHP(\r\n        state,\r\n        hpRegenBase * hpRegenMultiplier * timeElapsedSec,\r\n      );\r\n      return state;\r\n    },\r\n  );\r\n\r\n  addContextListener(\r\n    \"ContinueExplorationAfterReviving\",\r\n    (oldState, newState) => {\r\n      if (\r\n        getExplorationStatus(newState) == ExplorationStatus.Reviving &&\r\n        getCurrentPlayerHP(newState) == calculatePlayerMaxHP(newState)\r\n      ) {\r\n        return startExploration;\r\n      }\r\n    },\r\n  );\r\n}\r\n","import { PlayerContextState } from \"../PlayerContext\";\r\n\r\nexport type Hint = {\r\n  description: string;\r\n  isCompleted: (state: PlayerContextState) => boolean;\r\n\r\n  // Returns a number between 0 and 1 representing a percentage\r\n  progress?: (state: PlayerContextState) => number;\r\n};\r\n\r\nlet hintsDatabase: Hint[] = [];\r\n\r\nexport function clearAllHints(): void {\r\n  hintsDatabase = [];\r\n}\r\n\r\nexport function pushHint(hint: Hint): void {\r\n  hintsDatabase.push(hint);\r\n}\r\n\r\nexport function getFirstHint(state: PlayerContextState): Hint | undefined {\r\n  for (const idx in hintsDatabase) {\r\n    const hint = hintsDatabase[idx];\r\n    if (!hint.isCompleted(state)) {\r\n      return hint;\r\n    }\r\n  }\r\n}\r\n\r\nexport function getFirstHintIndex(\r\n  state: PlayerContextState,\r\n): string | undefined {\r\n  for (const idx in hintsDatabase) {\r\n    const hint = hintsDatabase[idx];\r\n    if (!hint.isCompleted(state)) {\r\n      return idx;\r\n    }\r\n  }\r\n}\r\n","import { ItemOccurrence, ItemAction } from \"./Item\";\r\nimport {\r\n  PlayerContextState,\r\n  EQUIPMENT_INITIAL_STATE,\r\n  PlayerContextTransform,\r\n} from \"../PlayerContext\";\r\nimport {\r\n  getAmountOfItem,\r\n  removeFromInventory,\r\n  getInventory,\r\n  calculateInventoryCap,\r\n  addToInventory,\r\n} from \"./Inventory\";\r\n\r\nimport bind from \"memoize-bind\";\r\n\r\nexport enum EquipmentSlot {\r\n  Hand = \"Hand\",\r\n  Body = \"Body\",\r\n  Accessory = \"Accessory\",\r\n}\r\n\r\nexport function canUnequipItem(\r\n  state: PlayerContextState,\r\n  slot: EquipmentSlot,\r\n): boolean {\r\n  const item = getEquippedItem(state, slot);\r\n  if (!item) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    getInventory(state).length >= calculateInventoryCap(state) &&\r\n    getAmountOfItem(item, state) <= 0\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function canEquipItem(\r\n  state: PlayerContextState,\r\n  slot: EquipmentSlot,\r\n  item: ItemOccurrence,\r\n): boolean {\r\n  if (getAmountOfItem(item, state) <= 0) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    getAmountOfItem(item, state) > 1 &&\r\n    getEquippedItem(state, slot) &&\r\n    !canUnequipItem(state, slot)\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function equipToSlot(\r\n  state: PlayerContextState,\r\n  slot: EquipmentSlot,\r\n  item: ItemOccurrence,\r\n): PlayerContextState {\r\n  if (!canEquipItem(state, slot, item)) {\r\n    return state;\r\n  }\r\n\r\n  state = removeFromInventory(item, 1, state);\r\n  state = unequipFromSlot(slot)(state);\r\n  if (!state.equipment) {\r\n    state.equipment = EQUIPMENT_INITIAL_STATE;\r\n  }\r\n  state.equipment[slot] = item;\r\n\r\n  return state;\r\n}\r\n\r\nexport function getEquippedItem(\r\n  state: PlayerContextState,\r\n  slot: EquipmentSlot,\r\n): ItemOccurrence | undefined {\r\n  return state.equipment?.[slot];\r\n}\r\n\r\nfunction unequipFromSlotImpl(\r\n  slot: EquipmentSlot,\r\n  state: PlayerContextState,\r\n): PlayerContextState {\r\n  if (!canUnequipItem(state, slot)) {\r\n    return state;\r\n  }\r\n\r\n  const item = getEquippedItem(state, slot);\r\n  if (!item) {\r\n    return state;\r\n  }\r\n\r\n  state = addToInventory(item, 1, state);\r\n  if (!state.equipment) {\r\n    state.equipment = EQUIPMENT_INITIAL_STATE;\r\n  }\r\n  state.equipment[slot] = undefined;\r\n\r\n  return state;\r\n}\r\n\r\nexport function unequipFromSlot(\r\n  this: any,\r\n  slot: EquipmentSlot,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return bind(unequipFromSlotImpl, this, slot);\r\n}\r\n\r\nexport function getUnequipAction(\r\n  state: PlayerContextState,\r\n  slot: EquipmentSlot,\r\n): ItemAction {\r\n  return {\r\n    description: \"Unequip\",\r\n    isEnabled: canUnequipItem(state, slot),\r\n    transform: unequipFromSlot(slot),\r\n  };\r\n}\r\n","// import { getAnalytics, logEvent } from \"firebase/analytics\";\r\n// import { initializeApp } from \"firebase/app\";\r\n\r\n// const firebaseConfig = {\r\n//   apiKey: \"AIzaSyDjH1kuc6_eCQyM91kGGXTVyW2uhLiztJc\",\r\n//   authDomain: \"magic-research.firebaseapp.com\",\r\n//   projectId: \"magic-research\",\r\n//   storageBucket: \"magic-research.appspot.com\",\r\n//   messagingSenderId: \"80276163359\",\r\n//   appId: \"1:80276163359:web:d68eca4ec6eb04db00be2a\",\r\n//   measurementId: \"G-E4V97V67HY\",\r\n// };\r\n\r\n// const app = initializeApp(firebaseConfig);\r\n// const webAnalytics = getAnalytics(app);\r\n\r\nexport async function sendAnalyticsEventAsync(\r\n  name: string,\r\n  params?: { [key: string]: any },\r\n) {\r\n  // Do nothing - Analytics has been removed\r\n  // await logEvent(webAnalytics, name, params);\r\n}\r\n","import Demo from \"../backend/Demo\";\r\nimport { getCurrentEnemy } from \"../backend/exploration/enemies/Enemies\";\r\nimport { Enemy } from \"../backend/exploration/enemies/Enemy\";\r\nimport {\r\n  getCurrentPlayerHP,\r\n  getExplorationStatus,\r\n} from \"../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../backend/exploration/ExplorationStatus\";\r\nimport { getFirstHintIndex } from \"../backend/hints/Hints\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../backend/items/Equipment\";\r\nimport { PlayerContextState } from \"../backend/PlayerContext\";\r\nimport { addContextListener } from \"../backend/PlayerContextListeners\";\r\nimport { registerRetirementListener } from \"../backend/Retire\";\r\nimport {\r\n  getSchoolLevel,\r\n  getUnlockedSchools,\r\n} from \"../backend/spells/ElementsAndSchools\";\r\nimport { Storyline, Storylines } from \"../backend/storylines/Storylines\";\r\nimport {\r\n  getSecondsPlayed,\r\n  getTotalSecondsPlayed,\r\n} from \"../backend/timetick/TotalTimePlayed\";\r\nimport { sendAnalyticsEventAsync } from \"./Analytics\";\r\n\r\nfunction getBaseLogData(state: PlayerContextState): { [key: string]: any } {\r\n  return {\r\n    primaryElement: state.primaryElement,\r\n    primarySchool: state.primarySchool,\r\n    secondsPlayed: getSecondsPlayed(state),\r\n    totalSecondsPlayed: getTotalSecondsPlayed(state),\r\n    currentPrimaryLevel:\r\n      state.primarySchool != null\r\n        ? getSchoolLevel(state, state.primarySchool)\r\n        : 0,\r\n    totalRetirements: state.global.totalTimesResetted,\r\n    currentHint: getFirstHintIndex(state),\r\n    isDemo: Demo.isDemo(),\r\n  };\r\n}\r\n\r\nexport async function logAnalyticsEventGeneric(\r\n  state: PlayerContextState,\r\n  eventName: string,\r\n  params: { [key: string]: any },\r\n) {\r\n  if (!state.global.allowAnalytics) {\r\n    return;\r\n  }\r\n  const baseLogData = getBaseLogData(state);\r\n  return await sendAnalyticsEventAsync(eventName, {\r\n    ...baseLogData,\r\n    ...params,\r\n  });\r\n}\r\n\r\nexport async function logStorylineCompleted(\r\n  state: PlayerContextState,\r\n  storyline: Storyline,\r\n) {\r\n  return await logAnalyticsEventGeneric(state, \"storyline_completed\", {\r\n    storyline: storyline.getId(),\r\n  });\r\n}\r\n\r\nexport async function logRetirement(state: PlayerContextState) {\r\n  return await logAnalyticsEventGeneric(state, \"retirement\", {});\r\n}\r\n\r\nexport async function logNewHint(state: PlayerContextState, hintIdx: string) {\r\n  return await logAnalyticsEventGeneric(state, \"new_hint_reached\", { hintIdx });\r\n}\r\n\r\nfunction getCombatDimensions(state: PlayerContextState) {\r\n  return {\r\n    ...Object.fromEntries(\r\n      getUnlockedSchools(state).map((school) => [\r\n        \"school\" + school + \"Level\",\r\n        getSchoolLevel(state, school),\r\n      ]),\r\n    ),\r\n    handEquipment: getEquippedItem(state, EquipmentSlot.Hand)?.itemId ?? \"none\",\r\n    bodyEquipment: getEquippedItem(state, EquipmentSlot.Body)?.itemId ?? \"none\",\r\n    accessoryEquipment:\r\n      getEquippedItem(state, EquipmentSlot.Accessory)?.itemId ?? \"none\",\r\n  };\r\n}\r\n\r\nexport async function logExplorationVictory(\r\n  state: PlayerContextState,\r\n  enemy: Enemy,\r\n) {\r\n  return await logAnalyticsEventGeneric(state, \"exploration_victory\", {\r\n    enemy: enemy.getId(),\r\n    ...getCombatDimensions(state),\r\n  });\r\n}\r\n\r\nexport async function logExplorationDefeat(\r\n  state: PlayerContextState,\r\n  enemy: Enemy,\r\n) {\r\n  return await logAnalyticsEventGeneric(state, \"exploration_defeat\", {\r\n    enemy: enemy.getId(),\r\n    ...getCombatDimensions(state),\r\n  });\r\n}\r\n\r\nexport function loadAnalytics() {\r\n  addContextListener(\"analytics_context_listener\", (oldState, newState) => {\r\n    const allStorylines = Storylines.getAll();\r\n    allStorylines.forEach((storyline) => {\r\n      if (!storyline.isCompleted(oldState) && storyline.isCompleted(newState)) {\r\n        logStorylineCompleted(newState, storyline);\r\n      }\r\n    });\r\n\r\n    if (\r\n      Number.parseInt(getFirstHintIndex(oldState) ?? \"0\") <\r\n      Number.parseInt(getFirstHintIndex(newState) ?? \"0\")\r\n    ) {\r\n      logNewHint(newState, getFirstHintIndex(newState) ?? \"0\");\r\n    }\r\n\r\n    if (\r\n      getExplorationStatus(oldState) === ExplorationStatus.Combat &&\r\n      getExplorationStatus(newState) !== ExplorationStatus.Combat\r\n    ) {\r\n      // We exitted combat\r\n      const enemy = getCurrentEnemy(oldState);\r\n      if (enemy.isBoss()) {\r\n        if (getCurrentPlayerHP(newState) > 0) {\r\n          logExplorationVictory(newState, enemy);\r\n        } else {\r\n          logExplorationDefeat(newState, enemy);\r\n        }\r\n      }\r\n    }\r\n  });\r\n  registerRetirementListener(\"analytics_retirement\", (state, isMock) => {\r\n    if (!isMock) {\r\n      logRetirement(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { getDocumentAsync } from \"expo-document-picker\";\r\nimport * as FileSystem from \"expo-file-system\";\r\nimport { StorageAccessFramework } from \"expo-file-system\";\r\nimport { openURL } from \"expo-linking\";\r\nimport { shareAsync } from \"expo-sharing\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { FlatList, Platform, StyleSheet, View } from \"react-native\";\r\nimport { Button, Card, Input, useThemeMode } from \"react-native-elements\";\r\nimport AudioManager from \"../audio/AudioManager\";\r\nimport {\r\n  explainTransformations,\r\n  TransformationType,\r\n} from \"../backend/calculation/Calculation\";\r\nimport { cleanup } from \"../backend/Cleanup\";\r\nimport { setGameEnding } from \"../backend/endings/Endings\";\r\nimport { debugRandomEvents } from \"../backend/events/autorandom/RandomEventTrigger\";\r\nimport { getAllGameEvents, triggerEvent } from \"../backend/events/Events\";\r\nimport { clearFlag, hasFlag, setFlag } from \"../backend/Flags\";\r\nimport {\r\n  GLOBAL_INITIAL_STATE,\r\n  PlayerContext,\r\n  PLAYER_INITIAL_STATE,\r\n} from \"../backend/PlayerContext\";\r\nimport { grantResource, Resource } from \"../backend/Resources\";\r\nimport {\r\n  loadBase64Data,\r\n  saveDataUnsafe,\r\n  serializeSaveData,\r\n} from \"../backend/SaveData\";\r\nimport { grantSchoolExp, School } from \"../backend/spells/ElementsAndSchools\";\r\nimport { grantTemporaryEffect } from \"../backend/timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../backend/timetick/TotalTimePlayed\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { logAnalyticsEventGeneric } from \"../utils/GameAnalytics\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function Debug() {\r\n  const events = getAllGameEvents();\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const eventButtons = useMemo(\r\n    () => (\r\n      <CategoryContainer title=\"Trigger events\">\r\n        <Button\r\n          title=\"Trigger random event\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              state.nextRandomEvent = 0;\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <FlatList\r\n          data={Object.values(events)}\r\n          renderItem={({ item }) => {\r\n            return (\r\n              <Button\r\n                key={item.getId()}\r\n                title={item.getId()}\r\n                onPress={() =>\r\n                  playerContextRef.current.apply(triggerEvent(item))\r\n                }\r\n              />\r\n            );\r\n          }}\r\n          keyExtractor={(event) => event.getId()}\r\n        />\r\n      </CategoryContainer>\r\n    ),\r\n    [JSON.stringify(Object.keys(events))],\r\n  );\r\n  const playerContextJson = JSON.stringify(\r\n    playerContext.exploration,\r\n    null,\r\n    \"\\t\",\r\n  );\r\n  const [newPlayerContextState, setNewPlayerContextState] = useState(\r\n    JSON.stringify(playerContext, null, \"  \"),\r\n  );\r\n  const overridePlayerContext = useCallback(async () => {\r\n    const deserializedJSON = JSON.parse(newPlayerContextState);\r\n    playerContextRef.current.overwrite((_oldState) => {\r\n      return deserializedJSON;\r\n    });\r\n    await saveDataUnsafe(deserializedJSON);\r\n  }, [newPlayerContextState]);\r\n\r\n  const [transformDebugInput, setTransformDebugInput] = useState(\"\");\r\n  const [transformDebugOutput, setTransformDebugOutput] = useState(\"\");\r\n\r\n  const calculate = useCallback(() => {\r\n    const tags = transformDebugInput.split(\",\");\r\n\r\n    const output = explainTransformations(tags, playerContextRef.current, 1.0);\r\n    const debugOutput = Object.keys(output)\r\n      .map((key) => {\r\n        const eachType = output[key as TransformationType].map(\r\n          ({ id, value }) =>\r\n            `${id}: ${\r\n              value != null\r\n                ? formatNumber(value, { showDecimals: true })\r\n                : \"undefined\"\r\n            }`,\r\n        );\r\n        return key + \": \" + eachType.join(\", \");\r\n      })\r\n      .join(\"\\n\");\r\n    setTransformDebugOutput(debugOutput);\r\n  }, [transformDebugInput, setTransformDebugOutput]);\r\n\r\n  const themeMode = useThemeMode();\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <CategoryContainer title=\"Other actions\">\r\n        <Button\r\n          title=\"Clear Quickbar\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              state.quickbar = [];\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Open Document Picker\"\r\n          onPress={async () => {\r\n            const result = await getDocumentAsync();\r\n            if (result.type == \"success\") {\r\n              const resultContents = await FileSystem.readAsStringAsync(\r\n                result.uri,\r\n              );\r\n              const unserialized = await loadBase64Data(resultContents);\r\n              console.warn(unserialized);\r\n            }\r\n            console.warn(result);\r\n          }}\r\n        />\r\n        <Button\r\n          title=\"Save To Local Storage (Web Only)\"\r\n          onPress={async () => {\r\n            const serializedData = await serializeSaveData(playerContext);\r\n            await openURL(\r\n              \"data:application/octet-stream;utf8,\" + serializedData,\r\n            );\r\n          }}\r\n        />\r\n        <Button\r\n          title=\"Save To Local Storage (iOS Only)\"\r\n          onPress={async () => {\r\n            const directoryUri =\r\n              (FileSystem.documentDirectory ?? \"\") + `/MagicResearch/`;\r\n            const dirInfo = await FileSystem.getInfoAsync(directoryUri);\r\n            console.warn(directoryUri);\r\n            if (!dirInfo.exists) {\r\n              const directoryCreateResults =\r\n                await FileSystem.makeDirectoryAsync(directoryUri, {\r\n                  intermediates: true,\r\n                });\r\n              console.warn(\"directoryCreated\", directoryCreateResults);\r\n            }\r\n            const uri = `${directoryUri}magic-research-save-${Date.now()}.sav`;\r\n            const serializedData = await serializeSaveData(\r\n              playerContextRef.current,\r\n            );\r\n            const results = await FileSystem.writeAsStringAsync(\r\n              uri,\r\n              serializedData,\r\n            );\r\n            const shareResults = await shareAsync(uri, {\r\n              dialogTitle: \"Send Magic Research Save to...\",\r\n              UTI: \"UTTypePlainText\",\r\n            });\r\n            console.warn(results, shareResults);\r\n          }}\r\n        />\r\n        <Button\r\n          title=\"Save To Local Storage (Android Only)\"\r\n          onPress={async () => {\r\n            // Gets SAF URI to the album\r\n            const directoryUri =\r\n              StorageAccessFramework.getUriForDirectoryInRoot(\"MagicResearch\");\r\n\r\n            // Requests permissions\r\n            const permissions =\r\n              await StorageAccessFramework.requestDirectoryPermissionsAsync(\r\n                directoryUri,\r\n              );\r\n            if (!permissions.granted) {\r\n              console.warn(permissions);\r\n              return;\r\n            }\r\n\r\n            const permittedUri = permissions.directoryUri;\r\n            const fileName = `magic-research-save-${Date.now()}.sav`;\r\n            const saveDataUri = await StorageAccessFramework.createFileAsync(\r\n              permittedUri,\r\n              fileName,\r\n              \"text/text\",\r\n            );\r\n            const serializedData = await serializeSaveData(\r\n              playerContextRef.current,\r\n            );\r\n            const results = await FileSystem.writeAsStringAsync(\r\n              saveDataUri,\r\n              serializedData,\r\n            );\r\n\r\n            // const directoryUri =\r\n            //   (FileSystem.documentDirectory ?? \"\") + `/MagicResearch/`;\r\n            // const dirInfo = await FileSystem.getInfoAsync(directoryUri);\r\n            // if (!dirInfo.exists) {\r\n            //   const directoryCreateResults =\r\n            //     await FileSystem.makeDirectoryAsync(directoryUri, {\r\n            //       intermediates: true,\r\n            //     });\r\n            //   console.warn(\"directoryCreated\", directoryCreateResults);\r\n            // }\r\n            // const uri = `${directoryUri}magic-research-save-${Date.now()}.sav`;\r\n            // const serializedData = await serializeSaveData(\r\n            //   playerContextRef.current,\r\n            // );\r\n            // const results = await FileSystem.writeAsStringAsync(\r\n            //   uri,\r\n            //   serializedData,\r\n            // );\r\n            // console.warn(results);\r\n          }}\r\n        />\r\n        <Button\r\n          title=\"Max All Storages\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              for (let resource in playerContextRef.current.resources) {\r\n                if (resource != \"TimePieces\") {\r\n                  state = grantResource(resource as Resource, 9999999)(state);\r\n                }\r\n              }\r\n              // state = grantResource(Resource.TimePieces, 9999999)(state);\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Grant Dummy Temp Effects\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              for (let i = 0; i < 10; i++) {\r\n                state = grantTemporaryEffect(\r\n                  \"dummy\" + i,\r\n                  \"Dummy effect \" + i,\r\n                  60,\r\n                  {\r\n                    isEnemyTemporaryEffect: true,\r\n                    combatOnly: true,\r\n                  },\r\n                )(state);\r\n              }\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Toggle Dark Mode\"\r\n          onPress={() =>\r\n            themeMode.setMode(themeMode.mode === \"light\" ? \"dark\" : \"light\")\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Grant 10k School Exp\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              state = grantSchoolExp(School.Conjuration, 10000)(state);\r\n              state = grantSchoolExp(School.Enchantment, 10000)(state);\r\n              state = grantSchoolExp(School.Illusion, 10000)(state);\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Play Sound\"\r\n          onPress={() => AudioManager.play(\"menuClick\")}\r\n        />\r\n        <Button\r\n          title=\"Warp 10 minutes\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              state.warpTimeSecs = 60 * 10;\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Artifically pass 10 minutes\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              state.skipAheadTime = 60 * 10;\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Toggle 2x speed\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              if (hasFlag(state, \"debug_2x_speed\")) {\r\n                state = clearFlag(\"debug_2x_speed\")(state);\r\n              } else {\r\n                state = setFlag(\"debug_2x_speed\")(state);\r\n              }\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Toggle 0x speed\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              if (hasFlag(state, \"debug_0x_speed\")) {\r\n                state = clearFlag(\"debug_0x_speed\")(state);\r\n              } else {\r\n                state = setFlag(\"debug_0x_speed\")(state);\r\n              }\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Toggle invincibility\"\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              if (hasFlag(state, \"debug_invincibility\")) {\r\n                state = clearFlag(\"debug_invincibility\")(state);\r\n              } else {\r\n                state = setFlag(\"debug_invincibility\")(state);\r\n              }\r\n              return state;\r\n            })\r\n          }\r\n        />\r\n        <Button\r\n          title=\"Send Test Analytics Event\"\r\n          onPress={() =>\r\n            logAnalyticsEventGeneric(\r\n              playerContextRef.current,\r\n              \"test_analytics_event\",\r\n              { testParam: Math.random() },\r\n            )\r\n          }\r\n        />\r\n        <Button\r\n          onPress={() => {\r\n            AsyncStorage.removeItem(\"PlayerContextState\");\r\n            AsyncStorage.removeItem(\"LastSaveSecondsPlayed\");\r\n          }}\r\n          title={\"Clear storage\"}\r\n          key=\"clearstorage\"\r\n        />\r\n        <Button\r\n          onPress={() => {\r\n            playerContext.apply((state) => {\r\n              state.global = GLOBAL_INITIAL_STATE;\r\n              return state;\r\n            });\r\n          }}\r\n          title={\"Reset global state\"}\r\n          key=\"resetglobal\"\r\n        />\r\n        <Button\r\n          onPress={() => {\r\n            playerContext.apply(cleanup);\r\n          }}\r\n          title={\"Clean up playercontext\"}\r\n          key=\"cleanupplayercontext\"\r\n        />\r\n        <Button\r\n          onPress={() => {\r\n            playerContext.apply((state) => {\r\n              return setGameEnding(state, \"standard_ending\");\r\n            });\r\n          }}\r\n          title={\"Trigger standard ending\"}\r\n          key=\"triggerending\"\r\n        />\r\n        <Button\r\n          onPress={() => {\r\n            playerContext.apply((state) => {\r\n              return PLAYER_INITIAL_STATE;\r\n            });\r\n            AsyncStorage.removeItem(\"PlayerContextState\");\r\n            AsyncStorage.removeItem(\"LastSaveSecondsPlayed\");\r\n          }}\r\n          title={\"Restart game (WARNING: ALSO DELETES SAVED DATA)\"}\r\n          key=\"restartgame\"\r\n        />\r\n      </CategoryContainer>\r\n      <Card>\r\n        <Card.Title>Multiplier Debugging</Card.Title>\r\n        <Text>Separate tags by commas</Text>\r\n        <Input\r\n          onChangeText={setTransformDebugInput}\r\n          value={transformDebugInput}\r\n          onSubmitEditing={calculate}\r\n        />\r\n        <Button onPress={calculate} title=\"Debug multipliers\" />\r\n        <Text>{transformDebugOutput}</Text>\r\n      </Card>\r\n      <Card>\r\n        <Card.Title>Random Event Debugging</Card.Title>\r\n        <Text>\r\n          Next event in{\" \"}\r\n          {formatNumber(\r\n            playerContext.nextRandomEvent - getSecondsPlayed(playerContext),\r\n          )}{\" \"}\r\n          sec\r\n        </Text>\r\n        <Text>\r\n          {JSON.stringify(debugRandomEvents(playerContext), null, \"\\t\")}\r\n        </Text>\r\n      </Card>\r\n      <Card>\r\n        <Card.Title>Player Context Editing</Card.Title>\r\n        <Input\r\n          multiline={true}\r\n          onChangeText={setNewPlayerContextState}\r\n          value={newPlayerContextState}\r\n          style={{\r\n            height: 400,\r\n            fontFamily: Platform.select({\r\n              android: \"monospace\",\r\n              default: \"Courier New\",\r\n            }),\r\n          }}\r\n        />\r\n        <Button\r\n          onPress={overridePlayerContext}\r\n          title={\"Set player context\"}\r\n          key=\"setPlayerContext\"\r\n        />\r\n      </Card>\r\n\r\n      <Card>\r\n        <Card.Title>Trigger Events</Card.Title>\r\n        {eventButtons}\r\n      </Card>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import moment from \"moment\";\r\nimport React, { useContext, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { getEnding, getEndingData } from \"../backend/endings/Endings\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport { Storylines } from \"../backend/storylines/Storylines\";\r\nimport { formatNumber, formatTimeLong } from \"../utils/FormattingUtils\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\ntype RowProps = {\r\n  caption: string;\r\n  value: string;\r\n};\r\n\r\nfunction Row(props: RowProps) {\r\n  return (\r\n    <View style={styles.row}>\r\n      <View style={styles.rowCaption}>\r\n        <Text numberOfLines={2}>{props.caption}</Text>\r\n      </View>\r\n      <Text style={styles.valueText}>{props.value}</Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default function Ending() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const endingData = getEndingData(playerContext);\r\n  if (endingData == null) {\r\n    return <View />;\r\n  }\r\n\r\n  const ending = getEnding(endingData.endingId);\r\n\r\n  const totalDuration = moment.duration(endingData.totalTimePlayed, \"seconds\");\r\n  const thisRunDuration = moment.duration(\r\n    endingData.totalTimePlayedThisRun,\r\n    \"seconds\",\r\n  );\r\n  const totalRealDuration =\r\n    endingData.totalRealWorldTimePlayed != null\r\n      ? moment.duration(endingData.totalRealWorldTimePlayed, \"seconds\")\r\n      : null;\r\n\r\n  const allStorylines = Storylines.getAll();\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>{ending?.title}</Text>\r\n      <View style={styles.explanation}>\r\n        <Markdown style={styles.explanationText}>\r\n          {ending?.description}\r\n        </Markdown>\r\n      </View>\r\n      <View style={styles.dividerContainer}>\r\n        <Divider />\r\n      </View>\r\n      <View style={styles.congratsContainer}>\r\n        <Text h1>Congratulations!</Text>\r\n        <Text h2>You have cleared Magic Research!</Text>\r\n      </View>\r\n      <View>\r\n        <Row\r\n          caption=\"Primary School and Element:\"\r\n          value={`${endingData.primarySchool} - ${endingData.primaryElement}`}\r\n        />\r\n        <Row\r\n          caption=\"Total In-Game Time Played:\"\r\n          value={formatTimeLong(totalDuration)}\r\n        />\r\n        <Row\r\n          caption=\"In-Game Time Played (This Run):\"\r\n          value={formatTimeLong(thisRunDuration)}\r\n        />\r\n        <Row\r\n          caption=\"Total Real World Time Played:\"\r\n          value={\r\n            totalRealDuration != null ? formatTimeLong(totalRealDuration) : \"-\"\r\n          }\r\n        />\r\n        <Row\r\n          caption=\"Total Retirements:\"\r\n          value={playerContext.global.totalTimesResetted.toString()}\r\n        />\r\n        <Row\r\n          caption=\"Maximum Primary Level Obtained:\"\r\n          value={endingData.mpl.toString()}\r\n        />\r\n        <Row\r\n          caption=\"Primary School Level on Game Beaten:\"\r\n          value={endingData.primarySchoolLevelOnEnding.toString()}\r\n        />\r\n        <Row\r\n          caption=\"Global Research Multiplier:\"\r\n          value={`${formatNumber(endingData.researchMultiplier, {\r\n            showDecimals: true,\r\n          })}x`}\r\n        />\r\n        <Row\r\n          caption=\"Global Production Multiplier:\"\r\n          value={`${formatNumber(endingData.productionMultiplier, {\r\n            showDecimals: true,\r\n          })}x`}\r\n        />\r\n        <Row\r\n          caption=\"Total Completed Storylines:\"\r\n          value={`${endingData.completedStorylines} / ${allStorylines.length}`}\r\n        />\r\n        <Row\r\n          caption=\"Storyline Completion Percentage:\"\r\n          value={\r\n            formatNumber(\r\n              (100 * endingData.completedStorylines) / allStorylines.length,\r\n            ) + \"%\"\r\n          }\r\n        />\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    width: \"100%\",\r\n  },\r\n  explanationText: {\r\n    width: \"100%\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginBottom: 4,\r\n  },\r\n  valueText: {\r\n    minWidth: 100,\r\n    textAlign: \"right\",\r\n    fontWeight: \"bold\",\r\n    marginLeft: 8,\r\n  },\r\n  dividerContainer: {\r\n    marginTop: 32,\r\n    marginBottom: 24,\r\n  },\r\n  congratsContainer: {\r\n    alignItems: \"center\",\r\n    marginBottom: 16,\r\n  },\r\n  rowCaption: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { EvilIcons, MaterialIcons } from \"@expo/vector-icons\";\r\nimport moment from \"moment\";\r\nimport React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  FlatList,\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableNativeFeedback,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\nimport { ListItem, useTheme } from \"react-native-elements\";\r\nimport { Gesture, GestureDetector } from \"react-native-gesture-handler\";\r\nimport ProgressBar from \"react-native-progress/Bar\";\r\nimport {\r\n  addOccurrenceToQueue,\r\n  EventOccurrenceData,\r\n  getEventMessageById,\r\n} from \"../../backend/events/Events\";\r\nimport { getFirstHint } from \"../../backend/hints/Hints\";\r\nimport {\r\n  PlayerContext,\r\n  PLAYER_INITIAL_STATE,\r\n} from \"../../backend/PlayerContext\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport Divider from \"../utility/Divider\";\r\nimport { createGestureHandler } from \"../utility/Miscellaneous\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nfunction EventListItem(props: {\r\n  item: EventOccurrenceData;\r\n  onPress: () => void;\r\n}) {\r\n  if (!props.item.currentMessageId) {\r\n    return null;\r\n  }\r\n  const currentMessageData = getEventMessageById(props.item.currentMessageId);\r\n  if (!currentMessageData) {\r\n    return null;\r\n  }\r\n  const title = currentMessageData.getTitle(props.item?.params);\r\n  const playerContext = useContext(PlayerContext);\r\n  const description = useMemo(\r\n    () =>\r\n      moment(props.item.timestamp).format(\"h:mm A\") +\r\n      \" - \" +\r\n      currentMessageData.getDescription(\r\n        PLAYER_INITIAL_STATE,\r\n        props.item?.params,\r\n      ),\r\n    [props.item.timestamp],\r\n  );\r\n  const theme = useTheme();\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        <ListItem\r\n          onPress={props.onPress}\r\n          Component={Platform.select<any>({\r\n            android: TouchableNativeFeedback,\r\n            default: TouchableOpacity,\r\n          })}\r\n        >\r\n          <ListItem.Content>\r\n            <View style={styles.eventTitleContainer}>\r\n              {currentMessageData.isActionable(\r\n                playerContext,\r\n                props.item?.params,\r\n              ) && (\r\n                <View style={styles.actionableIcon}>\r\n                  <EvilIcons\r\n                    name=\"exclamation\"\r\n                    type=\"evilicon\"\r\n                    size={24}\r\n                    color={theme.theme.colors.black}\r\n                  />\r\n                </View>\r\n              )}\r\n              <ListItem.Title style={styles.titleText}>{title}</ListItem.Title>\r\n            </View>\r\n            <Text numberOfLines={1}>{description}</Text>\r\n          </ListItem.Content>\r\n          <ListItem.Chevron\r\n            name={currentMessageData.isTerminal() ? \"check\" : \"chevron-right\"}\r\n            type=\"material\"\r\n          />\r\n        </ListItem>\r\n        <Divider />\r\n      </View>\r\n    );\r\n  }, [\r\n    title,\r\n    description,\r\n    currentMessageData.isTerminal(),\r\n    currentMessageData.isActionable(playerContext, props.item?.params),\r\n    theme,\r\n  ]);\r\n}\r\n\r\nconst EventListItemMemoized = React.memo(\r\n  EventListItem,\r\n  (prevProps, nextProps) => {\r\n    return prevProps.item.currentMessageId === nextProps.item.currentMessageId;\r\n  },\r\n);\r\n\r\nexport function EventList(props: {\r\n  style?: any;\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const keyExtractor = useCallback(\r\n    (item: EventOccurrenceData, index: number) => item.eventOccurrenceId,\r\n    [],\r\n  );\r\n\r\n  const renderItem = useCallback((props: any) => {\r\n    const onPress = () => {\r\n      playerContextRef.current.apply(\r\n        addOccurrenceToQueue(props.item.eventOccurrenceId),\r\n      );\r\n    };\r\n    return <EventListItemMemoized {...props} onPress={onPress} />;\r\n  }, []);\r\n\r\n  const sortedEvents = Object.values(playerContext.eventOccurrences).sort(\r\n    (a, b) => b.timestamp - a.timestamp,\r\n  );\r\n\r\n  const stringifiedEvents = useMemo(\r\n    () => JSON.stringify(playerContext.eventOccurrences),\r\n    [sortedEvents],\r\n  );\r\n\r\n  const terminalEvents = useMemo(\r\n    () =>\r\n      sortedEvents\r\n        .filter((event) => {\r\n          return (\r\n            event.currentMessageId &&\r\n            getEventMessageById(event.currentMessageId).isTerminal()\r\n          );\r\n        })\r\n        .slice(0, 20),\r\n    [stringifiedEvents],\r\n  );\r\n  const ongoingEvents = useMemo(\r\n    () =>\r\n      sortedEvents.filter((event) => {\r\n        return (\r\n          event.currentMessageId &&\r\n          !getEventMessageById(event.currentMessageId).isTerminal()\r\n        );\r\n      }),\r\n    [stringifiedEvents],\r\n  );\r\n\r\n  const eventCategories = useMemo(() => {\r\n    const eventCategories = [];\r\n    if (ongoingEvents.length > 0) {\r\n      eventCategories.push({ title: \"Ongoing\", data: ongoingEvents });\r\n    }\r\n    if (terminalEvents.length > 0) {\r\n      eventCategories.push({ title: \"Finished\", data: terminalEvents });\r\n    }\r\n    return eventCategories;\r\n  }, [ongoingEvents, terminalEvents]);\r\n\r\n  const currentHint = getFirstHint(playerContext);\r\n\r\n  const categoryKeyExtractor = useCallback(\r\n    (item: { title: string; data: EventOccurrenceData[] }, index: number) =>\r\n      item.title,\r\n    [],\r\n  );\r\n\r\n  const categoryRenderItem = useCallback(\r\n    (props: any) => {\r\n      return (\r\n        <CategoryContainer\r\n          titleStyle={styles.categoryTitle}\r\n          title={props.item.title}\r\n        >\r\n          <FlatList\r\n            keyExtractor={keyExtractor}\r\n            data={props.item.data}\r\n            renderItem={renderItem}\r\n          />\r\n        </CategoryContainer>\r\n      );\r\n    },\r\n    [keyExtractor, renderItem],\r\n  );\r\n\r\n  const swipeHandlerGesture = useMemo(\r\n    () => createGestureHandler(props.onSwipeLeft, props.onSwipeRight),\r\n    [props.onSwipeLeft, props.onSwipeRight],\r\n  );\r\n  const nativeGesture = useMemo(() => Gesture.Native(), []);\r\n  const compositeGesture = useMemo(\r\n    () => Gesture.Simultaneous(swipeHandlerGesture, nativeGesture),\r\n    [swipeHandlerGesture, nativeGesture],\r\n  );\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={props.style}>\r\n        <View style={styles.emptyTitleContainer}>\r\n          <MaterialIcons\r\n            size={24}\r\n            name=\"notifications\"\r\n            style={styles.titleIcon}\r\n            color={theme.theme.colors.black}\r\n          />\r\n          <Text h2>Events</Text>\r\n        </View>\r\n        <View style={styles.hintContainer}>\r\n          <CategoryContainer\r\n            titleStyle={styles.categoryTitle}\r\n            title=\"Current Goal\"\r\n          >\r\n            <View style={styles.hintContents}>\r\n              <Text style={styles.hintContentsText}>\r\n                {currentHint?.description}!\r\n              </Text>\r\n              {currentHint?.progress && (\r\n                <ProgressBar\r\n                  progress={currentHint?.progress(playerContext)}\r\n                  width={null}\r\n                  useNativeDriver={true}\r\n                  style={styles.hintProgress}\r\n                />\r\n              )}\r\n            </View>\r\n          </CategoryContainer>\r\n        </View>\r\n        <GestureDetector key=\"eventGesture\" gesture={compositeGesture}>\r\n          <FlatList\r\n            keyExtractor={categoryKeyExtractor}\r\n            data={eventCategories}\r\n            renderItem={categoryRenderItem}\r\n          />\r\n        </GestureDetector>\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      categoryKeyExtractor,\r\n      categoryRenderItem,\r\n      eventCategories,\r\n      currentHint,\r\n      currentHint?.progress?.(playerContext),\r\n      compositeGesture,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  categoryTitle: {\r\n    marginLeft: 8,\r\n  },\r\n  emptyTitleContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  titleIcon: {\r\n    paddingRight: 8,\r\n    height: 28,\r\n  },\r\n  hintContents: {\r\n    marginLeft: 16,\r\n    marginTop: 8,\r\n    paddingRight: 32,\r\n  },\r\n  hintContentsText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  hintProgress: {\r\n    marginTop: 4,\r\n  },\r\n  hintContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  eventTitleContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  titleText: {\r\n    flex: 1,\r\n  },\r\n  actionableIcon: {\r\n    marginRight: 4,\r\n  },\r\n});\r\n","import React, { useEffect, useMemo, useRef } from \"react\";\r\nimport { Animated, StyleSheet, TouchableWithoutFeedback } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { EventList } from \"./EventList\";\r\n\r\ntype Props = {\r\n  visible: boolean;\r\n  onBackgroundPress: () => void;\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n};\r\n\r\nexport function EventMenu(props: Props) {\r\n  const positionAnim = useRef(\r\n    new Animated.Value(props.visible ? 0 : 300),\r\n  ).current;\r\n\r\n  const opacityAnim = useRef(\r\n    new Animated.Value(props.visible ? 0.5 : 0),\r\n  ).current;\r\n\r\n  useEffect(() => {\r\n    if (props.visible) {\r\n      Animated.timing(positionAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0.5,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    } else {\r\n      Animated.timing(positionAnim, {\r\n        toValue: 300,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    }\r\n  }, [props.visible]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <>\r\n        <TouchableWithoutFeedback onPress={props.onBackgroundPress}>\r\n          <Animated.View\r\n            style={[styles.backdrop, { opacity: opacityAnim }]}\r\n            pointerEvents={props.visible ? \"auto\" : \"none\"}\r\n          />\r\n        </TouchableWithoutFeedback>\r\n        <Animated.View\r\n          style={[\r\n            styles.container,\r\n            {\r\n              transform: [{ translateX: positionAnim }],\r\n              backgroundColor: theme.theme.colors.background,\r\n            },\r\n          ]}\r\n        >\r\n          <EventList\r\n            style={styles.eventList}\r\n            onSwipeLeft={props.onSwipeLeft}\r\n            onSwipeRight={props.onSwipeRight}\r\n          />\r\n        </Animated.View>\r\n      </>\r\n    ),\r\n    [\r\n      opacityAnim,\r\n      positionAnim,\r\n      props.visible,\r\n      theme,\r\n      props.onSwipeLeft,\r\n      props.onSwipeRight,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  backdrop: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    backgroundColor: \"#000\",\r\n  },\r\n  backdropTouchable: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n  },\r\n  container: {\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"stretch\",\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: 300,\r\n    right: 0,\r\n    top: 0,\r\n  },\r\n  eventList: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, useWindowDimensions, View } from \"react-native\";\r\nimport { Overlay, useTheme } from \"react-native-elements\";\r\nimport { color } from \"react-native-elements/dist/config\";\r\nimport {\r\n  EventOccurrenceData,\r\n  executeEventOccurrenceAction,\r\n  getEventMessageById,\r\n  getEventOccurrenceById,\r\n  removeOccurrenceFromQueue,\r\n} from \"../../backend/events/Events\";\r\nimport { EventMessage } from \"../../backend/events/GameEvent\";\r\nimport { PlayerContext, PlayerContextState } from \"../../backend/PlayerContext\";\r\nimport {\r\n  addContextListener,\r\n  clearContextListener,\r\n} from \"../../backend/PlayerContextListeners\";\r\nimport { getUICommands } from \"../../backend/UICommands\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport { disabledColorByTheme } from \"../utility/Miscellaneous\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function EventOverlay() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const [currentEventOccurrenceId, setCurrentEventOccurrenceId] = useState(\r\n    undefined as string | undefined,\r\n  );\r\n\r\n  const processUICommand = useCallback((uiCommand: string) => {\r\n    if (uiCommand == \"closeEventOverlay\") {\r\n      setCurrentEventOccurrenceId(undefined);\r\n      setCurrentLookbackMessageId(\"\");\r\n    }\r\n  }, []);\r\n\r\n  const processUICommands = useCallback((state: PlayerContextState) => {\r\n    const uiCommands = getUICommands(state);\r\n    uiCommands.forEach(processUICommand);\r\n    state.uiCommands = uiCommands.filter(\r\n      (uiCommand) => uiCommand != \"closeEventOverlay\",\r\n    );\r\n    return state;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    addContextListener(\"eventOverlayUiCommand\", (oldState, newState) => {\r\n      const uiCommands = getUICommands(newState);\r\n      if (uiCommands.length > 0) {\r\n        return (state) => processUICommands(state);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const currentEventOccurrenceIdRef = useRef(currentEventOccurrenceId);\r\n  currentEventOccurrenceIdRef.current = currentEventOccurrenceId;\r\n\r\n  const [currentLookbackMessageId, setCurrentLookbackMessageId] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const contextListener = addContextListener(\r\n      \"event_overlay\",\r\n      (oldState, newState) => {\r\n        if (\r\n          newState.eventQueue.length > 0 &&\r\n          (!currentEventOccurrenceIdRef.current ||\r\n            getEventOccurrenceById(\r\n              newState,\r\n              currentEventOccurrenceIdRef.current,\r\n            ) == null)\r\n        ) {\r\n          // Get a new event\r\n          let newEventOccurrenceId = null;\r\n          const eventsToRemoveFromQueue: string[] = [];\r\n\r\n          do {\r\n            newEventOccurrenceId = newState.eventQueue.pop();\r\n            if (newEventOccurrenceId != null) {\r\n              eventsToRemoveFromQueue.push(newEventOccurrenceId);\r\n              const occurrence = getEventOccurrenceById(\r\n                newState,\r\n                newEventOccurrenceId,\r\n              );\r\n              const message = occurrence?.currentMessageId;\r\n              if (occurrence != null && message != null) {\r\n                if (\r\n                  (occurrence?.timestampSecondsPlayed ?? 0) <= 0.1 &&\r\n                  getEventMessageById(message)?.isTerminal()\r\n                ) {\r\n                  newEventOccurrenceId = null;\r\n                }\r\n              }\r\n            }\r\n          } while (\r\n            newState.eventQueue.length > 0 &&\r\n            newEventOccurrenceId == null\r\n          );\r\n\r\n          if (newEventOccurrenceId) {\r\n            setCurrentEventOccurrenceId(newEventOccurrenceId);\r\n            setCurrentLookbackMessageId(\"\");\r\n\r\n            // This next line is required because otherwise, if many events are\r\n            // in the queue before the next rerender, we will swallow them\r\n            currentEventOccurrenceIdRef.current = newEventOccurrenceId;\r\n          }\r\n\r\n          return (state) =>\r\n            eventsToRemoveFromQueue.reduce(\r\n              (accumulatedState, eventToRemove) =>\r\n                removeOccurrenceFromQueue(eventToRemove)(accumulatedState),\r\n              state,\r\n            );\r\n        }\r\n      },\r\n    );\r\n    return () => clearContextListener(\"event_overlay\");\r\n  }, []);\r\n\r\n  let eventOccurrence: EventOccurrenceData | null | undefined = null,\r\n    eventMessage: EventMessage | null | undefined = null,\r\n    optionDescriptions = null,\r\n    totalText: string | null = null,\r\n    messageInLookbackIdx: number = -1,\r\n    messageLength: number = 0,\r\n    totalMessageCount: number = -1;\r\n  if (currentEventOccurrenceId != null) {\r\n    eventOccurrence = getEventOccurrenceById(\r\n      playerContext,\r\n      currentEventOccurrenceId,\r\n    );\r\n    messageInLookbackIdx =\r\n      eventOccurrence?.messageHistory?.findIndex(\r\n        (value) => value === currentLookbackMessageId,\r\n      ) ?? -1;\r\n    if (messageInLookbackIdx < 0) {\r\n      eventMessage = (eventOccurrence?.currentMessageId &&\r\n        getEventMessageById(eventOccurrence.currentMessageId)) as EventMessage;\r\n    } else {\r\n      eventMessage = getEventMessageById(\r\n        currentLookbackMessageId as string,\r\n      ) as EventMessage;\r\n    }\r\n    if (eventMessage) {\r\n      optionDescriptions = eventMessage\r\n        .getAllowedOptions(playerContext, eventOccurrence?.params)\r\n        .map((option) => option.description + option.isEnabled);\r\n    }\r\n    messageLength = eventOccurrence?.messageHistory?.length ?? 0;\r\n    if (messageLength > 0) {\r\n      totalMessageCount = messageLength + 1;\r\n      const idxToDisplay =\r\n        messageInLookbackIdx >= 0\r\n          ? messageInLookbackIdx + 1\r\n          : totalMessageCount;\r\n      totalText = `(${idxToDisplay}/${totalMessageCount})`;\r\n    }\r\n  }\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const theme = useTheme();\r\n\r\n  const disabledIconColor = disabledColorByTheme(theme.theme);\r\n\r\n  const onRequestClose = useCallback(() => {\r\n    setCurrentEventOccurrenceId(undefined);\r\n    setCurrentLookbackMessageId(\"\");\r\n  }, [setCurrentLookbackMessageId, setCurrentEventOccurrenceId]);\r\n\r\n  return useMemo(() => {\r\n    if (currentEventOccurrenceId && eventMessage) {\r\n      const disableBackArrow =\r\n        messageInLookbackIdx === 0 || messageLength === 0;\r\n      const disableForwardArrow =\r\n        messageInLookbackIdx < 0 ||\r\n        messageInLookbackIdx > totalMessageCount - 2;\r\n      return (\r\n        <Overlay\r\n          onRequestClose={onRequestClose}\r\n          isVisible={true}\r\n          overlayStyle={[\r\n            styles.overlay,\r\n            {\r\n              maxWidth: Math.min(width - 16, 640),\r\n              backgroundColor: theme.theme.colors.background,\r\n            },\r\n          ]}\r\n          backdropStyle={Platform.select({\r\n            default: {},\r\n            web: {\r\n              backgroundColor: color(theme.theme.colors.black),\r\n              opacity: Platform.select({ default: 1.0, web: 0.4 }),\r\n            },\r\n          })}\r\n        >\r\n          <View style={styles.overlayContainer}>\r\n            <Button\r\n              icon={<MaterialIcons name=\"close\" size={24} color=\"white\" />}\r\n              containerStyle={styles.overlayCloseButton}\r\n              style={styles.overlayCloseButtonInner}\r\n              iconContainerStyle={styles.overlayCloseButtonInner}\r\n              buttonStyle={styles.overlayCloseButtonInner}\r\n              onPress={() => {\r\n                setCurrentEventOccurrenceId(undefined);\r\n                setCurrentLookbackMessageId(\"\");\r\n              }}\r\n            />\r\n\r\n            <View style={styles.titleContainer}>\r\n              <View\r\n                style={[\r\n                  styles.titleTextContainer,\r\n                  { maxWidth: messageLength > 0 ? width - 164 : width - 68 },\r\n                ]}\r\n              >\r\n                <Text h1>\r\n                  {eventMessage.getTitle(eventOccurrence?.params)} {totalText}{\" \"}\r\n                </Text>\r\n              </View>\r\n              {messageLength > 0 && (\r\n                <View style={styles.historyContainer}>\r\n                  <Button\r\n                    disabled={disableBackArrow}\r\n                    containerStyle={styles.historyButton}\r\n                    style={styles.overlayCloseButtonInner}\r\n                    iconContainerStyle={styles.overlayCloseButtonInner}\r\n                    buttonStyle={styles.overlayCloseButtonInner}\r\n                    icon={\r\n                      <MaterialIcons\r\n                        name=\"arrow-back\"\r\n                        size={24}\r\n                        color={disableBackArrow ? disabledIconColor : \"white\"}\r\n                      />\r\n                    }\r\n                    onPress={() =>\r\n                      setCurrentLookbackMessageId(\r\n                        messageInLookbackIdx > 0\r\n                          ? eventOccurrence?.messageHistory?.[\r\n                              messageInLookbackIdx - 1\r\n                            ] ?? \"\"\r\n                          : eventOccurrence?.messageHistory?.[\r\n                              totalMessageCount - 2\r\n                            ] ?? \"\",\r\n                      )\r\n                    }\r\n                  />\r\n                  <Button\r\n                    disabled={disableForwardArrow}\r\n                    containerStyle={styles.historyButton}\r\n                    style={styles.overlayCloseButtonInner}\r\n                    iconContainerStyle={styles.overlayCloseButtonInner}\r\n                    buttonStyle={styles.overlayCloseButtonInner}\r\n                    icon={\r\n                      <MaterialIcons\r\n                        name=\"arrow-forward\"\r\n                        size={24}\r\n                        color={\r\n                          disableForwardArrow ? disabledIconColor : \"white\"\r\n                        }\r\n                      />\r\n                    }\r\n                    onPress={() =>\r\n                      setCurrentLookbackMessageId(\r\n                        messageInLookbackIdx < totalMessageCount - 2\r\n                          ? eventOccurrence?.messageHistory?.[\r\n                              messageInLookbackIdx + 1\r\n                            ] ?? \"\"\r\n                          : \"\",\r\n                      )\r\n                    }\r\n                  />\r\n                </View>\r\n              )}\r\n            </View>\r\n            <View style={styles.description}>\r\n              <Markdown>\r\n                {eventMessage.getDescription(\r\n                  playerContext,\r\n                  eventOccurrence?.params,\r\n                )}\r\n              </Markdown>\r\n            </View>\r\n            {messageInLookbackIdx < 0 && (\r\n              <View style={styles.optionRow}>\r\n                {eventMessage\r\n                  .getAllowedOptions(playerContext, eventOccurrence?.params)\r\n                  .map((option) => {\r\n                    const optionPress = () => {\r\n                      if (!option.nextMessage && !option.transform) {\r\n                        setCurrentEventOccurrenceId(undefined);\r\n                        setCurrentLookbackMessageId(\"\");\r\n                        return;\r\n                      }\r\n                      playerContext.apply(\r\n                        executeEventOccurrenceAction(\r\n                          currentEventOccurrenceId,\r\n                          option,\r\n                        ),\r\n                      );\r\n                    };\r\n                    return (\r\n                      <Button\r\n                        key={option.description}\r\n                        onPress={optionPress}\r\n                        title={option.description}\r\n                        containerStyle={[\r\n                          styles.optionButton,\r\n                          { maxWidth: Math.min(width - 70, 586) },\r\n                        ]}\r\n                        disabled={!option.isEnabled}\r\n                      />\r\n                    );\r\n                  })}\r\n              </View>\r\n            )}\r\n          </View>\r\n        </Overlay>\r\n      );\r\n    }\r\n    return null;\r\n  }, [\r\n    JSON.stringify(eventOccurrence),\r\n    optionDescriptions?.join(\",\"),\r\n    messageInLookbackIdx,\r\n    currentLookbackMessageId,\r\n    width,\r\n    theme,\r\n    disabledIconColor,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  overlay: {\r\n    alignSelf: \"center\",\r\n    marginHorizontal: 16,\r\n    maxWidth: 640,\r\n  },\r\n  overlayContainer: {\r\n    padding: 8,\r\n  },\r\n  historyButton: {\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n    marginLeft: 8,\r\n  },\r\n  overlayCloseButton: {\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n    position: \"absolute\",\r\n    right: -16,\r\n    top: -16,\r\n  },\r\n  overlayCloseButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n  },\r\n  titleContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  titleTextContainer: {},\r\n  historyContainer: {\r\n    marginHorizontal: 8,\r\n    flexDirection: \"row\",\r\n    width: 80,\r\n  },\r\n  description: {\r\n    marginVertical: 8,\r\n  },\r\n  optionRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"space-around\",\r\n  },\r\n  optionButton: {\r\n    marginTop: 8,\r\n    maxWidth: 600,\r\n  },\r\n});\r\n","import { useTheme } from \"react-native-elements\";\r\nimport RNProgressBar from \"react-native-progress/Bar\";\r\n\r\nexport function ProgressBar(props: any) {\r\n  const theme = useTheme();\r\n  // @ts-ignore The progressBar is not part of react-native-elements\r\n  return <RNProgressBar color={theme.theme.colors.progressBar} {...props} />;\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  getCurrentEnemyAction,\r\n  getEnemyActionProgress,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function EnemyActionDisplay() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const currentEnemyAction = getCurrentEnemyAction(playerContext);\r\n  const progress = getEnemyActionProgress(playerContext);\r\n  return useMemo(() => {\r\n    if (!currentEnemyAction) {\r\n      return (\r\n        <View>\r\n          <Text h3>-</Text>\r\n          <ProgressBar progress={0} useNativeDriver={true} />\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"attack\" style={styles.icon} />\r\n        <View style={styles.progressBarContainer}>\r\n          <Markdown>{currentEnemyAction.name}</Markdown>\r\n          <ProgressBar\r\n            progress={progress}\r\n            useNativeDriver={true}\r\n            width={null}\r\n          />\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [currentEnemyAction?.name, progress]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 4,\r\n  },\r\n  progressBarContainer: {\r\n    flex: 1,\r\n    minHeight: 32,\r\n  },\r\n});\r\n","import React, { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport { Animated, Platform, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport ProgressBar from \"react-native-progress/Bar\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport { CombatActionResult, PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { getSecondsPlayed } from \"../../backend/timetick/TotalTimePlayed\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nfunction CombatActionResultDisplay(props: {\r\n  action: CombatActionResult;\r\n  delay: number;\r\n}) {\r\n  let auxText = null,\r\n    auxTextStyle = null;\r\n  if (props.action != undefined) {\r\n    if (!props.action.isHit) {\r\n      auxText = \"Miss!\";\r\n    } else {\r\n      auxText =\r\n        (props.action.damage > 0 ? \"-\" : \"\") +\r\n        formatNumber(Math.abs(props.action.damage), {\r\n          showDecimals: false,\r\n        }) +\r\n        (props.action.isCrit ? \"!\" : \"\");\r\n      auxTextStyle = props.action.isCrit\r\n        ? styles.auxTextCritical\r\n        : props.action.damage > 0\r\n        ? styles.auxTextDamage\r\n        : styles.auxTextHealing;\r\n    }\r\n  }\r\n\r\n  const damageAnim = useRef(new Animated.Value(0)).current;\r\n  const opacityAnim = useRef(new Animated.Value(0)).current;\r\n  useEffect(() => {\r\n    damageAnim.setValue(0);\r\n    Animated.sequence([\r\n      Animated.delay(props.delay),\r\n      Animated.spring(damageAnim, {\r\n        toValue: -16,\r\n        useNativeDriver: true,\r\n        bounciness: 0,\r\n      }),\r\n    ]).start();\r\n  }, [props.action?.id]);\r\n  useEffect(() => {\r\n    Animated.sequence([\r\n      Animated.delay(props.delay),\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 1,\r\n        useNativeDriver: true,\r\n        duration: 0,\r\n      }),\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0,\r\n        useNativeDriver: true,\r\n        duration: 800,\r\n      }),\r\n    ]).start();\r\n  }, [props.action?.id]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return auxText ? (\r\n    <Animated.View\r\n      style={[\r\n        styles.auxTextContainer,\r\n        { transform: [{ translateY: damageAnim }], opacity: opacityAnim },\r\n      ]}\r\n    >\r\n      <Text\r\n        style={[\r\n          styles.auxText,\r\n          { color: theme.theme.colors.black },\r\n          auxTextStyle,\r\n        ]}\r\n      >\r\n        {auxText}\r\n      </Text>\r\n    </Animated.View>\r\n  ) : (\r\n    <View />\r\n  );\r\n}\r\n\r\nfunction HPBarNonMemo(props: {\r\n  empty: boolean;\r\n  current: number;\r\n  max: number;\r\n  actionTarget: AttackTarget;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const mountTime = useRef(getSecondsPlayed(playerContext));\r\n\r\n  const actions = playerContext.exploration.actionResultQueue.filter(\r\n    (result) =>\r\n      result.target === props.actionTarget && result.time > mountTime.current,\r\n  );\r\n  const actionKeys = actions.map((action) => action.id).join();\r\n  const actionResults = useMemo(() => {\r\n    let lastTime = 0,\r\n      delay = 0;\r\n    const displays = [];\r\n    for (let actionIdx in actions) {\r\n      const action = actions[actionIdx];\r\n      if (action.time * 1000 < lastTime + 300) {\r\n        delay += lastTime + 300 - action.time * 1000;\r\n      } else {\r\n        delay = 0;\r\n      }\r\n      displays.push(\r\n        <CombatActionResultDisplay\r\n          key={action.id}\r\n          action={action}\r\n          delay={delay}\r\n        />,\r\n      );\r\n      lastTime = action.time * 1000;\r\n    }\r\n    return displays;\r\n  }, [actionKeys]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <View style={[styles.row, styles.container]}>\r\n      <GameIcon icon=\"hp\" style={styles.icon} />\r\n      <View style={styles.progressBarContainer}>\r\n        <ProgressBar\r\n          progress={props.current / props.max}\r\n          width={null}\r\n          useNativeDriver={true}\r\n          // @ts-ignore The hpBarForeground is not part of react-native-elements\r\n          color={theme.theme.colors.hpBarForeground}\r\n          // @ts-ignore The hpBarBackground is not part of react-native-elements\r\n          unfilledColor={theme.theme.colors.hpBarBackground}\r\n          height={20}\r\n        />\r\n        {!props.empty && (\r\n          <Text style={styles.overlaidText}>\r\n            {formatNumber(Math.ceil(props.current))}/\r\n            {formatNumber(Math.ceil(props.max))}\r\n          </Text>\r\n        )}\r\n        {actionResults}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst HPBar = React.memo(HPBarNonMemo);\r\n\r\nexport { HPBar };\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginTop: -4,\r\n    marginRight: 4,\r\n  },\r\n  overlaidText: {\r\n    color: \"#fff\",\r\n    fontWeight: \"bold\",\r\n    position: \"absolute\",\r\n    top: Platform.select({ default: 0, ios: 2 }),\r\n    width: \"100%\",\r\n    textAlign: \"center\",\r\n  },\r\n  auxTextContainer: {\r\n    left: 48,\r\n    position: \"absolute\",\r\n    width: \"100%\",\r\n  },\r\n  auxText: {\r\n    width: \"100%\",\r\n    textAlign: \"center\",\r\n    fontWeight: \"bold\",\r\n  },\r\n  auxTextCritical: {\r\n    color: \"#dd0\",\r\n  },\r\n  auxTextDamage: {\r\n    color: \"#f00\",\r\n  },\r\n  auxTextHealing: {\r\n    color: \"#0f0\",\r\n  },\r\n  progressBarContainer: {\r\n    flex: 1,\r\n  },\r\n  container: {\r\n    height: 32,\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport { getCurrentEnemy } from \"../../backend/exploration/enemies/Enemies\";\r\nimport {\r\n  getCurrentEnemyHP,\r\n  getExplorationStatus,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../backend/exploration/ExplorationStatus\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { HPBar } from \"./HPBar\";\r\n\r\nexport function EnemyHPBar() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const inCombat =\r\n    getExplorationStatus(playerContext) == ExplorationStatus.Combat;\r\n  let currentHP = 0;\r\n  let maxHP = 1;\r\n  if (inCombat) {\r\n    currentHP = getCurrentEnemyHP(playerContext);\r\n    maxHP = getCurrentEnemy(playerContext).getMaxHP(playerContext);\r\n  }\r\n\r\n  return (\r\n    <HPBar\r\n      empty={!inCombat}\r\n      current={currentHP}\r\n      max={maxHP}\r\n      actionTarget={AttackTarget.Enemy}\r\n    />\r\n  );\r\n}\r\n","import { LinearGradient } from \"expo-linear-gradient\";\r\nimport React from \"react\";\r\nimport { ImageSourcePropType, StyleSheet, View } from \"react-native\";\r\nimport { Image, useTheme } from \"react-native-elements\";\r\nimport { sanitizeImageSourceForElectron } from \"../utility/icons/IconUtils\";\r\n\r\nexport function EnemySpriteTile(props: {\r\n  sprite?: ImageSourcePropType;\r\n  backdropColor?: string | false;\r\n}) {\r\n  const LinearGradientComponent = LinearGradient;\r\n  const theme = useTheme();\r\n  let sprite = sanitizeImageSourceForElectron(props.sprite);\r\n  return (\r\n    <View style={[styles.tile, { borderColor: theme.theme.colors.grey5 }]}>\r\n      {props.backdropColor && (\r\n        <LinearGradientComponent\r\n          colors={[`${props.backdropColor}`, `${props.backdropColor}0`]}\r\n          style={styles.gradient}\r\n        />\r\n      )}\r\n      {sprite && (\r\n        <Image\r\n          resizeMode=\"contain\"\r\n          source={sprite}\r\n          style={styles.image}\r\n          placeholderStyle={{ backgroundColor: theme.theme.colors.background }}\r\n        />\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tile: {\r\n    borderWidth: 1,\r\n    height: 144,\r\n    width: 144,\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n    margin: 8,\r\n  },\r\n  image: {\r\n    height: 144,\r\n    width: 144,\r\n  },\r\n  gradient: {\r\n    height: 144,\r\n    width: 144,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n    opacity: 0.2,\r\n  },\r\n});\r\n","import React from \"react\";\r\n\r\nexport const VisibilityContext = React.createContext<boolean>(true);\r\n","import { StyleProp, StyleSheet, View, ViewStyle } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { getPrimaryButtonTextColor } from \"./Miscellaneous\";\r\n\r\nexport function ActiveMark(props: {\r\n  disabled: boolean;\r\n  style?: StyleProp<ViewStyle>;\r\n}) {\r\n  const theme = useTheme();\r\n  const color = getPrimaryButtonTextColor(theme.theme, props.disabled);\r\n  return (\r\n    <View\r\n      style={[styles.activeMark, { backgroundColor: color }, props?.style]}\r\n    />\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  activeMark: {\r\n    width: 8,\r\n    height: 8,\r\n    alignSelf: \"center\",\r\n    marginHorizontal: 8,\r\n    borderRadius: 4,\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { ItemTag } from \"../../backend/items/Item\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function ItemTags(props: { tags: ItemTag[] }) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View style={styles.tagRow}>\r\n      {props.tags.map((tag) => (\r\n        <View\r\n          style={[\r\n            styles.tagStyle,\r\n            {\r\n              backgroundColor: theme.theme.colors.grey0,\r\n              borderColor: theme.theme.colors.grey0,\r\n            },\r\n          ]}\r\n          key={tag.tag}\r\n        >\r\n          <Text\r\n            style={[styles.tagTextStyle, { color: theme.theme.colors.white }]}\r\n          >\r\n            {tag.tag}\r\n          </Text>\r\n        </View>\r\n      ))}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tagRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  tagStyle: {\r\n    textAlign: \"center\",\r\n    paddingHorizontal: 6,\r\n    borderRadius: 8,\r\n    height: 18,\r\n    marginRight: 4,\r\n  },\r\n  tagTextStyle: {\r\n    fontSize: 11,\r\n    lineHeight: 16,\r\n  },\r\n});\r\n","import React, { useMemo } from \"react\";\r\nimport { StyleSheet, TouchableOpacity, View } from \"react-native\";\r\nimport { Badge, useTheme } from \"react-native-elements\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\nexport function ItemTile(props: {\r\n  onPress?: () => void;\r\n  title: string;\r\n  icon?: string;\r\n  amount?: number;\r\n  disabled?: boolean;\r\n}) {\r\n  const theme = useTheme();\r\n  const inner = useMemo(\r\n    () => (\r\n      <View style={[styles.tile, { borderColor: theme.theme.colors.grey4 }]}>\r\n        {props.icon && (\r\n          <GameIcon\r\n            style={props.disabled && { opacity: 0.2 }}\r\n            icon={props.icon}\r\n          />\r\n        )}\r\n        {props.amount != null && props.amount > 1 && (\r\n          <Badge\r\n            status=\"primary\"\r\n            value={props.amount}\r\n            containerStyle={{ position: \"absolute\", top: -8, right: -8 }}\r\n            badgeStyle={{ borderColor: theme.theme.colors.background }}\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [theme, props.icon, props.amount],\r\n  );\r\n  if (!props.onPress) {\r\n    return inner;\r\n  }\r\n  return (\r\n    <TouchableOpacity\r\n      accessibilityLabel={props.title}\r\n      onPress={() => props.onPress && props.onPress()}\r\n    >\r\n      {inner}\r\n    </TouchableOpacity>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tile: {\r\n    borderWidth: 0.5,\r\n    height: 48,\r\n    width: 48,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    margin: 8,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ItemStack } from \"../../backend/items/Item\";\r\nimport { getItemById } from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { DescriptionViewer, EffectViewer } from \"../utility/Miscellaneous\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemTags } from \"./ItemTags\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nexport interface ItemInfoProps {\r\n  itemStack: ItemStack;\r\n}\r\n\r\nexport function ItemInfo(props: ItemInfoProps) {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const { itemId, params } = props.itemStack.itemOccurrence;\r\n  const item = getItemById(itemId);\r\n  const name = item.getName(params);\r\n  const description = item.getDescription(playerContext, params);\r\n  const effect = item.getEffect(playerContext, params);\r\n  const tags = item.getTags(playerContext, params);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.itemDetailsContainer}>\r\n        <View style={styles.main}>\r\n          <Text h3>\r\n            {name}\r\n            {props.itemStack.amount > 1 && ` (${props.itemStack.amount})`}\r\n          </Text>\r\n          <View style={styles.tagRow}>\r\n            <ItemTags tags={tags} />\r\n          </View>\r\n          {description && <DescriptionViewer>{description}</DescriptionViewer>}\r\n          {effect && <EffectViewer>{effect}</EffectViewer>}\r\n        </View>\r\n        <ItemTile title={name} icon={item.getId()} />\r\n      </View>\r\n    ),\r\n    [\r\n      name,\r\n      props.itemStack.amount,\r\n      JSON.stringify(tags),\r\n      description,\r\n      effect,\r\n      item.getId(),\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  itemDetailsContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n  },\r\n  main: {\r\n    flex: 1,\r\n  },\r\n  tagRow: {\r\n    marginVertical: 4,\r\n  },\r\n});\r\n","import React, { useContext, useMemo, useRef, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ItemAction, ItemStack } from \"../../backend/items/Item\";\r\nimport { getItemById } from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { ActiveMark } from \"../utility/ActiveMark\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\n\r\nexport interface ItemDetailsProps {\r\n  itemStack: ItemStack;\r\n  disableSelling?: boolean;\r\n  showQuickbar?: boolean;\r\n}\r\n\r\nfunction ItemDetailsAction(props: {\r\n  action: ItemAction;\r\n  requireConfirm?: boolean;\r\n}) {\r\n  const action = props.action;\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const [pressedOnce, setPressedOnce] = useState(false);\r\n  return useMemo(() => {\r\n    return (\r\n      <Button\r\n        key={action.description}\r\n        icon={\r\n          action.isActive ? (\r\n            <ActiveMark disabled={!action.isEnabled} />\r\n          ) : undefined\r\n        }\r\n        title={\r\n          props.requireConfirm && pressedOnce\r\n            ? \"Press again to confirm\"\r\n            : action.description\r\n        }\r\n        disabled={!action.isEnabled}\r\n        containerStyle={styles.actionButtonContainer}\r\n        onPress={() => {\r\n          if (props.requireConfirm && !pressedOnce) {\r\n            setPressedOnce(true);\r\n            return;\r\n          }\r\n          action.transform && playerContextRef.current.apply(action.transform);\r\n        }}\r\n      />\r\n    );\r\n  }, [\r\n    action.description,\r\n    action.isEnabled,\r\n    action.transform,\r\n    action.isActive,\r\n    props.requireConfirm,\r\n    pressedOnce,\r\n    setPressedOnce,\r\n  ]);\r\n}\r\n\r\nexport function ItemDetails(props: ItemDetailsProps) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const { itemId, params } = props.itemStack.itemOccurrence;\r\n  const item = getItemById(itemId);\r\n  const name = item.getName(params);\r\n  const description = item.getDescription(playerContext, params);\r\n  const effect = item.getEffect(playerContext, params);\r\n  const primaryAction = item.getPrimaryAction(playerContext, params);\r\n  const saleAction = props.disableSelling\r\n    ? undefined\r\n    : item.getSaleAction(playerContext, params);\r\n  const quickbarAction = props.showQuickbar\r\n    ? item.getQuickbarAction(playerContext, params)\r\n    : undefined;\r\n\r\n  const actions = [\r\n    { action: primaryAction },\r\n    { action: saleAction, requireConfirm: true },\r\n    { action: quickbarAction },\r\n  ].filter((action) => action.action != undefined) as {\r\n    action: ItemAction;\r\n    requireConfirm?: boolean;\r\n  }[];\r\n\r\n  const itemInfo = useMemo(() => {\r\n    return <ItemInfo itemStack={props.itemStack} />;\r\n  }, [JSON.stringify(props.itemStack)]);\r\n\r\n  return (\r\n    <View style={styles.itemDetailsContainer}>\r\n      {itemInfo}\r\n      <View style={styles.actionRow}>\r\n        {actions.map((action) => (\r\n          <ItemDetailsAction\r\n            key={action.action.description}\r\n            action={action.action}\r\n            requireConfirm={action?.requireConfirm}\r\n          />\r\n        ))}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  itemDetailsContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  tagRow: {\r\n    marginVertical: 4,\r\n  },\r\n  actionRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    marginTop: 8,\r\n  },\r\n  actionButtonContainer: {\r\n    marginRight: 8,\r\n  },\r\n});\r\n","import React, { useMemo } from \"react\";\r\nimport { ScrollView, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { Item } from \"../../backend/items/Item\";\r\nimport { getItemById } from \"../../backend/items/Items\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nexport interface ItemGridElement {\r\n  itemId: string;\r\n  amount: number;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport interface ItemGridProps {\r\n  items: ItemGridElement[];\r\n  onPressItem?: (item: Item, index: number) => void;\r\n  dummySlotAmount?: number;\r\n}\r\n\r\nexport function ItemGrid(props: ItemGridProps) {\r\n  const theme = useTheme();\r\n  return useMemo(() => {\r\n    let dummySlots = [];\r\n    for (let i = 0; i < (props.dummySlotAmount || 0); i++) {\r\n      dummySlots.push(<ItemTile title=\"Empty\" key={`dummySlot${i}`} />);\r\n    }\r\n    return (\r\n      <View\r\n        style={[styles.container, { borderColor: theme.theme.colors.grey5 }]}\r\n      >\r\n        <ScrollView style={styles.scrollView} nestedScrollEnabled={true}>\r\n          <View\r\n            style={[\r\n              styles.gridContainer,\r\n              { backgroundColor: theme.theme.colors.background },\r\n            ]}\r\n          >\r\n            {props.items.map((itemGridElement, index) => {\r\n              const item = getItemById(itemGridElement.itemId);\r\n              return (\r\n                <ItemTile\r\n                  key={index}\r\n                  title={item.getName(item.getDefaultParams())}\r\n                  onPress={() =>\r\n                    props.onPressItem && props.onPressItem(item, index)\r\n                  }\r\n                  icon={item.getId()}\r\n                  disabled={itemGridElement.disabled}\r\n                  amount={itemGridElement.amount}\r\n                />\r\n              );\r\n            })}\r\n            {dummySlots}\r\n          </View>\r\n        </ScrollView>\r\n      </View>\r\n    );\r\n  }, [\r\n    JSON.stringify(props.items),\r\n    props.onPressItem,\r\n    props.dummySlotAmount,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    borderWidth: 2,\r\n  },\r\n  scrollView: {\r\n    maxHeight: 220,\r\n  },\r\n  gridContainer: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"center\",\r\n    flex: 1,\r\n  },\r\n});\r\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  calculateInventoryCap,\r\n  getInventory,\r\n} from \"../../backend/items/Inventory\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { addContextListener } from \"../../backend/PlayerContextListeners\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\nimport { ItemDetails } from \"./ItemDetails\";\r\nimport { ItemGrid } from \"./ItemGrid\";\r\n\r\nexport default function InventoryItems(props: {\r\n  disableSelling?: boolean;\r\n  showQuickbar?: boolean;\r\n  isFullBleed?: boolean;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const [selectedIndex, setSelectedIndex] = useState(null as number | null);\r\n  const inventory = getInventory(playerContext);\r\n  const itemGridElements = inventory.map((itemStack) => {\r\n    return {\r\n      itemId: itemStack.itemOccurrence.itemId,\r\n      amount: itemStack.amount,\r\n    };\r\n  });\r\n  const selectedItemOccurrence =\r\n    selectedIndex != null\r\n      ? inventory[selectedIndex]?.itemOccurrence\r\n      : undefined;\r\n  const emptySlots = calculateInventoryCap(playerContext) - inventory.length;\r\n\r\n  const selectedIndexRef = useRef(selectedIndex);\r\n  selectedIndexRef.current = selectedIndex;\r\n\r\n  addContextListener(\"InventoryComponent\", (oldState, newState) => {\r\n    const oldInventory = getInventory(oldState);\r\n    const newInventory = getInventory(newState);\r\n    const oldSelectedItemOccurrence =\r\n      selectedIndexRef.current != null\r\n        ? oldInventory[selectedIndexRef.current]?.itemOccurrence\r\n        : undefined;\r\n    const newSelectedItemOccurrence =\r\n      selectedIndexRef.current != null\r\n        ? newInventory[selectedIndexRef.current]?.itemOccurrence\r\n        : undefined;\r\n\r\n    if (\r\n      JSON.stringify(oldSelectedItemOccurrence) !=\r\n      JSON.stringify(newSelectedItemOccurrence)\r\n    ) {\r\n      setSelectedIndex(null);\r\n    }\r\n  });\r\n\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setSelectedIndex(null);\r\n    }\r\n  }, [visible]);\r\n\r\n  const itemDetails = selectedIndex != null && selectedItemOccurrence && (\r\n    <ItemDetails\r\n      disableSelling={props.disableSelling}\r\n      showQuickbar={props.showQuickbar}\r\n      itemStack={inventory[selectedIndex]}\r\n    />\r\n  );\r\n\r\n  const onPressItem = React.useCallback(\r\n    (item: any, index: number) => {\r\n      setSelectedIndex(index);\r\n    },\r\n    [setSelectedIndex],\r\n  );\r\n\r\n  return (\r\n    <View>\r\n      <ItemGrid\r\n        items={itemGridElements}\r\n        onPressItem={onPressItem}\r\n        dummySlotAmount={emptySlots}\r\n      />\r\n      <View\r\n        style={[\r\n          styles.detailsContainer,\r\n          props.isFullBleed && styles.detailsContainerPadding,\r\n        ]}\r\n      >\r\n        {itemDetails}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  detailsContainer: {\r\n    marginTop: 18,\r\n  },\r\n  detailsContainerPadding: {\r\n    paddingHorizontal: 8,\r\n    paddingBottom: 8,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { PlayerContext, PlayerContextValue } from \"../../backend/PlayerContext\";\r\nimport {\r\n  addActionToQuickbar,\r\n  isInQuickbar,\r\n  isQuickbarFull,\r\n} from \"../../backend/Quickbar\";\r\n\r\nimport { Entypo, Ionicons } from \"@expo/vector-icons\";\r\nimport { getUnlockedElements } from \"../../backend/spells/ElementsAndSchools\";\r\nimport { Spell, SpellActionBase } from \"../../backend/spells/Spell\";\r\nimport {\r\n  addFavoriteSpell,\r\n  isInFavoriteSpells,\r\n  removeFromFavoriteSpells,\r\n} from \"../../backend/spells/Spells\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { ActiveMark } from \"./ActiveMark\";\r\nimport { Button } from \"./Button\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport {\r\n  DescriptionViewer,\r\n  disabledColorByTheme,\r\n  elementColorByTheme,\r\n} from \"./Miscellaneous\";\r\nimport { Text } from \"./Text\";\r\n\r\ntype SpellViewProps = {\r\n  spell: Spell;\r\n  showAddToQuickbar?: boolean;\r\n  collapsed?: boolean;\r\n  toggleCollapsed?: () => void;\r\n  isMinimal?: boolean;\r\n};\r\n\r\nfunction SpellViewMemoized(\r\n  props: SpellViewProps & { playerContext: PlayerContextValue },\r\n) {\r\n  const playerContext = props.playerContext;\r\n  const playerContextRef = useRef(props.playerContext);\r\n  const spell = props.spell;\r\n  const showAddToQuickbar = props.showAddToQuickbar || false;\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    const descriptionContents = `${spell.getDisplayDescription(\r\n      playerContext,\r\n    )} **${spell.getDisplayEffect(playerContext)}**`;\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <DescriptionViewer style={{ flex: 1 }}>\r\n          {descriptionContents}\r\n        </DescriptionViewer>\r\n      </View>\r\n    );\r\n  }, [\r\n    !props.collapsed && spell.getDisplayDescription(playerContext),\r\n    !props.collapsed && spell.getDisplayEffect(playerContext),\r\n  ]);\r\n\r\n  const theme = useTheme();\r\n\r\n  let spellElement = spell.getElement();\r\n  if (\r\n    spellElement &&\r\n    !getUnlockedElements(playerContext).includes(spellElement)\r\n  ) {\r\n    spellElement = undefined;\r\n  }\r\n  const elementText = useMemo(() => {\r\n    return (\r\n      <View>\r\n        {spellElement != null && (\r\n          <View style={styles.elementContainer}>\r\n            <Markdown>Element:</Markdown>\r\n            <View\r\n              style={[\r\n                styles.elementTextContainer,\r\n                {\r\n                  backgroundColor: elementColorByTheme(\r\n                    theme.theme.mode,\r\n                    spellElement,\r\n                  ),\r\n                },\r\n              ]}\r\n            >\r\n              <Text\r\n                style={[\r\n                  spellElement === playerContext.primaryElement &&\r\n                    styles.primaryElementText,\r\n                  styles.spellElementBadgeText,\r\n                ]}\r\n              >\r\n                {spellElement}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [spellElement, theme]);\r\n\r\n  const cooldownContainer = useMemo(() => {\r\n    const cooldown = (spell as SpellActionBase).getCooldown(playerContext);\r\n    const cooldownText = `${formatNumber(cooldown, {\r\n      showDecimals: true,\r\n    })} sec`;\r\n    return (\r\n      <View>\r\n        {cooldown > 0 && (\r\n          <View style={styles.costContainer}>\r\n            <Markdown>Cooldown:</Markdown>\r\n            <Markdown>{cooldownText}</Markdown>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    !props.collapsed && (spell as SpellActionBase).getCooldown(playerContext),\r\n  ]);\r\n\r\n  const toggleFavorite = useCallback(() => {\r\n    playerContextRef.current.apply((state) =>\r\n      isInFavoriteSpells(state, spell)\r\n        ? removeFromFavoriteSpells(state, spell)\r\n        : addFavoriteSpell(state, spell),\r\n    );\r\n  }, []);\r\n\r\n  const favoritesButton = useMemo(\r\n    () => (\r\n      <Ionicons\r\n        onPress={toggleFavorite}\r\n        name={\r\n          isInFavoriteSpells(playerContext, spell) ? \"heart\" : \"heart-outline\"\r\n        }\r\n        style={[styles.expandContainer]}\r\n        color={theme.theme.colors.black}\r\n        size={32}\r\n      />\r\n    ),\r\n    [\r\n      !props.showAddToQuickbar && isInFavoriteSpells(playerContext, spell),\r\n      toggleFavorite,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  const disabled = !spell.isEnabled(playerContext);\r\n  const buttonTitleStyles = useMemo(\r\n    () => [\r\n      {\r\n        color: \"white\",\r\n      },\r\n      styles.buttonTitle,\r\n      disabled && {\r\n        color: disabledColorByTheme(theme.theme),\r\n      },\r\n      styles.smallButtonTitle,\r\n    ],\r\n    [theme?.theme?.colors?.disabled, disabled],\r\n  );\r\n  const spellDisplayName = spell.getDisplayName(playerContext);\r\n  const spellCost = spell.getCost(playerContext)?.resources?.Mana ?? 0;\r\n  const isActive = spell.isActive(playerContext);\r\n  const button = useMemo(\r\n    () => (\r\n      <Button\r\n        key={spell.getName()}\r\n        enableAutoRepress={true}\r\n        onPress={() =>\r\n          playerContextRef.current.apply(\r\n            spell.doAction.bind(spell, { isAutomatic: false }),\r\n          )\r\n        }\r\n        title={\r\n          <View style={styles.spellButtonTitleContainer}>\r\n            <View style={styles.spellButtonTitleOnlyContainer}>\r\n              {isActive && <ActiveMark disabled={disabled} />}\r\n              <Text style={buttonTitleStyles}>{spellDisplayName}</Text>\r\n            </View>\r\n            <View style={styles.spellButtonCostContainer}>\r\n              <Text style={buttonTitleStyles}>\r\n                {formatNumber(spellCost, { showDecimals: false })}\r\n              </Text>\r\n              <GameIcon icon=\"mana\" style={styles.spellManaIcon} />\r\n            </View>\r\n          </View>\r\n        }\r\n        titleStyle={styles.smallButtonTitle}\r\n        containerStyle={[styles.buttonContainer, styles.buttonContainerSmall]}\r\n        disabled={disabled}\r\n      />\r\n    ),\r\n    [\r\n      spell.getDisplayName(playerContext),\r\n      buttonTitleStyles,\r\n      spellDisplayName,\r\n      spellCost,\r\n      disabled,\r\n      isActive,\r\n    ],\r\n  );\r\n\r\n  const addToQuickbarButton = useMemo(\r\n    () => (\r\n      <Button\r\n        onPress={() =>\r\n          playerContextRef.current.apply((state) =>\r\n            addActionToQuickbar(state, spell),\r\n          )\r\n        }\r\n        title=\"Add to Quickbar\"\r\n        titleStyle={styles.smallButtonTitle}\r\n        containerStyle={[styles.quickbarButtonContainer]}\r\n        disabled={\r\n          isInQuickbar(playerContext, {\r\n            type: \"action\",\r\n            name: spell.getName(),\r\n          }) || isQuickbarFull(playerContext)\r\n        }\r\n      />\r\n    ),\r\n    [\r\n      isInQuickbar(playerContext, {\r\n        type: \"action\",\r\n        name: spell.getName(),\r\n      }),\r\n      isQuickbarFull(playerContext),\r\n    ],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (props.isMinimal) {\r\n      return <View style={styles.buttonContainerView}>{button}</View>;\r\n    }\r\n    return (\r\n      <View style={styles.actionContainer} key={spell.getName()}>\r\n        <View style={styles.buttonRowContainer}>\r\n          <View style={styles.buttonContainerView}>{button}</View>\r\n          <TouchableWithoutFeedback\r\n            accessibilityLabel={props.collapsed ? \"Expand\" : \"Contract\"}\r\n            onPress={props.toggleCollapsed}\r\n          >\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.theme.colors.black}\r\n              />\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n        </View>\r\n        {(!props.collapsed || !props.showAddToQuickbar) && (\r\n          <View style={props.collapsed && { display: \"none\" }}>\r\n            <View style={styles.descriptionRow}>\r\n              {descriptionContainer}\r\n              {!showAddToQuickbar && favoritesButton}\r\n              {showAddToQuickbar && addToQuickbarButton}\r\n            </View>\r\n            {elementText}\r\n            {cooldownContainer}\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    spell.getName(),\r\n    !props.collapsed && cooldownContainer,\r\n    !props.collapsed && descriptionContainer,\r\n    showAddToQuickbar,\r\n    showAddToQuickbar && addToQuickbarButton,\r\n    showAddToQuickbar && JSON.stringify(playerContext.quickbar),\r\n    props.collapsed,\r\n    theme,\r\n    toggleFavorite,\r\n    props.isMinimal,\r\n    props.toggleCollapsed,\r\n    favoritesButton,\r\n    button,\r\n  ]);\r\n}\r\n\r\nexport function SpellView(props: SpellViewProps & { isVisible?: boolean }) {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  return useMemo(\r\n    () => <SpellViewMemoized playerContext={playerContext} {...props} />,\r\n    [\r\n      props.spell.getName(),\r\n      props.collapsed,\r\n      props.showAddToQuickbar,\r\n      props.toggleCollapsed,\r\n      props.isVisible !== false ? playerContext : false,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  actionContainer: { marginVertical: 8 },\r\n  buttonRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  quickbarButtonContainer: {\r\n    marginTop: 4,\r\n    marginLeft: 8,\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n    alignSelf: \"stretch\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  elementContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n    marginTop: 4,\r\n  },\r\n  descriptionTextContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    paddingRight: 4,\r\n  },\r\n  buttonTitle: {\r\n    fontSize: 16,\r\n    textAlign: \"center\",\r\n    paddingVertical: 1,\r\n    ...Platform.select({\r\n      android: {\r\n        fontFamily: \"sans-serif-medium\",\r\n      },\r\n      default: {\r\n        fontSize: 18,\r\n      },\r\n    }),\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  buttonContainerView: {\r\n    flexDirection: \"row\",\r\n    flex: 1,\r\n  },\r\n  buttonContainer: {\r\n    flex: 1,\r\n  },\r\n  buttonContainerSmall: {\r\n    marginRight: 0,\r\n  },\r\n  disabledActionText: {\r\n    color: \"#aaa\",\r\n  },\r\n  capTooLowText: {\r\n    color: \"#d99\",\r\n  },\r\n  turnOnRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  turnOnQuantityContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusContainer: {\r\n    marginLeft: 8,\r\n  },\r\n  spellButtonTitleContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n  },\r\n  spellButtonTitleOnlyContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonCostContainer: {\r\n    flexDirection: \"row\",\r\n    width: 50,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  spellManaIcon: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 1,\r\n    marginLeft: 2,\r\n  },\r\n  descriptionRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 8,\r\n  },\r\n  elementTextContainer: {\r\n    paddingHorizontal: 8,\r\n    borderRadius: 8,\r\n  },\r\n  primaryElementText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  spellElementBadgeText: {\r\n    color: \"white\",\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Button } from \"react-native-elements\";\r\nimport { PlayerContext, PlayerContextValue } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getFavoriteSpells,\r\n  removeFromFavoriteSpells,\r\n} from \"../../backend/spells/Spells\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { SpellView } from \"../utility/SpellView\";\r\n\r\nfunction FavoriteSpellsContainerInside(props: {\r\n  playerContext: PlayerContextValue;\r\n}) {\r\n  const favoriteSpells = getFavoriteSpells(props.playerContext);\r\n  if (favoriteSpells.length === 0) {\r\n    return null;\r\n  }\r\n  const playerContextRef = useRef(props.playerContext);\r\n  return (\r\n    <View>\r\n      <CategoryContainer title=\"Favorites\">\r\n        {favoriteSpells.map((spell) => (\r\n          <View style={styles.spellViewContainer} key={spell.getName()}>\r\n            <SpellView key={spell.getName()} spell={spell} isMinimal={true} />\r\n            <Button\r\n              icon={<MaterialIcons name=\"close\" size={24} color=\"white\" />}\r\n              containerStyle={styles.deleteButton}\r\n              style={styles.deleteButtonInner}\r\n              iconContainerStyle={styles.deleteButtonInner}\r\n              buttonStyle={styles.deleteButtonInner}\r\n              hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n              onPress={() =>\r\n                playerContextRef.current.apply((state) =>\r\n                  removeFromFavoriteSpells(state, spell),\r\n                )\r\n              }\r\n            />\r\n          </View>\r\n        ))}\r\n      </CategoryContainer>\r\n    </View>\r\n  );\r\n}\r\n\r\nexport function FavoriteSpellsContainer(props: { isVisible?: boolean }) {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <FavoriteSpellsContainerInside playerContext={playerContext} {...props} />\r\n    ),\r\n    [props.isVisible !== false ? playerContext : false],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  spellViewContainer: {\r\n    paddingTop: 8,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  deleteButton: {\r\n    marginLeft: 8,\r\n  },\r\n  deleteButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n  },\r\n});\r\n","import { SimpleLineIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { Button, useTheme } from \"react-native-elements\";\r\nimport { hasGlobalFlag, setGlobalFlag } from \"../../backend/Flags\";\r\nimport { PlayerContext, PlayerContextValue } from \"../../backend/PlayerContext\";\r\nimport { School } from \"../../backend/spells/ElementsAndSchools\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport { getVisibleSpellsBySchool } from \"../../backend/spells/Spells\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { Picker as UtilityPicker } from \"../utility/Picker\";\r\nimport { SpellView } from \"../utility/SpellView\";\r\nimport { Text } from \"../utility/Text\";\r\nimport {\r\n  UIContext,\r\n  UIContextValue,\r\n  useUIStateFromContext,\r\n} from \"../utility/UIContext\";\r\nimport { FavoriteSpellsContainer } from \"./FavoriteSpellsContainer\";\r\n\r\nfunction SpellsContainerInside(props: {\r\n  uiKey: string;\r\n  area?: string;\r\n  onlyBySchool?: boolean;\r\n  showAddToQuickbar?: boolean;\r\n  playerContext: PlayerContextValue;\r\n  uiContext: UIContextValue;\r\n  isVisible?: boolean;\r\n}) {\r\n  const playerContext = props.playerContext;\r\n  const playerContextRef = useRef(playerContext);\r\n  const uiContext = props.uiContext;\r\n\r\n  const currentSchoolKey = props.uiKey + \".currentSchool\";\r\n  let spellsBySchool = getVisibleSpellsBySchool(playerContext);\r\n  for (let school in spellsBySchool) {\r\n    spellsBySchool[school] = spellsBySchool[school].filter(\r\n      (spell) => !props.area || spell.getArea() == props.area,\r\n    );\r\n    if (spellsBySchool[school].length == 0) {\r\n      delete spellsBySchool[school];\r\n    }\r\n  }\r\n\r\n  const [currentSchool, setCurrentSchool] = useUIStateFromContext(\r\n    uiContext,\r\n    currentSchoolKey,\r\n    Object.keys(spellsBySchool)?.[0] ?? \"Conjuration\",\r\n  );\r\n\r\n  const [expandedSpells, setExpandedSpells] = useState<Record<string, boolean>>(\r\n    {},\r\n  );\r\n  const expandedSpellsRef = useRef(expandedSpells);\r\n  expandedSpellsRef.current = expandedSpells;\r\n\r\n  const setCurrentSchoolCallback = useCallback(\r\n    (school: string) => {\r\n      setCurrentSchool(school);\r\n      if (\r\n        !hasGlobalFlag(\r\n          playerContextRef.current,\r\n          \"has_completed_spell_menu_picker_nux\",\r\n        )\r\n      ) {\r\n        playerContextRef.current.apply(\r\n          setGlobalFlag(\"has_completed_spell_menu_picker_nux\"),\r\n        );\r\n      }\r\n    },\r\n    [setCurrentSchool],\r\n  );\r\n\r\n  const fullSpellString = Object.keys(spellsBySchool)\r\n    .map((school) =>\r\n      Object.values(spellsBySchool[school])\r\n        .map((spell) => spell.getName())\r\n        .join(\",\"),\r\n    )\r\n    .join(\";\");\r\n  const allSpellString = (spellsBySchool?.[currentSchool as School] || [])\r\n    .map((spell) => spell.getName())\r\n    .join(\",\");\r\n\r\n  const currentSchoolSpells = useMemo(\r\n    () => spellsBySchool?.[currentSchool as School] || [],\r\n    [allSpellString],\r\n  );\r\n\r\n  const toggleCollapsed = useCallback((spell: Spell) => {\r\n    const spellName = spell.getName();\r\n    expandedSpellsRef.current[spellName] =\r\n      !expandedSpellsRef?.current?.[spellName];\r\n    setExpandedSpells(expandedSpellsRef.current);\r\n  }, []);\r\n\r\n  const boundToggleCollapsed = useMemo(\r\n    () =>\r\n      Object.fromEntries(\r\n        Object.keys(spellsBySchool).map((school) => [\r\n          school,\r\n          Object.fromEntries(\r\n            spellsBySchool[school].map((spell) => [\r\n              spell.getName(),\r\n              toggleCollapsed.bind(null, spell),\r\n            ]),\r\n          ),\r\n        ]),\r\n      ),\r\n    [fullSpellString],\r\n  );\r\n\r\n  const spellActionContainers = useMemo(() => {\r\n    if (!props.onlyBySchool) {\r\n      return Object.keys(spellsBySchool).map((school) => {\r\n        const spellArray = spellsBySchool[school];\r\n        return (\r\n          <View\r\n            key={school}\r\n            style={currentSchool !== school && { display: \"none\" }}\r\n          >\r\n            {spellArray.map((spell, idx) => {\r\n              return (\r\n                <SpellView\r\n                  key={spell.getSpellName()}\r\n                  spell={spell}\r\n                  showAddToQuickbar={props.showAddToQuickbar}\r\n                  collapsed={!expandedSpells?.[spell.getSpellName()]}\r\n                  toggleCollapsed={\r\n                    boundToggleCollapsed[school][spell.getName()]\r\n                  }\r\n                  isVisible={props.isVisible && currentSchool === school}\r\n                />\r\n              );\r\n            })}\r\n          </View>\r\n        );\r\n      });\r\n    }\r\n    return currentSchoolSpells.map((spell, idx) => {\r\n      return (\r\n        <SpellView\r\n          key={spell.getSpellName()}\r\n          spell={spell}\r\n          showAddToQuickbar={props.showAddToQuickbar}\r\n          collapsed={!expandedSpells?.[spell.getSpellName()]}\r\n          toggleCollapsed={boundToggleCollapsed[currentSchool][spell.getName()]}\r\n          isVisible={props.isVisible}\r\n        />\r\n      );\r\n    });\r\n  }, [\r\n    !props.onlyBySchool ? fullSpellString : currentSchoolSpells,\r\n    JSON.stringify(expandedSpells),\r\n    boundToggleCollapsed,\r\n    currentSchool,\r\n    props.isVisible,\r\n  ]);\r\n\r\n  const tags = Object.keys(spellsBySchool);\r\n\r\n  const spellSchoolPicker = useMemo(\r\n    () => (\r\n      <UtilityPicker\r\n        onValueChange={setCurrentSchoolCallback}\r\n        style={styles.picker}\r\n        selectedValue={currentSchool}\r\n        data={tags.map((tag, idx) => ({ label: tag, value: tag, key: tag }))}\r\n      />\r\n    ),\r\n    [setCurrentSchoolCallback, currentSchool, JSON.stringify(tags)],\r\n  );\r\n\r\n  const expandContractAll = useCallback(() => {\r\n    let expandedSomething = false;\r\n    currentSchoolSpells.forEach((spell) => {\r\n      const spellName = spell.getName();\r\n      if (!expandedSpells?.[spellName]) {\r\n        expandedSomething = true;\r\n        expandedSpells[spellName] = true;\r\n      }\r\n    });\r\n    if (!expandedSomething) {\r\n      currentSchoolSpells.forEach((spell) => {\r\n        delete expandedSpells[spell.getName()];\r\n      });\r\n    }\r\n    setExpandedSpells(expandedSpells);\r\n  }, [\r\n    expandedSpells,\r\n    currentSchoolSpells.map((spell) => spell.getName()).join(\",\"),\r\n  ]);\r\n\r\n  const theme = useTheme();\r\n\r\n  const showNUX = !hasGlobalFlag(\r\n    playerContext,\r\n    \"has_completed_spell_menu_picker_nux\",\r\n  );\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        <View style={styles.emptyTitleContainer}>\r\n          <SimpleLineIcons\r\n            name=\"magic-wand\"\r\n            size={24}\r\n            style={styles.magicWand}\r\n            color={theme.theme.colors.black}\r\n          />\r\n          <Text h2>Cast Spell</Text>\r\n        </View>\r\n        {!props.onlyBySchool && (\r\n          <View>\r\n            <FavoriteSpellsContainer isVisible={props.isVisible} />\r\n          </View>\r\n        )}\r\n        {Object.keys(spellsBySchool).length > 0 ? (\r\n          <CategoryContainer title=\"By School\">\r\n            <View style={styles.schoolRowContainer}>\r\n              <View\r\n                style={[\r\n                  styles.tagPickerContainer,\r\n                  Platform.select({\r\n                    android: { backgroundColor: \"#eee\", borderRadius: 10 },\r\n                    default: null,\r\n                  }),\r\n                ]}\r\n              >\r\n                {spellSchoolPicker}\r\n              </View>\r\n              <Button\r\n                titleStyle={styles.buttonTitle}\r\n                title=\"Expand all\"\r\n                onPress={expandContractAll}\r\n              />\r\n            </View>\r\n            {showNUX && (\r\n              <Text style={styles.nuxText}>\r\n                Tip: You can find more spells by{\" \"}\r\n                {Platform.OS == \"ios\"\r\n                  ? \"pressing the \" + currentSchool + \" button\"\r\n                  : \"changing the dropdown\"}{\" \"}\r\n                above to switch to a different school!\r\n              </Text>\r\n            )}\r\n            <View style={styles.schoolContainer}>{spellActionContainers}</View>\r\n          </CategoryContainer>\r\n        ) : (\r\n          <View style={styles.noSpellsContainer}>\r\n            <Text style={styles.noSpellsText}>No spells yet!</Text>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    currentSchool,\r\n    setCurrentSchool,\r\n    spellActionContainers,\r\n    props.isVisible,\r\n    spellSchoolPicker,\r\n    expandContractAll,\r\n    props.onlyBySchool,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nexport default function SpellsContainer(props: {\r\n  uiKey: string;\r\n  area?: string;\r\n  hideRecent?: boolean;\r\n  showAddToQuickbar?: boolean;\r\n  isVisible?: boolean;\r\n  onlyBySchool?: boolean;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const uiContext = useContext(UIContext);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <SpellsContainerInside\r\n        playerContext={playerContext}\r\n        uiContext={uiContext}\r\n        {...props}\r\n      />\r\n    ),\r\n    [\r\n      props.area,\r\n      props.hideRecent,\r\n      props.showAddToQuickbar,\r\n      props.onlyBySchool,\r\n      props.isVisible !== false ? playerContext : false,\r\n      props.isVisible !== false ? uiContext : false,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  schoolContainer: { marginTop: 8 },\r\n  spellsContainer: { marginTop: 8 },\r\n  schoolButton: { marginVertical: 4 },\r\n  magicWand: { marginRight: 8 },\r\n  schoolTitleContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n  emptyTitleContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n  },\r\n  titleContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  schoolTitleTextContainer: {},\r\n  picker: {\r\n    flex: 1,\r\n  },\r\n  schoolRowContainer: {\r\n    marginTop: 8,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  tagPickerContainer: {\r\n    width: Platform.select({ default: 190, web: 180 }),\r\n  },\r\n  buttonTitle: {\r\n    textAlign: \"center\",\r\n    paddingVertical: 1,\r\n    ...Platform.select({\r\n      android: {\r\n        fontFamily: \"sans-serif-medium\",\r\n      },\r\n      default: {\r\n        fontSize: 18,\r\n      },\r\n    }),\r\n    fontSize: 12,\r\n  },\r\n  noSpellsText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  noSpellsContainer: {\r\n    marginTop: 16,\r\n  },\r\n  nuxText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { getTemporaryEffects } from \"../../backend/timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../backend/timetick/TotalTimePlayed\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Text } from \"./Text\";\r\n\r\nfunction TemporaryEffectRow(props: { text: string; isBeneficial: boolean }) {\r\n  return (\r\n    <View style={styles.row}>\r\n      <GameIcon\r\n        icon={props.isBeneficial ? \"boost\" : \"debuff\"}\r\n        style={styles.icon}\r\n      />\r\n      <Text style={styles.boostText}>{props.text}</Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst TemporaryEffectRowMemo = React.memo(TemporaryEffectRow);\r\n\r\nexport function TemporaryEffectsViewer(props: {\r\n  isEnemy?: boolean;\r\n  isVisible?: boolean;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const temporaryEffects = getTemporaryEffects(playerContext)\r\n    .sort((a, b) => (a.isBeneficial ? 1 : 0) - (b.isBeneficial ? 1 : 0))\r\n    .filter(\r\n      (temporaryEffect) =>\r\n        !temporaryEffect.hidden &&\r\n        (props.isEnemy\r\n          ? temporaryEffect.isEnemyTemporaryEffect\r\n          : !temporaryEffect.isEnemyTemporaryEffect),\r\n    );\r\n  return useMemo(() => {\r\n    const rows = temporaryEffects.map((temporaryEffect) => {\r\n      const { name, endTime, isBeneficial } = temporaryEffect;\r\n      const timeLeftSec = endTime - getSecondsPlayed(playerContext);\r\n      const text = `${name} (${formatNumber(timeLeftSec)} sec)`;\r\n      return (\r\n        <TemporaryEffectRowMemo\r\n          key={name}\r\n          isBeneficial={isBeneficial}\r\n          text={text}\r\n        />\r\n      );\r\n    });\r\n    return <View style={styles.container}>{rows}</View>;\r\n  }, [\r\n    props.isVisible !== false ? playerContext : false,\r\n    props.isVisible !== false ? temporaryEffects : false,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  icon: {\r\n    height: 20,\r\n    width: 20,\r\n    marginTop: 2,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n    marginTop: 4,\r\n  },\r\n  boostText: {\r\n    marginLeft: 8,\r\n    flex: 1,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo, useRef } from \"react\";\r\nimport { ScrollView, StyleSheet, View } from \"react-native\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getQuickbarActions,\r\n  QuickbarAction,\r\n  removeFromQuickbar,\r\n} from \"../../backend/Quickbar\";\r\nimport { ActiveMark } from \"../utility/ActiveMark\";\r\nimport { Button } from \"../utility/Button\";\r\n\r\nimport { TemporaryEffectsViewer } from \"../utility/TemporaryEffectsViewer\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nfunction QuickbarActionContainer(props: { quickbarAction: QuickbarAction }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const quickbarAction = props.quickbarAction;\r\n  const name = quickbarAction.getDisplayName(playerContext);\r\n  const transform = quickbarAction.getTransform(playerContext);\r\n  const data = quickbarAction.toQuickbarData();\r\n  const enabled = quickbarAction.isEnabled(playerContext);\r\n  const active = quickbarAction.isActive(playerContext);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Button\r\n          title={name}\r\n          icon={active ? <ActiveMark disabled={!enabled} /> : undefined}\r\n          containerStyle={styles.mainButton}\r\n          titleStyle={styles.smallButtonTitle}\r\n          onPress={() => playerContextRef.current.apply(transform)}\r\n          disabled={!enabled}\r\n        />\r\n        <Button\r\n          icon={<MaterialIcons name=\"close\" size={24} color=\"white\" />}\r\n          containerStyle={styles.deleteButton}\r\n          style={styles.deleteButtonInner}\r\n          iconContainerStyle={styles.deleteButtonInner}\r\n          buttonStyle={styles.deleteButtonInner}\r\n          hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n          onPress={() =>\r\n            playerContextRef.current.apply((state) => {\r\n              return removeFromQuickbar(state, data);\r\n            })\r\n          }\r\n        />\r\n      </View>\r\n    ),\r\n    [name, playerContextRef, transform, enabled, active, removeFromQuickbar],\r\n  );\r\n}\r\n\r\nexport function QuickbarContainer() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const quickbar = getQuickbarActions(playerContext);\r\n  if (quickbar.length == 0) {\r\n    return (\r\n      <View>\r\n        <Text style={styles.emptyText}>\r\n          Your Quickbar is empty. Add actions to the Quickbar through the\r\n          \"Inventory\" and \"Spells\" menus at the bottom!\r\n        </Text>\r\n      </View>\r\n    );\r\n  }\r\n  const mappedActions = quickbar.map((quickbarAction) => (\r\n    <QuickbarActionContainer\r\n      key={JSON.stringify(quickbarAction.toQuickbarData())}\r\n      quickbarAction={quickbarAction}\r\n    />\r\n  ));\r\n  return (\r\n    <View style={styles.mainContainer}>\r\n      <View style={styles.actionsContainer}>\r\n        <ScrollView nestedScrollEnabled={true}>{mappedActions}</ScrollView>\r\n      </View>\r\n      <ScrollView style={styles.infoContainer} nestedScrollEnabled={true}>\r\n        <TemporaryEffectsViewer />\r\n      </ScrollView>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  emptyText: { fontWeight: \"bold\", fontStyle: \"italic\" },\r\n  row: { flexDirection: \"row\", alignItems: \"center\", marginVertical: 4 },\r\n  mainContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  actionsContainer: {\r\n    flex: 1.5,\r\n    marginRight: 8,\r\n    height: 226,\r\n  },\r\n  infoContainer: { flex: 1, height: 226 },\r\n  mainButton: {\r\n    flex: 1,\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  deleteButton: {\r\n    marginLeft: 8,\r\n  },\r\n  deleteButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 24,\r\n    width: 24,\r\n    borderRadius: 16,\r\n  },\r\n});\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport {\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport InventoryItems from \"../inventory/InventoryItems\";\r\nimport SpellsContainer from \"../spells/SpellsContainer\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\nimport { QuickbarContainer } from \"./QuickbarContainer\";\r\n\r\nexport function ExplorationBottomComponent() {\r\n  const [openedTab, setOpenedTab] = useState(\"\");\r\n  const theme = useTheme();\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setOpenedTab(\"\");\r\n    }\r\n  }, [visible]);\r\n  return (\r\n    <View>\r\n      <View\r\n        style={[\r\n          styles.mainComponent,\r\n          { backgroundColor: theme.theme.colors.grey5 },\r\n          !openedTab && { display: \"none\" },\r\n        ]}\r\n      >\r\n        {openedTab == \"Inventory\" && (\r\n          <ScrollView\r\n            style={[styles.mainScrollView]}\r\n            nestedScrollEnabled={true}\r\n          >\r\n            <InventoryItems disableSelling={true} showQuickbar={true} />\r\n          </ScrollView>\r\n        )}\r\n        <ScrollView\r\n          style={[\r\n            styles.mainScrollView,\r\n            openedTab != \"Spells\" && { display: \"none\" },\r\n          ]}\r\n        >\r\n          <SpellsContainer\r\n            uiKey=\"ExplorationBottomContainer\"\r\n            area=\"Exploration\"\r\n            hideRecent={true}\r\n            showAddToQuickbar={true}\r\n            onlyBySchool={true}\r\n            isVisible={openedTab == \"Spells\"}\r\n          />\r\n        </ScrollView>\r\n        {openedTab == \"Quickbar\" && (\r\n          <View style={styles.quickbarScrollView}>\r\n            <QuickbarContainer />\r\n          </View>\r\n        )}\r\n      </View>\r\n\r\n      <View style={styles.tabsContainer}>\r\n        <TouchableWithoutFeedback\r\n          onPress={() => {\r\n            if (openedTab != \"Inventory\") {\r\n              setOpenedTab(\"Inventory\");\r\n            } else {\r\n              setOpenedTab(\"\");\r\n            }\r\n          }}\r\n        >\r\n          <View\r\n            style={[\r\n              styles.tab,\r\n              { backgroundColor: theme.theme.colors.grey5 },\r\n              openedTab == \"Inventory\" && styles.selectedTab,\r\n            ]}\r\n          >\r\n            <Text h3>Inventory</Text>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        <TouchableWithoutFeedback\r\n          onPress={() => {\r\n            if (openedTab != \"Spells\") {\r\n              setOpenedTab(\"Spells\");\r\n            } else {\r\n              setOpenedTab(\"\");\r\n            }\r\n          }}\r\n        >\r\n          <View\r\n            style={[\r\n              styles.tab,\r\n              { backgroundColor: theme.theme.colors.grey5 },\r\n              openedTab == \"Spells\" && styles.selectedTab,\r\n            ]}\r\n          >\r\n            <Text h3>Spells</Text>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        <TouchableWithoutFeedback\r\n          onPress={() => {\r\n            if (openedTab != \"Quickbar\") {\r\n              setOpenedTab(\"Quickbar\");\r\n            } else {\r\n              setOpenedTab(\"\");\r\n            }\r\n          }}\r\n        >\r\n          <View\r\n            style={[\r\n              styles.tab,\r\n              { backgroundColor: theme.theme.colors.grey5 },\r\n              openedTab == \"Quickbar\" && styles.selectedTab,\r\n            ]}\r\n          >\r\n            <Text h3>Quickbar</Text>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  mainComponent: {\r\n    padding: 8,\r\n    marginHorizontal: 2,\r\n    borderWidth: 0.5,\r\n  },\r\n  mainScrollView: { height: 296 },\r\n  quickbarScrollView: { height: 226 },\r\n  tabsContainer: {\r\n    marginHorizontal: 8,\r\n    marginBottom: 8,\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  tab: {\r\n    borderWidth: 0.5,\r\n    borderRadius: 8,\r\n    marginHorizontal: 8,\r\n    padding: 8,\r\n    top: -1,\r\n    cursor: \"pointer\",\r\n  },\r\n  selectedTab: {\r\n    borderTopLeftRadius: 0,\r\n    borderTopRightRadius: 0,\r\n    borderTopWidth: 0,\r\n    paddingTop: 16,\r\n    position: \"relative\",\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport {\r\n  getExplorationStartTime,\r\n  getExplorationTimeRequirementSec,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { getSecondsPlayed } from \"../../backend/timetick/TotalTimePlayed\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\n\r\nexport function ExplorationProgressDisplay() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const currentTime = getSecondsPlayed(playerContext);\r\n  const actionStartTime = getExplorationStartTime(playerContext);\r\n  const actionTotalTime = getExplorationTimeRequirementSec(playerContext);\r\n  const progress = (currentTime - actionStartTime) / actionTotalTime;\r\n  return (\r\n    <View>\r\n      <ProgressBar progress={progress} useNativeDriver={true} />\r\n    </View>\r\n  );\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  getExplorationStatus,\r\n  getPlayerActionProgress,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../backend/exploration/ExplorationStatus\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\n\r\nexport function PlayerActionDisplay() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const inCombat =\r\n    getExplorationStatus(playerContext) == ExplorationStatus.Combat;\r\n  let progress = 0;\r\n  if (inCombat) {\r\n    progress = getPlayerActionProgress(playerContext);\r\n  }\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"attack\" style={styles.icon} />\r\n        <ProgressBar progress={progress} useNativeDriver={true} width={120} />\r\n      </View>\r\n    ),\r\n    [progress],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  icon: {\r\n    marginRight: 4,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../../backend/exploration/CombatStats\";\r\nimport { getCurrentPlayerHP } from \"../../backend/exploration/Exploration\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { HPBar } from \"./HPBar\";\r\n\r\nexport function PlayerHPBar() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const currentHP = getCurrentPlayerHP(playerContext);\r\n  const maxHP = calculatePlayerMaxHP(playerContext);\r\n  return (\r\n    <HPBar\r\n      empty={false}\r\n      current={currentHP}\r\n      max={maxHP}\r\n      actionTarget={AttackTarget.Player}\r\n    />\r\n  );\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { ScrollView } from \"react-native\";\r\nimport { getMessageLog } from \"../../backend/exploration/Exploration\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\n\r\nexport function PlayerMessageLog() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const messageLog = getMessageLog(playerContext);\r\n  return useMemo(\r\n    () => (\r\n      <ScrollView>\r\n        {messageLog.map((logItem) => (\r\n          <Markdown key={logItem?.id ?? logItem}>\r\n            {logItem?.message ?? logItem}\r\n          </Markdown>\r\n        ))}\r\n      </ScrollView>\r\n    ),\r\n    [messageLog.map((logItem) => logItem?.id ?? logItem).join()],\r\n  );\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Text } from \"react-native-elements\";\r\nimport {\r\n  getCurrentSummonAction,\r\n  getSummonActionProgress,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\n\r\nexport function SummonActionDisplay() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const currentSummonAction = getCurrentSummonAction(playerContext);\r\n  const progress = getSummonActionProgress(playerContext);\r\n  return useMemo(() => {\r\n    if (!currentSummonAction) {\r\n      return (\r\n        <View style={styles.row}>\r\n          <GameIcon icon=\"attack\" style={styles.icon} />\r\n          <View style={styles.progressBarContainer}>\r\n            <Text style={styles.idleTextContainer}>-</Text>\r\n            <ProgressBar progress={0} useNativeDriver={true} width={120} />\r\n          </View>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"attack\" style={styles.icon} />\r\n        <View style={styles.progressBarContainer}>\r\n          <Text numberOfLines={1} style={styles.markdownContainer}>\r\n            {currentSummonAction.name}\r\n          </Text>\r\n          <ProgressBar progress={progress} useNativeDriver={true} width={120} />\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [currentSummonAction?.name, progress]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    width: 156,\r\n  },\r\n  icon: {\r\n    marginRight: 4,\r\n  },\r\n  progressBarContainer: {\r\n    flex: 1,\r\n    height: 32,\r\n  },\r\n  idleTextContainer: {\r\n    height: 18,\r\n  },\r\n  markdownContainer: {\r\n    minHeight: 18,\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport { getCurrentSummon } from \"../../backend/exploration/summons/Summons\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { HPBar } from \"./HPBar\";\r\n\r\nexport function SummonHPBar() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const currentHP = playerContext.exploration?.currentSummon?.currentHP || 0;\r\n  let maxHP = getCurrentSummon(playerContext)?.getMaxHP(playerContext) || 1;\r\n  return (\r\n    <HPBar\r\n      empty={false}\r\n      current={currentHP}\r\n      max={maxHP}\r\n      actionTarget={AttackTarget.Summon}\r\n    />\r\n  );\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport { ImageSourcePropType, StyleSheet, View } from \"react-native\";\r\nimport { Image, useTheme } from \"react-native-elements\";\r\nimport { sanitizeImageSourceForElectron } from \"../utility/icons/IconUtils\";\r\n\r\nexport function SummonSpriteTile(props: { sprite?: ImageSourcePropType }) {\r\n  const theme = useTheme();\r\n  return useMemo(\r\n    () => (\r\n      <View style={[styles.tile, { borderColor: theme.theme.colors.grey5 }]}>\r\n        {props.sprite && (\r\n          <Image\r\n            resizeMode=\"contain\"\r\n            source={sanitizeImageSourceForElectron(props.sprite)}\r\n            style={styles.image}\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [props.sprite, theme],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tile: {\r\n    borderWidth: 1,\r\n    height: 48,\r\n    width: 48,\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  image: {\r\n    height: 46,\r\n    width: 46,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo, useRef } from \"react\";\r\nimport { ActivityIndicator, ScrollView, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { Dungeon } from \"../backend/exploration/dungeons/Dungeon\";\r\nimport { DungeonFloor } from \"../backend/exploration/dungeons/DungeonFloor\";\r\nimport {\r\n  getUnlockedDungeons,\r\n  isDungeonFloorCompletedThisRun,\r\n} from \"../backend/exploration/dungeons/Dungeons\";\r\nimport { getCurrentEnemy } from \"../backend/exploration/enemies/Enemies\";\r\nimport {\r\n  endExploration,\r\n  getCurrentDungeonFloor,\r\n  getExplorationStatus,\r\n  getSuccessfulExplorationsForFloor,\r\n  startBossExploration,\r\n  startExplorationOnFloor,\r\n} from \"../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../backend/exploration/ExplorationStatus\";\r\nimport { hasCurrentActiveSummon } from \"../backend/exploration/Summoning\";\r\nimport { getCurrentSummon } from \"../backend/exploration/summons/Summons\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport { EnemyActionDisplay } from \"./exploration/EnemyActionDisplay\";\r\nimport { EnemyHPBar } from \"./exploration/EnemyHPBar\";\r\nimport { EnemySpriteTile } from \"./exploration/EnemySpriteTile\";\r\nimport { ExplorationBottomComponent } from \"./exploration/ExplorationBottomComponent\";\r\nimport { ExplorationProgressDisplay } from \"./exploration/ExplorationProgressDisplay\";\r\nimport { PlayerActionDisplay } from \"./exploration/PlayerActionDisplay\";\r\nimport { PlayerHPBar } from \"./exploration/PlayerHPBar\";\r\nimport { PlayerMessageLog } from \"./exploration/PlayerMessageLog\";\r\nimport { SummonActionDisplay } from \"./exploration/SummonActionDisplay\";\r\nimport { SummonHPBar } from \"./exploration/SummonHPBar\";\r\nimport { SummonSpriteTile } from \"./exploration/SummonSpriteTile\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { TemporaryEffectsViewer } from \"./utility/TemporaryEffectsViewer\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction ExplorationRow(props: { floor: DungeonFloor }) {\r\n  const floor = props.floor;\r\n  const playerContext = useContext(PlayerContext);\r\n  const isBossUnlocked =\r\n    floor.canFightBoss(playerContext) && floor.getBoss(playerContext) != null;\r\n  const isFloorCompleted = isDungeonFloorCompletedThisRun(playerContext, floor);\r\n  const theme = useTheme();\r\n  return (\r\n    <View>\r\n      <View style={styles.noneRow}>\r\n        <View>\r\n          <Text style={styles.noneFloorText}>{floor.getFloorName()}</Text>\r\n          <View style={styles.noneStatusRow}>\r\n            <Text>Status: </Text>\r\n            {isBossUnlocked ? (\r\n              <MaterialIcons\r\n                name=\"check\"\r\n                size={24}\r\n                style={styles.noneIcon}\r\n                color={\r\n                  isFloorCompleted\r\n                    ? theme.theme.colors.primary\r\n                    : theme.theme.colors.black\r\n                }\r\n              />\r\n            ) : (\r\n              <MaterialIcons\r\n                name=\"lock-open\"\r\n                size={24}\r\n                style={styles.noneIcon}\r\n                color={theme.theme.colors.grey0}\r\n              />\r\n            )}\r\n            <Text>\r\n              {isFloorCompleted\r\n                ? \"Completed\"\r\n                : isBossUnlocked\r\n                ? \"Boss Unlocked\"\r\n                : \"Open for Exploration\"}\r\n            </Text>\r\n          </View>\r\n        </View>\r\n        <Button\r\n          title=\"Explore\"\r\n          onPress={() =>\r\n            playerContext.apply((state) =>\r\n              startExplorationOnFloor(state, floor),\r\n            )\r\n          }\r\n        />\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction ExplorationDungeon(props: { dungeon: Dungeon }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  return (\r\n    <CategoryContainer title={props.dungeon.getName()}>\r\n      <View style={styles.noneDungeonContentsContainer}>\r\n        {props.dungeon\r\n          .getDungeonFloors()\r\n          .filter((floor) => floor.isUnlocked(playerContext))\r\n          .map((floor) => {\r\n            return <ExplorationRow key={floor.getId()} floor={floor} />;\r\n          })}\r\n      </View>\r\n    </CategoryContainer>\r\n  );\r\n}\r\n\r\nfunction ExplorationNone() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const allDungeons = getUnlockedDungeons(playerContext);\r\n  return (\r\n    <ScrollView\r\n      style={styles.container}\r\n      contentContainerStyle={styles.noneContent}\r\n    >\r\n      <View style={styles.topRow}>\r\n        <Text h2>Exploration</Text>\r\n      </View>\r\n      <Text>Select a destination.</Text>\r\n      {allDungeons.map((dungeon) => {\r\n        return <ExplorationDungeon key={dungeon.getId()} dungeon={dungeon} />;\r\n      })}\r\n    </ScrollView>\r\n  );\r\n}\r\n\r\nfunction ExplorationMain() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const explorationStatus = getExplorationStatus(playerContext);\r\n\r\n  const dungeonFloor = getCurrentDungeonFloor(playerContext);\r\n  const dungeonTitle = dungeonFloor.getFloorName();\r\n  const currentEnemySprite =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(playerContext).getPicture(playerContext);\r\n  const toUnlockBoss =\r\n    dungeonFloor.getExplorationSuccessesForBoss(playerContext) -\r\n    getSuccessfulExplorationsForFloor(playerContext, dungeonFloor.getId());\r\n  const currentEnemyName =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(playerContext).getName();\r\n\r\n  const checkmark =\r\n    getSuccessfulExplorationsForFloor(playerContext, dungeonFloor.getId()) >=\r\n    dungeonFloor.getExplorationSuccessesForBoss(playerContext);\r\n  const hasBoss = dungeonFloor.getBoss(playerContext) != null;\r\n  const canFightBoss = dungeonFloor.canFightBoss(playerContext);\r\n  const canMoveToNextFloor = dungeonFloor\r\n    .getNextFloor()\r\n    ?.isUnlocked(playerContext);\r\n\r\n  const explorationStatusContainer = useMemo(() => {\r\n    let explorationStatusContainer = null;\r\n    if (explorationStatus == ExplorationStatus.Combat) {\r\n      explorationStatusContainer = (\r\n        <ScrollView\r\n          centerContent={false}\r\n          style={styles.explorationStatusContainer}\r\n        >\r\n          <Text h3>{currentEnemyName}</Text>\r\n          <EnemyHPBar />\r\n          <EnemyActionDisplay />\r\n          <TemporaryEffectsViewer isEnemy={true} />\r\n        </ScrollView>\r\n      );\r\n    } else if (\r\n      explorationStatus == ExplorationStatus.Exploring ||\r\n      explorationStatus == ExplorationStatus.ExploringBoss\r\n    ) {\r\n      explorationStatusContainer = (\r\n        <View style={styles.explorationStatusContainer}>\r\n          <Text h3>Exploring...</Text>\r\n          <ExplorationProgressDisplay />\r\n        </View>\r\n      );\r\n    } else if (explorationStatus == ExplorationStatus.Reviving) {\r\n      explorationStatusContainer = (\r\n        <View style={styles.explorationStatusContainer}>\r\n          <Text h3>Recovering...</Text>\r\n          <ActivityIndicator />\r\n        </View>\r\n      );\r\n    }\r\n    return explorationStatusContainer;\r\n  }, [explorationStatus, currentEnemyName]);\r\n\r\n  const hasActiveSummon = hasCurrentActiveSummon(playerContext);\r\n  const currentSummonSprite =\r\n    hasActiveSummon && getCurrentSummon(playerContext)?.getPicture();\r\n\r\n  const isFloorCompleted = isDungeonFloorCompletedThisRun(\r\n    playerContext,\r\n    dungeonFloor,\r\n  );\r\n  const { theme } = useTheme();\r\n\r\n  const backdropColor =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(playerContext).getBackdropColor();\r\n\r\n  const topContainer = useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={[styles.row, styles.enemyContainer]}>\r\n          <EnemySpriteTile\r\n            sprite={currentEnemySprite}\r\n            backdropColor={backdropColor}\r\n          />\r\n          {explorationStatusContainer}\r\n        </View>\r\n        <Divider />\r\n        <View style={[styles.row, styles.playerContainer]}>\r\n          <View style={{ flex: 1, marginRight: 4 }}>\r\n            <PlayerHPBar />\r\n          </View>\r\n          <PlayerActionDisplay />\r\n        </View>\r\n        {hasActiveSummon && (\r\n          <View style={[styles.row, styles.summonContainer]}>\r\n            <SummonSpriteTile sprite={currentSummonSprite} />\r\n            <View style={{ flex: 1, marginLeft: 4, marginRight: 4 }}>\r\n              <SummonHPBar />\r\n            </View>\r\n            <SummonActionDisplay />\r\n          </View>\r\n        )}\r\n        <View style={[styles.row, styles.runAway]}>\r\n          <View style={[styles.row, styles.unlockBossContainer]}>\r\n            {checkmark && (\r\n              <MaterialIcons\r\n                name=\"check\"\r\n                size={24}\r\n                style={styles.checkmark}\r\n                color={\r\n                  isFloorCompleted ? theme.colors.primary : theme.colors.black\r\n                }\r\n              />\r\n            )}\r\n            <View style={styles.unlockBossTextContainer}>\r\n              <Text numberOfLines={2}>\r\n                {isFloorCompleted\r\n                  ? \"Floor complete!\"\r\n                  : canFightBoss\r\n                  ? \"Boss unlocked\"\r\n                  : hasBoss\r\n                  ? `To unlock boss: ${toUnlockBoss}`\r\n                  : \"\"}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n          <View style={styles.row}>\r\n            <Button\r\n              containerStyle={styles.exitButtonContainer}\r\n              title=\"Exit\"\r\n              titleStyle={styles.smallButtonTitle}\r\n              onPress={() => playerContextRef.current.apply(endExploration)}\r\n            />\r\n            <Button\r\n              containerStyle={styles.exitButtonContainer}\r\n              title=\"Next Floor\"\r\n              titleStyle={styles.smallButtonTitle}\r\n              onPress={() =>\r\n                playerContextRef.current.apply((state) =>\r\n                  startExplorationOnFloor(\r\n                    state,\r\n                    getCurrentDungeonFloor(\r\n                      state,\r\n                    ).getNextFloor() as DungeonFloor,\r\n                  ),\r\n                )\r\n              }\r\n              disabled={!canMoveToNextFloor}\r\n            />\r\n            <Button\r\n              title=\"Fight Boss\"\r\n              titleStyle={styles.smallButtonTitle}\r\n              onPress={() =>\r\n                playerContextRef.current.apply(startBossExploration)\r\n              }\r\n              disabled={!canFightBoss}\r\n            />\r\n          </View>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      currentEnemySprite,\r\n      explorationStatusContainer,\r\n      toUnlockBoss,\r\n      checkmark,\r\n      canFightBoss,\r\n      hasBoss,\r\n      playerContextRef,\r\n      startBossExploration,\r\n      endExploration,\r\n      canMoveToNextFloor,\r\n      hasActiveSummon,\r\n      currentSummonSprite,\r\n      isFloorCompleted,\r\n      backdropColor,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.wholeContainer}>\r\n        <View style={styles.container}>\r\n          <View style={[styles.topRow]}>\r\n            <MaterialIcons\r\n              name=\"arrow-back\"\r\n              size={24}\r\n              color={theme.colors.black}\r\n              style={styles.arrowBack}\r\n              onPress={() => playerContextRef.current.apply(endExploration)}\r\n              hitSlop={{ top: 30, left: 30, bottom: 30, right: 30 }}\r\n            />\r\n            <Text h2>Exploration - {dungeonTitle}</Text>\r\n          </View>\r\n          <View style={styles.restOfScreen}>\r\n            {topContainer}\r\n            <View style={styles.playerMessageLogContainer}>\r\n              <PlayerMessageLog />\r\n            </View>\r\n          </View>\r\n        </View>\r\n        <View style={styles.bottomComponentContainer}>\r\n          <ExplorationBottomComponent />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [playerContextRef, endExploration, dungeonTitle, topContainer, theme],\r\n  );\r\n}\r\n\r\nexport default function Exploration() {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const explorationStatus = getExplorationStatus(playerContext);\r\n\r\n  if (explorationStatus == ExplorationStatus.None) {\r\n    return <ExplorationNone />;\r\n  }\r\n\r\n  // We are exploring, reviving, or in combat\r\n  return <ExplorationMain />;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  wholeContainer: { flex: 1 },\r\n  container: {\r\n    flex: 1,\r\n    padding: 8,\r\n  },\r\n  topRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n    marginBottom: 16,\r\n    height: 40,\r\n  },\r\n  arrowBack: {\r\n    marginRight: 8,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  checkmark: {\r\n    marginRight: 8,\r\n  },\r\n  enemyContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  playerContainer: {\r\n    marginTop: 8,\r\n  },\r\n  summonContainer: {\r\n    marginTop: 8,\r\n  },\r\n  playerMessageLogContainer: {\r\n    flex: 1,\r\n    padding: 8,\r\n    borderColor: \"#444\",\r\n    borderWidth: 1,\r\n    marginTop: 8,\r\n  },\r\n  moveRow: {\r\n    marginTop: 8,\r\n  },\r\n  exitButtonContainer: { marginRight: 4 },\r\n  explorationStatusContainer: {\r\n    flex: 1,\r\n    maxHeight: 210,\r\n  },\r\n  restOfScreen: {\r\n    flex: 1,\r\n    justifyContent: \"space-between\",\r\n    marginBottom: 48,\r\n  },\r\n  bottomComponentContainer: {\r\n    position: \"absolute\",\r\n    left: 0,\r\n    bottom: 0,\r\n    width: \"100%\",\r\n  },\r\n  dungeonButton: {\r\n    marginTop: 8,\r\n  },\r\n  gradient: {\r\n    left: 0,\r\n    top: 0,\r\n    width: \"100%\",\r\n    height: \"60%\",\r\n    position: \"absolute\",\r\n    opacity: 0.3,\r\n  },\r\n  noneContent: {\r\n    paddingBottom: 32,\r\n  },\r\n  noneDungeonContentsContainer: {\r\n    marginTop: 8,\r\n  },\r\n  noneRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    paddingVertical: 4,\r\n  },\r\n  noneStatusRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n  },\r\n  noneFloorText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  noneIcon: {\r\n    marginHorizontal: 4,\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  runAway: {\r\n    marginTop: 4,\r\n  },\r\n  unlockBossContainer: { flex: 1, justifyContent: \"flex-start\" },\r\n  unlockBossTextContainer: { flex: 1 },\r\n});\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\n\r\nexport type Help = {\r\n  title: string;\r\n  description: string;\r\n  descriptionWeb?: string;\r\n  order: number;\r\n  isVisible: (state: PlayerContextState) => boolean;\r\n};\r\n\r\nlet helpsDatabase: Help[] = [];\r\n\r\nconst Helps = new DataStore<Help>();\r\n\r\nexport { Helps };\r\n\r\nexport function getVisibleHelps(state: PlayerContextState): Help[] {\r\n  return Helps.getAll()\r\n    .filter((help) => help.isVisible(state))\r\n    .sort((a, b) => a.order - b.order);\r\n}\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, { useMemo } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { Help } from \"../../backend/help/Helps\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function HelpContainer(props: {\r\n  help: Help;\r\n  collapsed?: boolean;\r\n  onPressExpand?: () => void;\r\n}) {\r\n  const help = props.help;\r\n  const title = help.title;\r\n  const description = help.description;\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <Markdown style={styles.descriptionViewer}>{description}</Markdown>\r\n      </View>\r\n    );\r\n  }, [description]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.helpContainer} key={title}>\r\n        <TouchableWithoutFeedback onPress={props.onPressExpand}>\r\n          <View style={styles.topRowContainer}>\r\n            <Text h3 key={title} style={[styles.topContainer]}>\r\n              {title}\r\n            </Text>\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.theme.colors.black}\r\n              />\r\n            </View>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        {!props.collapsed && <View>{descriptionContainer}</View>}\r\n      </View>\r\n    );\r\n  }, [\r\n    theme,\r\n    title,\r\n    !props.collapsed && descriptionContainer,\r\n    props.collapsed,\r\n    props.onPressExpand,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  helpContainer: { marginVertical: 8 },\r\n  topRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginBottom: 8,\r\n    marginTop: 8,\r\n    marginHorizontal: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  descriptionViewer: { flex: 1, justifyContent: \"center\" },\r\n  topContainer: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n  },\r\n  disabledStorylineText: {\r\n    color: \"#aaa\",\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { getVisibleHelps } from \"../backend/help/Helps\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { HelpContainer } from \"./utility/HelpContainer\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction HelpsContainer() {\r\n  const [expandedHelp, setExpandedHelp] = useState(\"\");\r\n  const setHelpCallback = useCallback(\r\n    (title: string) => {\r\n      if (expandedHelp == title) {\r\n        setExpandedHelp(\"\");\r\n      } else {\r\n        setExpandedHelp(title);\r\n      }\r\n    },\r\n    [expandedHelp],\r\n  );\r\n\r\n  const playerContext = useContext(PlayerContext);\r\n  const allHelps = getVisibleHelps(playerContext);\r\n\r\n  const helpNameString = allHelps.map((help) => help.title).join(\",\");\r\n\r\n  const helpContainers = useMemo(\r\n    () =>\r\n      allHelps.map((help) => {\r\n        return (\r\n          <HelpContainer\r\n            key={help.title}\r\n            help={help}\r\n            collapsed={expandedHelp != help.title}\r\n            onPressExpand={setHelpCallback.bind(null, help.title)}\r\n          />\r\n        );\r\n      }),\r\n    [helpNameString, expandedHelp, setExpandedHelp],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (allHelps.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <View>\r\n        {helpContainers.map((helpContainer, idx) => {\r\n          return (\r\n            <View key={allHelps[idx].title}>\r\n              <Divider />\r\n              {helpContainer}\r\n            </View>\r\n          );\r\n        })}\r\n        <Divider />\r\n      </View>\r\n    );\r\n  }, [helpNameString, helpContainers]);\r\n}\r\n\r\nexport default function Help() {\r\n  return (\r\n    <View>\r\n      <View style={styles.headerContainer}>\r\n        <Text h1>Help</Text>\r\n      </View>\r\n\r\n      <Text>Learn how to play the game!</Text>\r\n      <View style={styles.helpContainer}>\r\n        <HelpsContainer />\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  headerContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  valueText: {\r\n    minWidth: 60,\r\n    textAlign: \"right\",\r\n    marginLeft: 8,\r\n  },\r\n  valueTextLong: {\r\n    minWidth: 112,\r\n  },\r\n  helpContainer: {\r\n    marginTop: 16,\r\n  },\r\n  captionText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { openURL } from \"expo-linking\";\r\nimport { PlayerContextState } from \"../backend/PlayerContext\";\r\nimport { serializeSaveData } from \"../backend/SaveData\";\r\n\r\nexport type LoadResult =\r\n  | {\r\n      result: \"success\";\r\n      data: PlayerContextState;\r\n    }\r\n  | {\r\n      result: \"cancel\";\r\n    }\r\n  | {\r\n      result: \"error\";\r\n      error: string;\r\n    };\r\n\r\nexport type SaveResult =\r\n  | {\r\n      result: \"success\";\r\n    }\r\n  | {\r\n      result: \"cancel\";\r\n    }\r\n  | {\r\n      result: \"error\";\r\n      error: string;\r\n    };\r\n\r\nexport async function loadSaveFromFile(): Promise<LoadResult> {\r\n  return { result: \"error\", error: \"Not implemented\" };\r\n}\r\n\r\nexport async function saveToFile(\r\n  state: PlayerContextState,\r\n): Promise<SaveResult> {\r\n  const serializedData = await serializeSaveData(state);\r\n  await openURL(\"data:application/octet-stream;utf8,\" + serializedData);\r\n  return { result: \"success\" };\r\n}\r\n","import { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { Button, Input, useTheme } from \"react-native-elements\";\r\nimport Demo from \"../../backend/Demo\";\r\nimport { PlayerContext, PlayerContextState } from \"../../backend/PlayerContext\";\r\nimport { loadBase64Data, saveDataUnsafe } from \"../../backend/SaveData\";\r\nimport { loadSaveFromFile } from \"../../utils/FilesystemSave\";\r\nimport { getCurrentVersionTimestamp } from \"../../utils/Versioning\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport default function LoadGameContainer() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  const [loadMessage, setLoadMessage] = useState(\"\");\r\n  const [loadSaveContents, setLoadSaveContents] = useState(\"\");\r\n\r\n  const loadSaveFromDeserializedData = useCallback(\r\n    async (deserializedData: PlayerContextState) => {\r\n      try {\r\n        // Only in the demo version, fail loading saves coming from the full version.\r\n        const isDemo = Demo.isDemo();\r\n        if (isDemo && deserializedData.global.isFullVersionSave) {\r\n          setLoadMessage(\r\n            \"Failed to load save. This save data belongs to the full version of the game, and cannot be used in the demo version.\",\r\n          );\r\n          return;\r\n        }\r\n\r\n        // Only in the full version, fail loading saves coming from the full version\r\n        // if they come from a future version.\r\n        const currentAppVersionTimestamp =\r\n          getCurrentVersionTimestamp() || +Infinity;\r\n        if (\r\n          currentAppVersionTimestamp <\r\n            deserializedData.global.appVersionTimestamp - 1000 * 60 * 60 * 24 &&\r\n          !isDemo &&\r\n          deserializedData.global.isFullVersionSave\r\n        ) {\r\n          setLoadMessage(\r\n            \"Failed to load save. This save data was made with a more recent version of the game. Please update your game and try again. If no update is available, please try restarting the game or your device several times and loading the save again.\",\r\n          );\r\n          return;\r\n        }\r\n        playerContextRef.current.overwrite((_oldState) => {\r\n          return deserializedData;\r\n        });\r\n        await saveDataUnsafe(deserializedData);\r\n        setLoadMessage(\"Load successful!\");\r\n      } catch (e) {\r\n        setLoadMessage(\r\n          \"Failed to load save because of an unexpected error! Is the data valid?\",\r\n        );\r\n      }\r\n    },\r\n    [],\r\n  );\r\n  const importSavefile = useCallback(async () => {\r\n    if (loadSaveContents === \"\") {\r\n      setLoadMessage(\r\n        \"Please paste your save in the text field above this message first!\",\r\n      );\r\n      return;\r\n    }\r\n    try {\r\n      const deserializedData = await loadBase64Data(loadSaveContents);\r\n      if (deserializedData != null) {\r\n        await loadSaveFromDeserializedData(deserializedData);\r\n      } else {\r\n        setLoadMessage(\r\n          \"Failed to load save. Make sure you have copied the full text!\",\r\n        );\r\n      }\r\n    } catch (e) {\r\n      setLoadMessage(\r\n        \"Failed to load save. Make sure you have copied the full text!\",\r\n      );\r\n    }\r\n  }, [loadSaveContents, loadSaveFromDeserializedData]);\r\n  useEffect(() => setLoadMessage(\"\"), [loadSaveContents]);\r\n\r\n  const theme = useTheme();\r\n\r\n  const showByFile = Platform.select({\r\n    default: false,\r\n    ios: true,\r\n    android: true,\r\n  });\r\n\r\n  const importSavefileFromFile = useCallback(async () => {\r\n    try {\r\n      const result = await loadSaveFromFile();\r\n      if (result.result === \"error\") {\r\n        setLoadMessage(\r\n          \"There was an error reading from the file. Is it a valid Magic Research save?\",\r\n        );\r\n      }\r\n      if (result.result === \"success\") {\r\n        await loadSaveFromDeserializedData(result.data);\r\n      }\r\n    } catch (e) {\r\n      setLoadMessage(\r\n        \"There was an error reading from the file. Is it a valid Magic Research save?\",\r\n      );\r\n    }\r\n  }, [loadSaveFromDeserializedData]);\r\n\r\n  return (\r\n    <View>\r\n      <Input\r\n        multiline={true}\r\n        onChangeText={setLoadSaveContents}\r\n        value={loadSaveContents}\r\n        inputContainerStyle={styles.inputContainer}\r\n        containerStyle={styles.loadInputContainer}\r\n      />\r\n      {loadMessage != \"\" && (\r\n        <View style={styles.loadMessageContainer}>\r\n          <Text style={{ color: theme.theme.colors.error }}>{loadMessage}</Text>\r\n        </View>\r\n      )}\r\n      {loadSaveContents != \"\" || !showByFile ? (\r\n        <Button onPress={importSavefile} title={\"Import savefile\"} />\r\n      ) : (\r\n        <Button onPress={importSavefileFromFile} title={\"Load from file\"} />\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  inputContainer: {\r\n    borderWidth: 1,\r\n    marginTop: 16,\r\n    maxHeight: 48,\r\n  },\r\n  loadInputContainer: {\r\n    maxHeight: 80,\r\n  },\r\n  loadMessageContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  importByFileContainer: {\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import React, { useContext, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ButtonGroup, Card, useTheme } from \"react-native-elements\";\r\nimport Demo from \"../backend/Demo\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport {\r\n  getMaxPrimarySchoolLevel,\r\n  getUnlockedElements,\r\n  getUnlockedSchools,\r\n  School,\r\n  selectPrimaryElement,\r\n  selectPrimarySchool,\r\n} from \"../backend/spells/ElementsAndSchools\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport LoadGameContainer from \"./utility/LoadGameContainer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { showImportFromFile } from \"./utility/Miscellaneous\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function Intro() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const [selectedSchoolIndex, setSelectedSchoolIndex] = useState(\r\n    null as number | null,\r\n  );\r\n  const [selectedElementIndex, setSelectedElementIndex] = useState(\r\n    null as number | null,\r\n  );\r\n  const schools = getUnlockedSchools(playerContext);\r\n  const elements = getUnlockedElements(playerContext);\r\n\r\n  const selectedMPL =\r\n    selectedSchoolIndex != null\r\n      ? getMaxPrimarySchoolLevel(playerContext, schools[selectedSchoolIndex])\r\n      : 0;\r\n  const isFirstTime = (playerContext?.global?.totalTimesResetted ?? 0) === 0;\r\n  const showLoadGameContainer = !Demo.isDemo() && isFirstTime;\r\n\r\n  const loadText = showImportFromFile()\r\n    ? \"If you have a save data from the demo version of the game, you may load it by opening the save file, or pasting it here.\"\r\n    : \"If you have a save data from the demo version of the game, you may load it by pasting it here.\";\r\n  const beginnerText = isFirstTime\r\n    ? \"**If it's your first time playing, choosing Conjuration is recommended.**\"\r\n    : \"\";\r\n\r\n  const primarySchoolText = `Please choose a primary school of magic. ${beginnerText}`;\r\n\r\n  const schoolDescriptionMap: Record<School, string> = {\r\n    Conjuration:\r\n      \"You have selected **Conjuration**! Conjuration is the school that studies creating permanent or semi-permanent physical objects out of nothing. An example spell is *Create Pebble*. **This school is recommended for beginners.**\",\r\n    Enchantment:\r\n      \"You have selected **Enchantment**! Enchantment is the school that studies temporarily altering the physical properties of existing objects or creatures. An example spell is *Enchant Mana Spouts*.\",\r\n    Illusion:\r\n      \"You have selected **Illusion**! Illusion is the school that studies altering people's perception of reality. It's often one of the best ways to make money. An example spell is *Wind Show*.\",\r\n    Alchemy:\r\n      \"You have selected **Alchemy**! Alchemy is the school that studies transforming objects or materials into powerful potions, with various effects. There are also legends that it might be possible to create gold using alchemy.\",\r\n    Evocation:\r\n      \"You have selected **Evocation**! Evocation is the school that studies damaging combat spells, with the intention to cause harm or destroy. An example spell is *Mana Spike*.\",\r\n    Protection:\r\n      \"You have selected **Protection**! Protection is the school that studies spells that provide shielding from adverse effects, as well as mend them. An example spell is *Heal*.\",\r\n    Breeding:\r\n      \"You have selected **Breeding**! Breeding is the school that studies the ability to raise monsters to do your will, exploring and obtaining materials for you.\",\r\n    Summoning:\r\n      \"You have selected **Summoning**! Summoning is the school that studies invoking monsters out of thin air, to aid you in combat by enduring blows and attacking en enemy. An example spell is *Summon Mouse*.\",\r\n    Divination:\r\n      \"You have selected **Divination**! Divination is the school that studies learning the unknown by using magic, which can make you more effective. An example spell is *Minor Divination*.\",\r\n  };\r\n  const elementDescriptionMap: Record<string, string> = {\r\n    Fire: \"You have selected **Fire**! A basic element, it is often quite dangerous but powerful. Fire is key to creating higher temperatures.\",\r\n    Earth:\r\n      \"You have selected **Earth**! A basic element, one that we often deal with. Includes spells related to metals.\",\r\n    Water:\r\n      \"You have selected **Water**! A basic element, represents water in its various forms, including ice and snow.\",\r\n    Air: \"You have selected **Air**! A basic element, it's all around us. It can be very useful when we want to move quicker.\",\r\n    Nature:\r\n      \"You have selected **Nature**! An element composed of plant life. Great for poisoning effects and gathering wood.\",\r\n    Lightning:\r\n      \"You have selected **Lightning**! An element that embodies a unique type of energy. Good for fast, high damage.\",\r\n    Darkness:\r\n      \"You have selected **Darkness**! A forbidden element, with extreme strength - and with some link to dead things...\",\r\n  };\r\n\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View>\r\n        <View style={styles.topView}>\r\n          <Text h1>Welcome to Magic Research!</Text>\r\n          <Text style={styles.topViewText}>\r\n            In Magic Research, you are the headmaster of a magical institution.\r\n            What sort of adventures await you?\r\n          </Text>\r\n          <Text style={styles.topViewText}>\r\n            Before you begin, you will need to choose a primary school of magic\r\n            and a primary element. While you may cast spells from any schools,\r\n            it will be easier to learn new spells in your primary school. Your\r\n            primary element selection may affect availability and effects of\r\n            various spells, among other things. You will be able to change these\r\n            (via retirement) later in the game.\r\n          </Text>\r\n        </View>\r\n        <UtilityCard>\r\n          <Card.Title>Schools</Card.Title>\r\n          <Markdown>{primarySchoolText}</Markdown>\r\n          <View>\r\n            <ButtonGroup\r\n              buttonStyle={\r\n                theme.theme.mode === \"dark\" && {\r\n                  borderColor: theme.theme.colors.grey5,\r\n                  borderBottomWidth: StyleSheet.hairlineWidth,\r\n                }\r\n              }\r\n              containerStyle={[\r\n                styles.buttonGroupContainer,\r\n                theme.theme.mode === \"dark\" && {\r\n                  backgroundColor: theme.theme.colors.grey4,\r\n                  borderColor: theme.theme.colors.grey5,\r\n                  borderBottomWidth: 0,\r\n                },\r\n              ]}\r\n              textStyle={[\r\n                styles.buttonGroupText,\r\n                theme.theme.mode === \"dark\" && { color: \"#fff\" },\r\n              ]}\r\n              vertical={true}\r\n              onPress={setSelectedSchoolIndex}\r\n              selectedIndex={selectedSchoolIndex}\r\n              buttons={schools}\r\n            />\r\n          </View>\r\n          <View>\r\n            {selectedSchoolIndex != undefined && (\r\n              <View>\r\n                <Markdown>\r\n                  {schoolDescriptionMap[schools[selectedSchoolIndex]]}\r\n                </Markdown>\r\n                {selectedMPL > 0 ? (\r\n                  <Text style={styles.mplText}>\r\n                    Your Maximum Primary Level (MPL) for this school is{\" \"}\r\n                    {selectedMPL}.\r\n                  </Text>\r\n                ) : (\r\n                  false\r\n                )}\r\n              </View>\r\n            )}\r\n          </View>\r\n        </UtilityCard>\r\n        <UtilityCard>\r\n          <Card.Title>Elements</Card.Title>\r\n          <Text>Please choose a primary element.</Text>\r\n          <ButtonGroup\r\n            buttonStyle={\r\n              theme.theme.mode === \"dark\" && {\r\n                borderColor: theme.theme.colors.grey5,\r\n                borderBottomWidth: StyleSheet.hairlineWidth,\r\n              }\r\n            }\r\n            containerStyle={[\r\n              styles.buttonGroupContainer,\r\n              theme.theme.mode === \"dark\" && {\r\n                backgroundColor: theme.theme.colors.grey4,\r\n                borderColor: theme.theme.colors.grey5,\r\n                borderBottomWidth: 0,\r\n              },\r\n            ]}\r\n            textStyle={[\r\n              styles.buttonGroupText,\r\n              theme.theme.mode === \"dark\" && { color: \"#fff\" },\r\n            ]}\r\n            vertical={true}\r\n            onPress={setSelectedElementIndex}\r\n            selectedIndex={selectedElementIndex}\r\n            buttons={elements}\r\n          />\r\n          <View>\r\n            {selectedElementIndex != undefined && (\r\n              <Markdown>\r\n                {elementDescriptionMap[elements[selectedElementIndex]]}\r\n              </Markdown>\r\n            )}\r\n          </View>\r\n        </UtilityCard>\r\n        <Button\r\n          containerStyle={styles.startButton}\r\n          title=\"Start the Game!\"\r\n          disabled={\r\n            selectedSchoolIndex == undefined ||\r\n            selectedElementIndex == undefined\r\n          }\r\n          onPress={() => {\r\n            const selectedSchool = schools[selectedSchoolIndex as number];\r\n            const selectedElement = elements[selectedElementIndex as number];\r\n            playerContext.apply((state) => {\r\n              state = selectPrimarySchool(selectedSchool)(state);\r\n              state = selectPrimaryElement(selectedElement)(state);\r\n              state.lastProcessedTime = Date.now();\r\n              return state;\r\n            });\r\n          }}\r\n        />\r\n        {showLoadGameContainer && (\r\n          <View>\r\n            <Text>{loadText}</Text>\r\n            <LoadGameContainer />\r\n          </View>\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"center\",\r\n    justifyContent: \"flex-start\",\r\n    maxWidth: 600,\r\n  },\r\n  topView: {\r\n    paddingHorizontal: 16,\r\n  },\r\n  topViewText: {\r\n    marginTop: 8,\r\n  },\r\n  buttonGroupContainer: {\r\n    marginVertical: 16,\r\n  },\r\n  buttonGroupText: {\r\n    fontSize: 14,\r\n  },\r\n  startButton: {\r\n    marginVertical: 24,\r\n  },\r\n  mplText: {\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import { registerGameEvent } from \"./Events\";\r\nimport { EventMessage, EventTag, EventTransform, GameEvent } from \"./GameEvent\";\r\n\r\nclass SimpleGameEvent implements GameEvent {\r\n  constructor(\r\n    private id: string,\r\n    private message: EventMessage,\r\n    private tags: EventTag[],\r\n    private onTriggerTransform?: EventTransform,\r\n  ) {\r\n    registerGameEvent(this);\r\n  }\r\n\r\n  onTrigger(): EventTransform | undefined {\r\n    return this.onTriggerTransform;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getMainEventMessage(): EventMessage {\r\n    return this.message;\r\n  }\r\n\r\n  getTags(): EventTag[] {\r\n    return this.tags;\r\n  }\r\n}\r\n\r\nexport function createGameEvent(\r\n  id: string,\r\n  message: EventMessage,\r\n  tags: EventTag[],\r\n  onTrigger?: EventTransform,\r\n): GameEvent {\r\n  return new SimpleGameEvent(id, message, tags, onTrigger);\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { registerEventMessage } from \"./Events\";\r\nimport {\r\n  EventMessage,\r\n  EventMessageOption,\r\n  EventTag,\r\n  EventTransform,\r\n  GameEvent,\r\n} from \"./GameEvent\";\r\nimport { createGameEvent } from \"./SimpleGameEvent\";\r\n\r\n/*\r\nUsage:\r\n\r\nconst staffEventBuilder = buildEvent(\"RandomSpoutEvents_1\", \"Found a staff!\");\r\nstaffEventBuilder.createMessage()\r\n  .setSimpleDescription(\"A staff was found on the ground.\")\r\n  .addOption(\r\n    \"Pick up\",\r\n    { transform: grantResource(Resource.Mana, -100) },  \r\n    staffEventBuilder.createMessage()\r\n      .setSimpleDescription(\r\n        \"You pick up the staff. It's cursed! You feel your mana getting drained.\",\r\n      ),\r\n  )\r\n  .addOption(\r\n    \"Destroy\",\r\n    staffEventBuilder.createMessage()\r\n      .setSimpleDescription(\r\n        \"You destroy the staff. Wonder what it could have been...\",\r\n      ),\r\n  );\r\n\r\nconst staffEvent = staffEventBuilder.build();\r\n*/\r\n\r\nexport const CONFIRM_OPTION = {\r\n  description: \"Close\",\r\n};\r\n\r\ntype EventMessageOptionWithVisibility = {\r\n  option: Omit<EventMessageOption, \"isEnabled\">;\r\n  isVisible?: (state: PlayerContextState, params?: any) => boolean;\r\n  isEnabled?: (state: PlayerContextState, params?: any) => boolean;\r\n};\r\n\r\nfunction replaceWithParams(text: string, params: any) {\r\n  if (!params) {\r\n    return text;\r\n  }\r\n  Object.keys(params)\r\n    .map((key) => [\r\n      \"{\" + key + \"}\",\r\n      isNaN(params[key]) || params[key] === \"\"\r\n        ? params[key]\r\n        : formatNumber(params[key]),\r\n    ])\r\n    .forEach((replacement) => {\r\n      text = text.replace(replacement[0], replacement[1]);\r\n    });\r\n  return text;\r\n}\r\n\r\nexport class EventMessageImpl implements EventMessage {\r\n  constructor(\r\n    private id: string,\r\n    private title: string,\r\n    private description: (state: PlayerContextState) => string,\r\n    private options: EventMessageOptionWithVisibility[],\r\n  ) {\r\n    registerEventMessage(this);\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n  getTitle(params: any): string {\r\n    return replaceWithParams(this.title, params);\r\n  }\r\n  getDescription(state: PlayerContextState, params: any): string {\r\n    return replaceWithParams(this.description(state), params);\r\n  }\r\n  getAllowedOptions(\r\n    state: PlayerContextState,\r\n    params: any,\r\n  ): EventMessageOption[] {\r\n    return this.options\r\n      .filter(\r\n        (option) => option.isVisible == null || option.isVisible(state, params),\r\n      )\r\n      .map((option) => ({\r\n        ...option.option,\r\n        description: replaceWithParams(option.option.description, params),\r\n        isEnabled: option.isEnabled == null || option.isEnabled(state, params),\r\n      }));\r\n  }\r\n  isTerminal(): boolean {\r\n    return this.options.every(\r\n      (option) => !option.option.nextMessage && !option.option.transform,\r\n    );\r\n  }\r\n  isActionable(state: PlayerContextState, params: any): boolean {\r\n    return this.getAllowedOptions(state, params).some(\r\n      (option) => (option.nextMessage || option.transform) && option.isEnabled,\r\n    );\r\n  }\r\n}\r\n\r\nclass EventMessageBuilder {\r\n  constructor(private id: string, private title: string) {}\r\n  description: (state: PlayerContextState) => string = () => \"\";\r\n  options: EventMessageOptionWithVisibility[] = [];\r\n\r\n  setDescription(description: (state: PlayerContextState) => string) {\r\n    this.description = description;\r\n    return this;\r\n  }\r\n\r\n  setSimpleDescription(description: string) {\r\n    this.setDescription((state: PlayerContextState) => description);\r\n    return this;\r\n  }\r\n\r\n  addOption(\r\n    description: string,\r\n    nextMessage?: EventMessage,\r\n    transform?: (state: PlayerContextState, params: any) => PlayerContextState,\r\n    isVisible?: (state: PlayerContextState, params: any) => boolean,\r\n    isEnabled?: (state: PlayerContextState, params: any) => boolean,\r\n  ) {\r\n    this.options.push({\r\n      option: {\r\n        description,\r\n        transform,\r\n        nextMessage,\r\n      },\r\n      isVisible,\r\n      isEnabled,\r\n    });\r\n    return this;\r\n  }\r\n\r\n  build(): EventMessage {\r\n    return new EventMessageImpl(\r\n      this.id,\r\n      this.title,\r\n      this.description,\r\n      this.options.length > 0 ? this.options : [{ option: CONFIRM_OPTION }],\r\n    );\r\n  }\r\n}\r\n\r\ntype EventMessageOptionStub = {\r\n  description: string;\r\n  nextMessage?: EventMessageBuilderDeluxe | EventMessage;\r\n  transform?: (state: PlayerContextState, params: any) => PlayerContextState;\r\n  isVisible?: (state: PlayerContextState, params: any) => boolean;\r\n  isEnabled?: (state: PlayerContextState, params: any) => boolean;\r\n};\r\n\r\nclass EventMessageBuilderDeluxe {\r\n  id: string;\r\n  description: (state: PlayerContextState) => string = () => \"\";\r\n  options: EventMessageOptionStub[] = [];\r\n\r\n  constructor(private eventBuilder: EventBuilder) {\r\n    this.id = this.eventBuilder.newMessageId();\r\n  }\r\n\r\n  setDescription(description: (state: PlayerContextState) => string) {\r\n    this.description = description;\r\n    return this;\r\n  }\r\n\r\n  setSimpleDescription(description: string) {\r\n    this.setDescription((state: PlayerContextState) => description);\r\n    return this;\r\n  }\r\n\r\n  addOption(\r\n    description: string,\r\n    paramsOrNextMessage:\r\n      | {\r\n          transform?: (\r\n            state: PlayerContextState,\r\n            params: any,\r\n          ) => PlayerContextState;\r\n          isVisible?: (state: PlayerContextState, params: any) => boolean;\r\n          isEnabled?: (state: PlayerContextState, params: any) => boolean;\r\n        }\r\n      | EventMessageBuilderDeluxe = {},\r\n    nextMessage?: EventMessageBuilderDeluxe | EventMessage,\r\n  ) {\r\n    if (paramsOrNextMessage instanceof EventMessageBuilderDeluxe) {\r\n      nextMessage = paramsOrNextMessage;\r\n      paramsOrNextMessage = {};\r\n    }\r\n\r\n    this.options.push({\r\n      description,\r\n      nextMessage,\r\n      transform: paramsOrNextMessage?.transform,\r\n      isVisible: paramsOrNextMessage?.isVisible,\r\n      isEnabled: paramsOrNextMessage?.isEnabled,\r\n    });\r\n    return this;\r\n  }\r\n\r\n  build(): GameEvent {\r\n    return this.eventBuilder.build();\r\n  }\r\n}\r\n\r\nclass EventBuilder {\r\n  constructor(\r\n    private id: string,\r\n    private title: string,\r\n    private tags: EventTag[],\r\n  ) {}\r\n\r\n  messages: { [messageId: string]: EventMessageBuilderDeluxe } = {};\r\n\r\n  private lastMessageId: number = 0;\r\n  private onTrigger?: EventTransform;\r\n\r\n  createMessage(): EventMessageBuilderDeluxe {\r\n    const builder = new EventMessageBuilderDeluxe(this);\r\n    this.messages[builder.id] = builder;\r\n    return builder;\r\n  }\r\n\r\n  newMessageId(): string {\r\n    return this.id + (this.lastMessageId++).toString();\r\n  }\r\n\r\n  setOnTrigger(onTrigger: EventTransform) {\r\n    this.onTrigger = onTrigger;\r\n    return this;\r\n  }\r\n\r\n  build(): GameEvent {\r\n    // Start from the first message\r\n    const message = this.buildRecursive(this.messages[this.id + \"0\"]);\r\n    return createGameEvent(this.id, message, this.tags, this.onTrigger);\r\n  }\r\n\r\n  private buildRecursive(\r\n    messageBuilder: EventMessageBuilderDeluxe | EventMessage,\r\n  ): EventMessage {\r\n    if (!(messageBuilder instanceof EventMessageBuilderDeluxe)) {\r\n      return messageBuilder;\r\n    }\r\n    const options = messageBuilder.options.map((optionStub) => {\r\n      const nextMessageBuilder = optionStub?.nextMessage;\r\n\r\n      let message = undefined;\r\n      if (nextMessageBuilder != null) {\r\n        message = this.buildRecursive(nextMessageBuilder);\r\n      }\r\n      return {\r\n        option: {\r\n          description: optionStub.description,\r\n          transform: optionStub.transform,\r\n          nextMessage: message,\r\n        },\r\n        isVisible: optionStub.isVisible,\r\n        isEnabled: optionStub.isEnabled,\r\n      };\r\n    });\r\n    return new EventMessageImpl(\r\n      messageBuilder.id,\r\n      this.title,\r\n      messageBuilder.description,\r\n      options.length > 0 ? options : [{ option: CONFIRM_OPTION }],\r\n    );\r\n  }\r\n}\r\n\r\nexport function buildEvent(id: string, title: string, tags: EventTag[]) {\r\n  return new EventBuilder(id, title, tags);\r\n}\r\n\r\nexport function buildEventMessage(id: string, title: string) {\r\n  return new EventMessageBuilder(id, title);\r\n}\r\n","import { PlayerContextState } from \"../PlayerContext\";\r\n\r\nexport enum EventTag {\r\n  EARLY_GAME = \"EARLY_GAME\",\r\n  INCONSEQUENTIAL_RANDOM_EVENT = \"INCONSEQUENTIAL_RANDOM_EVENT\",\r\n  LEVEL_UP = \"LEVEL_UP\",\r\n  LEVEL_UP_FIRST_FIFTEEN_MINS = \"LEVEL_UP_FIRST_FIFTEEN_MINS\",\r\n  LEVEL_UP_EMPTY = \"LEVEL_UP_EMPTY\",\r\n  STORYLINE = \"STORYLINE\",\r\n}\r\n\r\nexport type EventTransform = (\r\n  state: PlayerContextState,\r\n  params: any,\r\n) => PlayerContextState;\r\n\r\nexport interface EventMessageOption {\r\n  description: string;\r\n  isEnabled: boolean;\r\n  transform?: (state: PlayerContextState, params: any) => PlayerContextState;\r\n  nextMessage?: EventMessage;\r\n}\r\n\r\nexport interface EventMessage {\r\n  getId(): string;\r\n  getTitle(params: any): string;\r\n  getDescription(state: PlayerContextState, params: any): string;\r\n  getAllowedOptions(\r\n    state: PlayerContextState,\r\n    params: any,\r\n  ): EventMessageOption[];\r\n  isTerminal(): boolean;\r\n  isActionable(state: PlayerContextState, params: any): boolean;\r\n}\r\n\r\nexport interface GameEvent {\r\n  getId(): string;\r\n  getMainEventMessage(): EventMessage;\r\n  onTrigger(): EventTransform | undefined;\r\n  getTags(): EventTag[];\r\n}\r\n","import { getFloorsAvailableForCreatures } from \"../../exploration/Creatures\";\r\nimport { DungeonFloor } from \"../../exploration/dungeons/DungeonFloor\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { Item } from \"../../items/Item\";\r\nimport { getCraftableItems, isCraftingUnlocked } from \"../../items/Items\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getSchoolLevel, School } from \"../../spells/ElementsAndSchools\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport { getVisibleSpellsForSchool } from \"../../spells/Spells\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nfunction getConcatenatedRequirements(spell: Spell): string {\r\n  let requirements = [];\r\n  const schoolRequirements = spell.getSchoolLevelRequirements();\r\n  for (let school in schoolRequirements) {\r\n    requirements.push(`${school} Lv${schoolRequirements[school as School]}`);\r\n  }\r\n  return requirements.join(\", \");\r\n}\r\n\r\nexport function getConcatenatedRequirementsForCraft(\r\n  state: PlayerContextState,\r\n  item: Item,\r\n): string {\r\n  let requirements = [];\r\n  const schoolRequirements = item.getCraftingSchoolLevelRequirements(state);\r\n  for (let school in schoolRequirements) {\r\n    requirements.push(`${school} Lv${schoolRequirements[school as School]}`);\r\n  }\r\n  return requirements.join(\", \");\r\n}\r\n\r\nexport function getMarkdownTextForSpell(spell: Spell): string {\r\n  return `*${spell.getSpellName()}* (${getConcatenatedRequirements(spell)})`;\r\n}\r\n\r\nexport function getMarkdownTextForCraftableItem(\r\n  state: PlayerContextState,\r\n  item: Item,\r\n): string {\r\n  return `:${item.getId()}: *${item.getName(\r\n    {},\r\n  )}* (${getConcatenatedRequirementsForCraft(state, item)})`;\r\n}\r\n\r\nfunction getLevelUpLearnedSpellsText(\r\n  oldSpells: Spell[],\r\n  newSpells: Spell[],\r\n): string {\r\n  let diffSpells = newSpells.filter((spell) => !oldSpells.includes(spell));\r\n  let newSpellText = \"\";\r\n  let extraSpellText = \"\";\r\n  if (diffSpells.length > 3) {\r\n    const extraSpells = diffSpells.length - 3;\r\n    extraSpellText = `and ${extraSpells} more!`;\r\n    diffSpells = diffSpells.slice(0, 3);\r\n  }\r\n  if (diffSpells.length > 0) {\r\n    let newSpellsLearnedText = diffSpells\r\n      .map(getMarkdownTextForSpell)\r\n      .join(\", \");\r\n    if (extraSpellText !== \"\") {\r\n      newSpellsLearnedText = [newSpellsLearnedText, extraSpellText].join(\". \");\r\n    }\r\n    newSpellText = `**New spells learned:** ${newSpellsLearnedText}`;\r\n  }\r\n  return newSpellText;\r\n}\r\n\r\nfunction getLevelUpLearnedCraftsTextForSchool(\r\n  state: PlayerContextState,\r\n  school: School,\r\n  oldItems: Item[],\r\n  newItems: Item[],\r\n): string {\r\n  let diffItems = newItems.filter(\r\n    (item) =>\r\n      !oldItems.includes(item) &&\r\n      (item.getCraftingSchoolLevelRequirements(state)?.[school] ?? 0) > 0,\r\n  );\r\n  let newCraftsText = \"\";\r\n  if (isCraftingUnlocked(state) && diffItems.length > 0) {\r\n    let extraItemsText = \"\";\r\n    if (diffItems.length > 3) {\r\n      const extraItems = diffItems.length - 3;\r\n      extraItemsText = `and ${extraItems} more!`;\r\n      diffItems = diffItems.slice(0, 3);\r\n    }\r\n    let newCraftsLearnedText = diffItems\r\n      .map(getMarkdownTextForCraftableItem.bind(null, state))\r\n      .join(\", \");\r\n    if (extraItemsText !== \"\") {\r\n      newCraftsLearnedText = [newCraftsLearnedText, extraItemsText].join(\", \");\r\n    }\r\n    newCraftsText = `**New craftable items:**\r\n${newCraftsLearnedText}`;\r\n  }\r\n  return newCraftsText;\r\n}\r\n\r\nfunction getLevelUpUnlockedFloorsForCreaturesText(\r\n  state: PlayerContextState,\r\n  oldFloors: DungeonFloor[],\r\n  newFloors: DungeonFloor[],\r\n): string {\r\n  let diffFloors = newFloors.filter((floor) => !oldFloors.includes(floor));\r\n  let newFloorsText = \"\";\r\n  if (hasFlag(state, \"creatures_unlocked\") && diffFloors.length > 0) {\r\n    let extraFloorsText = \"\";\r\n    if (diffFloors.length > 3) {\r\n      const extraItems = diffFloors.length - 3;\r\n      extraFloorsText = `and ${extraItems} more!`;\r\n      diffFloors = diffFloors.slice(0, 3);\r\n    }\r\n    let newFloorsLearnedText = diffFloors\r\n      .map((floor) => `*${floor.getFloorName()}*`)\r\n      .join(\", \");\r\n    if (extraFloorsText !== \"\") {\r\n      newFloorsLearnedText = [newFloorsLearnedText, extraFloorsText].join(\", \");\r\n    }\r\n    newFloorsText = `**You can now send creatures to:**\r\n${newFloorsLearnedText}`;\r\n  }\r\n  return newFloorsText;\r\n}\r\n\r\nexport function loadLevelUpEvents() {\r\n  for (let school in School) {\r\n    const message = buildEventMessage(\r\n      \"Level_Up_\" + school,\r\n      school + \" Level Up!\",\r\n    )\r\n      .setSimpleDescription(\r\n        `Congratulations!\r\n      \r\nYour ${school} level is now {level}!\r\n\r\n{levelUpLearnedSpells}\r\n\r\n{levelUpLearnedCrafts}\r\n\r\n{levelUpLearnedFloors}`,\r\n      )\r\n      .build();\r\n\r\n    const event = createGameEvent(\"Level_Up_\" + school, message, [\r\n      EventTag.LEVEL_UP,\r\n    ]);\r\n    addContextListener(\"Level_Up_\" + school, (oldState, newState) => {\r\n      if (\r\n        getSchoolLevel(newState, school as School) >\r\n        getSchoolLevel(oldState, school as School)\r\n      ) {\r\n        const oldSpells = getVisibleSpellsForSchool(oldState, school as School);\r\n        const newSpells = getVisibleSpellsForSchool(newState, school as School);\r\n        const levelUpLearnedSpells = getLevelUpLearnedSpellsText(\r\n          oldSpells,\r\n          newSpells,\r\n        );\r\n        const oldCrafts = getCraftableItems(oldState);\r\n        const newCrafts = getCraftableItems(newState);\r\n        const levelUpLearnedCrafts = getLevelUpLearnedCraftsTextForSchool(\r\n          newState,\r\n          school as School,\r\n          oldCrafts,\r\n          newCrafts,\r\n        );\r\n        let levelUpLearnedFloors = \"\";\r\n        if (school === School.Breeding) {\r\n          const oldFloors = getFloorsAvailableForCreatures(oldState);\r\n          const newFloors = getFloorsAvailableForCreatures(newState);\r\n          levelUpLearnedFloors = getLevelUpUnlockedFloorsForCreaturesText(\r\n            newState,\r\n            oldFloors,\r\n            newFloors,\r\n          );\r\n        }\r\n        const tags = [];\r\n        if (\r\n          !levelUpLearnedSpells &&\r\n          !levelUpLearnedCrafts &&\r\n          !levelUpLearnedFloors\r\n        ) {\r\n          tags.push(EventTag.LEVEL_UP_EMPTY);\r\n        }\r\n        if (getSecondsPlayed(newState) < 60 * 15) {\r\n          tags.push(EventTag.LEVEL_UP_FIRST_FIFTEEN_MINS);\r\n        }\r\n        return triggerEvent(\r\n          event,\r\n          {\r\n            level: getSchoolLevel(newState, school as School),\r\n            levelUpLearnedSpells: levelUpLearnedSpells,\r\n            levelUpLearnedCrafts: levelUpLearnedCrafts,\r\n            levelUpLearnedFloors: levelUpLearnedFloors,\r\n          },\r\n          tags,\r\n        );\r\n      }\r\n    });\r\n  }\r\n}\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { getConcatenatedRequirementsForCraft } from \"../../backend/events/campus/LevelUp\";\r\nimport {\r\n  calculateInventoryCap,\r\n  getInventory,\r\n  getTotalAmountOfItem,\r\n} from \"../../backend/items/Inventory\";\r\nimport { Item } from \"../../backend/items/Item\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { CostViewer } from \"../utility/CostViewer\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\n\r\nexport interface CraftingDetailsProps {\r\n  item: Item;\r\n}\r\n\r\nexport function CraftingDetails(props: CraftingDetailsProps) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const item = props.item;\r\n  const params = item.generateCraftedParams(playerContext);\r\n  const totalOwnedText = `Total owned: ${getTotalAmountOfItem(\r\n    item,\r\n    playerContext,\r\n  )}`;\r\n\r\n  const cost = item.getCraftingMaterials(playerContext);\r\n  const canCraft = item.canCraft(playerContext);\r\n  const isCraftable = item.isCraftable(playerContext);\r\n  const hasCraftingMaterials = item.hasCraftingMaterials(playerContext);\r\n  const inventoryFull =\r\n    getInventory(playerContext).length === calculateInventoryCap(playerContext);\r\n  const theme = useTheme();\r\n\r\n  const concatenatedRequirements = getConcatenatedRequirementsForCraft(\r\n    playerContext,\r\n    item,\r\n  );\r\n  const cannotCraftText = `You do not meet the requirements to craft this item. You need: ${concatenatedRequirements}`;\r\n\r\n  const craftCallback = useCallback(() => {\r\n    playerContextRef.current.apply(item.craft.bind(item));\r\n  }, [item]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.craftingDetailsContainer}>\r\n        <ItemInfo\r\n          itemStack={{\r\n            itemOccurrence: { itemId: item.getId(), params },\r\n            amount: 1,\r\n          }}\r\n        />\r\n        <Markdown>{totalOwnedText}</Markdown>\r\n        <View style={styles.costContainer}>\r\n          <Markdown>Cost:</Markdown>\r\n          <CostViewer resources={cost.resources} items={cost.items} />\r\n        </View>\r\n        <View style={styles.actionRow}>\r\n          {isCraftable ? (\r\n            [\r\n              <Button\r\n                key=\"craft_button\"\r\n                enableAutoRepress={true}\r\n                title=\"Craft\"\r\n                disabled={!canCraft}\r\n                onPress={craftCallback}\r\n              />,\r\n              !canCraft && hasCraftingMaterials && inventoryFull && (\r\n                <View\r\n                  style={styles.inventoryFullContainer}\r\n                  key=\"inventory_full\"\r\n                >\r\n                  <Text style={{ color: theme.theme.colors.error }}>\r\n                    You cannot craft this item as your inventory is full!\r\n                  </Text>\r\n                </View>\r\n              ),\r\n            ]\r\n          ) : (\r\n            <Text\r\n              style={[\r\n                styles.cannotCraftText,\r\n                { color: theme.theme.colors.warning },\r\n              ]}\r\n            >\r\n              {cannotCraftText}\r\n            </Text>\r\n          )}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      item.getId(),\r\n      JSON.stringify(params),\r\n      totalOwnedText,\r\n      JSON.stringify(cost.resources),\r\n      JSON.stringify(cost.items),\r\n      canCraft,\r\n      inventoryFull,\r\n      playerContextRef,\r\n      theme,\r\n      isCraftable,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  craftingDetailsContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  tagRow: {\r\n    marginVertical: 4,\r\n  },\r\n  actionRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    marginTop: 8,\r\n  },\r\n  actionButtonContainer: {\r\n    marginRight: 8,\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  inventoryFullContainer: {\r\n    flex: 1,\r\n    marginHorizontal: 8,\r\n  },\r\n  cannotCraftText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n});\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { CheckBox } from \"react-native-elements\";\r\nimport {\r\n  getAllItemsEverCraftable,\r\n  getItemByIdNullable,\r\n} from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  addContextListener,\r\n  clearContextListener,\r\n} from \"../../backend/PlayerContextListeners\";\r\nimport { Picker as UtilityPicker } from \"../utility/Picker\";\r\nimport { UIContext, useUIStateFromContext } from \"../utility/UIContext\";\r\nimport { CraftingDetails } from \"./CraftingDetails\";\r\nimport { ItemGrid } from \"./ItemGrid\";\r\n\r\nexport default function Crafting() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const uiContext = useContext(UIContext);\r\n  const [selectedIndex, setSelectedIndex] = useState(null as number | null);\r\n  const [selectedTag, setSelectedTag] = useUIStateFromContext(\r\n    uiContext,\r\n    \"CraftingTag\",\r\n    \"All\",\r\n  );\r\n  const maxSchoolLevels = playerContext.global.maxSchoolLevels;\r\n  let craftableItems = useMemo(() => {\r\n    const allItems = getAllItemsEverCraftable(playerContext);\r\n    return allItems;\r\n  }, [JSON.stringify(maxSchoolLevels)]);\r\n\r\n  const tagSet = new Set<string>();\r\n  craftableItems.forEach((item) => {\r\n    const tags = item.getTags(playerContext, item.getDefaultParams());\r\n    tags.forEach((tag) => tagSet.add(tag.tag));\r\n  });\r\n  const tags = Array.from(tagSet);\r\n\r\n  useEffect(() => setSelectedIndex(null), [selectedTag]);\r\n\r\n  const selectedIndexRef = useRef(selectedIndex);\r\n  selectedIndexRef.current = selectedIndex;\r\n\r\n  useEffect(() => {\r\n    addContextListener(\"CraftingComponent\", (oldState, newState) => {\r\n      const oldCraftable = getAllItemsEverCraftable(oldState);\r\n      const newCraftable = getAllItemsEverCraftable(newState);\r\n      const oldSelectedItem =\r\n        selectedIndexRef.current != null\r\n          ? oldCraftable[selectedIndexRef.current]\r\n          : undefined;\r\n      const newSelectedItem =\r\n        selectedIndexRef.current != null\r\n          ? newCraftable[selectedIndexRef.current]\r\n          : undefined;\r\n\r\n      if (\r\n        newSelectedItem === undefined ||\r\n        oldSelectedItem?.getId() !== newSelectedItem?.getId()\r\n      ) {\r\n        setSelectedIndex(null);\r\n      }\r\n    });\r\n    return () => clearContextListener(\"CraftingComponent\");\r\n  }, []);\r\n\r\n  const onPressItem = React.useCallback(\r\n    (item: any, index: number) => {\r\n      setSelectedIndex(index);\r\n    },\r\n    [setSelectedIndex],\r\n  );\r\n\r\n  const tagButtons = useMemo(() => {\r\n    return (\r\n      <UtilityPicker\r\n        onValueChange={setSelectedTag}\r\n        style={styles.picker}\r\n        selectedValue={selectedTag}\r\n        data={[\"All\", ...tags].map((tag) => ({\r\n          label: tag,\r\n          value: tag,\r\n          key: tag,\r\n        }))}\r\n      />\r\n    );\r\n  }, [setSelectedTag, selectedTag, JSON.stringify(tags)]);\r\n\r\n  if (selectedTag !== \"All\") {\r\n    craftableItems = craftableItems\r\n      .filter((item) =>\r\n        item\r\n          .getTags(playerContext, item.getDefaultParams())\r\n          .find((tag) => tag.tag == selectedTag),\r\n      )\r\n      .sort((a, b) => {\r\n        const maxA = Math.max(\r\n          ...(Object.values(\r\n            a.getCraftingSchoolLevelRequirements(playerContext),\r\n          ).filter((n) => n != undefined) as number[]),\r\n        );\r\n        const maxB = Math.max(\r\n          ...(Object.values(\r\n            b.getCraftingSchoolLevelRequirements(playerContext),\r\n          ).filter((n) => n != undefined) as number[]),\r\n        );\r\n        return maxA - maxB;\r\n      });\r\n  }\r\n\r\n  const [hideLocked, setHideLocked] = useUIStateFromContext(\r\n    uiContext,\r\n    \"crafting_hide_locked\",\r\n    false,\r\n  );\r\n\r\n  const toggleLockedCallback = useCallback(() => {\r\n    setHideLocked(!hideLocked);\r\n  }, [hideLocked, setHideLocked]);\r\n\r\n  useEffect(() => setSelectedIndex(null), [hideLocked]);\r\n\r\n  const itemGridElements = craftableItems.map((item) => ({\r\n    itemId: item.getId(),\r\n    amount: 1,\r\n    disabled: !item.isCraftable(playerContext),\r\n  }));\r\n\r\n  const itemGridElementsJSON = JSON.stringify(itemGridElements);\r\n\r\n  const isAnyLocked = useMemo(() => {\r\n    return itemGridElements.some((element) => element.disabled);\r\n  }, [itemGridElementsJSON]);\r\n\r\n  const itemGridElementsFiltered = useMemo(() => {\r\n    if (hideLocked) {\r\n      return itemGridElements.filter(\r\n        (itemGridElement) => !itemGridElement.disabled,\r\n      );\r\n    }\r\n    return itemGridElements;\r\n  }, [itemGridElementsJSON, hideLocked]);\r\n\r\n  const itemGridElementsFilteredJSON = JSON.stringify(itemGridElementsFiltered);\r\n\r\n  const selectedItem =\r\n    selectedIndex != null\r\n      ? getItemByIdNullable(itemGridElementsFiltered[selectedIndex]?.itemId)\r\n      : undefined;\r\n\r\n  const itemGrid = useMemo(\r\n    () => (\r\n      <ItemGrid items={itemGridElementsFiltered} onPressItem={onPressItem} />\r\n    ),\r\n    [itemGridElementsFilteredJSON, onPressItem],\r\n  );\r\n\r\n  const details = useMemo(\r\n    () => (\r\n      <View style={styles.detailsContainer}>\r\n        {selectedItem && <CraftingDetails item={selectedItem} />}\r\n      </View>\r\n    ),\r\n    [selectedItem?.getId()],\r\n  );\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.row}>\r\n        <View style={styles.tagPickerContainer}>{tagButtons}</View>\r\n        {isAnyLocked && (\r\n          <CheckBox\r\n            title=\"Hide locked\"\r\n            checked={hideLocked}\r\n            onPress={toggleLockedCallback}\r\n            textStyle={styles.checkboxText}\r\n            containerStyle={styles.checkboxContainer}\r\n          />\r\n        )}\r\n      </View>\r\n      {itemGrid}\r\n      {details}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  detailsContainer: {\r\n    marginTop: 16,\r\n    paddingHorizontal: 8,\r\n    paddingBottom: 8,\r\n  },\r\n  buttonGroupContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    height: undefined,\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"flex-start\",\r\n    borderWidth: 0,\r\n  },\r\n  buttonGroupButtonContainer: {\r\n    flex: 1,\r\n    height: 40,\r\n    borderWidth: 1,\r\n    borderColor: \"#eee\",\r\n    margin: 4,\r\n  },\r\n  picker: {\r\n    flex: 1,\r\n  },\r\n  tagPickerContainer: {\r\n    width: 180,\r\n    marginHorizontal: 8,\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    flexWrap: \"wrap\",\r\n    marginBottom: 16,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    padding: 0,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n});\r\n","import mem from \"mem\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../actions/Action\";\r\nimport { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { addItemToQuickbar, isInQuickbar, isQuickbarFull } from \"../Quickbar\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../Resources\";\r\nimport {\r\n  grantSchoolExp,\r\n  meetsRequirements,\r\n  School,\r\n} from \"../spells/ElementsAndSchools\";\r\nimport {\r\n  addToInventory,\r\n  calculateInventoryCap,\r\n  getAmountOfItem,\r\n  getInventory,\r\n  getTotalAmountOfItem,\r\n  removeFromInventory,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"./Inventory\";\r\nimport { getItemById, registerItem } from \"./Items\";\r\n\r\nexport interface ItemTag {\r\n  tag: string;\r\n}\r\n\r\nexport interface ItemStack {\r\n  itemOccurrence: ItemOccurrence;\r\n  amount: number;\r\n}\r\n\r\nexport type ItemParams = Record<string, any>;\r\n\r\nexport interface ItemOccurrence {\r\n  itemId: string;\r\n  params: ItemParams;\r\n}\r\n\r\nexport interface ItemAction {\r\n  description: string;\r\n  isEnabled: boolean;\r\n  isActive?: boolean;\r\n  transform?: PlayerContextTransform;\r\n}\r\n\r\nexport interface Item {\r\n  getId(): string;\r\n  getPicture(): any;\r\n  getName(params: ItemParams): string;\r\n  getDescription(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): string | undefined;\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined;\r\n  getTags(state: PlayerContextState, params: ItemParams): ItemTag[];\r\n  getPrimaryAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined;\r\n  getSaleAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined;\r\n  getQuickbarAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined;\r\n\r\n  getCraftingSchoolLevelRequirements(\r\n    state: PlayerContextState,\r\n  ): Partial<Record<string, number>>;\r\n  getCraftingMaterials(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  };\r\n  generateCraftedParams(state: PlayerContextState): ItemParams;\r\n  getDefaultParams(): ItemParams;\r\n  isCraftable(state: PlayerContextState): boolean;\r\n  hasCraftingMaterials(state: PlayerContextState): boolean;\r\n  canCraft(state: PlayerContextState): boolean;\r\n  craft(state: PlayerContextState): PlayerContextState;\r\n  // Returns whether or not an effect produced by the item is currently active,\r\n  // used mainly to display when a buff is going on\r\n  isActive(state: PlayerContextState): boolean;\r\n  fitsInInventory(state: PlayerContextState, params?: ItemParams): boolean;\r\n}\r\n\r\nconst saleAction = mem(\r\n  (\r\n    sellingUnlocked: boolean,\r\n    id: string,\r\n    params: ItemParams,\r\n    salePrice: number,\r\n    totalAmount: number,\r\n  ) => {\r\n    if (sellingUnlocked) {\r\n      const totalCoins = salePrice * totalAmount;\r\n      return {\r\n        description: `Sell all for ${formatNumber(totalCoins)} Coins`,\r\n        isEnabled: true,\r\n        isActive: false,\r\n        transform: (state: PlayerContextState) => {\r\n          state = removeFromInventory({ itemId: id, params }, 1e10, state);\r\n          return grantResource(Resource.Coins, totalCoins)(state);\r\n        },\r\n      };\r\n    } else {\r\n      return {\r\n        description: \"Discard all\",\r\n        isEnabled: true,\r\n        isActive: false,\r\n        transform: (state: PlayerContextState) => {\r\n          return removeFromInventory({ itemId: id, params }, 1e10, state);\r\n        },\r\n      };\r\n    }\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nexport abstract class ItemBase implements Item {\r\n  constructor() {\r\n    registerItem(this);\r\n  }\r\n\r\n  abstract getId(): string;\r\n  abstract getPicture(): any;\r\n  abstract getBaseName(params: ItemParams): string;\r\n  abstract getDescription(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): string | undefined;\r\n  abstract getEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): string | undefined;\r\n  abstract getSalePrice(state: PlayerContextState, params: ItemParams): number;\r\n\r\n  getTags(_state: PlayerContextState, _params: ItemParams): ItemTag[] {\r\n    return [];\r\n  }\r\n\r\n  getName(params: ItemParams): string {\r\n    const base = this.getBaseName(params);\r\n    if (params?.itemQuality != null && params?.itemQuality > 0) {\r\n      return `${base} +${formatNumber(params?.itemQuality)}`;\r\n    }\r\n    return `${base}`;\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return false;\r\n  }\r\n\r\n  getItemEffects(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): Record<string, number> {\r\n    const baseEffects = this.getBaseItemEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = applyTransformations(\r\n        [\r\n          this.getId(),\r\n          ...this.getTags(state, params).map((itemTag) => itemTag.tag),\r\n          ...(baseEffect.tags ?? []),\r\n          TransformationTags.ItemEffect,\r\n        ],\r\n        state,\r\n        baseEffect.value,\r\n        {\r\n          item: this,\r\n          params,\r\n        },\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getPrimaryAction(\r\n    _state: PlayerContextState,\r\n    _params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSaleAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    return saleAction(\r\n      hasFlag(state, \"selling_unlocked\"),\r\n      this.getId(),\r\n      params,\r\n      this.getSalePrice(state, params),\r\n      getAmountOfItem({ itemId: this.getId(), params }, state),\r\n    );\r\n  }\r\n\r\n  getQuickbarAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    if (!this.getPrimaryAction(state, params)) {\r\n      return undefined;\r\n    }\r\n    return {\r\n      description: \"Add to Quickbar\",\r\n      isActive: false,\r\n      isEnabled:\r\n        !isInQuickbar(state, {\r\n          type: \"item\",\r\n          occurrence: { itemId: this.getId(), params },\r\n        }) && !isQuickbarFull(state),\r\n      transform: (state: PlayerContextState) => {\r\n        return addItemToQuickbar(state, { itemId: this.getId(), params });\r\n      },\r\n    };\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    const schoolRequirements = this.getCraftingSchoolLevelRequirements(state);\r\n    if (Object.keys(schoolRequirements).length == 0) {\r\n      return false;\r\n    }\r\n    return meetsRequirements(state, schoolRequirements);\r\n  }\r\n\r\n  hasCraftingMaterials(state: PlayerContextState): boolean {\r\n    const materials = this.getCraftingMaterials(state);\r\n    for (let resource in materials.resources) {\r\n      const amount = materials.resources?.[resource as Resource] || 0;\r\n      if (getResourceAmount(state, resource as Resource) < amount) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let itemId in materials.items) {\r\n      const amount = materials.items[itemId];\r\n      if (getTotalAmountOfItem(getItemById(itemId), state) < amount) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  canCraft(state: PlayerContextState): boolean {\r\n    if (!this.isCraftable(state)) {\r\n      return false;\r\n    }\r\n\r\n    if (!this.hasCraftingMaterials(state)) {\r\n      return false;\r\n    }\r\n\r\n    if (!this.fitsInInventory(state)) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  fitsInInventory(state: PlayerContextState, params?: ItemParams) {\r\n    const inventoryLength = getInventory(state).length;\r\n    const inventoryCap = calculateInventoryCap(state);\r\n    if (inventoryLength > inventoryCap) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      inventoryLength === inventoryCap &&\r\n      getAmountOfItem(\r\n        {\r\n          itemId: this.getId(),\r\n          params: params ?? this.generateCraftedParams(state),\r\n        },\r\n        state,\r\n      ) === 0\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements(\r\n    state: PlayerContextState,\r\n  ): Partial<Record<School, number>> {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getCraftingMaterials(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const base = this.getCraftingMaterialsBase(state);\r\n    let resources: Partial<Record<Resource, number>> = {},\r\n      items: Record<string, number> = {};\r\n    for (let resource in base.resources) {\r\n      const baseAmount = base.resources[resource as Resource] ?? 0;\r\n      resources[resource as Resource] = Math.ceil(\r\n        applyTransformations(\r\n          [\r\n            ...this.getTags(state, {}).map((itemTag) => itemTag.tag),\r\n            ...Object.keys(this.getCraftingSchoolLevelRequirements(state)),\r\n            TransformationTags.ItemCost,\r\n          ],\r\n          state,\r\n          baseAmount,\r\n        ),\r\n      );\r\n    }\r\n    for (let item in base.items) {\r\n      const baseAmount = base.items[item] ?? 0;\r\n      items[item] = Math.ceil(\r\n        applyTransformations(\r\n          [\r\n            ...this.getTags(state, {}).map((itemTag) => itemTag.tag),\r\n            ...Object.keys(this.getCraftingSchoolLevelRequirements(state)),\r\n            TransformationTags.ItemCost,\r\n          ],\r\n          state,\r\n          baseAmount,\r\n        ),\r\n      );\r\n    }\r\n    return {\r\n      resources,\r\n      items,\r\n    };\r\n  }\r\n\r\n  generateCraftedParams(state: PlayerContextState): ItemParams {\r\n    const itemQuality = applyTransformations(\r\n      [\r\n        this.getId(),\r\n        TransformationTags.ItemQuality,\r\n        ...this.getTags(state, {}).map((tag) => tag.tag),\r\n        ...Object.keys(this.getCraftingSchoolLevelRequirements(state)),\r\n      ],\r\n      state,\r\n      0,\r\n      { item: this },\r\n    );\r\n    if (itemQuality == 0) {\r\n      return {};\r\n    }\r\n    return { itemQuality };\r\n  }\r\n\r\n  getDefaultParams(): ItemParams {\r\n    return {};\r\n  }\r\n\r\n  craft(state: PlayerContextState): PlayerContextState {\r\n    if (!this.canCraft(state)) {\r\n      return state;\r\n    }\r\n\r\n    const materials = this.getCraftingMaterials(state);\r\n    const params = this.generateCraftedParams(state);\r\n    const schoolRequirements = this.getCraftingSchoolLevelRequirements(state);\r\n\r\n    for (let resource in materials.resources) {\r\n      const amount = materials.resources?.[resource as Resource] || 0;\r\n      state = grantResource(resource as Resource, -amount)(state);\r\n    }\r\n\r\n    for (let itemId in materials.items) {\r\n      const amount = materials.items[itemId];\r\n      state = removeFromInventoryWithAnyParams(\r\n        getItemById(itemId),\r\n        amount,\r\n        state,\r\n      );\r\n    }\r\n\r\n    state = addToInventory({ itemId: this.getId(), params }, 1, state);\r\n\r\n    Object.keys(schoolRequirements).forEach((school) => {\r\n      state = grantSchoolExp(\r\n        school as School,\r\n        (schoolRequirements[school as School] || 0) * 3 + 5,\r\n      )(state);\r\n    });\r\n\r\n    return state;\r\n  }\r\n}\r\n","import mem from \"mem\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps, Resource } from \"../../Resources\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  canEquipItem,\r\n  EquipmentSlot,\r\n  equipToSlot,\r\n  getEquippedItem,\r\n} from \"../Equipment\";\r\nimport {\r\n  ItemAction,\r\n  ItemBase,\r\n  ItemOccurrence,\r\n  ItemParams,\r\n  ItemTag,\r\n} from \"../Item\";\r\nimport { getItemById } from \"../Items\";\r\n\r\nconst memoizedEquip = mem(\r\n  (\r\n    canEquipItem: boolean,\r\n    slot: EquipmentSlot,\r\n    id: string,\r\n    params: ItemParams,\r\n  ) => {\r\n    return {\r\n      description: \"Equip\",\r\n      isEnabled: canEquipItem,\r\n      transform: (state: PlayerContextState) => {\r\n        state = equipToSlot(state, slot, {\r\n          itemId: id,\r\n          params,\r\n        });\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nexport abstract class EquippableItem extends ItemBase {\r\n  abstract getSlot(): EquipmentSlot;\r\n\r\n  getTags(state: PlayerContextState, params: ItemParams): ItemTag[] {\r\n    return [{ tag: \"Equipment\" }, { tag: this.getSlot() }];\r\n  }\r\n\r\n  getPrimaryAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    return memoizedEquip(\r\n      canEquipItem(state, this.getSlot(), { itemId: this.getId(), params }),\r\n      this.getSlot(),\r\n      this.getId(),\r\n      params,\r\n    );\r\n  }\r\n\r\n  generateCraftedParams(): ItemParams {\r\n    return {\r\n      randomId: Math.random(),\r\n      ...this.generateEquipmentCraftedParams(),\r\n    };\r\n  }\r\n\r\n  generateEquipmentCraftedParams(): ItemParams {\r\n    return {};\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  getMaxHPBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  getHPRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 0;\r\n  }\r\n\r\n  getPlayerAccuracyBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 0;\r\n  }\r\n\r\n  getPlayerDodgeBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 0;\r\n  }\r\n\r\n  getPlayerCritChanceBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 0;\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    return this.getEffectBase(state, params);\r\n  }\r\n\r\n  getEffectExtra(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getEffectBase(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): string | undefined {\r\n    const bonuses: Record<string, number> = {\r\n      attack: this.getAttackBonus(state, params),\r\n      defense: this.getDefenseBonus(state, params),\r\n      maxHP: this.getMaxHPBonus(state, params),\r\n      hpRegen: this.getHPRegenBonus(state, params),\r\n      manaRegen: this.getManaRegenBonus(state, params),\r\n      maxMana: this.getMaxManaBonus(state, params),\r\n      attackDelay: this.getAttackDelayBonusPct(state, params),\r\n      accuracy: this.getPlayerAccuracyBonusPct(state, params),\r\n      dodge: this.getPlayerDodgeBonusPct(state, params),\r\n      critChance: this.getPlayerCritChanceBonusPct(state, params),\r\n    };\r\n\r\n    const bonusStrings = Object.keys(bonuses).map((stat) => {\r\n      let value = bonuses?.[stat];\r\n      if (value == 0) {\r\n        return null;\r\n      }\r\n      let prefix = \"+\";\r\n      if (value < 0) {\r\n        prefix = \"-\";\r\n        value = Math.abs(value);\r\n      }\r\n      switch (stat) {\r\n        case \"attack\":\r\n        case \"defense\":\r\n        case \"hpRegen\":\r\n          return (\r\n            prefix +\r\n            formatNumber(value, { showDecimals: true }) +\r\n            \":\" +\r\n            stat +\r\n            \":\"\r\n          );\r\n        case \"manaRegen\":\r\n          return prefix + formatNumber(value) + \":mana:/sec\";\r\n        case \"maxHP\":\r\n          return prefix + formatNumber(value) + \" Max:hp:\";\r\n        case \"maxMana\":\r\n          return prefix + formatNumber(value) + \" Max:mana:\";\r\n        case \"attackDelay\":\r\n        case \"accuracy\":\r\n        case \"dodge\":\r\n        case \"critChance\":\r\n          return prefix + formatNumber(value) + \"%:\" + stat + \":\";\r\n      }\r\n    });\r\n\r\n    const bonusEffect = this.getEffectExtra(state, params);\r\n    bonusStrings.push(bonusEffect);\r\n\r\n    return bonusStrings.filter((bonusString) => bonusString != null).join(\", \");\r\n  }\r\n}\r\n\r\ntype EquippedItemFunction = (itemOccurrence: ItemOccurrence) => void;\r\n\r\nconst forEachEquippedItem = function (\r\n  state: PlayerContextState,\r\n  each: EquippedItemFunction,\r\n): void {\r\n  const equippedItemHand = getEquippedItem(state, EquipmentSlot.Hand);\r\n  const equippedItemBody = getEquippedItem(state, EquipmentSlot.Body);\r\n  const equippedItemAccessory = getEquippedItem(state, EquipmentSlot.Accessory);\r\n\r\n  [equippedItemHand, equippedItemBody, equippedItemAccessory].forEach(\r\n    (itemOccurrence) => {\r\n      if (itemOccurrence == null) {\r\n        return;\r\n      }\r\n      each(itemOccurrence);\r\n    },\r\n  );\r\n};\r\n\r\ntype EquippedItemBonus = (\r\n  state: PlayerContextState,\r\n  item: EquippableItem,\r\n  params: ItemParams,\r\n) => number;\r\n\r\nconst additiveTransform = (bonusFn: EquippedItemBonus) => {\r\n  return (state: PlayerContextState) => {\r\n    let total = 0;\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = getItemById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const bonus = bonusFn(state, item, itemOccurrence.params);\r\n      if (bonus != 0) {\r\n        total += bonus;\r\n      }\r\n    });\r\n\r\n    return total;\r\n  };\r\n};\r\n\r\nconst pctMultiplicativeTransform = (bonusFn: EquippedItemBonus) => {\r\n  return (state: PlayerContextState) => {\r\n    let totalMultiplier = 1.0;\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = getItemById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const bonus = bonusFn(state, item, itemOccurrence.params);\r\n      if (bonus != 0) {\r\n        totalMultiplier *= (100 + bonus) / 100.0;\r\n      }\r\n    });\r\n\r\n    return totalMultiplier;\r\n  };\r\n};\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"EquippableItem\", (state) => {\r\n    const totalIncome: Partial<Record<Resource, number>> = {};\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = getItemById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const manaRegen = item.getManaRegenBonus(state, itemOccurrence.params);\r\n      if (manaRegen != 0) {\r\n        totalIncome[Resource.Mana] =\r\n          (totalIncome?.[Resource.Mana] ?? 0) + manaRegen;\r\n      }\r\n    });\r\n    return totalIncome;\r\n  }),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"EquippableItemAttack\",\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getAttackBonus(state, params),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Defense]],\r\n  \"EquippableItemDefense\",\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getDefenseBonus(state, params),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.MaxHP]],\r\n  \"EquippableItemMaxHP\",\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) => item.getMaxHPBonus(state, params)),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.HPRegen]],\r\n  \"EquippableItemHPRegen\",\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getHPRegenBonus(state, params),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n  \"EquippableItemAttackDelay\",\r\n  TransformationType.Multiplier,\r\n  pctMultiplicativeTransform((state, item, params) =>\r\n    item.getAttackDelayBonusPct(state, params),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Accuracy]],\r\n  \"EquippableItemAccuracy\",\r\n  TransformationType.Multiplier,\r\n  pctMultiplicativeTransform((state, item, params) =>\r\n    item.getPlayerAccuracyBonusPct(state, params),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Dodge]],\r\n  \"EquippableItemDodge\",\r\n  TransformationType.Addition,\r\n  additiveTransform(\r\n    (state, item, params) => item.getPlayerDodgeBonusPct(state, params) / 100.0,\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.CritChance]],\r\n  \"EquippableItemCritChance\",\r\n  TransformationType.Addition,\r\n  additiveTransform(\r\n    (state, item, params) =>\r\n      item.getPlayerCritChanceBonusPct(state, params) / 100.0,\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[Resource.Mana, TransformationTags.Cap]],\r\n  \"EquippableItemManaCap\",\r\n  TransformationType.Addition,\r\n  (state) => {\r\n    let capBonus = 0;\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = getItemById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const maxManaBonus = item.getMaxManaBonus(state, itemOccurrence.params);\r\n      if (maxManaBonus != 0) {\r\n        capBonus += maxManaBonus;\r\n      }\r\n    });\r\n\r\n    return capBonus;\r\n  },\r\n);\r\n\r\naddContextListener(\"equippableItem_cap_listener\", (oldState, newState) => {\r\n  let shouldRecalculate = false;\r\n  [EquipmentSlot.Hand, EquipmentSlot.Body, EquipmentSlot.Accessory].forEach(\r\n    (equipmentSlot) => {\r\n      const oldItem = getEquippedItem(oldState, equipmentSlot);\r\n      const newItem = getEquippedItem(newState, equipmentSlot);\r\n      if (oldItem?.itemId != newItem?.itemId) {\r\n        shouldRecalculate = true;\r\n      }\r\n    },\r\n  );\r\n  if (shouldRecalculate) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n","import React, { useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  EquipmentSlot,\r\n  getEquippedItem,\r\n  getUnequipAction,\r\n} from \"../../backend/items/Equipment\";\r\nimport { EquippableItem } from \"../../backend/items/equipment/EquippableItem\";\r\nimport { getItemById } from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nfunction EquippedItemSlot(props: {\r\n  slot: EquipmentSlot;\r\n  onPressEquippedItem?: (slot: EquipmentSlot) => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const slot = props.slot;\r\n  const equippedItem = getEquippedItem(playerContext, slot);\r\n  const unequipAction = getUnequipAction(playerContext, slot);\r\n\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const item = equippedItem && getItemById(equippedItem.itemId);\r\n  if (item && !(item instanceof EquippableItem)) {\r\n    throw new Error(\"Only equippable items should be equipped\");\r\n  }\r\n\r\n  return useMemo(() => {\r\n    if (!equippedItem) {\r\n      return (\r\n        <View key={slot} style={styles.equipmentRow}>\r\n          <View style={styles.row}>\r\n            <ItemTile title=\"Empty\" />\r\n            <Text numberOfLines={2} style={styles.labelStyle} h4>\r\n              {slot}: Empty\r\n            </Text>\r\n          </View>\r\n          <Button\r\n            title={unequipAction.description}\r\n            disabled={!unequipAction.isEnabled}\r\n            onPress={() =>\r\n              unequipAction.transform &&\r\n              playerContextRef.current.apply(unequipAction.transform)\r\n            }\r\n          />\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View key={slot} style={styles.equipmentRow}>\r\n        <View style={styles.row}>\r\n          <ItemTile\r\n            icon={(item as EquippableItem).getId()}\r\n            title={(item as EquippableItem).getName(equippedItem.params)}\r\n            onPress={\r\n              props.onPressEquippedItem &&\r\n              (() =>\r\n                props.onPressEquippedItem && props.onPressEquippedItem(slot))\r\n            }\r\n          />\r\n          <Text numberOfLines={2} style={styles.labelStyle} h4>\r\n            {slot}: {(item as EquippableItem).getName(equippedItem.params)}\r\n          </Text>\r\n        </View>\r\n        <Button\r\n          title={unequipAction.description}\r\n          disabled={!unequipAction.isEnabled}\r\n          onPress={() =>\r\n            unequipAction.transform &&\r\n            playerContext.apply(unequipAction.transform)\r\n          }\r\n        />\r\n      </View>\r\n    );\r\n  }, [\r\n    JSON.stringify(equippedItem),\r\n    slot,\r\n    unequipAction.description,\r\n    unequipAction.isEnabled,\r\n    unequipAction.transform,\r\n    playerContextRef,\r\n    item?.getName(equippedItem?.params || {}),\r\n    props.onPressEquippedItem,\r\n  ]);\r\n}\r\n\r\nexport default function EquippedItems(props: {\r\n  onPressEquippedItem?: (slot: EquipmentSlot) => void;\r\n}) {\r\n  const slots = Object.keys(EquipmentSlot);\r\n  const slotComponents = slots.map((slot) => {\r\n    return (\r\n      <EquippedItemSlot\r\n        key={slot}\r\n        slot={slot as EquipmentSlot}\r\n        onPressEquippedItem={props.onPressEquippedItem}\r\n      />\r\n    );\r\n  });\r\n\r\n  return <View>{slotComponents}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  equipmentRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"flex-start\",\r\n    flex: 1,\r\n  },\r\n  labelStyle: {\r\n    marginHorizontal: 8,\r\n    flex: 1,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { BackHandler, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { sortInventory } from \"../backend/items/Inventory\";\r\nimport { isCraftingUnlocked } from \"../backend/items/Items\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport Crafting from \"./inventory/Crafting\";\r\nimport EquippedItems from \"./inventory/EquippedItems\";\r\nimport InventoryItems from \"./inventory/InventoryItems\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\n\r\nexport default function Inventory() {\r\n  const [isCrafting, setIsCrafting] = useState(false);\r\n  const theme = useTheme();\r\n\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const sortInventoryCallback = useCallback(() => {\r\n    playerContextRef.current.apply(sortInventory);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handler = BackHandler.addEventListener(\"hardwareBackPress\", () => {\r\n      if (isCrafting) {\r\n        setIsCrafting(false);\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n\r\n    return () => handler.remove();\r\n  }, [isCrafting, setIsCrafting]);\r\n\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setIsCrafting(false);\r\n    }\r\n  }, [visible]);\r\n\r\n  if (!isCrafting) {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={styles.fullBleedPadding}>\r\n          <View style={styles.topRow}>\r\n            <Text h2>Inventory</Text>\r\n            <View style={styles.topButtons}>\r\n              <Button\r\n                title=\"Sort Inventory\"\r\n                onPress={sortInventoryCallback}\r\n                titleStyle={styles.sortButtonText}\r\n              />\r\n              {isCraftingUnlocked(playerContext) && (\r\n                <Button\r\n                  title=\"Craft Items\"\r\n                  containerStyle={styles.craftButton}\r\n                  onPress={() => setIsCrafting(true)}\r\n                />\r\n              )}\r\n            </View>\r\n          </View>\r\n          <View style={styles.equippedItemsContainer}>\r\n            <EquippedItems />\r\n          </View>\r\n        </View>\r\n        <InventoryItems isFullBleed={true} />\r\n      </View>\r\n    );\r\n  } else {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={[styles.topRow, styles.row, styles.fullBleedPadding]}>\r\n          <MaterialIcons\r\n            name=\"arrow-back\"\r\n            color={theme.theme.colors.black}\r\n            size={24}\r\n            style={styles.arrowBack}\r\n            onPress={() => setIsCrafting(false)}\r\n            hitSlop={{ top: 30, left: 30, bottom: 30, right: 30 }}\r\n          />\r\n          <Text h2>Crafting</Text>\r\n        </View>\r\n        <Crafting />\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  topRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginBottom: 16,\r\n    height: 48,\r\n  },\r\n  arrowBack: {\r\n    marginRight: 8,\r\n  },\r\n  equippedItemsContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  row: {\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  topButtons: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  craftButton: {\r\n    marginLeft: 16,\r\n  },\r\n  sortButtonText: {\r\n    fontSize: 12,\r\n  },\r\n  fullBleedPadding: {\r\n    paddingHorizontal: 8,\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useCallback, useContext, useMemo, useState } from \"react\";\r\nimport {\r\n  FlatList,\r\n  ListRenderItemInfo,\r\n  NativeScrollEvent,\r\n  NativeSyntheticEvent,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { getEndingData } from \"../../backend/endings/Endings\";\r\nimport { hasFlag, hasGlobalFlag } from \"../../backend/Flags\";\r\nimport { isInventoryUnlocked } from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { getTotalElementAndSchoolExp } from \"../../backend/spells/ElementsAndSchools\";\r\nimport Divider from \"../utility/Divider\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nconst SelectedContext = React.createContext(\"Campus\");\r\n\r\nfunction MenuComponent(props: { title: string; onPress: () => void }) {\r\n  const { title, onPress } = { ...props };\r\n  const theme = useTheme();\r\n  const selected = useContext(SelectedContext);\r\n  const shouldHighlight = selected == title;\r\n  return useMemo(\r\n    () => (\r\n      <TouchableOpacity onPress={onPress}>\r\n        <View\r\n          style={[\r\n            styles.itemContainerStyle,\r\n            shouldHighlight\r\n              ? { backgroundColor: theme.theme.colors.grey5 }\r\n              : null,\r\n          ]}\r\n        >\r\n          <GameIcon icon={title.toLowerCase()} />\r\n          <Text style={styles.itemStyle}>{title}</Text>\r\n        </View>\r\n      </TouchableOpacity>\r\n    ),\r\n    [title, onPress, shouldHighlight, theme],\r\n  );\r\n}\r\n\r\nconst SCROLL_VIEW_EPSILON = 10;\r\n\r\nexport function BottomMenu(props: {\r\n  onNavigationPress: (section: string) => void;\r\n  onSpellMenuPress: () => void;\r\n  selected: string;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const showResearch = hasFlag(playerContext, \"research_unlocked\");\r\n  const showAutocast = hasFlag(playerContext, \"autocast_unlocked\");\r\n  const showInventory = isInventoryUnlocked(playerContext);\r\n  const showExploration = hasFlag(playerContext, \"exploration_unlocked\");\r\n  const showRetirement = getTotalElementAndSchoolExp(playerContext) >= 10000;\r\n  const showUpgrades = hasFlag(playerContext, \"upgrades_unlocked\");\r\n  const showCreatures = hasFlag(playerContext, \"creatures_unlocked\");\r\n  const showStrengthening =\r\n    hasGlobalFlag(playerContext, \"strengthening_unlocked\") && showExploration;\r\n  const showEnding = getEndingData(playerContext) != null;\r\n\r\n  const navigationPressCallback = useCallback(\r\n    (item: string) => {\r\n      props.onNavigationPress(item);\r\n    },\r\n    [props.onNavigationPress],\r\n  );\r\n\r\n  const menuItems = useMemo(\r\n    () =>\r\n      [\r\n        \"Campus\",\r\n        showResearch ? \"Research\" : null,\r\n        showAutocast ? \"Apprentices\" : null,\r\n        showInventory ? \"Inventory\" : null,\r\n        showExploration ? \"Exploration\" : null,\r\n        showCreatures ? \"Creatures\" : null,\r\n        showUpgrades ? \"Upgrades\" : null,\r\n        showStrengthening ? \"Strengthen\" : null,\r\n        showEnding ? \"Ending\" : null,\r\n        showRetirement ? \"Retirement\" : null,\r\n        \"Stats\",\r\n        \"Help\",\r\n        \"Options\",\r\n        \"About\",\r\n      ].filter((value) => value != null) as string[],\r\n    [\r\n      showResearch,\r\n      showAutocast,\r\n      showInventory,\r\n      showExploration,\r\n      showCreatures,\r\n      showUpgrades,\r\n      showStrengthening,\r\n      showEnding,\r\n      showRetirement,\r\n    ],\r\n  );\r\n  const callbacks = useMemo(\r\n    () => menuItems.map((item) => () => navigationPressCallback(item)),\r\n    [menuItems, navigationPressCallback],\r\n  );\r\n\r\n  const renderItem = useCallback(\r\n    (item: ListRenderItemInfo<string>) => (\r\n      <View style={{ flexDirection: \"row\" }}>\r\n        {item.index === 0 && <Divider orientation=\"vertical\" />}\r\n        <MenuComponent title={item.item} onPress={callbacks[item.index]} />\r\n        <Divider orientation=\"vertical\" />\r\n      </View>\r\n    ),\r\n    [callbacks, navigationPressCallback],\r\n  );\r\n\r\n  const keyExtractor = useCallback((item: string) => item, []);\r\n\r\n  const theme = useTheme();\r\n  const [scrollEnd, setScrollEnd] = useState(false);\r\n  const [scrollStart, setScrollStart] = useState(true);\r\n  const onScroll = useCallback(\r\n    (e: NativeSyntheticEvent<NativeScrollEvent>) => {\r\n      const position = e.nativeEvent.contentOffset.x;\r\n      const contentWidth = e.nativeEvent.contentSize.width;\r\n      const scrollViewWidth = e.nativeEvent.layoutMeasurement.width;\r\n      const isStart = position < SCROLL_VIEW_EPSILON;\r\n      const isEnd =\r\n        contentWidth - scrollViewWidth - position < SCROLL_VIEW_EPSILON;\r\n      if (isStart != scrollStart) {\r\n        setScrollStart(isStart);\r\n      }\r\n      if (isEnd != scrollEnd) {\r\n        setScrollEnd(isEnd);\r\n      }\r\n    },\r\n    [scrollEnd, scrollStart, setScrollEnd, setScrollStart],\r\n  );\r\n\r\n  const flatListBackgroundStyle = useMemo(\r\n    () => [\r\n      styles.scrollContentContainer,\r\n      { backgroundColor: theme.theme.colors.background },\r\n    ],\r\n    [theme],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.bottomMenuContainer,\r\n          { backgroundColor: theme.theme.colors.grey5 },\r\n        ]}\r\n      >\r\n        <View style={[styles.chevron, scrollStart && { opacity: 0 }]}>\r\n          <MaterialIcons\r\n            name=\"chevron-left\"\r\n            size={24}\r\n            color={theme.theme.colors.black}\r\n          />\r\n        </View>\r\n        <SelectedContext.Provider value={props.selected}>\r\n          <FlatList\r\n            data={menuItems}\r\n            renderItem={renderItem}\r\n            keyExtractor={keyExtractor}\r\n            horizontal={true}\r\n            snapToInterval={71}\r\n            style={styles.scrollContainer}\r\n            contentContainerStyle={flatListBackgroundStyle}\r\n            scrollEventThrottle={100}\r\n            onScroll={onScroll}\r\n            overScrollMode=\"never\"\r\n            showsHorizontalScrollIndicator={false}\r\n            nestedScrollEnabled={true}\r\n          />\r\n        </SelectedContext.Provider>\r\n        <View style={[styles.chevron, scrollEnd && { opacity: 0 }]}>\r\n          <MaterialIcons\r\n            name=\"chevron-right\"\r\n            size={24}\r\n            color={theme.theme.colors.black}\r\n          />\r\n        </View>\r\n        <View style={styles.spellButtonPlaceholder} />\r\n      </View>\r\n    ),\r\n    [\r\n      menuItems,\r\n      renderItem,\r\n      theme,\r\n      scrollStart,\r\n      scrollEnd,\r\n      flatListBackgroundStyle,\r\n      onScroll,\r\n      props.selected,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  scrollContainer: {\r\n    flex: 1,\r\n    height: 48,\r\n  },\r\n  scrollContentContainer: {\r\n    paddingVertical: 0,\r\n    justifyContent: \"center\",\r\n  },\r\n  navigationBlock: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  itemContainerStyle: {\r\n    width: 70,\r\n    alignItems: \"center\",\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n  itemStyle: {\r\n    fontSize: 10,\r\n  },\r\n  gradient: {\r\n    flex: 1,\r\n  },\r\n  spellButtonPlaceholder: {\r\n    width: 84,\r\n    height: 48,\r\n  },\r\n  bottomMenuContainer: { flexDirection: \"row\", alignItems: \"center\" },\r\n  spellMenuButtonPlaceholder: {\r\n    height: 48,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"flex-end\",\r\n    overflow: \"visible\",\r\n  },\r\n  chevron: {\r\n    width: 24,\r\n    height: 48,\r\n    justifyContent: \"center\",\r\n  },\r\n});\r\n","import { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { applyTransformations } from \"../../backend/calculation/Calculation\";\r\nimport { TransformationTags } from \"../../backend/calculation/TransformationTags\";\r\nimport { cleanup } from \"../../backend/Cleanup\";\r\nimport { PlayerContext, PlayerContextState } from \"../../backend/PlayerContext\";\r\nimport {\r\n  processOfflineTicks,\r\n  processTimeTick,\r\n  processWarpTime,\r\n} from \"../../backend/timetick/TimeTick\";\r\n\r\nconst TARGET_FPS = 20;\r\n\r\nexport default function GameTickProcessor(props: {\r\n  setPlayerState: (state: PlayerContextState) => void;\r\n  onLoadingProgress: (ticksProcessedSoFar: number, ticksTotal: number) => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  // The use of ref is needed here because:\r\n  // 1. We don't want to reset the interval if the context changes,\r\n  //    because that will lead to delayed updates\r\n  // 2. If we don't use playerContextRef and use playerContext instead,\r\n  //    it will refer to an old context,\r\n  //    and it will miss updates\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const [lastTickTime, setLastTickTime] = useState(\r\n    playerContext.lastProcessedTime,\r\n  );\r\n\r\n  const [warping, setWarping] = useState(false);\r\n\r\n  const timeTickCallback = useCallback(async () => {\r\n    let nowTime = Date.now();\r\n    let lastTickTimeConsidered = lastTickTime;\r\n\r\n    if (warping) {\r\n      // Skip ticks entirely if warping\r\n      return;\r\n    }\r\n\r\n    if (playerContextRef.current.warpTimeSecs > 0) {\r\n      // Trigger a time warp!\r\n      let { apply, ...currentState } = playerContextRef.current;\r\n      setWarping(true);\r\n      await processWarpTime(\r\n        currentState,\r\n        () => Date.now(),\r\n        props.onLoadingProgress,\r\n        props.setPlayerState,\r\n      );\r\n      // Processing can take a while, so overwrite this so we don't end up with a long tick...\r\n      nowTime = Date.now();\r\n      setWarping(false);\r\n      lastTickTimeConsidered = nowTime;\r\n    }\r\n\r\n    const elapsedSec =\r\n      (nowTime - lastTickTimeConsidered) / 1000 +\r\n      playerContextRef.current.skipAheadTime;\r\n    if (elapsedSec > 3) {\r\n      // Trigger a loading update\r\n      const secsTotal = Math.floor(Math.min(60 * 60 * 48, elapsedSec));\r\n      let { apply, ...currentState } = playerContextRef.current;\r\n      await processOfflineTicks(\r\n        currentState,\r\n        secsTotal,\r\n        nowTime,\r\n        props.setPlayerState,\r\n      );\r\n    } else {\r\n      playerContextRef.current.apply((state) => {\r\n        state = processTimeTick(elapsedSec, false)(state);\r\n        state.lastProcessedTime = nowTime;\r\n        return state;\r\n      });\r\n    }\r\n    if (playerContextRef.current.skipAheadTime > 0) {\r\n      playerContextRef.current.apply((state) => {\r\n        state.skipAheadTime = 0;\r\n        return state;\r\n      });\r\n    }\r\n    setLastTickTime(nowTime);\r\n  }, [lastTickTime, warping]);\r\n\r\n  const cleanupCallback = useCallback(async () => {\r\n    playerContextRef.current.apply(cleanup);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const gameSpeed = applyTransformations(\r\n      [TransformationTags.GameSpeed],\r\n      playerContextRef.current,\r\n      1.0,\r\n    );\r\n    const interval = setTimeout(() => {\r\n      timeTickCallback();\r\n    }, 1000 / gameSpeed / (playerContext.global?.targetFps ?? TARGET_FPS));\r\n    return () => clearTimeout(interval);\r\n  }, [timeTickCallback]);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      cleanupCallback();\r\n    }, 10000);\r\n    return () => clearTimeout(interval);\r\n  }, [cleanupCallback]);\r\n\r\n  // Do not render anything\r\n  return null;\r\n}\r\n","import React, { useContext, useEffect, useRef } from \"react\";\r\nimport { Animated, StyleSheet, View } from \"react-native\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  Resource,\r\n} from \"../../backend/Resources\";\r\nimport { calculateIncomePerSecond } from \"../../backend/timetick/IncomeOverTime\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\n/*\r\n * This component displays a mana bar. However, it's a total hack and will\r\n * certainly not look ok if it's not full-screen-width.\r\n */\r\nexport default function ManaBar() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const mana = getResourceAmount(playerContext, Resource.Mana);\r\n  const manaCap = getResourceCap(playerContext, Resource.Mana);\r\n  const ratioFilled = mana / manaCap;\r\n\r\n  const filledAnim = useRef(new Animated.Value(ratioFilled)).current;\r\n\r\n  const manaIncome = calculateIncomePerSecond(playerContext)?.Mana ?? 0;\r\n  const incomeText =\r\n    manaIncome != 0\r\n      ? \" (\" +\r\n        (manaIncome > 0 ? \"+\" : \"\") +\r\n        formatNumber(manaIncome, { showDecimals: true }) +\r\n        \"/s)\"\r\n      : \"\";\r\n\r\n  useEffect(() => {\r\n    Animated.timing(filledAnim, {\r\n      toValue: Math.max(ratioFilled, 1e-5),\r\n      duration: 100,\r\n      useNativeDriver: true,\r\n    }).start();\r\n  }, [ratioFilled]);\r\n  return (\r\n    <View style={styles.container}>\r\n      <Animated.View\r\n        style={[styles.filled, { transform: [{ scaleX: filledAnim }] }]}\r\n      />\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"mana\" style={styles.icon} />\r\n        <Text style={styles.textOverlay}>\r\n          {formatNumber(mana)}/{formatNumber(manaCap)}\r\n          <Text style={styles.income}>{incomeText}</Text>\r\n        </Text>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    alignItems: \"center\",\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    width: \"100%\",\r\n    backgroundColor: \"#014\",\r\n    height: 29,\r\n  },\r\n  filled: {\r\n    backgroundColor: \"#04c\",\r\n    position: \"absolute\",\r\n    left: \"-100%\",\r\n    top: 0,\r\n    height: \"100%\",\r\n    width: \"200%\",\r\n  },\r\n  textOverlay: {\r\n    color: \"#fff\",\r\n    fontWeight: \"bold\",\r\n  },\r\n  income: {\r\n    color: \"#fff\",\r\n    fontWeight: \"normal\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    height: 16,\r\n    width: 16,\r\n    marginRight: 4,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  calculatePlayerAccuracy,\r\n  calculatePlayerAttack,\r\n  calculatePlayerAttackDelaySec,\r\n  calculatePlayerCritChance,\r\n  calculatePlayerDefense,\r\n  calculatePlayerDodgeChance,\r\n  calculatePlayerHPRegenPerSec,\r\n  calculatePlayerMaxHP,\r\n} from \"../../backend/exploration/CombatStats\";\r\nimport { getCurrentPlayerHP } from \"../../backend/exploration/Exploration\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Text } from \"./Text\";\r\n\r\nfunction CombatStatsRow(props: {\r\n  stat: string;\r\n  icon: string;\r\n  value: string;\r\n  hideText?: boolean;\r\n}) {\r\n  return (\r\n    <View style={styles.inlineRow}>\r\n      <View style={styles.inlineRow}>\r\n        <GameIcon icon={props.icon} style={styles.icon} small />\r\n        {!props.hideText && <Text>{props.stat}: </Text>}\r\n      </View>\r\n      <Text>{props.value}</Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst CombatStatsRowMemo = React.memo(CombatStatsRow);\r\n\r\nexport function CombatStatsViewer(props: {\r\n  hideText?: boolean;\r\n  isVisible?: boolean;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const currentHP = getCurrentPlayerHP(playerContext);\r\n  const maxHP = calculatePlayerMaxHP(playerContext);\r\n  const accuracy = Math.max(0, calculatePlayerAccuracy(playerContext));\r\n  const dodgeChance = calculatePlayerDodgeChance(playerContext);\r\n  const critChance = calculatePlayerCritChance(playerContext);\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        <CombatStatsRowMemo\r\n          stat=\"HP\"\r\n          icon=\"hp\"\r\n          hideText={props.hideText}\r\n          value={formatNumber(currentHP) + \"/\" + formatNumber(maxHP)}\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"Attack\"\r\n          icon=\"attack\"\r\n          hideText={props.hideText}\r\n          value={formatNumber(calculatePlayerAttack(playerContext))}\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"Attack Delay\"\r\n          icon=\"attackDelay\"\r\n          hideText={props.hideText}\r\n          value={\r\n            formatNumber(calculatePlayerAttackDelaySec(playerContext), {\r\n              showDecimals: true,\r\n            }) + \" sec\"\r\n          }\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"Defense\"\r\n          icon=\"defense\"\r\n          hideText={props.hideText}\r\n          value={formatNumber(calculatePlayerDefense(playerContext))}\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"HP Regen\"\r\n          icon=\"hpRegen\"\r\n          hideText={props.hideText}\r\n          value={\r\n            formatNumber(calculatePlayerHPRegenPerSec(playerContext), {\r\n              showDecimals: true,\r\n            }) + \"/sec\"\r\n          }\r\n        />\r\n        {accuracy != 1.0 && (\r\n          <CombatStatsRowMemo\r\n            stat=\"Accuracy\"\r\n            icon=\"accuracy\"\r\n            hideText={props.hideText}\r\n            value={\r\n              formatNumber(accuracy * 100, {\r\n                showDecimals: false,\r\n              }) + \"%\"\r\n            }\r\n          />\r\n        )}\r\n        {dodgeChance > 0 && (\r\n          <CombatStatsRowMemo\r\n            stat=\"Dodge Chance\"\r\n            icon=\"dodge\"\r\n            hideText={props.hideText}\r\n            value={\r\n              formatNumber(dodgeChance * 100, {\r\n                showDecimals: false,\r\n              }) + \"%\"\r\n            }\r\n          />\r\n        )}\r\n        {critChance > 0 && (\r\n          <CombatStatsRowMemo\r\n            stat=\"Critical Chance\"\r\n            icon=\"critChance\"\r\n            hideText={props.hideText}\r\n            value={\r\n              formatNumber(critChance * 100, {\r\n                showDecimals: false,\r\n              }) + \"%\"\r\n            }\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [props.isVisible !== false ? playerContext : false, props.hideText],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getSchoolExp,\r\n  getSchoolLevel,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedSchools,\r\n} from \"../../backend/spells/ElementsAndSchools\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { Text } from \"./Text\";\r\n\r\nfunction SchoolRow(props: {\r\n  name: string;\r\n  level: number;\r\n  isPrimary: boolean;\r\n  currentExp: string;\r\n  toNextLevel: string;\r\n}) {\r\n  return (\r\n    <View style={styles.row}>\r\n      <Text style={props.isPrimary && styles.primaryText}>\r\n        {props.name}: Lv{props.level}\r\n      </Text>\r\n\r\n      <Text style={props.isPrimary && styles.primaryText}>\r\n        Exp {props.currentExp}/{props.toNextLevel}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst SchoolRowMemo = React.memo(SchoolRow);\r\n\r\nexport function SchoolViewer(props: { isVisible: boolean }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const keys = getUnlockedSchools(playerContext);\r\n  const rows = useMemo(\r\n    () =>\r\n      keys.map((key) => {\r\n        const level = getSchoolLevel(playerContext, key);\r\n        const currentExp = getSchoolExp(playerContext, key);\r\n        const toNextLevel = getTotalExpRequiredForLevel(\r\n          playerContext,\r\n          level + 1,\r\n          key,\r\n        );\r\n        return (\r\n          <SchoolRowMemo\r\n            name={key}\r\n            level={level}\r\n            isPrimary={playerContext.primarySchool == key}\r\n            currentExp={formatNumber(currentExp)}\r\n            toNextLevel={formatNumber(toNextLevel)}\r\n            key={key}\r\n          />\r\n        );\r\n      }),\r\n    [\r\n      props.isVisible !== false\r\n        ? JSON.stringify(playerContext.schoolExperience)\r\n        : false,\r\n      playerContext.primarySchool,\r\n    ],\r\n  );\r\n  return <View style={styles.container}>{rows}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  primaryText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getResourceInfo,\r\n  getSortedResourceKeys,\r\n  Resource,\r\n  ResourceData,\r\n} from \"../../backend/Resources\";\r\nimport { calculateIncomePerSecond } from \"../../backend/timetick/IncomeOverTime\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Text } from \"./Text\";\r\n\r\nconst EPSILON = 1e-6;\r\n\r\nfunction ResourceRow(props: {\r\n  resource: Resource;\r\n  current: number;\r\n  cap: number;\r\n  income: number;\r\n  hideIncome: boolean;\r\n}) {\r\n  const resourceInfo = getResourceInfo(props.resource);\r\n  const isCapped = props.current >= props.cap - EPSILON;\r\n  const theme = useTheme();\r\n  return (\r\n    <View style={styles.row}>\r\n      <View style={styles.inlineRow}>\r\n        <GameIcon icon={resourceInfo.icon} style={styles.icon} small />\r\n        <Text>{props.resource}: </Text>\r\n      </View>\r\n      <View style={styles.inlineRow}>\r\n        {/*@ts-ignore The cappedResource is not part of react-native-elements*/}\r\n        <Text style={isCapped && { color: theme.theme.colors.cappedResource }}>\r\n          {formatNumber(props.current, { showDecimals: true })}/\r\n          {formatNumber(props.cap)}\r\n        </Text>\r\n        {!props.hideIncome && (\r\n          <View style={styles.income}>\r\n            {props.income != 0 && (\r\n              <Text\r\n                style={props.income < 0 && { color: theme.theme.colors.error }}\r\n              >\r\n                {(props.income > 0 ? \"+\" : \"\") +\r\n                  formatNumber(props.income, { showDecimals: true })}\r\n                /s\r\n              </Text>\r\n            )}\r\n          </View>\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst ResourceRowMemo = React.memo(ResourceRow);\r\n\r\nexport function ResourceViewer(props: { isVisible?: boolean }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const resourceKeys = getSortedResourceKeys(playerContext) as Array<Resource>;\r\n  const income = calculateIncomePerSecond(playerContext);\r\n  const hasAnyIncome = Object.keys(income).some(\r\n    (resource) => income[resource as Resource] != 0,\r\n  );\r\n  const rows = useMemo(\r\n    () =>\r\n      resourceKeys.map((resourceName) => {\r\n        const resource = playerContext.resources[resourceName] as ResourceData;\r\n        return (\r\n          <ResourceRowMemo\r\n            resource={resourceName}\r\n            current={resource.current}\r\n            cap={resource.cap}\r\n            income={income?.[resourceName] ?? 0}\r\n            hideIncome={!hasAnyIncome}\r\n            key={resourceName}\r\n          />\r\n        );\r\n      }),\r\n    [props.isVisible !== false ? playerContext : false],\r\n  );\r\n  return <View style={styles.container}>{rows}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n  income: {\r\n    width: 65,\r\n    marginLeft: 8,\r\n  },\r\n});\r\n","import Constants from \"expo-constants\";\r\nimport React, { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  Animated,\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableNativeFeedback,\r\n  TouchableOpacity,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport { Button, ListItem, useTheme } from \"react-native-elements\";\r\nimport { Gesture, GestureDetector } from \"react-native-gesture-handler\";\r\nimport { getEndingData } from \"../../backend/endings/Endings\";\r\nimport {\r\n  clearFlag,\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  setFlag,\r\n} from \"../../backend/Flags\";\r\nimport { isInventoryUnlocked } from \"../../backend/items/Items\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { getResourceAmount, Resource } from \"../../backend/Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../backend/spells/ElementsAndSchools\";\r\nimport { getTemporaryEffects } from \"../../backend/timetick/TemporaryEffects\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { CombatStatsViewer } from \"../utility/CombatStatsViewer\";\r\nimport Divider from \"../utility/Divider\";\r\nimport { SchoolViewer } from \"../utility/ElementViewer\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { createGestureHandler } from \"../utility/Miscellaneous\";\r\nimport { ResourceViewer } from \"../utility/ResourceViewer\";\r\nimport { TemporaryEffectsViewer } from \"../utility/TemporaryEffectsViewer\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\ntype Props = {\r\n  onNavigationPress: (section: string) => void;\r\n  onBackgroundPress: () => void;\r\n  visible: boolean;\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n};\r\n\r\nconst MenuComponent = (\r\n  props: {\r\n    title: string;\r\n    onPress: () => void;\r\n    topDivider?: boolean;\r\n    children: React.ReactNode;\r\n  } & any,\r\n) => {\r\n  const { title, onPress, topDivider, ...others } = props;\r\n  return (\r\n    <View>\r\n      {topDivider && <Divider />}\r\n      <ListItem\r\n        containerStyle={styles.navigationRowTitle}\r\n        onPress={onPress}\r\n        Component={Platform.select<any>({\r\n          android: TouchableNativeFeedback,\r\n          default: TouchableOpacity,\r\n        })}\r\n        {...others}\r\n      >\r\n        <GameIcon icon={title.toLowerCase()} />\r\n        <ListItem.Content>\r\n          <ListItem.Title>{title}</ListItem.Title>\r\n        </ListItem.Content>\r\n        <ListItem.Chevron />\r\n      </ListItem>\r\n      <Divider />\r\n    </View>\r\n  );\r\n};\r\n\r\nexport function MenuContents(props: {\r\n  visible: boolean;\r\n  onNavigationPress: (section: string) => void;\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n\r\n  const showResearch = hasFlag(playerContext, \"research_unlocked\");\r\n  const showAutocast = hasFlag(playerContext, \"autocast_unlocked\");\r\n  const showInventory = isInventoryUnlocked(playerContext);\r\n  const showExploration = hasFlag(playerContext, \"exploration_unlocked\");\r\n  const showRetirement = getTotalElementAndSchoolExp(playerContext) >= 10000;\r\n  const showUpgrades = hasFlag(playerContext, \"upgrades_unlocked\");\r\n  const showCreatures = hasFlag(playerContext, \"creatures_unlocked\");\r\n  const showStrengthening =\r\n    hasGlobalFlag(playerContext, \"strengthening_unlocked\") && showExploration;\r\n  const showEnding = getEndingData(playerContext) != null;\r\n\r\n  const swipeHandlerGesture = useMemo(\r\n    () => createGestureHandler(props.onSwipeLeft, props.onSwipeRight),\r\n    [props.onSwipeLeft, props.onSwipeRight],\r\n  );\r\n  const nativeGesture = useMemo(() => Gesture.Native(), []);\r\n  const compositeGesture = useMemo(\r\n    () => Gesture.Simultaneous(swipeHandlerGesture, nativeGesture),\r\n    [swipeHandlerGesture, nativeGesture],\r\n  );\r\n\r\n  const navigation = useMemo(\r\n    () => (\r\n      <View style={styles.navigationBlock}>\r\n        <MenuComponent\r\n          title=\"Campus\"\r\n          topDivider\r\n          onPress={() => props.onNavigationPress(\"Campus\")}\r\n        />\r\n        {showResearch && (\r\n          <MenuComponent\r\n            title=\"Research\"\r\n            onPress={() => props.onNavigationPress(\"Research\")}\r\n          />\r\n        )}\r\n        {showAutocast && (\r\n          <MenuComponent\r\n            title=\"Apprentices\"\r\n            onPress={() => props.onNavigationPress(\"Apprentices\")}\r\n          />\r\n        )}\r\n        {showInventory && (\r\n          <MenuComponent\r\n            title=\"Inventory\"\r\n            onPress={() => props.onNavigationPress(\"Inventory\")}\r\n          />\r\n        )}\r\n        {showExploration && (\r\n          <MenuComponent\r\n            title=\"Exploration\"\r\n            onPress={() => props.onNavigationPress(\"Exploration\")}\r\n          />\r\n        )}\r\n        {showUpgrades && (\r\n          <MenuComponent\r\n            title=\"Upgrades\"\r\n            onPress={() => props.onNavigationPress(\"Upgrades\")}\r\n          />\r\n        )}\r\n        {showCreatures && (\r\n          <MenuComponent\r\n            title=\"Creatures\"\r\n            onPress={() => props.onNavigationPress(\"Creatures\")}\r\n          />\r\n        )}\r\n        {showStrengthening && (\r\n          <MenuComponent\r\n            title=\"Strengthen\"\r\n            onPress={() => props.onNavigationPress(\"Strengthen\")}\r\n          />\r\n        )}\r\n        {showEnding && (\r\n          <MenuComponent\r\n            title=\"Ending\"\r\n            onPress={() => props.onNavigationPress(\"Ending\")}\r\n          />\r\n        )}\r\n        {showRetirement && (\r\n          <MenuComponent\r\n            title=\"Retirement\"\r\n            onPress={() => props.onNavigationPress(\"Retirement\")}\r\n          />\r\n        )}\r\n        <MenuComponent\r\n          title=\"Stats\"\r\n          onPress={() => props.onNavigationPress(\"Stats\")}\r\n        />\r\n        <MenuComponent\r\n          title=\"Help\"\r\n          onPress={() => props.onNavigationPress(\"Help\")}\r\n        />\r\n        <MenuComponent\r\n          title=\"Options\"\r\n          onPress={() => props.onNavigationPress(\"Options\")}\r\n        />\r\n        <MenuComponent\r\n          title=\"About\"\r\n          onPress={() => props.onNavigationPress(\"About\")}\r\n        />\r\n        {Constants?.expoConfig?.extra?.showDebug && (\r\n          <MenuComponent\r\n            title=\"Debug\"\r\n            onPress={() => props.onNavigationPress(\"Debug\")}\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      showResearch,\r\n      showAutocast,\r\n      showInventory,\r\n      showExploration,\r\n      showUpgrades,\r\n      showCreatures,\r\n      showEnding,\r\n      showRetirement,\r\n      props.onNavigationPress,\r\n    ],\r\n  );\r\n\r\n  const hasTemporaryEffects = getTemporaryEffects(playerContext).length > 0;\r\n\r\n  const isSpeedingUp = hasFlag(playerContext, \"time_piece_speedup_enabled\");\r\n  const hasTimePieces =\r\n    getResourceAmount(playerContext, Resource.TimePieces) > 0;\r\n\r\n  return useMemo(\r\n    () => (\r\n      <GestureDetector key=\"menuGesture\" gesture={compositeGesture}>\r\n        <ScrollView\r\n          style={styles.scrollContainer}\r\n          contentContainerStyle={styles.scrollContentContainer}\r\n        >\r\n          <View style={styles.titleContainer}>\r\n            <Text h1>Magic Research</Text>\r\n          </View>\r\n          {navigation}\r\n          {hasTimePieces && (\r\n            <>\r\n              {!isSpeedingUp && (\r\n                <Button\r\n                  title=\"Speed up time (3 Time Pieces / sec)\"\r\n                  onPress={() =>\r\n                    playerContextRef.current.apply(\r\n                      setFlag(\"time_piece_speedup_enabled\"),\r\n                    )\r\n                  }\r\n                  titleStyle={styles.timePieceButtonTitle}\r\n                  containerStyle={[styles.timePieceButtonContainer]}\r\n                />\r\n              )}\r\n              {isSpeedingUp && (\r\n                <Button\r\n                  title=\"Return time to normal\"\r\n                  onPress={() =>\r\n                    playerContextRef.current.apply(\r\n                      clearFlag(\"time_piece_speedup_enabled\"),\r\n                    )\r\n                  }\r\n                  titleStyle={styles.timePieceButtonTitle}\r\n                  containerStyle={[styles.timePieceButtonContainer]}\r\n                />\r\n              )}\r\n            </>\r\n          )}\r\n          <CategoryContainer title=\"Resources\">\r\n            <View style={styles.statViewer}>\r\n              <ResourceViewer isVisible={props.visible} />\r\n            </View>\r\n          </CategoryContainer>\r\n          <CategoryContainer title=\"Schools\">\r\n            <View style={styles.statViewer}>\r\n              <SchoolViewer isVisible={props.visible} />\r\n            </View>\r\n          </CategoryContainer>\r\n          {showExploration && (\r\n            <CategoryContainer title=\"Combat\">\r\n              <View style={styles.statViewer}>\r\n                <CombatStatsViewer isVisible={props.visible} />\r\n              </View>\r\n            </CategoryContainer>\r\n          )}\r\n          {hasTemporaryEffects && (\r\n            <CategoryContainer title=\"Buffs\">\r\n              <TemporaryEffectsViewer isVisible={props.visible} />\r\n            </CategoryContainer>\r\n          )}\r\n        </ScrollView>\r\n      </GestureDetector>\r\n    ),\r\n    [\r\n      navigation,\r\n      showExploration,\r\n      hasTemporaryEffects,\r\n      hasTimePieces,\r\n      isSpeedingUp,\r\n      props.visible,\r\n      compositeGesture,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function Menu(props: Props) {\r\n  const positionAnim = useRef(\r\n    new Animated.Value(props.visible ? 0 : -300),\r\n  ).current;\r\n\r\n  const opacityAnim = useRef(\r\n    new Animated.Value(props.visible ? 0.5 : 0),\r\n  ).current;\r\n\r\n  useEffect(() => {\r\n    if (props.visible) {\r\n      Animated.timing(positionAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0.5,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    } else {\r\n      Animated.timing(positionAnim, {\r\n        toValue: -300,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    }\r\n  }, [props.visible]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <>\r\n        <TouchableWithoutFeedback onPress={props.onBackgroundPress}>\r\n          <Animated.View\r\n            style={[styles.backdrop, { opacity: opacityAnim }]}\r\n            pointerEvents={props.visible ? \"auto\" : \"none\"}\r\n          />\r\n        </TouchableWithoutFeedback>\r\n        <Animated.View\r\n          style={[\r\n            styles.container,\r\n            {\r\n              transform: [{ translateX: positionAnim }],\r\n              backgroundColor: theme.theme.colors.background,\r\n            },\r\n          ]}\r\n        >\r\n          <MenuContents {...props} />\r\n        </Animated.View>\r\n      </>\r\n    ),\r\n    [positionAnim, opacityAnim, props.onBackgroundPress, props.visible, theme],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  backdrop: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    backgroundColor: \"#000\",\r\n    zIndex: 130,\r\n  },\r\n  container: {\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"stretch\",\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: 300,\r\n    left: 0,\r\n    top: 0,\r\n    zIndex: 140,\r\n  },\r\n  scrollContainer: {\r\n    padding: 8,\r\n  },\r\n  scrollContentContainer: {\r\n    paddingBottom: 16,\r\n  },\r\n  titleContainer: { marginBottom: 8 },\r\n  navigationBlock: { marginTop: 16 },\r\n  navigationRowTitle: { paddingVertical: 4 },\r\n  timePieceButtonContainer: { marginTop: 16 },\r\n  timePieceButtonTitle: { fontSize: 12 },\r\n  statViewer: {\r\n    marginTop: 4,\r\n  },\r\n});\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { Action, ActionBase, DoActionArgs } from \"../actions/Action\";\r\nimport { registerAction } from \"../actions/Actions\";\r\nimport { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { grantResource, Resource } from \"../Resources\";\r\nimport { hasTemporaryEffect } from \"../timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  grantSchoolExp,\r\n  meetsRequirements,\r\n  School,\r\n  SpellElement,\r\n} from \"./ElementsAndSchools\";\r\nimport { addRecentSpellCast, registerSpell, setLastCastedTime } from \"./Spells\";\r\n\r\nexport interface Spell extends Action {\r\n  getSpellName(): string;\r\n  canAfford(state: PlayerContextState): boolean;\r\n  getSchoolLevelRequirements(): Partial<Record<School, number>>;\r\n  getElement(): SpellElement | undefined;\r\n}\r\n\r\nexport abstract class SpellActionBase extends ActionBase implements Spell {\r\n  abstract getSpellName(): string;\r\n  abstract getManaCost(state: PlayerContextState): number;\r\n  abstract doSpellAction(\r\n    state: PlayerContextState,\r\n    args: DoActionArgs,\r\n  ): PlayerContextState;\r\n  abstract getSchoolLevelRequirements(): Partial<Record<School, number>>;\r\n\r\n  constructor() {\r\n    super();\r\n    registerSpell(this);\r\n    registerAction(this);\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  _tagArray: string[] | null = null;\r\n\r\n  getTags(): string[] {\r\n    if (this._tagArray == null) {\r\n      const tags = [\r\n        ...super.getTags(),\r\n        TransformationTags.Spell,\r\n        ...Object.keys(this.getSchoolLevelRequirements()),\r\n      ];\r\n      const element = this.getElement();\r\n      if (element) {\r\n        tags.push(element);\r\n      }\r\n      this._tagArray = tags;\r\n    }\r\n    return this._tagArray;\r\n  }\r\n\r\n  getName(): string {\r\n    return this.getSpellName();\r\n  }\r\n\r\n  _manaCostTags: string[] | null = null;\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    if (this._manaCostTags == null) {\r\n      this._manaCostTags = [\r\n        ...this.getTags(),\r\n        TransformationTags.Cost,\r\n        Resource.Mana,\r\n      ];\r\n    }\r\n    return {\r\n      resources: {\r\n        Mana: applyTransformations(\r\n          this._manaCostTags,\r\n          state,\r\n          this.getManaCost(state),\r\n        ),\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getDisplayName(state: PlayerContextState): string {\r\n    const lastCastTime = state?.lastSpellCastTimes?.[this.getSpellName()] || 0;\r\n    if (lastCastTime > 0) {\r\n      const cooldown = lastCastTime + this.getCooldown(state);\r\n      const secTillOver = cooldown - getSecondsPlayed(state);\r\n      if (secTillOver > 0) {\r\n        return `${this.getName()} (${formatNumber(secTillOver, {\r\n          showDecimals: true,\r\n        })} sec)`;\r\n      }\r\n    }\r\n    return super.getDisplayName(state);\r\n  }\r\n\r\n  getCategory(): string {\r\n    return \"Spells\";\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 0.0;\r\n  }\r\n\r\n  _cooldownTagArray: string[] | null = null;\r\n  getCooldown(state: PlayerContextState): number {\r\n    if (this._cooldownTagArray == null) {\r\n      this._cooldownTagArray = [\r\n        ...this.getTags(),\r\n        TransformationTags.SpellCooldown,\r\n      ];\r\n    }\r\n    if (this.getBaseCooldown() === 0.0) {\r\n      return 0.0;\r\n    }\r\n    return applyTransformations(\r\n      this._cooldownTagArray,\r\n      state,\r\n      this.getBaseCooldown(),\r\n    );\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    const schoolRequirements = this.getSchoolLevelRequirements();\r\n    return meetsRequirements(state, schoolRequirements);\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    const lastCastTime = state?.lastSpellCastTimes?.[this.getSpellName()] || 0;\r\n    if (\r\n      lastCastTime > 0 &&\r\n      getSecondsPlayed(state) < lastCastTime + this.getCooldown(state)\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      hasTemporaryEffect(state, \"SilencePlayer\") ||\r\n      hasTemporaryEffect(state, \"PlayerStun\")\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    const transformationResult = applyTransformations(\r\n      [...this.getTags(), TransformationTags.CanCastSpell],\r\n      state,\r\n      1.0,\r\n    );\r\n    if (transformationResult <= 0) {\r\n      return false;\r\n    }\r\n\r\n    return super.isEnabled(state);\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    const cost = this.getCost(state);\r\n    (Object.keys(cost.resources) as Array<Resource>).forEach((resourceName) => {\r\n      state = grantResource(\r\n        resourceName,\r\n        -(cost?.resources?.[resourceName] ?? 0),\r\n      )(state);\r\n    });\r\n\r\n    const schoolRequirements = this.getSchoolLevelRequirements();\r\n    Object.keys(schoolRequirements).forEach((school) => {\r\n      state = grantSchoolExp(\r\n        school as School,\r\n        (schoolRequirements[school as School] || -4) * 3 + 12,\r\n      )(state);\r\n    });\r\n\r\n    if (!args.isAutomatic) {\r\n      state = addRecentSpellCast(this)(state);\r\n    }\r\n\r\n    state = setLastCastedTime(this)(state);\r\n\r\n    return this.doSpellAction(state, args);\r\n  }\r\n}\r\n","import { ActionEffect, DoActionArgs } from \"../../actions/Action\";\r\nimport { getActionsForAreaByCategory } from \"../../actions/Actions\";\r\nimport { BuildingActionBase } from \"../../buildings/Building\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass ConjureBuilding extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Conjure Building\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Use magic to apply your current materials towards building a random building.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return `Builds a random building among the ones that can be built`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 300;\r\n  }\r\n\r\n  getValidActions(state: PlayerContextState): BuildingActionBase[] {\r\n    const actions = (getActionsForAreaByCategory(\"Campus\")?.[\"Buildings\"] ??\r\n      []) as Record<string, BuildingActionBase>;\r\n    const validActions = Object.values(actions).filter(\r\n      (action) =>\r\n        action.canAfford(state) &&\r\n        action.isVisible(state) &&\r\n        action.isEnabled(state) &&\r\n        (action.getResourceCost(state)?.[Resource.TimePieces] ?? 0) == 0,\r\n    );\r\n    return validActions;\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    const meetsCost = super.isEnabled(state);\r\n    if (!meetsCost) {\r\n      return false;\r\n    }\r\n\r\n    // Need to subtract the spell cost from the Mana\r\n    const cost = this.getCost(state);\r\n    state = grantResource(Resource.Mana, -(cost.resources.Mana ?? 0))(state);\r\n    const validActions = this.getValidActions(state);\r\n    state = grantResource(Resource.Mana, cost.resources.Mana ?? 0)(state);\r\n\r\n    return validActions.length > 0;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 8,\r\n    };\r\n  }\r\n\r\n  doSpellAction(\r\n    state: PlayerContextState,\r\n    args: DoActionArgs,\r\n  ): PlayerContextState {\r\n    const validActions = this.getValidActions(state);\r\n    const randomBuildingIdx = Math.floor(Math.random() * validActions.length);\r\n    return validActions[randomBuildingIdx].doAction(args, state);\r\n  }\r\n}\r\n\r\nexport default new ConjureBuilding();\r\n","import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport * as Clipboard from \"expo-clipboard\";\r\nimport React, {\r\n  RefObject,\r\n  useCallback,\r\n  useContext,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { CheckBox, Input, useTheme } from \"react-native-elements\";\r\nimport { EventTag } from \"../backend/events/GameEvent\";\r\nimport {\r\n  PlayerContext,\r\n  PlayerContextValue,\r\n  PLAYER_INITIAL_STATE,\r\n} from \"../backend/PlayerContext\";\r\nimport { serializeSaveData } from \"../backend/SaveData\";\r\nimport ConjureBuilding from \"../backend/spells/conjuration/ConjureBuilding\";\r\nimport { saveToFile } from \"../utils/FilesystemSave\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport LoadGameContainer from \"./utility/LoadGameContainer\";\r\nimport { showExportToFile, showImportFromFile } from \"./utility/Miscellaneous\";\r\nimport { Picker as UtilityPicker } from \"./utility/Picker\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nconst FPS_DATA = [\"10\", \"12\", \"15\", \"20\", \"24\", \"30\", \"40\", \"50\", \"60\"].map(\r\n  (x) => ({ label: x, key: x, value: x }),\r\n);\r\n\r\nfunction useEventTagToggle(\r\n  playerContextRef: RefObject<PlayerContextValue>,\r\n  tag: EventTag,\r\n) {\r\n  return useCallback(() => {\r\n    playerContextRef.current?.apply((oldState) => {\r\n      if (oldState.global.hideEventTags.includes(tag)) {\r\n        oldState.global.hideEventTags.splice(\r\n          oldState.global.hideEventTags.findIndex(\r\n            (innerTag) => innerTag === tag,\r\n          ),\r\n          1,\r\n        );\r\n      } else {\r\n        oldState.global.hideEventTags.push(tag);\r\n      }\r\n      return oldState;\r\n    });\r\n  }, []);\r\n}\r\n\r\nexport default function Options() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n\r\n  const copyToClipboard = useCallback(async () => {\r\n    const serializedData = await serializeSaveData(playerContextRef.current);\r\n    await Clipboard.setStringAsync(serializedData);\r\n  }, []);\r\n\r\n  const targetFpsChange = useCallback((value: string) => {\r\n    playerContextRef.current.apply((oldState) => {\r\n      oldState.global.targetFps = Number.parseInt(value);\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const swipingToggle = useCallback(() => {\r\n    playerContextRef.current.apply((oldState) => {\r\n      oldState.global.enableSwiping = !oldState.global.enableSwiping;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const darkModeToggle = useCallback(() => {\r\n    playerContextRef.current.apply((oldState) => {\r\n      oldState.global.themeMode =\r\n        oldState.global.themeMode === \"dark\" ? \"light\" : \"dark\";\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const conjureBuildingAutoOffCallback = useCallback(() => {\r\n    playerContextRef.current.apply((oldState) => {\r\n      oldState.global.automaticallyBuiltBuildingsStartOff =\r\n        !oldState.global.automaticallyBuiltBuildingsStartOff;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const eventTagLevelUpFifteenMinutesToggle = useEventTagToggle(\r\n    playerContextRef,\r\n    EventTag.LEVEL_UP_FIRST_FIFTEEN_MINS,\r\n  );\r\n  const eventTagLevelUpEmptyToggle = useEventTagToggle(\r\n    playerContextRef,\r\n    EventTag.LEVEL_UP_EMPTY,\r\n  );\r\n  const eventTagLevelUpAllToggle = useEventTagToggle(\r\n    playerContextRef,\r\n    EventTag.LEVEL_UP,\r\n  );\r\n  const eventTagInconsequentialRandomEventsToggle = useEventTagToggle(\r\n    playerContextRef,\r\n    EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n  );\r\n  const eventTagEarlyGameEventsToggle = useEventTagToggle(\r\n    playerContextRef,\r\n    EventTag.EARLY_GAME,\r\n  );\r\n\r\n  const [eraseText, setEraseText] = useState(\"\");\r\n  const eraseGame = useCallback(() => {\r\n    playerContextRef.current.apply((state) => {\r\n      return PLAYER_INITIAL_STATE;\r\n    });\r\n    AsyncStorage.removeItem(\"PlayerContextState\");\r\n    AsyncStorage.removeItem(\"LastSaveSecondsPlayed\");\r\n  }, []);\r\n\r\n  const theme = useTheme();\r\n\r\n  const loadText = showImportFromFile()\r\n    ? \"You may import save data by loading it from a file, or by pasting it here.\"\r\n    : \"You may import save data by pasting it here.\";\r\n\r\n  const saveToFileCallback = useCallback(async () => {\r\n    const result = await saveToFile(playerContextRef.current);\r\n  }, []);\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.headerContainer}>\r\n        <Text h2>Options</Text>\r\n      </View>\r\n      <CategoryContainer title=\"Performance\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            You may set your target FPS here. Higher FPS will make the game\r\n            smoother but it could affect battery power and CPU usage.\r\n          </Text>\r\n          <View style={styles.targetFpsContainer}>\r\n            <Text>Target FPS:</Text>\r\n            <View style={styles.targetFpsDropdownContainer}>\r\n              <UtilityPicker\r\n                onValueChange={targetFpsChange}\r\n                selectedValue={playerContext.global.targetFps.toString()}\r\n                style={styles.targetFpsPicker}\r\n                data={FPS_DATA}\r\n              />\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </CategoryContainer>\r\n      <CategoryContainer title=\"Hide Event Popups\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            Hide certain kinds of events, so that they don't disrupt gameplay.\r\n            Hidden events will not show a popup, but will still be accessible\r\n            through the Event Menu.\r\n          </Text>\r\n          <View style={styles.eventPopupsContainer}>\r\n            {playerContext.global.totalTimesResetted > 0 && (\r\n              <View>\r\n                <CheckBox\r\n                  title=\"Hide game progression events that require no action, up to unlocking Exploration\"\r\n                  checked={playerContext.global.hideEventTags.includes(\r\n                    EventTag.EARLY_GAME,\r\n                  )}\r\n                  onPress={eventTagEarlyGameEventsToggle}\r\n                  textStyle={styles.checkboxText}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            )}\r\n            <View>\r\n              <CheckBox\r\n                title=\"Hide school level up events during the first 15 minutes of a run\"\r\n                checked={playerContext.global.hideEventTags.includes(\r\n                  EventTag.LEVEL_UP_FIRST_FIFTEEN_MINS,\r\n                )}\r\n                onPress={eventTagLevelUpFifteenMinutesToggle}\r\n                textStyle={styles.checkboxText}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title=\"Hide school level up events if nothing new is unlocked\"\r\n                checked={playerContext.global.hideEventTags.includes(\r\n                  EventTag.LEVEL_UP_EMPTY,\r\n                )}\r\n                onPress={eventTagLevelUpEmptyToggle}\r\n                textStyle={styles.checkboxText}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title=\"Hide all school level up events\"\r\n                checked={playerContext.global.hideEventTags.includes(\r\n                  EventTag.LEVEL_UP,\r\n                )}\r\n                onPress={eventTagLevelUpAllToggle}\r\n                textStyle={styles.checkboxText}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title=\"Hide common random events (random events which are not Storylines and which appear more than once)\"\r\n                checked={playerContext.global.hideEventTags.includes(\r\n                  EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n                )}\r\n                onPress={eventTagInconsequentialRandomEventsToggle}\r\n                textStyle={styles.checkboxText}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </CategoryContainer>\r\n      <CategoryContainer title=\"Swipe to Open Menus\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            In smaller screens, you can swipe the screen left or right in order\r\n            to open menus. You can disable this behavior here.\r\n          </Text>\r\n          <View style={styles.targetFpsContainer}>\r\n            <CheckBox\r\n              title=\"Enable swiping\"\r\n              checked={playerContext.global.enableSwiping}\r\n              onPress={swipingToggle}\r\n              textStyle={styles.checkboxText}\r\n              containerStyle={styles.checkboxContainer}\r\n            />\r\n          </View>\r\n        </View>\r\n      </CategoryContainer>\r\n      {ConjureBuilding.isVisible(playerContext) && (\r\n        <CategoryContainer title=\"Conjure Building\">\r\n          <View style={styles.categoryContainer}>\r\n            <Text>\r\n              When the spell Conjure Building is cast automatically, buildings\r\n              that consume resources to operate (such as Furnaces) can be turned\r\n              off by default to prevent extra resource consumption.\r\n            </Text>\r\n            <View style={styles.eventPopupsContainer}>\r\n              <CheckBox\r\n                title=\"Turn off buildings when automatically created by Conjure Building\"\r\n                checked={\r\n                  playerContext.global.automaticallyBuiltBuildingsStartOff\r\n                }\r\n                onPress={conjureBuildingAutoOffCallback}\r\n                textStyle={styles.checkboxText}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n          </View>\r\n        </CategoryContainer>\r\n      )}\r\n      <CategoryContainer title=\"Dark Mode\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>Change the colors to be easier in the eyes.</Text>\r\n          <View style={styles.targetFpsContainer}>\r\n            <CheckBox\r\n              title=\"Enable dark mode\"\r\n              checked={playerContext.global.themeMode === \"dark\"}\r\n              onPress={darkModeToggle}\r\n              textStyle={styles.checkboxText}\r\n              containerStyle={styles.checkboxContainer}\r\n            />\r\n          </View>\r\n        </View>\r\n      </CategoryContainer>\r\n      <CategoryContainer title=\"Save File\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            You may persist your save data by copying it to the clipboard and\r\n            storing it anywhere you'd like.\r\n          </Text>\r\n          <Button\r\n            onPress={copyToClipboard}\r\n            title=\"Copy savefile to clipboard\"\r\n            containerStyle={styles.saveButton}\r\n          />\r\n        </View>\r\n        {showExportToFile() && (\r\n          <View style={styles.categoryContainer}>\r\n            <Text>\r\n              You can also save your data directly to a file or elsewhere.\r\n            </Text>\r\n            <Button\r\n              onPress={saveToFileCallback}\r\n              title=\"Save to file\"\r\n              containerStyle={styles.saveButton}\r\n            />\r\n          </View>\r\n        )}\r\n      </CategoryContainer>\r\n      <CategoryContainer title=\"Load File\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>{loadText}</Text>\r\n          <Text style={{ fontWeight: \"bold\", color: theme.theme.colors.error }}>\r\n            WARNING: This will erase your current save! Make sure you have\r\n            backed up your data!\r\n          </Text>\r\n          <LoadGameContainer />\r\n        </View>\r\n      </CategoryContainer>\r\n      <CategoryContainer title=\"Erase Saved Data\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            If you want to start all over again and retirement isn't enough, you\r\n            can delete your save data entirely.\r\n          </Text>\r\n          <Text style={{ fontWeight: \"bold\", color: theme.theme.colors.error }}>\r\n            WARNING: This will erase your current save, including all your\r\n            progress with Storylines and retirement! Make sure you have backed\r\n            up your data! Once you have done this, there is no going back! If\r\n            you are sure you want to do this, write \"erase\" in the text field\r\n            below.\r\n          </Text>\r\n          <Input\r\n            inputContainerStyle={styles.inputContainer}\r\n            value={eraseText}\r\n            onChangeText={setEraseText}\r\n          />\r\n          <Button\r\n            disabled={eraseText.toLowerCase() != \"erase\"}\r\n            onPress={eraseGame}\r\n            color=\"error\"\r\n            title=\"Permanently erase all saved data\"\r\n          />\r\n        </View>\r\n      </CategoryContainer>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  headerContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  categoryContainer: {\r\n    marginTop: 8,\r\n    paddingHorizontal: 8,\r\n  },\r\n  targetFpsContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  eventPopupsContainer: {\r\n    marginTop: 8,\r\n  },\r\n  targetFpsDropdownContainer: {\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n    marginLeft: 16,\r\n  },\r\n  targetFpsPicker: {\r\n    width: 100,\r\n  },\r\n  sliderContainer: {\r\n    width: 200,\r\n    marginLeft: 16,\r\n  },\r\n  sliderTextContainer: {\r\n    width: 120,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n  saveButton: {\r\n    marginTop: 8,\r\n  },\r\n  loadMessageContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  inputContainer: {\r\n    borderWidth: 1,\r\n    marginTop: 16,\r\n    maxHeight: 48,\r\n  },\r\n});\r\n","import { applyTransformations } from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { PlayerContextState, PlayerContextTransform } from \"../PlayerContext\";\r\nimport { grantSchoolExp, School } from \"../spells/ElementsAndSchools\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\n\r\nfunction onTick(\r\n  state: PlayerContextState,\r\n  elapsedTimeSec: number,\r\n): PlayerContextState {\r\n  const expPerSec = getResearcherExpPerSecForSchools(state);\r\n  for (let school in expPerSec) {\r\n    state = grantSchoolExp(\r\n      school as School,\r\n      (expPerSec?.[school as School] ?? 0) * elapsedTimeSec,\r\n    )(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getResearcherExpPerSecForSchools(\r\n  state: PlayerContextState,\r\n): Partial<Record<School, number>> {\r\n  const researcherAllocation = state.research.researcherAllocation;\r\n  const totalExpPerSec: Partial<Record<School, number>> = {};\r\n  for (let school in researcherAllocation.schools) {\r\n    const allocatedResearchers =\r\n      researcherAllocation.schools?.[school as School] || 0;\r\n    if (allocatedResearchers > 0) {\r\n      const researchRatePerResearcher = applyTransformations(\r\n        [school, TransformationTags.Research],\r\n        state,\r\n        1.0,\r\n      );\r\n      totalExpPerSec[school as School] =\r\n        researchRatePerResearcher * allocatedResearchers;\r\n    }\r\n  }\r\n  return totalExpPerSec;\r\n}\r\n\r\nexport function getBaseResearchRate(state: PlayerContextState) {\r\n  return applyTransformations([TransformationTags.Research], state, 1.0);\r\n}\r\n\r\nexport function getFreeResearchers(state: PlayerContextState): number {\r\n  const researcherAllocation = state.research.researcherAllocation;\r\n  let researchersAllocated = 0;\r\n  for (let school in researcherAllocation.schools) {\r\n    researchersAllocated += researcherAllocation.schools[school as School] || 0;\r\n  }\r\n  return state.research.totalResearchers - researchersAllocated;\r\n}\r\n\r\nfunction allocateResearchersToSchoolImpl(\r\n  school: School,\r\n  amount: number,\r\n  state: PlayerContextState,\r\n) {\r\n  const currentAllocation =\r\n    state.research.researcherAllocation.schools?.[school] || 0;\r\n  const actualAmountToAllocate =\r\n    amount > 0\r\n      ? Math.min(getFreeResearchers(state), amount)\r\n      : Math.max(-currentAllocation, amount);\r\n  state.research.researcherAllocation.schools[school] =\r\n    currentAllocation + actualAmountToAllocate;\r\n  return state;\r\n}\r\n\r\nexport function allocateResearchersToSchool(\r\n  this: any,\r\n  school: School,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return allocateResearchersToSchoolImpl.bind(this, school, amount);\r\n}\r\n\r\nfunction grantNewResearcherImpl(amount: number, state: PlayerContextState) {\r\n  state.research.totalResearchers = Math.max(\r\n    0,\r\n    state.research.totalResearchers + amount,\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function grantNewResearcher(\r\n  this: any,\r\n  amount: number,\r\n): PlayerContextTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return grantNewResearcherImpl.bind(this, amount);\r\n}\r\n\r\nexport function calculateResearcherCap(state: PlayerContextState): number {\r\n  return applyTransformations(\r\n    [TransformationTags.Researcher, TransformationTags.Cap],\r\n    state,\r\n    1,\r\n  );\r\n}\r\n\r\nexport function loadResearchers(): void {\r\n  registerTimeTickListener(\"Researchers\", onTick);\r\n}\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Card, CheckBox } from \"react-native-elements\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport {\r\n  allocateResearchersToSchool,\r\n  calculateResearcherCap,\r\n  getBaseResearchRate,\r\n  getFreeResearchers,\r\n} from \"../backend/research/Researchers\";\r\nimport {\r\n  getSchoolLevel,\r\n  getUnlockedSchools,\r\n  School,\r\n} from \"../backend/spells/ElementsAndSchools\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport { PlusMinusAllocator } from \"./utility/PlusMinusAllocator\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"./utility/UIContext\";\r\n\r\nfunction ResearchRow(props: { school: School; applyAll: boolean }) {\r\n  const school = props.school;\r\n  const playerContext = useContext(PlayerContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const freeResearchers = getFreeResearchers(playerContext);\r\n  const hasFreeResearchers = freeResearchers > 0;\r\n\r\n  const current =\r\n    playerContext.research.researcherAllocation.schools?.[school] || 0;\r\n  const onPressMinus = useCallback(\r\n    () =>\r\n      playerContextRef.current.apply(\r\n        allocateResearchersToSchool(school, props.applyAll ? -Infinity : -1),\r\n      ),\r\n    [school, props.applyAll],\r\n  );\r\n  const onPressPlus = useCallback(\r\n    () =>\r\n      playerContextRef.current.apply(\r\n        allocateResearchersToSchool(school, props.applyAll ? Infinity : 1),\r\n      ),\r\n    [school, props.applyAll],\r\n  );\r\n  const schoolLevel = getSchoolLevel(playerContext, school);\r\n\r\n  const schoolText = useMemo(\r\n    () => (\r\n      <Text numberOfLines={3}>\r\n        {school}\r\n        {playerContext.primarySchool == school ? \" (Primary)\" : \"\"}:{\" \"}\r\n        {\"Lv\" + schoolLevel}\r\n      </Text>\r\n    ),\r\n    [school, playerContext.primarySchool, schoolLevel],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        key={school}\r\n        style={[styles.row, styles.singleSchoolElementContainer]}\r\n      >\r\n        <View style={styles.schoolTextContainer}>{schoolText}</View>\r\n        <View style={[styles.row, styles.rightHandSide]}>\r\n          <Text>{current}</Text>\r\n          <View style={styles.plusMinusAllocatorContainer}>\r\n            <PlusMinusAllocator\r\n              disableMinus={current === 0}\r\n              disablePlus={!hasFreeResearchers}\r\n              onPressMinus={onPressMinus}\r\n              onPressPlus={onPressPlus}\r\n            />\r\n          </View>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [schoolText, current, hasFreeResearchers, onPressMinus, onPressPlus],\r\n  );\r\n}\r\n\r\nexport function Research() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const uiContext = useContext(UIContext);\r\n  const playerContextRef = useRef(playerContext);\r\n  playerContextRef.current = playerContext;\r\n  const freeResearchers = getFreeResearchers(playerContext);\r\n\r\n  const [applyAll, setApplyAll] = useUIStateFromContext(\r\n    uiContext,\r\n    \"research_applyall\",\r\n    false,\r\n  );\r\n\r\n  const toggleApplyAll = useCallback(() => {\r\n    setApplyAll(!applyAll);\r\n  }, [applyAll, setApplyAll]);\r\n\r\n  const bottomSection = useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={styles.assignAllContainer}>\r\n          <CheckBox\r\n            title=\"Assign / unassign all at once\"\r\n            checked={applyAll}\r\n            textStyle={styles.checkboxText}\r\n            containerStyle={styles.checkboxContainer}\r\n            onPress={toggleApplyAll}\r\n          />\r\n        </View>\r\n        <View style={[styles.row, styles.researcherCapacityContainer]}>\r\n          <Text>Researchers available: </Text>\r\n          <Text>\r\n            {formatNumber(freeResearchers)}/\r\n            {formatNumber(playerContext.research.totalResearchers)}\r\n          </Text>\r\n        </View>\r\n        <View style={[styles.row, styles.researcherCapacityContainer]}>\r\n          <Text>Researcher capacity: </Text>\r\n          <Text>\r\n            {formatNumber(playerContext.research.totalResearchers)}/\r\n            {formatNumber(calculateResearcherCap(playerContext))}\r\n          </Text>\r\n        </View>\r\n        <View style={[styles.row, styles.researcherCapacityContainer]}>\r\n          <Text>Exp per researcher: </Text>\r\n          <Text>\r\n            {formatNumber(getBaseResearchRate(playerContext), {\r\n              showDecimals: true,\r\n            })}{\" \"}\r\n            / sec\r\n          </Text>\r\n        </View>\r\n        <View>\r\n          <ActionsContainer area=\"Research\" />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      calculateResearcherCap(playerContext),\r\n      getBaseResearchRate(playerContext),\r\n      playerContext.research.totalResearchers,\r\n      freeResearchers,\r\n      applyAll,\r\n      toggleApplyAll,\r\n    ],\r\n  );\r\n  const schools = getUnlockedSchools(playerContext);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        <UtilityCard>\r\n          <Card.Title>Schools</Card.Title>\r\n          {schools.map((school) => {\r\n            return (\r\n              <ResearchRow key={school} school={school} applyAll={applyAll} />\r\n            );\r\n          })}\r\n        </UtilityCard>\r\n        {bottomSection}\r\n      </View>\r\n    );\r\n  }, [schools.length, bottomSection, applyAll]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusAllocatorContainer: {\r\n    marginLeft: 16,\r\n  },\r\n  assignAllContainer: {\r\n    marginTop: 8,\r\n    paddingHorizontal: 16,\r\n  },\r\n  researcherCapacityContainer: {\r\n    marginTop: 4,\r\n    paddingHorizontal: 16,\r\n  },\r\n  singleSchoolElementContainer: {\r\n    marginVertical: 4,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n  rightHandSide: {\r\n    marginLeft: 16,\r\n  },\r\n  schoolTextContainer: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { formatTime } from \"../../../utils/FormattingUtils\";\r\nimport { applyTransformations } from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { grantSchoolExp, School } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  ActionBase,\r\n  ActionEffect,\r\n  ActionSubcategory,\r\n  DoActionArgs,\r\n} from \"../Action\";\r\n\r\nclass UseTimePiecesResearch extends ActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.TimePieces) > 0 &&\r\n      hasFlag(state, \"research_unlocked\")\r\n    );\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Use Time Pieces (Research)\";\r\n  }\r\n\r\n  getArea(): string[] {\r\n    return [\"Campus\", \"Research\"];\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory[\"Use Time Pieces\"];\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Use your time pieces to get some research. Requires at least one active researcher.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      timePiecesPerResearchSecond: {\r\n        value: 2,\r\n        tags: [TransformationTags.TimePiecePerResearch],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const timePiecesPerResearchSecond =\r\n      this.getActionEffects(state).timePiecesPerResearchSecond;\r\n    const secs = 3000 / timePiecesPerResearchSecond;\r\n    const timeString = formatTime(secs, {\r\n      shortForm: true,\r\n      showDecimals: true,\r\n    });\r\n    return `Instantly obtain ${timeString} (Real World time) of research`;\r\n  }\r\n\r\n  canAfford(state: PlayerContextState): boolean {\r\n    return (\r\n      super.canAfford(state) &&\r\n      getResourceAmount(state, Resource.TimePieces) >= 3000\r\n    );\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        \"Time Pieces\": 3000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return (\r\n      super.isEnabled(state) &&\r\n      Object.keys(state.research.researcherAllocation.schools).some(\r\n        (school) =>\r\n          (state.research.researcherAllocation.schools[school as School] ?? 0) >\r\n          0,\r\n      )\r\n    );\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    const timePiecesPerResearchSecond =\r\n      this.getActionEffects(state).timePiecesPerResearchSecond;\r\n    const timePieces = 3000;\r\n    const secs = timePieces / timePiecesPerResearchSecond;\r\n    const transformedSecs = applyTransformations(\r\n      [TransformationTags.GameSpeed],\r\n      state,\r\n      secs,\r\n      { isWarp: true },\r\n    );\r\n\r\n    state = grantResource(\r\n      Resource.TimePieces,\r\n      -(this.getCost(state).resources[\"Time Pieces\"] ?? 0),\r\n    )(state);\r\n\r\n    Object.keys(state.research.researcherAllocation.schools).forEach(\r\n      (school) => {\r\n        const researchersAllocated =\r\n          state.research.researcherAllocation.schools[school as School] ?? 0;\r\n        if (researchersAllocated > 0) {\r\n          const expPerResearcherPerSec = applyTransformations(\r\n            [school, TransformationTags.Research],\r\n            state,\r\n            1.0,\r\n            { isWarp: true },\r\n          );\r\n          state = grantSchoolExp(\r\n            school as School,\r\n            researchersAllocated * expPerResearcherPerSec * transformedSecs,\r\n          )(state);\r\n        }\r\n      },\r\n    );\r\n\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new UseTimePiecesResearch();\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { DungeonFloor } from \"../../exploration/dungeons/DungeonFloor\";\r\nimport { isDungeonFloorEverCompleted } from \"../../exploration/dungeons/Dungeons\";\r\nimport { getSuccessfulExplorationsForFloor } from \"../../exploration/Exploration\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlag,\r\n} from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport {\r\n  getMaxOfMaxPrimarySchoolLevels,\r\n  getMaxPrimarySchoolLevel,\r\n  getSchoolLevel,\r\n  getUnlockedSchools,\r\n  grantSchoolExp,\r\n} from \"../../spells/ElementsAndSchools\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nconst memoryChamberEventBuilder = buildEvent(\r\n  \"memory_chamber\",\r\n  \"(Storyline) The Memory Chamber\",\r\n  [EventTag.STORYLINE],\r\n);\r\nmemoryChamberEventBuilder\r\n  .setOnTrigger(setFlag(\"memory_chamber_triggered\"))\r\n  .createMessage()\r\n  .setSimpleDescription(\r\n    `Your researcher approaches you. In her hands is a large blueprint.\r\n    \r\n\"I have figured out an interesting idea,\" she says. \"There is a way we could build a magical storage, not for our resources, but for our memories.\"`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    memoryChamberEventBuilder\r\n      .createMessage()\r\n      .setSimpleDescription(\r\n        `Confused, you ask her to explain further.\r\n      \r\n\"Well, you see,\" she continues. \"We are doing a ton of research right now, and it would be a shame if it were to be lost to future generations. Not only that, but the exploration we have been doing is also something they would be able to benefit from... as long as they know about it, of course.\"\r\n\r\nYou ponder her proposal and look at the blueprint. The costs are definitely hefty.`,\r\n      )\r\n      .addOption(\r\n        \"Build the Memory Chamber (5000 Mana, 30K Stone)\",\r\n        {\r\n          transform: (state) => {\r\n            state = grantResource(Resource.Mana, -5000)(state);\r\n            state = grantResource(Resource.Stone, -30000)(state);\r\n            return state;\r\n          },\r\n          isEnabled: (state) =>\r\n            getResourceAmount(state, Resource.Mana) >= 5000 &&\r\n            getResourceAmount(state, Resource.Stone) >= 30000,\r\n        },\r\n        memoryChamberEventBuilder\r\n          .createMessage()\r\n          .setSimpleDescription(\r\n            `You decide to build the Memory Chamber and motion to your researcher to do so.\r\n    \r\nA few days later, your researcher takes you to the freshly built chamber: a small room in a corner of the campus. You enter it and enchant it with plenty of Mana. The room is mostly empty bookshelves right now.`,\r\n          )\r\n          .addOption(\r\n            \"Continue\",\r\n            {\r\n              transform: (state) => {\r\n                state = setGlobalFlag(\"memory_chamber_completed\")(state);\r\n                state = setFlag(\"memory_chamber_exp_granted\")(state);\r\n                return state;\r\n              },\r\n            },\r\n            memoryChamberEventBuilder.createMessage()\r\n              .setSimpleDescription(`\"We'll make sure to fill it with the fruits of our research\", says the researcher. \"We will leave behind a lasting legacy.\" You nod, satisfied, knowing that your efforts will not be forgotten in the future.\r\n\r\n**You have completed the \"The Memory Chamber\" storyline! You will begin future runs with some experience on your schools based on each school's MPL (Maximum Primary Level). In addition, areas you have beaten the boss of in the past will require less exploration depending on your highest MPL!**`),\r\n          ),\r\n      ),\r\n  );\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationBossRequirement]],\r\n  \"MemoryChamberExploration\",\r\n  TransformationType.Multiplier,\r\n  (state, params) => {\r\n    const floor = params.floor as DungeonFloor;\r\n    return isDungeonFloorEverCompleted(state, floor)\r\n      ? calculateMemoryChamberExplorationMultiplier(state)\r\n      : 1.0;\r\n  },\r\n);\r\n\r\naddContextListener(\"memory_chamber_post_retirement\", (oldState, newState) => {\r\n  if (\r\n    hasGlobalFlag(newState, \"memory_chamber_completed\") &&\r\n    !hasFlag(newState, \"memory_chamber_exp_granted\")\r\n  ) {\r\n    return (state) => {\r\n      const schools = getUnlockedSchools(state);\r\n      schools.forEach((school) => {\r\n        const mpl = getMaxPrimarySchoolLevel(state, school);\r\n        const expToGrant = 100 * Math.pow(1.25, mpl);\r\n        state = grantSchoolExp(school, expToGrant)(state);\r\n      });\r\n      state = setFlag(\"memory_chamber_exp_granted\")(state);\r\n      return state;\r\n    };\r\n  }\r\n});\r\n\r\nexport function calculateMemoryChamberExplorationMultiplier(\r\n  state: PlayerContextState,\r\n): number {\r\n  return hasGlobalFlag(state, \"memory_chamber_completed\")\r\n    ? 0.7 -\r\n        Math.min(\r\n          Math.max(getMaxOfMaxPrimarySchoolLevels(state) - 15, 0) * 0.016,\r\n          0.4,\r\n        )\r\n    : 1.0;\r\n}\r\n\r\nconst memoryChamberEvent = memoryChamberEventBuilder.build();\r\n\r\nregisterRandomEventTrigger(\r\n  memoryChamberEvent,\r\n  60,\r\n  true,\r\n  (state) =>\r\n    !hasFlag(state, \"memory_chamber_triggered\") &&\r\n    state.primarySchool != undefined &&\r\n    getSchoolLevel(state, state.primarySchool) >= 15 &&\r\n    hasFlag(state, \"exploration_unlocked\") &&\r\n    !hasGlobalFlag(state, \"memory_chamber_completed\"),\r\n);\r\n\r\naddContextListener(\"safeguard_memory_chamber_trigger\", (oldState, state) => {\r\n  if (\r\n    !hasFlag(state, \"memory_chamber_triggered\") &&\r\n    !hasGlobalFlag(state, \"memory_chamber_completed\") &&\r\n    state.primarySchool != undefined &&\r\n    getSuccessfulExplorationsForFloor(state, \"livingForestGrove\") > 10\r\n  ) {\r\n    // Safeguard unlock the alchemy lab.\r\n    return triggerEvent(memoryChamberEvent, {});\r\n  }\r\n});\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Memory Chamber\",\r\n    3060,\r\n    (state) => hasGlobalFlagIncludingNextRun(state, \"memory_chamber_completed\"),\r\n    (state) => hasGlobalFlag(state, \"memory_chamber_completed\"),\r\n    \"There's a chance of this happening randomly if your primary School is Lv15 or higher...\",\r\n    \"Start new runs with exp on every school depending on its MPL; Exploration amount requirement to unlock boss for previously beaten areas halved\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nexport default memoryChamberEvent;\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Button, useTheme } from \"react-native-elements\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport { retire } from \"../backend/Retire\";\r\nimport {\r\n  maximumSchoolLevelProductionMultiplierDx,\r\n  maximumSchoolLevelResearchMultiplier,\r\n} from \"../backend/spells/ElementsAndSchools\";\r\nimport { Storylines } from \"../backend/storylines/Storylines\";\r\nimport { clone } from \"../utils/CoreUtils\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nimport UseTimePiecesResearch from \"../backend/actions/campus/UseTimePiecesResearch\";\r\nimport { getEventMessageById } from \"../backend/events/Events\";\r\nimport { calculateMemoryChamberExplorationMultiplier } from \"../backend/events/storyline/MemoryChamber\";\r\nimport { hasGlobalFlag, hasGlobalFlagIncludingNextRun } from \"../backend/Flags\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\n\r\nexport default function Retirement() {\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const modifiedContext = retire(clone(playerContext), true);\r\n  const newResearchMultiplier =\r\n    maximumSchoolLevelResearchMultiplier(modifiedContext);\r\n  const newProductionMultiplier =\r\n    maximumSchoolLevelProductionMultiplierDx(modifiedContext);\r\n  const oldResearchMultiplier =\r\n    maximumSchoolLevelResearchMultiplier(playerContext);\r\n  const oldProductionMultiplier =\r\n    maximumSchoolLevelProductionMultiplierDx(playerContext);\r\n  const researchDeltaPct =\r\n    ((newResearchMultiplier - oldResearchMultiplier) * 100.0) /\r\n    oldResearchMultiplier;\r\n  const productionDeltaPct =\r\n    ((newProductionMultiplier - oldProductionMultiplier) * 100.0) /\r\n    oldProductionMultiplier;\r\n\r\n  const newStorylines = Storylines.getAll().filter(\r\n    (storyline) =>\r\n      !storyline.isBonusActive(playerContext) &&\r\n      storyline.isCompleted(playerContext),\r\n  );\r\n\r\n  let memoryChamberMessage = \"\";\r\n  const completedMemoryChamber = hasGlobalFlag(\r\n    playerContext,\r\n    \"memory_chamber_completed\",\r\n  );\r\n  const completedUpgradedMemoryChamber = hasGlobalFlagIncludingNextRun(\r\n    playerContext,\r\n    \"upgraded_memory_chamber_completed\",\r\n  );\r\n  if (completedMemoryChamber && !completedUpgradedMemoryChamber) {\r\n    const memoryChamberMultiplierBefore =\r\n      calculateMemoryChamberExplorationMultiplier(playerContext);\r\n    const memoryChamberMultiplierAfter =\r\n      calculateMemoryChamberExplorationMultiplier(modifiedContext);\r\n    const memoryChamberMultiplierDeltaPct =\r\n      ((memoryChamberMultiplierAfter - memoryChamberMultiplierBefore) * 100.0) /\r\n      memoryChamberMultiplierBefore;\r\n    memoryChamberMessage = ` Your Memory Chamber will also reduce the required exploration for previously completed areas to **${formatNumber(\r\n      memoryChamberMultiplierAfter * 100,\r\n      { showDecimals: false },\r\n    )}% (${\r\n      memoryChamberMultiplierDeltaPct != 0\r\n        ? formatNumber(memoryChamberMultiplierDeltaPct, {\r\n            showDecimals: false,\r\n          }) + \"%\"\r\n        : \"no change\"\r\n    })**.`;\r\n  }\r\n\r\n  let storylineBonusMessage = \"\";\r\n  if (newStorylines.length > 0) {\r\n    storylineBonusMessage = ` The following Storyline bonuses will also fully activate:\r\n    \r\n${newStorylines\r\n  .map(\r\n    (storyline) =>\r\n      `* **${storyline.name}**: ${storyline.getBonusDescription(\r\n        playerContext,\r\n      )}`,\r\n  )\r\n  .join(\"\\n\")}`;\r\n  }\r\n\r\n  const retirementEffects = `**If you retire now, your research multiplier will become ${formatNumber(\r\n    newResearchMultiplier,\r\n    { showDecimals: true },\r\n  )}x (+${formatNumber(researchDeltaPct, {\r\n    showDecimals: true,\r\n  })}%) and your production and loot multiplier will become ${formatNumber(\r\n    newProductionMultiplier,\r\n    { showDecimals: true },\r\n  )}x (+${formatNumber(productionDeltaPct, {\r\n    showDecimals: true,\r\n  })}%).**${memoryChamberMessage}${storylineBonusMessage}`;\r\n\r\n  const text = `You have built up enough knowledge that you feel it might be enough. You consider retirement.\r\n\r\nIf you retire, **you will reset the game.** Everything will revert back to its initial state, except:\r\n* Any unlocked schools or elements will stay unlocked;\r\n* Any bonuses you obtained from \"(Storyline)\" events will remain;\r\n* You will gain a boost to research, building production and loot based on the maximum level you have ever attained on your primary school (MPL), as well as on the sum of the MPLs you have attained on each school you have unlocked.\r\n\r\nWhen you retire, you will be able to choose a new primary school and element.\r\n\r\n${retirementEffects}\r\n\r\n*Do you want to retire?*`;\r\n\r\n  const [hasClicked, setHasClicked] = useState(false);\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setHasClicked(false);\r\n    }\r\n  }, [visible]);\r\n  const showTimePiecesWarning =\r\n    UseTimePiecesResearch.isVisible(playerContext) &&\r\n    UseTimePiecesResearch.isEnabled(playerContext);\r\n  const showOngoingEventsWarning = Object.values(\r\n    playerContext.eventOccurrences,\r\n  ).some((event) => {\r\n    return (\r\n      event.currentMessageId &&\r\n      !getEventMessageById(event.currentMessageId).isTerminal()\r\n    );\r\n  });\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>Retirement</Text>\r\n      <View style={styles.explanation}>\r\n        <Markdown>{text}</Markdown>\r\n      </View>\r\n      {showTimePiecesWarning && (\r\n        <View style={styles.warning}>\r\n          <Text style={{ color: theme.theme.colors.warning }}>\r\n            Warning: It looks like you still have many unused Time Pieces!\r\n            Consider using them up with \"Use Time Pieces (Research)\" (or in\r\n            other ways) before retiring, as they will be gone when you retire!\r\n          </Text>\r\n        </View>\r\n      )}\r\n      {showOngoingEventsWarning && (\r\n        <View style={styles.warning}>\r\n          <Text style={{ color: theme.theme.colors.warning }}>\r\n            Warning: You still have ongoing events! Are you sure you want to\r\n            retire?\r\n          </Text>\r\n        </View>\r\n      )}\r\n      <View style={styles.buttonContainer}>\r\n        {!hasClicked && (\r\n          <Button title=\"Retire\" onPress={() => setHasClicked(true)} />\r\n        )}\r\n        {hasClicked && (\r\n          <Button\r\n            title=\"Are you sure? Press again to confirm\"\r\n            onPress={() => {\r\n              playerContext.apply((state) => retire(state, false));\r\n            }}\r\n          />\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n  },\r\n  buttonContainer: {\r\n    marginTop: 16,\r\n  },\r\n  warning: {\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import React, { useEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  Animated,\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { Gesture, GestureDetector } from \"react-native-gesture-handler\";\r\nimport { createGestureHandler } from \"../utility/Miscellaneous\";\r\nimport SpellsContainer from \"./SpellsContainer\";\r\n\r\ntype Props = {\r\n  visible: boolean;\r\n  onBackgroundPress: () => void;\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n};\r\n\r\nexport function SpellMenuContents(props: {\r\n  onSwipeLeft: () => void;\r\n  onSwipeRight: () => void;\r\n  visible: boolean;\r\n}) {\r\n  const swipeHandlerGesture = useMemo(\r\n    () => createGestureHandler(props.onSwipeLeft, props.onSwipeRight),\r\n    [props.onSwipeLeft, props.onSwipeRight],\r\n  );\r\n  const nativeGesture = useMemo(() => Gesture.Native(), []);\r\n  const compositeGesture = useMemo(\r\n    () => Gesture.Simultaneous(swipeHandlerGesture, nativeGesture),\r\n    [swipeHandlerGesture, nativeGesture],\r\n  );\r\n  return (\r\n    <GestureDetector key=\"spellMenuContentsGesture\" gesture={compositeGesture}>\r\n      <ScrollView contentContainerStyle={styles.magicContainer}>\r\n        <SpellsContainer isVisible={props.visible} uiKey=\"SpellMenuContainer\" />\r\n      </ScrollView>\r\n    </GestureDetector>\r\n  );\r\n}\r\n\r\nexport function SpellMenu(props: Props) {\r\n  const positionAnim = useRef(\r\n    new Animated.Value(props.visible ? 0 : 300),\r\n  ).current;\r\n\r\n  const opacityAnim = useRef(\r\n    new Animated.Value(props.visible ? 0.5 : 0),\r\n  ).current;\r\n\r\n  const theme = useTheme();\r\n\r\n  useEffect(() => {\r\n    if (props.visible) {\r\n      Animated.timing(positionAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0.5,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    } else {\r\n      Animated.timing(positionAnim, {\r\n        toValue: 300,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    }\r\n  }, [props.visible]);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <>\r\n        <TouchableWithoutFeedback onPress={props.onBackgroundPress}>\r\n          <Animated.View\r\n            style={[styles.backdrop, { opacity: opacityAnim }]}\r\n            pointerEvents={props.visible ? \"auto\" : \"none\"}\r\n          />\r\n        </TouchableWithoutFeedback>\r\n        <Animated.View\r\n          style={[\r\n            styles.container,\r\n            {\r\n              transform: [{ translateX: positionAnim }],\r\n              backgroundColor: theme.theme.colors.background,\r\n            },\r\n          ]}\r\n        >\r\n          <SpellMenuContents\r\n            visible={props.visible}\r\n            onSwipeLeft={props.onSwipeLeft}\r\n            onSwipeRight={props.onSwipeRight}\r\n          />\r\n        </Animated.View>\r\n      </>\r\n    );\r\n  }, [\r\n    opacityAnim,\r\n    positionAnim,\r\n    props.visible,\r\n    props.onBackgroundPress,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  backdrop: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    backgroundColor: \"#000\",\r\n    zIndex: 80,\r\n  },\r\n  backdropTouchable: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    zIndex: 90,\r\n  },\r\n  container: {\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"stretch\",\r\n    position: \"absolute\",\r\n    zIndex: 100,\r\n    height: \"100%\",\r\n    width: 300,\r\n    right: 0,\r\n    top: 0,\r\n  },\r\n  magicContainer: {\r\n    padding: 8,\r\n  },\r\n});\r\n","// A secret is a piece of information that can be unlocked through some means.\r\n\r\nimport { hashCode } from \"../../utils/CoreUtils\";\r\nimport { hasGlobalFlag, setGlobalFlag } from \"../Flags\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\n\r\nexport enum SecretType {\r\n  Basic = \"Basic\",\r\n  Storyline = \"Storyline\",\r\n}\r\n\r\nexport class Secret implements Identifiable {\r\n  id: string;\r\n  secretType: SecretType;\r\n  getDescription: (state: PlayerContextState) => string;\r\n  isUnlockable: (state: PlayerContextState) => boolean;\r\n  _isCompleted?: (state: PlayerContextState) => boolean;\r\n\r\n  constructor(\r\n    id: string,\r\n    secretType: SecretType,\r\n    getDescription: (state: PlayerContextState) => string,\r\n    isUnlockable: (state: PlayerContextState) => boolean,\r\n    isCompleted?: (state: PlayerContextState) => boolean,\r\n  ) {\r\n    (this.id = id), (this.secretType = secretType);\r\n    this.getDescription = getDescription;\r\n    this.isUnlockable = isUnlockable;\r\n    this._isCompleted = isCompleted;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getType(): SecretType {\r\n    return this.secretType;\r\n  }\r\n\r\n  unlock(state: PlayerContextState): PlayerContextState {\r\n    return setGlobalFlag(`secret_${this.secretType}_${this.id}`)(state);\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return hasGlobalFlag(state, `secret_${this.secretType}_${this.id}`);\r\n  }\r\n\r\n  isCompleted(state: PlayerContextState): boolean {\r\n    if (this._isCompleted != null) {\r\n      return this._isCompleted(state);\r\n    }\r\n    return this.isUnlocked(state);\r\n  }\r\n}\r\n\r\nconst SecretsByType: Record<SecretType, DataStore<Secret>> = {\r\n  Basic: new DataStore<Secret>(),\r\n  Storyline: new DataStore<Secret>(),\r\n};\r\n\r\nexport function addSecret(secret: Secret): void {\r\n  SecretsByType[secret.getType()].register(secret);\r\n}\r\n\r\nexport function getUnlockedSecretsByType(\r\n  state: PlayerContextState,\r\n  secretType: SecretType,\r\n): Secret[] {\r\n  return SecretsByType[secretType]\r\n    .getAll()\r\n    .filter((secret) => secret.isUnlocked(state) || secret.isCompleted(state));\r\n}\r\n\r\nexport function getUnlockableLockedSecretsByType(\r\n  state: PlayerContextState,\r\n  secretType: SecretType,\r\n): Secret[] {\r\n  return SecretsByType[secretType].getAll().filter((secret) => {\r\n    return (\r\n      secret.isUnlockable(state) &&\r\n      !secret.isUnlocked(state) &&\r\n      !secret.isCompleted(state)\r\n    );\r\n  });\r\n}\r\n\r\nexport function getRandomUnlockableSecret(\r\n  state: PlayerContextState,\r\n  secretType: SecretType,\r\n): Secret | undefined {\r\n  const unlockableSecrets = getUnlockableLockedSecretsByType(state, secretType);\r\n  if (unlockableSecrets.length === 0) {\r\n    return undefined;\r\n  }\r\n  const randomIdx = Math.floor(Math.random() * unlockableSecrets.length);\r\n  const secretToUnlock = unlockableSecrets[randomIdx];\r\n  return secretToUnlock;\r\n}\r\n\r\nexport function getUnlockableSecretsByType(\r\n  state: PlayerContextState,\r\n  secretType: SecretType,\r\n): Secret[] {\r\n  return SecretsByType[secretType]\r\n    .getAll()\r\n    .filter(\r\n      (secret) =>\r\n        secret.isUnlockable(state) ||\r\n        secret.isUnlocked(state) ||\r\n        secret.isCompleted(state),\r\n    );\r\n}\r\n\r\nexport function addBasicSecret(\r\n  description: string,\r\n  isUnlockable?: (state: PlayerContextState) => boolean,\r\n) {\r\n  addSecret(\r\n    new Secret(\r\n      hashCode(description).toString(),\r\n      SecretType.Basic,\r\n      (state) => description,\r\n      isUnlockable ?? ((state) => true),\r\n    ),\r\n  );\r\n}\r\n\r\nexport { SecretsByType };\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { Secret } from \"../../backend/secrets/Secrets\";\r\nimport { DescriptionViewer } from \"./Miscellaneous\";\r\n\r\nexport function SecretContainer(props: { secret: Secret }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const secret = props.secret;\r\n  const isCompleted = props.secret.isCompleted(playerContext);\r\n  const isUnlocked = props.secret.isUnlocked(playerContext);\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    const descriptionContents = isUnlocked\r\n      ? secret.getDescription(playerContext)\r\n      : \"???\";\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <DescriptionViewer style={{ flex: 1, justifyContent: \"center\" }}>\r\n          {descriptionContents}\r\n        </DescriptionViewer>\r\n      </View>\r\n    );\r\n  }, [secret.getDescription(playerContext), isUnlocked]);\r\n\r\n  const theme = useTheme();\r\n  const iconContainer = useMemo(() => {\r\n    let iconName: \"lock\" | \"more-horiz\" | \"check\" = \"lock\";\r\n\r\n    if (isUnlocked) {\r\n      iconName = \"more-horiz\";\r\n    }\r\n\r\n    if (isCompleted) {\r\n      iconName = \"check\";\r\n    }\r\n\r\n    return (\r\n      <MaterialIcons\r\n        name={iconName}\r\n        size={20}\r\n        color={\r\n          isCompleted ? theme.theme.colors.grey1 : theme.theme.colors.grey3\r\n        }\r\n      />\r\n    );\r\n  }, [isUnlocked, isCompleted, theme]);\r\n\r\n  return (\r\n    <View style={styles.topContainer}>\r\n      {iconContainer}\r\n      {descriptionContainer}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  topContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    paddingVertical: 8,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginLeft: 8,\r\n    justifyContent: \"center\",\r\n    flex: 1,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getUnlockableSecretsByType,\r\n  SecretType,\r\n} from \"../../backend/secrets/Secrets\";\r\nimport Divider from \"./Divider\";\r\nimport { SecretContainer } from \"./SecretContainer\";\r\n\r\ntype SecretsContainerProps = { secretType: SecretType };\r\n\r\nexport default function SecretsContainer(props: SecretsContainerProps) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const secrets = getUnlockableSecretsByType(playerContext, props.secretType);\r\n\r\n  const secretDisplays = useMemo(\r\n    () =>\r\n      secrets.map((secret) => {\r\n        return <SecretContainer key={secret.id} secret={secret} />;\r\n      }),\r\n    [secrets.map((secret) => secret.id).join(\",\")],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (secretDisplays.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <View>\r\n        <View key={secrets[0].id}>{secretDisplays[0]}</View>\r\n        {secretDisplays.slice(1).map((secretDisplay, idx) => {\r\n          return (\r\n            <View key={secrets[idx].id}>\r\n              <Divider />\r\n              {secretDisplay}\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }, [secretDisplays]);\r\n}\r\n\r\nconst styles = StyleSheet.create({});\r\n","import { Entypo, MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { SecretsByType } from \"../../backend/secrets/Secrets\";\r\nimport { Storyline } from \"../../backend/storylines/Storylines\";\r\nimport { DescriptionViewer, EffectViewer } from \"./Miscellaneous\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function StorylineContainer(props: {\r\n  storyline: Storyline;\r\n  collapsed?: boolean;\r\n  onPressExpand?: () => void;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const storyline = props.storyline;\r\n  const secret = SecretsByType.Storyline.getById(storyline.name);\r\n\r\n  const isSecretUnlocked = secret.isUnlocked(playerContext);\r\n  const isCompleted = storyline.isCompleted(playerContext);\r\n  const isBonusActive = storyline.isBonusActive(playerContext);\r\n\r\n  const isEnabled = isSecretUnlocked || isCompleted || isBonusActive;\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    let descriptionContents = \"???\";\r\n    if (isSecretUnlocked) {\r\n      descriptionContents = secret.getDescription(playerContext);\r\n    }\r\n    if (isCompleted) {\r\n      descriptionContents =\r\n        \"You have completed this Storyline, but not all of its bonuses are active. Retire to obtain the rest!\";\r\n    }\r\n    if (isBonusActive) {\r\n      descriptionContents = storyline.getBonusDescription(playerContext);\r\n    }\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        {isBonusActive ? (\r\n          <View style={styles.effectContainer}>\r\n            <Text>Storyline completed!</Text>\r\n            <View style={styles.effectSubcontainer}>\r\n              <Text>Bonus: </Text>\r\n              <EffectViewer style={styles.descriptionViewer}>\r\n                {descriptionContents}\r\n              </EffectViewer>\r\n            </View>\r\n          </View>\r\n        ) : (\r\n          <DescriptionViewer style={styles.descriptionViewer}>\r\n            {descriptionContents}\r\n          </DescriptionViewer>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    secret.getDescription(playerContext),\r\n    storyline.getBonusDescription(playerContext),\r\n    isSecretUnlocked,\r\n    isCompleted,\r\n    isBonusActive,\r\n  ]);\r\n\r\n  const theme = useTheme();\r\n\r\n  const icon = useMemo(() => {\r\n    let icon = (\r\n      <MaterialIcons name=\"lock\" size={20} color={theme.theme.colors.grey3} />\r\n    );\r\n    if (isSecretUnlocked) {\r\n      icon = (\r\n        <MaterialIcons\r\n          name=\"more-horiz\"\r\n          size={20}\r\n          color={theme.theme.colors.grey3}\r\n        />\r\n      );\r\n    }\r\n    if (isCompleted) {\r\n      icon = (\r\n        <MaterialIcons\r\n          name=\"error-outline\"\r\n          size={20}\r\n          color={theme.theme.colors.black}\r\n        />\r\n      );\r\n    }\r\n    if (isBonusActive) {\r\n      icon = (\r\n        <MaterialIcons\r\n          name=\"check\"\r\n          size={20}\r\n          color={theme.theme.colors.black}\r\n        />\r\n      );\r\n    }\r\n    return icon;\r\n  }, [isSecretUnlocked, isCompleted, isBonusActive, theme]);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.storylineContainer} key={storyline.name}>\r\n        <TouchableWithoutFeedback onPress={props.onPressExpand}>\r\n          <View style={styles.topRowContainer}>\r\n            {icon}\r\n            <Text\r\n              h3\r\n              key={storyline.name}\r\n              onPress={props.onPressExpand}\r\n              style={[\r\n                styles.topContainer,\r\n                !isEnabled && styles.disabledStorylineText,\r\n              ]}\r\n            >\r\n              {isEnabled ? storyline.name : \"???\"}\r\n            </Text>\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.theme.colors.black}\r\n              />\r\n            </View>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        {!props.collapsed && <View>{descriptionContainer}</View>}\r\n      </View>\r\n    );\r\n  }, [\r\n    storyline.name,\r\n    isEnabled,\r\n    icon,\r\n    theme,\r\n    !props.collapsed && descriptionContainer,\r\n    props.collapsed,\r\n    props.onPressExpand,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  storylineContainer: { marginVertical: 8 },\r\n  topRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginBottom: 8,\r\n    marginTop: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  descriptionViewer: { flex: 1, justifyContent: \"center\" },\r\n  effectContainer: {\r\n    flex: 1,\r\n  },\r\n  effectSubcontainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  topContainer: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n  },\r\n  disabledStorylineText: {\r\n    color: \"#aaa\",\r\n  },\r\n});\r\n","import React, { useCallback, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { getSortedStorylines } from \"../../backend/storylines/Storylines\";\r\nimport Divider from \"./Divider\";\r\nimport { StorylineContainer } from \"./StorylineContainer\";\r\n\r\ntype StorylinesContainerProps = {};\r\n\r\nexport default function StorylinesContainer(props: StorylinesContainerProps) {\r\n  const [expandedStoryline, setExpandedStoryline] = useState(\"\");\r\n  const setStorylineCallback = useCallback(\r\n    (storylineName: string) => {\r\n      if (expandedStoryline == storylineName) {\r\n        setExpandedStoryline(\"\");\r\n      } else {\r\n        setExpandedStoryline(storylineName);\r\n      }\r\n    },\r\n    [expandedStoryline],\r\n  );\r\n\r\n  const storylines = getSortedStorylines();\r\n  const storylineNameString = storylines\r\n    .map((storyline) => storyline.name)\r\n    .join(\",\");\r\n\r\n  const storylineContainers = useMemo(\r\n    () =>\r\n      storylines.map((storyline) => {\r\n        return (\r\n          <StorylineContainer\r\n            key={storyline.name}\r\n            storyline={storyline}\r\n            collapsed={expandedStoryline != storyline.name}\r\n            onPressExpand={setStorylineCallback.bind(null, storyline.name)}\r\n          />\r\n        );\r\n      }),\r\n    [storylineNameString, expandedStoryline, setExpandedStoryline],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (storylines.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <View>\r\n        <View key={storylines[0].name}>{storylineContainers[0]}</View>\r\n        {storylineContainers.slice(1).map((storylineContainer, idx) => {\r\n          return (\r\n            <View key={storylines[idx].name}>\r\n              <Divider />\r\n              {storylineContainer}\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }, [storylineNameString, storylineContainers]);\r\n}\r\n\r\nconst styles = StyleSheet.create({});\r\n","import moment from \"moment\";\r\nimport React, { useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Card as RNECard, ListItem } from \"react-native-elements\";\r\nimport {\r\n  getMarkdownTextForCraftableItem,\r\n  getMarkdownTextForSpell,\r\n} from \"../backend/events/campus/LevelUp\";\r\nimport { Item } from \"../backend/items/Item\";\r\nimport { getCraftableItems, isCraftingUnlocked } from \"../backend/items/Items\";\r\nimport { PlayerContext } from \"../backend/PlayerContext\";\r\nimport { getResearcherExpPerSecForSchools } from \"../backend/research/Researchers\";\r\nimport { SecretsByType, SecretType } from \"../backend/secrets/Secrets\";\r\nimport {\r\n  getMaxPrimarySchoolLevel,\r\n  getSchoolExp,\r\n  getSchoolLevel,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedSchools,\r\n  maximumSchoolLevelProductionMultiplierDx,\r\n  maximumSchoolLevelResearchMultiplier,\r\n  School,\r\n  SCHOOL_LEVEL_CAP,\r\n} from \"../backend/spells/ElementsAndSchools\";\r\nimport { Spell } from \"../backend/spells/Spell\";\r\nimport { getVisibleSpellsForSchool } from \"../backend/spells/Spells\";\r\nimport { getSortedStorylines } from \"../backend/storylines/Storylines\";\r\nimport { clone } from \"../utils/CoreUtils\";\r\nimport { formatNumber, formatTimeLong } from \"../utils/FormattingUtils\";\r\nimport { Card } from \"./utility/Card\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport SecretsContainer from \"./utility/SecretsContainer\";\r\nimport StorylinesContainer from \"./utility/StorylinesContainer\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction StatsSingleSchool(props: { school: School }) {\r\n  const school = props.school;\r\n  const playerContext = useContext(PlayerContext);\r\n  const allSchoolLevels = getUnlockedSchools(playerContext).map((eachSchool) =>\r\n    getSchoolLevel(playerContext, eachSchool),\r\n  );\r\n\r\n  const newSpellsText = useMemo(() => {\r\n    const thisLevelSpells = getVisibleSpellsForSchool(playerContext, school);\r\n    const thisLevelCrafts = getCraftableItems(playerContext);\r\n    const currentSchoolLevel = getSchoolLevel(playerContext, school);\r\n    let nextUnlockLevelAdd = 0;\r\n    let foundNewSpellsOrItems = false;\r\n    let extraSpells: Spell[] = [];\r\n    let extraCrafts: Item[] = [];\r\n    const fakeState = clone(playerContext);\r\n    while (\r\n      !foundNewSpellsOrItems &&\r\n      currentSchoolLevel + nextUnlockLevelAdd < SCHOOL_LEVEL_CAP\r\n    ) {\r\n      nextUnlockLevelAdd += 1;\r\n      fakeState.schoolExperience[school] = getTotalExpRequiredForLevel(\r\n        fakeState,\r\n        getSchoolLevel(playerContext, school) + nextUnlockLevelAdd,\r\n        school,\r\n      );\r\n      const nextLevelSpells = getVisibleSpellsForSchool(fakeState, school);\r\n      const nextLevelCrafts = getCraftableItems(fakeState);\r\n      extraSpells = nextLevelSpells.filter(\r\n        (spell) => !thisLevelSpells.includes(spell),\r\n      );\r\n      extraCrafts = nextLevelCrafts.filter(\r\n        (item) => !thisLevelCrafts.includes(item),\r\n      );\r\n      if (extraSpells.length > 0 || extraCrafts.length > 0) {\r\n        foundNewSpellsOrItems = true;\r\n      }\r\n    }\r\n    const newSpells = extraSpells.map(getMarkdownTextForSpell);\r\n    const newCrafts = extraCrafts.map(\r\n      getMarkdownTextForCraftableItem.bind(null, playerContext),\r\n    );\r\n    const newUnlocks = [...newSpells, ...newCrafts];\r\n\r\n    return newUnlocks.length > 0\r\n      ? `Your next unlock is at level ${\r\n          nextUnlockLevelAdd + currentSchoolLevel\r\n        }, when you will learn:\r\n    \r\n${newUnlocks.join(\"\\n\")}`\r\n      : `If you only level up this school, you will not unlock any new spell${\r\n          isCraftingUnlocked(playerContext) ? \" or item\" : \"\"\r\n        }!`;\r\n  }, [JSON.stringify(allSchoolLevels)]);\r\n\r\n  const nextLevelRequiredExp =\r\n    getTotalExpRequiredForLevel(\r\n      playerContext,\r\n      getSchoolLevel(playerContext, school) + 1,\r\n      school,\r\n    ) - getSchoolExp(playerContext, school);\r\n\r\n  const researchEstimate = getResearcherExpPerSecForSchools(playerContext);\r\n\r\n  return (\r\n    <View>\r\n      <View style={styles.row}>\r\n        <Text>Level:</Text>\r\n        <Text style={styles.valueText}>\r\n          {getSchoolLevel(playerContext, school)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>To Next Level:</Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(nextLevelRequiredExp)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>To Next Level (Time):</Text>\r\n        <Text style={styles.valueText}>\r\n          {(researchEstimate?.[school as School] ?? 0) == 0 ||\r\n          nextLevelRequiredExp == Infinity\r\n            ? \"∞\"\r\n            : formatTimeLong(\r\n                moment.duration(\r\n                  (1000 * nextLevelRequiredExp) /\r\n                    (researchEstimate?.[school as School] ?? 0),\r\n                ),\r\n              )}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text style={{ flex: 1 }}>\r\n          Maximum Primary Level in previous runs (MPL):\r\n        </Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(getMaxPrimarySchoolLevel(playerContext, school))}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.insideBlock}>\r\n        <Markdown>{newSpellsText}</Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction StatsSchoolViewer() {\r\n  const [activeSection, setActiveSection] = useState(\"\");\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const schools = getUnlockedSchools(playerContext);\r\n\r\n  const perSchool = schools.map((school, index) => {\r\n    const title =\r\n      `${school} Lv${getSchoolLevel(playerContext, school)}` +\r\n      (school == playerContext.primarySchool ? \" (Primary)\" : \"\");\r\n    return (\r\n      <View key={school}>\r\n        <ListItem\r\n          topDivider\r\n          onPress={() => {\r\n            if (activeSection != school) {\r\n              setActiveSection(school);\r\n            } else {\r\n              setActiveSection(\"\");\r\n            }\r\n          }}\r\n        >\r\n          <ListItem.Content>\r\n            <ListItem.Title>{title}</ListItem.Title>\r\n          </ListItem.Content>\r\n          <ListItem.Chevron\r\n            type=\"material\"\r\n            name={activeSection == school ? \"close\" : \"chevron-right\"}\r\n          />\r\n        </ListItem>\r\n        {activeSection == school && (\r\n          <View style={styles.schoolElementContainer}>\r\n            <StatsSingleSchool school={school} />\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  });\r\n\r\n  return (\r\n    <View>\r\n      {perSchool}\r\n      <Divider />\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction StorylineViewer() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const allStorylines = getSortedStorylines();\r\n  const completedStorylines = allStorylines.filter((storyline) =>\r\n    storyline.isCompleted(playerContext),\r\n  );\r\n\r\n  return (\r\n    <View>\r\n      <View style={styles.row}>\r\n        <Text>Total Completed Storylines:</Text>\r\n        <Text style={styles.valueText}>\r\n          {completedStorylines.length} / {allStorylines.length}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>Completion Percentage:</Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(\r\n            (100 * completedStorylines.length) / allStorylines.length,\r\n          ) + \"%\"}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.storylineContainer}>\r\n        <StorylinesContainer />\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction StatsOtherViewer() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const totalDuration = moment.duration(\r\n    playerContext.global?.secondsPlayed,\r\n    \"seconds\",\r\n  );\r\n  const thisRunDuration = moment.duration(\r\n    playerContext.thisRun?.secondsPlayed,\r\n    \"seconds\",\r\n  );\r\n  const totalRealWorldDuration = moment.duration(\r\n    Date.now() - playerContext.global?.startTimestamp ?? 0,\r\n  );\r\n  const thisRunRealWorldDuration = moment.duration(\r\n    Date.now() - playerContext.thisRun?.startTimestamp ?? 0,\r\n  );\r\n\r\n  const researchMultiplier =\r\n    maximumSchoolLevelResearchMultiplier(playerContext);\r\n  const productionMultiplier =\r\n    maximumSchoolLevelProductionMultiplierDx(playerContext);\r\n\r\n  return (\r\n    <View>\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={2}>\r\n          In-game time played (total):\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(totalDuration)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={2}>\r\n          In-game time played (this run):\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(thisRunDuration)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={2}>\r\n          Real world time played (total):\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(totalRealWorldDuration)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={2}>\r\n          Real world time played (this run):\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(thisRunRealWorldDuration)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>Total times retired:</Text>\r\n        <Text style={styles.valueText}>\r\n          {playerContext.global.totalTimesResetted}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>Global research multiplier:</Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(researchMultiplier, { showDecimals: true })}x\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>Global production multiplier:</Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(productionMultiplier, { showDecimals: true })}x\r\n        </Text>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default function Stats() {\r\n  const playerContext = useContext(PlayerContext);\r\n  const hasSecrets =\r\n    SecretsByType.Basic.getAll().filter((secret) =>\r\n      secret.isUnlocked(playerContext),\r\n    ).length > 0;\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        <Card>\r\n          <RNECard.Title>Stats</RNECard.Title>\r\n          <StatsOtherViewer />\r\n        </Card>\r\n        <Card>\r\n          <RNECard.Title>Schools</RNECard.Title>\r\n          <StatsSchoolViewer />\r\n        </Card>\r\n        <Card>\r\n          <RNECard.Title>Storylines</RNECard.Title>\r\n          <StorylineViewer />\r\n        </Card>\r\n        {hasSecrets && (\r\n          <Card>\r\n            <RNECard.Title>Secrets</RNECard.Title>\r\n            <SecretsContainer secretType={SecretType.Basic} />\r\n          </Card>\r\n        )}\r\n      </View>\r\n    ),\r\n    [hasSecrets],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  schoolElementContainer: {\r\n    margin: 8,\r\n    marginBottom: 24,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginBottom: 4,\r\n  },\r\n  insideBlock: {\r\n    marginTop: 16,\r\n  },\r\n  valueText: {\r\n    minWidth: 60,\r\n    textAlign: \"right\",\r\n    marginLeft: 8,\r\n  },\r\n  valueTextLong: {\r\n    minWidth: 112,\r\n  },\r\n  storylineContainer: {\r\n    marginTop: 8,\r\n  },\r\n  captionText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\n\r\nexport default function Strengthening() {\r\n  return (\r\n    <View style={styles.container}>\r\n      <ActionsContainer area=\"Strengthening\" />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\n\r\nexport default function Upgrades() {\r\n  return (\r\n    <View style={styles.container}>\r\n      <ActionsContainer area=\"Upgrades\" />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-elements\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport {\r\n  getResourceInfo,\r\n  getSortedResourceKeys,\r\n  Resource,\r\n  ResourceData,\r\n} from \"../../backend/Resources\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Text } from \"./Text\";\r\n\r\nconst EPSILON = 1e-6;\r\n\r\nfunction ResourceItem(props: {\r\n  resource: Resource;\r\n  current: number;\r\n  cap: number;\r\n}) {\r\n  const resourceInfo = getResourceInfo(props.resource);\r\n  const isCapped = props.current >= props.cap - EPSILON;\r\n  const theme = useTheme();\r\n  return (\r\n    <View style={styles.item}>\r\n      <GameIcon icon={resourceInfo.icon} style={styles.icon} small />\r\n      {/*@ts-ignore The cappedResource is not part of react-native-elements*/}\r\n      <Text style={isCapped && { color: theme.theme.colors.cappedResource }}>\r\n        {formatNumber(props.current, { showDecimals: true })}/\r\n        {formatNumber(props.cap)}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst ResourceItemMemo = React.memo(ResourceItem);\r\n\r\nexport function BottomResourceViewer(props: { isVisible?: boolean }) {\r\n  const playerContext = useContext(PlayerContext);\r\n  const resourceKeys = getSortedResourceKeys(playerContext) as Array<Resource>;\r\n  const filteredResourceKeys = resourceKeys.filter(\r\n    (resource) => resource !== Resource.Mana,\r\n  );\r\n  const rows = useMemo(\r\n    () =>\r\n      filteredResourceKeys.map((resourceName) => {\r\n        const resource = playerContext.resources[resourceName] as ResourceData;\r\n        return (\r\n          <ResourceItemMemo\r\n            resource={resourceName}\r\n            current={resource.current}\r\n            cap={resource.cap}\r\n            key={resourceName}\r\n          />\r\n        );\r\n      }),\r\n    [props.isVisible !== false ? playerContext : false],\r\n  );\r\n  return <View style={styles.container}>{rows}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"space-around\",\r\n  },\r\n  item: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n    width: 106,\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n});\r\n","import { useContext, useMemo } from \"react\";\r\nimport { PlayerContext } from \"../../backend/PlayerContext\";\r\nimport { VisibilityContext } from \"./VisibilityContext\";\r\n\r\nexport function PlayerContextFreezer(props: {\r\n  isVisible: boolean;\r\n  children: any;\r\n}) {\r\n  const playerContext = useContext(PlayerContext);\r\n  return useMemo(() => {\r\n    return (\r\n      <VisibilityContext.Provider value={props.isVisible}>\r\n        <PlayerContext.Provider value={playerContext}>\r\n          {props.children}\r\n        </PlayerContext.Provider>\r\n      </VisibilityContext.Provider>\r\n    );\r\n  }, [props.isVisible ? playerContext : false]);\r\n}\r\n","export function OrientationLockManager() {\r\n  // Do not lock anything on web\r\n  return null;\r\n}\r\n","import { MaterialIcons, SimpleLineIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n  useTransition,\r\n} from \"react\";\r\nimport {\r\n  ActivityIndicator,\r\n  Animated,\r\n  BackHandler,\r\n  Easing,\r\n  Platform,\r\n  SafeAreaView,\r\n  ScrollView,\r\n  StatusBar,\r\n  StatusBarStyle,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  useWindowDimensions,\r\n  View,\r\n} from \"react-native\";\r\nimport {\r\n  Badge,\r\n  createTheme,\r\n  CreateThemeOptions,\r\n  Header,\r\n  Text,\r\n  ThemeContext,\r\n  ThemeProvider,\r\n  useTheme,\r\n} from \"react-native-elements\";\r\nimport \"react-native-gesture-handler\";\r\nimport {\r\n  Gesture,\r\n  GestureDetector,\r\n  GestureHandlerRootView,\r\n} from \"react-native-gesture-handler\";\r\nimport {\r\n  initialWindowMetrics,\r\n  SafeAreaProvider,\r\n} from \"react-native-safe-area-context\";\r\nimport AudioManager from \"./audio/AudioManager\";\r\nimport Demo from \"./backend/Demo\";\r\nimport { getEventMessageById } from \"./backend/events/Events\";\r\nimport {\r\n  PlayerContext,\r\n  PlayerContextState,\r\n  PlayerContextTransform,\r\n  PLAYER_INITIAL_STATE,\r\n} from \"./backend/PlayerContext\";\r\nimport {\r\n  addContextListener,\r\n  applyAllTransforms,\r\n} from \"./backend/PlayerContextListeners\";\r\nimport { loadData, saveData } from \"./backend/SaveData\";\r\nimport { SpellElement } from \"./backend/spells/ElementsAndSchools\";\r\nimport { nextFrame } from \"./backend/timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"./backend/timetick/TotalTimePlayed\";\r\nimport { getUICommands } from \"./backend/UICommands\";\r\nimport About from \"./components/About\";\r\nimport { Autocast } from \"./components/Autocast\";\r\nimport Campus from \"./components/Campus\";\r\nimport { Creatures } from \"./components/Creatures\";\r\nimport Debug from \"./components/Debug\";\r\nimport Ending from \"./components/Ending\";\r\nimport { EventList } from \"./components/events/EventList\";\r\nimport { EventMenu } from \"./components/events/EventMenu\";\r\nimport { EventOverlay } from \"./components/events/EventOverlay\";\r\nimport Exploration from \"./components/Exploration\";\r\nimport Help from \"./components/Help\";\r\nimport Intro from \"./components/Intro\";\r\nimport Inventory from \"./components/Inventory\";\r\nimport { BottomMenu } from \"./components/main/BottomMenu\";\r\nimport GameTickProcessor from \"./components/main/GameTickProcessor\";\r\nimport ManaBar from \"./components/main/ManaBar\";\r\nimport { Menu, MenuContents } from \"./components/main/Menu\";\r\nimport Options from \"./components/Options\";\r\nimport { Research } from \"./components/Research\";\r\nimport Retirement from \"./components/Retirement\";\r\nimport { SpellMenu, SpellMenuContents } from \"./components/spells/SpellMenu\";\r\nimport Stats from \"./components/Stats\";\r\nimport Strengthening from \"./components/Strengthening\";\r\nimport Upgrades from \"./components/Upgrades\";\r\nimport { BottomResourceViewer } from \"./components/utility/BottomResourceViewer\";\r\nimport { Button } from \"./components/utility/Button\";\r\nimport {\r\n  createGestureHandler,\r\n  elementColorByTheme,\r\n} from \"./components/utility/Miscellaneous\";\r\nimport { PlayerContextFreezer } from \"./components/utility/PlayerContextFreezer\";\r\nimport {\r\n  UIContext,\r\n  useUIStateFromContext,\r\n} from \"./components/utility/UIContext\";\r\nimport { formatNumber } from \"./utils/FormattingUtils\";\r\nimport { OrientationLockManager } from \"./utils/OrientationLockManager\";\r\nimport { getCurrentVersionTimestamp } from \"./utils/Versioning\";\r\n\r\nAudioManager.load();\r\n\r\nconst dividerColorDark =\r\n  StyleSheet.hairlineWidth < 1 ? \"#666\" : \"rgba(255, 255, 255, 0.12)\";\r\n\r\nconst lightCommonColors = {\r\n  hpBarForeground: \"#f00\",\r\n  hpBarBackground: \"#800\",\r\n  progressBar: \"#07f\",\r\n  background: \"#fff\",\r\n  disabled: \"#eee\",\r\n  grey0: \"#333\",\r\n  grey1: \"#444\",\r\n  grey2: \"#666\",\r\n  grey3: \"#888\",\r\n  grey4: \"#ccc\",\r\n  grey5: \"#eee\",\r\n  cappedResource: \"#00c\",\r\n  warning: \"#e90\",\r\n};\r\n\r\nconst darkCommonColors = {\r\n  divider: dividerColorDark,\r\n  disabled: \"#363636\",\r\n  grey5: \"#303030\",\r\n  grey4: \"#444\",\r\n  grey3: \"#666\",\r\n  grey2: \"#888\",\r\n  grey1: \"#ccc\",\r\n  grey0: \"#eee\",\r\n  background: \"#222\",\r\n  hpBarForeground: \"#a00\",\r\n  hpBarBackground: \"#500\",\r\n  progressBar: \"#06c\",\r\n  cappedResource: \"#bbf\",\r\n  error: \"#f00\",\r\n};\r\n\r\nconst primaryColorsByElement: Record<string, any> = {\r\n  Default: {\r\n    lightColors: { ...lightCommonColors },\r\n    darkColors: { primary: \"#247\", ...darkCommonColors },\r\n  },\r\n  Fire: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Fire),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Fire),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n  Earth: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Earth),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Earth),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n  Water: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Water),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Water),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n  Air: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Air),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Air),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n  Nature: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Nature),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Nature),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n  Lightning: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Lightning),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Lightning),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n  Darkness: {\r\n    lightColors: {\r\n      primary: elementColorByTheme(\"light\", SpellElement.Darkness),\r\n      ...lightCommonColors,\r\n    },\r\n    darkColors: {\r\n      primary: elementColorByTheme(\"dark\", SpellElement.Darkness),\r\n      ...darkCommonColors,\r\n    },\r\n  },\r\n};\r\n\r\nfunction overrideShouldComponentUpdate(\r\n  this: any,\r\n  nextProps: any,\r\n  nextState: any,\r\n) {\r\n  return (\r\n    this.props.theme != nextProps.theme ||\r\n    JSON.stringify(this.state) != JSON.stringify(nextState)\r\n  );\r\n}\r\n\r\nconst memoizedThemes: Record<string, any> = {};\r\nconst memoizedTheme = (key: any, theme: any) => {\r\n  const stringified = JSON.stringify(key);\r\n  if (!memoizedThemes[stringified]) {\r\n    memoizedThemes[stringified] = theme;\r\n  }\r\n  return memoizedThemes[stringified];\r\n};\r\n\r\nfunction overrideRender(this: any) {\r\n  const value = memoizedTheme(this.state.theme, {\r\n    theme: this.state.theme,\r\n    updateTheme: this.updateTheme,\r\n    replaceTheme: this.replaceTheme,\r\n  });\r\n  return (\r\n    <ThemeContext.Provider value={value}>\r\n      {this.props.children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\nThemeProvider.prototype.shouldComponentUpdate = overrideShouldComponentUpdate;\r\nThemeProvider.prototype.render = overrideRender;\r\n\r\nfunction ThemeUpdater() {\r\n  const theme = useTheme();\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const fullTheme = useMemo((): CreateThemeOptions => {\r\n    return {\r\n      lightColors:\r\n        primaryColorsByElement?.[playerContext.primaryElement || \"Default\"]\r\n          ?.lightColors,\r\n      darkColors:\r\n        primaryColorsByElement?.[playerContext.primaryElement || \"Default\"]\r\n          ?.darkColors,\r\n      mode: playerContext.global.themeMode,\r\n    };\r\n  }, [\r\n    primaryColorsByElement,\r\n    playerContext.primaryElement,\r\n    playerContext.global.themeMode,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    theme.replaceTheme(fullTheme);\r\n  }, [fullTheme]);\r\n\r\n  return null;\r\n}\r\n\r\nfunction IntroContents() {\r\n  const theme = useTheme();\r\n  const statusBarProps = useMemo(\r\n    () => ({\r\n      translucent: true,\r\n      backgroundColor: \"transparent\",\r\n      barStyle: \"light-content\" as StatusBarStyle,\r\n    }),\r\n    [],\r\n  );\r\n  return (\r\n    <View style={styles.maxContainer}>\r\n      <Header\r\n        containerStyle={[\r\n          styles.headerContainer,\r\n          { borderBottomColor: theme.theme.colors.background },\r\n        ]}\r\n        statusBarProps={statusBarProps}\r\n        centerComponent={{\r\n          text: \"Welcome to Magic Research\",\r\n          style: { color: \"#fff\" },\r\n        }}\r\n      />\r\n      <OrientationLockManager />\r\n      <SafeAreaView style={styles.safeAreaContainer}>\r\n        <View\r\n          style={[\r\n            styles.biggerContainer,\r\n            { backgroundColor: theme.theme.colors.background },\r\n          ]}\r\n        >\r\n          <View style={styles.introContainer}>\r\n            <ScrollView contentContainerStyle={styles.container}>\r\n              <Intro />\r\n            </ScrollView>\r\n          </View>\r\n        </View>\r\n      </SafeAreaView>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst SCROLLABLE_SECTIONS = [\r\n  \"Campus\",\r\n  \"Research\",\r\n  \"Apprentices\",\r\n  \"Inventory\",\r\n  \"Upgrades\",\r\n  \"Stats\",\r\n  \"Creatures\",\r\n  \"Strengthen\",\r\n  \"Retirement\",\r\n  \"Ending\",\r\n  \"Options\",\r\n  \"About\",\r\n  \"Help\",\r\n  \"Debug\",\r\n];\r\n\r\ntype MainAppContentsProps = {\r\n  setPlayerState: any;\r\n  onLoadingProgress: any;\r\n};\r\n\r\nlet sharedTouchPosition = {\r\n  x: 0,\r\n  y: 0,\r\n  initialX: 0,\r\n  initialY: 0,\r\n  lastTimestamp: 0,\r\n};\r\n\r\nfunction MainAppContents(props: MainAppContentsProps) {\r\n  const { height, width } = useWindowDimensions();\r\n  const playerContext = useContext(PlayerContext);\r\n\r\n  const [menuShown, setMenuShown] = useState(false);\r\n  const [rightMenuShown, setRightMenuShown] = useState(\"none\");\r\n\r\n  const [section, setSection] = useState(\"Campus\");\r\n  const theme = useTheme();\r\n\r\n  const processUICommand = useCallback((uiCommand: string) => {\r\n    if (uiCommand == \"goToExploration\") {\r\n      setSection(\"Exploration\");\r\n    } else if (uiCommand == \"goToEnding\") {\r\n      setSection(\"Ending\");\r\n    } else if (uiCommand == \"closeAllMenus\") {\r\n      setMenuShown(false);\r\n      setRightMenuShown(\"none\");\r\n    }\r\n  }, []);\r\n\r\n  const processUICommands = useCallback((state: PlayerContextState) => {\r\n    const uiCommands = getUICommands(state);\r\n    uiCommands.forEach(processUICommand);\r\n    state.uiCommands = uiCommands.filter(\r\n      (uiCommand) =>\r\n        uiCommand != \"goToExploration\" &&\r\n        uiCommand != \"goToEnding\" &&\r\n        uiCommand != \"closeAllMenus\",\r\n    );\r\n    return state;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    addContextListener(\"appUiCommand\", (oldState, newState) => {\r\n      const uiCommands = getUICommands(newState);\r\n      if (uiCommands.length > 0) {\r\n        return (state) => processUICommands(state);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onMenuPress = useCallback(() => {\r\n    setMenuShown(!menuShown);\r\n    setRightMenuShown(\"none\");\r\n  }, [menuShown]);\r\n  const onEventMenuPress = useCallback(() => {\r\n    if (rightMenuShown !== \"event\") {\r\n      setRightMenuShown(\"event\");\r\n    } else {\r\n      setRightMenuShown(\"none\");\r\n    }\r\n    setMenuShown(false);\r\n  }, [rightMenuShown]);\r\n  const onSpellMenuPress = useCallback(() => {\r\n    if (rightMenuShown !== \"spell\") {\r\n      setRightMenuShown(\"spell\");\r\n    } else {\r\n      setRightMenuShown(\"none\");\r\n    }\r\n    setMenuShown(false);\r\n  }, [rightMenuShown]);\r\n  const onNavigationPress = useCallback((section: string) => {\r\n    setSection(section);\r\n    setMenuShown(false);\r\n    setRightMenuShown(\"none\");\r\n  }, []);\r\n\r\n  const ongoingEventCount = Object.values(\r\n    playerContext.eventOccurrences,\r\n  ).filter((event) => {\r\n    return (\r\n      event.currentMessageId &&\r\n      !getEventMessageById(event.currentMessageId).isTerminal() &&\r\n      getEventMessageById(event.currentMessageId).isActionable(\r\n        playerContext,\r\n        event.params,\r\n      )\r\n    );\r\n  }).length;\r\n\r\n  useEffect(() => {\r\n    setSection(\"Campus\");\r\n  }, [playerContext.global.totalTimesResetted]);\r\n\r\n  const hasFourColumns = width >= 1250;\r\n  const hasTwoColumnsOrMore = width >= 700;\r\n  const hasThreeColumnsOrMore = width >= 960;\r\n\r\n  const showBottomResourceBar =\r\n    Platform.OS !== \"web\" &&\r\n    !hasTwoColumnsOrMore &&\r\n    ![\r\n      \"Apprentices\",\r\n      \"Exploration\",\r\n      \"Inventory\",\r\n      \"Retirement\",\r\n      \"Stats\",\r\n      \"Help\",\r\n      \"Options\",\r\n      \"About\",\r\n      \"Debug\",\r\n    ].includes(section);\r\n\r\n  const centerComponent = useMemo(\r\n    () => (\r\n      <View style={styles.centerText}>\r\n        <Text style={{ color: \"#fff\" }}>{section}</Text>\r\n      </View>\r\n    ),\r\n    [section, theme],\r\n  );\r\n\r\n  const bottomOpacityAnim = useRef(\r\n    new Animated.Value(showBottomResourceBar ? 0.5 : 0),\r\n  ).current;\r\n\r\n  useEffect(() => {\r\n    if (showBottomResourceBar) {\r\n      Animated.timing(bottomOpacityAnim, {\r\n        toValue: 1.0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    } else {\r\n      Animated.timing(bottomOpacityAnim, {\r\n        toValue: 0,\r\n        duration: 150,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    }\r\n  }, [showBottomResourceBar]);\r\n\r\n  const scrollViewRef = useRef<ScrollView>();\r\n\r\n  const enableSwiping = playerContext.global.enableSwiping;\r\n\r\n  const swipeLeftHandler = useCallback(() => {\r\n    if (!enableSwiping) {\r\n      return;\r\n    }\r\n    if (menuShown) {\r\n      setMenuShown(false);\r\n    } else if (rightMenuShown === \"none\") {\r\n      setRightMenuShown(\"spell\");\r\n    }\r\n  }, [\r\n    menuShown,\r\n    setMenuShown,\r\n    rightMenuShown,\r\n    setRightMenuShown,\r\n    enableSwiping,\r\n  ]);\r\n  const swipeRightHandler = useCallback(() => {\r\n    if (!enableSwiping) {\r\n      return;\r\n    }\r\n    if (rightMenuShown != \"none\") {\r\n      setRightMenuShown(\"none\");\r\n    } else if (!menuShown && !hasTwoColumnsOrMore) {\r\n      setMenuShown(true);\r\n    }\r\n  }, [\r\n    menuShown,\r\n    setMenuShown,\r\n    rightMenuShown,\r\n    setRightMenuShown,\r\n    enableSwiping,\r\n  ]);\r\n\r\n  const swipeHandlerGesture = useMemo(\r\n    () => createGestureHandler(swipeLeftHandler, swipeRightHandler),\r\n    [swipeLeftHandler, swipeRightHandler],\r\n  );\r\n  const nativeGesture = useMemo(() => Gesture.Native(), []);\r\n  const compositeGesture = useMemo(\r\n    () => Gesture.Simultaneous(swipeHandlerGesture, nativeGesture),\r\n    [swipeHandlerGesture, nativeGesture],\r\n  );\r\n\r\n  const swipeHandlerGestureExploration = useMemo(\r\n    () => createGestureHandler(swipeLeftHandler, swipeRightHandler),\r\n    [swipeLeftHandler, swipeRightHandler],\r\n  );\r\n  const nativeGestureExploration = useMemo(() => Gesture.Native(), []);\r\n  const compositeGestureExploration = useMemo(\r\n    () =>\r\n      Gesture.Simultaneous(\r\n        swipeHandlerGestureExploration,\r\n        nativeGestureExploration,\r\n      ),\r\n    [swipeHandlerGestureExploration, nativeGestureExploration],\r\n  );\r\n\r\n  const uiContext = useContext(UIContext);\r\n  const [scrollPositions, setScrollPositions] = useUIStateFromContext<\r\n    Record<string, number>\r\n  >(uiContext, \"mainScrollPositions\", {});\r\n  const onScroll = useCallback(\r\n    (event: any) => {\r\n      if (!SCROLLABLE_SECTIONS.includes(section)) {\r\n        return;\r\n      }\r\n      const scrollValue = event.nativeEvent.contentOffset.y;\r\n      scrollPositions[section] = scrollValue;\r\n      setScrollPositions(scrollPositions);\r\n    },\r\n    [section],\r\n  );\r\n  useEffect(() => {\r\n    if (!SCROLLABLE_SECTIONS.includes(section)) {\r\n      return;\r\n    }\r\n    const shouldScroll = Platform.select({ default: true, web: false });\r\n    if (!shouldScroll) {\r\n      return;\r\n    }\r\n    scrollViewRef?.current?.scrollTo({\r\n      y: scrollPositions?.[section] ?? 0,\r\n      animated: false,\r\n    });\r\n  }, [section]);\r\n\r\n  const mainSection = useMemo(() => {\r\n    function wrapInSection(\r\n      component: React.ReactElement,\r\n      sectionTitle: string,\r\n    ) {\r\n      return (\r\n        <View style={section !== sectionTitle && { display: \"none\" }}>\r\n          <PlayerContextFreezer isVisible={section === sectionTitle}>\r\n            {component}\r\n          </PlayerContextFreezer>\r\n        </View>\r\n      );\r\n    }\r\n\r\n    const noScrollViewSections = [\"Apprentices\", \"Exploration\"];\r\n\r\n    return (\r\n      <View style={{ flex: 1 }}>\r\n        <View\r\n          style={[\r\n            { flex: 1 },\r\n            noScrollViewSections.includes(section) && { display: \"none\" },\r\n          ]}\r\n        >\r\n          <GestureDetector key=\"mainGesture\" gesture={compositeGesture}>\r\n            <ScrollView\r\n              //@ts-ignore Not sure why this is giving error\r\n              ref={scrollViewRef}\r\n              style={styles.mainContainer}\r\n              onScroll={onScroll}\r\n              contentContainerStyle={section != \"Inventory\" && styles.container}\r\n            >\r\n              {wrapInSection(<Campus />, \"Campus\")}\r\n              {wrapInSection(<Research />, \"Research\")}\r\n              {wrapInSection(<Inventory />, \"Inventory\")}\r\n              {wrapInSection(<Upgrades />, \"Upgrades\")}\r\n              {wrapInSection(<Stats />, \"Stats\")}\r\n              {wrapInSection(<Creatures />, \"Creatures\")}\r\n              {wrapInSection(<Strengthening />, \"Strengthen\")}\r\n              {wrapInSection(<Retirement />, \"Retirement\")}\r\n              {wrapInSection(<Ending />, \"Ending\")}\r\n              {wrapInSection(<Options />, \"Options\")}\r\n              {wrapInSection(<Help />, \"Help\")}\r\n              {wrapInSection(<About />, \"About\")}\r\n              {section === \"Debug\" && <Debug />}\r\n            </ScrollView>\r\n          </GestureDetector>\r\n        </View>\r\n        <View\r\n          style={[\r\n            styles.mainContainer,\r\n            section !== \"Apprentices\" && { display: \"none\" },\r\n          ]}\r\n        >\r\n          <PlayerContextFreezer isVisible={section == \"Apprentices\"}>\r\n            <Autocast\r\n              onSwipeLeft={swipeLeftHandler}\r\n              onSwipeRight={swipeRightHandler}\r\n            />\r\n          </PlayerContextFreezer>\r\n        </View>\r\n        <View\r\n          style={[\r\n            styles.mainContainer,\r\n            section !== \"Exploration\" && { display: \"none\" },\r\n          ]}\r\n        >\r\n          <GestureDetector\r\n            key=\"explorationGesture\"\r\n            gesture={compositeGestureExploration}\r\n          >\r\n            <View style={styles.mainContainer}>\r\n              <PlayerContextFreezer isVisible={section == \"Exploration\"}>\r\n                <Exploration />\r\n              </PlayerContextFreezer>\r\n            </View>\r\n          </GestureDetector>\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [section, compositeGesture, compositeGestureExploration]);\r\n\r\n  const contentsWide = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.biggerContainer,\r\n          { backgroundColor: theme.theme.colors.background },\r\n        ]}\r\n      >\r\n        <View\r\n          style={[\r\n            styles.horizontalContainer,\r\n            Platform.OS === \"web\" && hasFourColumns\r\n              ? { height: height - 66 }\r\n              : Platform.OS === \"web\"\r\n              ? { height: height - 76 }\r\n              : { flex: 1 },\r\n          ]}\r\n        >\r\n          <View style={styles.webMenuContainer}>\r\n            <MenuContents\r\n              visible={true}\r\n              onNavigationPress={onNavigationPress}\r\n              onSwipeLeft={swipeLeftHandler}\r\n              onSwipeRight={swipeRightHandler}\r\n            />\r\n          </View>\r\n          {mainSection}\r\n          {hasThreeColumnsOrMore ? (\r\n            <View style={styles.webRightMenuContainer}>\r\n              <SpellMenuContents\r\n                visible={true}\r\n                onSwipeLeft={swipeLeftHandler}\r\n                onSwipeRight={swipeRightHandler}\r\n              />\r\n            </View>\r\n          ) : (\r\n            <SpellMenu\r\n              visible={rightMenuShown === \"spell\"}\r\n              onBackgroundPress={onSpellMenuPress}\r\n              onSwipeLeft={swipeLeftHandler}\r\n              onSwipeRight={swipeRightHandler}\r\n            />\r\n          )}\r\n          {hasFourColumns ? (\r\n            <View style={styles.webRightMenuContainer}>\r\n              <ScrollView>\r\n                <EventList\r\n                  onSwipeLeft={swipeLeftHandler}\r\n                  onSwipeRight={swipeRightHandler}\r\n                />\r\n              </ScrollView>\r\n            </View>\r\n          ) : (\r\n            <EventMenu\r\n              visible={rightMenuShown === \"event\"}\r\n              onBackgroundPress={onEventMenuPress}\r\n              onSwipeLeft={swipeLeftHandler}\r\n              onSwipeRight={swipeRightHandler}\r\n            />\r\n          )}\r\n        </View>\r\n\r\n        <ManaBar />\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      hasThreeColumnsOrMore,\r\n      hasFourColumns,\r\n      height,\r\n      rightMenuShown,\r\n      mainSection,\r\n    ],\r\n  );\r\n\r\n  const contents = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.biggerContainer,\r\n          { backgroundColor: theme.theme.colors.background },\r\n        ]}\r\n      >\r\n        <View\r\n          style={[\r\n            Platform.OS === \"web\" ? { height: height - 76 } : { flex: 1 },\r\n            styles.mainContainerPhone,\r\n          ]}\r\n        >\r\n          <View style={{ flex: 1 }}>\r\n            {mainSection}\r\n            <PlayerContextFreezer isVisible={rightMenuShown === \"spell\"}>\r\n              <SpellMenu\r\n                visible={rightMenuShown === \"spell\"}\r\n                onBackgroundPress={onSpellMenuPress}\r\n                onSwipeLeft={swipeLeftHandler}\r\n                onSwipeRight={swipeRightHandler}\r\n              />\r\n            </PlayerContextFreezer>\r\n            <PlayerContextFreezer isVisible={rightMenuShown === \"event\"}>\r\n              <EventMenu\r\n                visible={rightMenuShown === \"event\"}\r\n                onBackgroundPress={onEventMenuPress}\r\n                onSwipeLeft={swipeLeftHandler}\r\n                onSwipeRight={swipeRightHandler}\r\n              />\r\n            </PlayerContextFreezer>\r\n          </View>\r\n          {showBottomResourceBar && (\r\n            <Animated.View\r\n              style={[\r\n                {\r\n                  opacity: bottomOpacityAnim,\r\n                  borderTopWidth: 1.0,\r\n                  borderTopColor: theme.theme.colors.divider,\r\n                },\r\n              ]}\r\n            >\r\n              <BottomResourceViewer />\r\n            </Animated.View>\r\n          )}\r\n          <View\r\n            style={{\r\n              borderTopWidth: 1.0,\r\n              borderTopColor: theme.theme.colors.divider,\r\n            }}\r\n          >\r\n            <BottomMenu\r\n              onNavigationPress={onNavigationPress}\r\n              onSpellMenuPress={onSpellMenuPress}\r\n              selected={section}\r\n            />\r\n          </View>\r\n          <View\r\n            style={{\r\n              right: -144,\r\n              bottom: -110,\r\n              position: \"absolute\",\r\n              zIndex: 120,\r\n            }}\r\n          >\r\n            <Button\r\n              accessibilityLabel={\"Cast Spell\"}\r\n              hitSlop={{ top: 50, left: 50, bottom: 20, right: 20 }}\r\n              onPressIn={onSpellMenuPress}\r\n              onPress={() => {}}\r\n              enableAutoRepress={false}\r\n              containerStyle={{\r\n                borderTopLeftRadius: 100,\r\n                width: 240,\r\n                height: 168,\r\n              }}\r\n              buttonStyle={{\r\n                paddingLeft: 92,\r\n                paddingTop: 92,\r\n                paddingRight: 4,\r\n                borderTopLeftRadius: 100,\r\n                borderTopWidth: 2,\r\n                borderLeftWidth: 2,\r\n                borderColor: theme.theme.colors.divider,\r\n                width: 144,\r\n                height: 76,\r\n              }}\r\n              icon={\r\n                <SimpleLineIcons\r\n                  style={{\r\n                    position: \"relative\",\r\n                    right: 50,\r\n                    bottom: 62,\r\n                    width: 24,\r\n                    height: 24,\r\n                    overflow: \"visible\",\r\n                  }}\r\n                  name=\"magic-wand\"\r\n                  size={24}\r\n                  color=\"#fff\"\r\n                />\r\n              }\r\n            ></Button>\r\n          </View>\r\n          <PlayerContextFreezer isVisible={menuShown}>\r\n            <Menu\r\n              visible={menuShown}\r\n              onBackgroundPress={onMenuPress}\r\n              onNavigationPress={onNavigationPress}\r\n              onSwipeLeft={swipeLeftHandler}\r\n              onSwipeRight={swipeRightHandler}\r\n            />\r\n          </PlayerContextFreezer>\r\n        </View>\r\n        <ManaBar />\r\n      </View>\r\n    ),\r\n    [\r\n      bottomOpacityAnim,\r\n      theme,\r\n      menuShown,\r\n      mainSection,\r\n      onMenuPress,\r\n      onNavigationPress,\r\n      onSpellMenuPress,\r\n      onEventMenuPress,\r\n      height,\r\n      compositeGesture,\r\n      swipeLeftHandler,\r\n      swipeRightHandler,\r\n    ],\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handler = BackHandler.addEventListener(\"hardwareBackPress\", () => {\r\n      if (menuShown) {\r\n        setMenuShown(false);\r\n        return true;\r\n      }\r\n      if (rightMenuShown != \"none\") {\r\n        setRightMenuShown(\"none\");\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n\r\n    return () => handler.remove();\r\n  }, [menuShown, rightMenuShown, setMenuShown, setRightMenuShown]);\r\n\r\n  const headerContainerStyle = useMemo(\r\n    () => [\r\n      styles.headerContainer,\r\n      { borderBottomColor: theme.theme.colors.background },\r\n    ],\r\n    [theme],\r\n  );\r\n\r\n  const statusBarProps = useMemo(\r\n    () => ({\r\n      translucent: true,\r\n      backgroundColor: \"transparent\",\r\n      barStyle: \"light-content\" as StatusBarStyle,\r\n    }),\r\n    [],\r\n  );\r\n\r\n  const menuButton = useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        accessibilityLabel={\"Menu\"}\r\n        onPressIn={onMenuPress}\r\n        hitSlop={{ top: 20, left: 20, bottom: 20, right: 20 }}\r\n      >\r\n        <MaterialIcons name=\"menu\" size={24} color=\"#fff\" />\r\n      </TouchableOpacity>\r\n    ),\r\n    [onMenuPress],\r\n  );\r\n\r\n  const eventButton = useMemo(\r\n    () => (\r\n      <View style={styles.rightHeaderContainer}>\r\n        <TouchableOpacity\r\n          accessibilityLabel={\"Events\"}\r\n          style={styles.rightHeaderIcon}\r\n          onPressIn={onEventMenuPress}\r\n          hitSlop={{ top: 20, left: 10, bottom: 20, right: 20 }}\r\n        >\r\n          <MaterialIcons name=\"notifications\" size={24} color=\"#fff\" />\r\n          {ongoingEventCount > 0 && (\r\n            <Badge\r\n              value={ongoingEventCount}\r\n              status=\"error\"\r\n              containerStyle={styles.notificationsBadge}\r\n            />\r\n          )}\r\n        </TouchableOpacity>\r\n      </View>\r\n    ),\r\n    [onEventMenuPress, ongoingEventCount],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (hasTwoColumnsOrMore) {\r\n      return (\r\n        <GestureHandlerRootView\r\n          style={[\r\n            styles.maxContainer,\r\n            { backgroundColor: theme.theme.colors.background },\r\n          ]}\r\n        >\r\n          <GameTickProcessor\r\n            setPlayerState={props.setPlayerState}\r\n            onLoadingProgress={props.onLoadingProgress}\r\n          />\r\n          <Header\r\n            containerStyle={headerContainerStyle}\r\n            statusBarProps={statusBarProps}\r\n            leftComponent={undefined}\r\n            centerComponent={centerComponent}\r\n            rightComponent={\r\n              !hasFourColumns ? (\r\n                <View style={styles.rightHeaderContainer}>\r\n                  {!hasThreeColumnsOrMore && (\r\n                    <TouchableOpacity\r\n                      style={styles.rightHeaderIcon}\r\n                      onPressIn={onSpellMenuPress}\r\n                      hitSlop={{ top: 20, left: 20, bottom: 20, right: 20 }}\r\n                    >\r\n                      <SimpleLineIcons\r\n                        name=\"magic-wand\"\r\n                        size={24}\r\n                        color=\"#fff\"\r\n                      />\r\n                    </TouchableOpacity>\r\n                  )}\r\n                  <TouchableOpacity\r\n                    style={styles.rightHeaderIcon}\r\n                    onPressIn={onEventMenuPress}\r\n                    hitSlop={{ top: 20, left: 10, bottom: 20, right: 20 }}\r\n                  >\r\n                    <MaterialIcons\r\n                      name=\"notifications\"\r\n                      size={24}\r\n                      color=\"#fff\"\r\n                    />\r\n                    {ongoingEventCount > 0 && (\r\n                      <Badge\r\n                        value={ongoingEventCount}\r\n                        status=\"error\"\r\n                        containerStyle={styles.notificationsBadge}\r\n                      />\r\n                    )}\r\n                  </TouchableOpacity>\r\n                </View>\r\n              ) : undefined\r\n            }\r\n          />\r\n          <SafeAreaView style={styles.safeAreaContainer}>\r\n            <EventOverlay />\r\n            {contentsWide}\r\n          </SafeAreaView>\r\n        </GestureHandlerRootView>\r\n      );\r\n    }\r\n    return (\r\n      <GestureHandlerRootView\r\n        style={[\r\n          styles.maxContainer,\r\n          { backgroundColor: theme.theme.colors.background },\r\n        ]}\r\n      >\r\n        <GameTickProcessor\r\n          setPlayerState={props.setPlayerState}\r\n          onLoadingProgress={props.onLoadingProgress}\r\n        />\r\n        <Header\r\n          containerStyle={headerContainerStyle}\r\n          statusBarProps={statusBarProps}\r\n          leftComponent={menuButton}\r\n          centerComponent={centerComponent}\r\n          rightComponent={eventButton}\r\n        />\r\n        <SafeAreaView style={styles.safeAreaContainer}>\r\n          <EventOverlay />\r\n          {contents}\r\n        </SafeAreaView>\r\n      </GestureHandlerRootView>\r\n    );\r\n  }, [\r\n    props.setPlayerState,\r\n    props.onLoadingProgress,\r\n    onMenuPress,\r\n    onSpellMenuPress,\r\n    onEventMenuPress,\r\n    section,\r\n    mainSection,\r\n    ongoingEventCount,\r\n    menuShown,\r\n    rightMenuShown,\r\n    onNavigationPress,\r\n    hasTwoColumnsOrMore,\r\n    hasFourColumns,\r\n    height,\r\n    bottomOpacityAnim,\r\n    theme,\r\n    contents,\r\n    contentsWide,\r\n    headerContainerStyle,\r\n    statusBarProps,\r\n    menuButton,\r\n    eventButton,\r\n  ]);\r\n}\r\n\r\nfunction OfflineProgress(props: { currentTicks: number; totalTicks: number }) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View\r\n      style={[\r\n        styles.offlineProgressContainer,\r\n        { backgroundColor: theme.theme.colors.background },\r\n      ]}\r\n    >\r\n      <ActivityIndicator size=\"large\" />\r\n      <Text>\r\n        Warping through time...{\" \"}\r\n        {formatNumber(props.currentTicks, { showDecimals: false })} /{\" \"}\r\n        {formatNumber(props.totalTicks, { showDecimals: false })}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction Loading(props: { theme: CreateThemeOptions | undefined }) {\r\n  const theme = props.theme;\r\n\r\n  const loadingAnim = useRef(new Animated.Value(0.0)).current;\r\n\r\n  useEffect(() => {\r\n    Animated.timing(loadingAnim, {\r\n      useNativeDriver: true,\r\n      toValue: 400,\r\n      duration: 40000,\r\n      easing: Easing.out(Easing.poly(5)),\r\n    }).start();\r\n  }, []);\r\n\r\n  return (\r\n    <SafeAreaProvider initialMetrics={initialWindowMetrics}>\r\n      <ThemeProvider theme={theme}>\r\n        <OrientationLockManager />\r\n        <StatusBar\r\n          translucent={true}\r\n          backgroundColor=\"transparent\"\r\n          barStyle={theme?.mode === \"dark\" ? \"light-content\" : \"dark-content\"}\r\n        />\r\n        <SafeAreaView\r\n          style={[\r\n            styles.safeAreaContainer,\r\n            {\r\n              backgroundColor:\r\n                theme?.mode === \"dark\"\r\n                  ? theme?.darkColors?.background\r\n                  : theme?.lightColors?.background,\r\n            },\r\n          ]}\r\n        >\r\n          <View style={{ alignItems: \"center\", width: \"100%\" }}>\r\n            <ActivityIndicator size=\"large\" />\r\n            {Platform.OS != \"web\" && (\r\n              <View\r\n                style={{\r\n                  width: 200,\r\n                  marginVertical: 8,\r\n                  borderWidth: 1,\r\n                  borderRadius: 3,\r\n                  height: 6,\r\n                  overflow: \"hidden\",\r\n                  borderColor:\r\n                    theme?.mode === \"dark\"\r\n                      ? theme?.darkColors?.primary\r\n                      : theme?.lightColors?.primary,\r\n                }}\r\n              >\r\n                <Animated.View\r\n                  style={{\r\n                    height: 4,\r\n                    width: 1,\r\n                    transform: [{ scaleX: loadingAnim }],\r\n                    backgroundColor:\r\n                      theme?.mode === \"dark\"\r\n                        ? theme?.darkColors?.primary\r\n                        : theme?.lightColors?.primary,\r\n                  }}\r\n                />\r\n              </View>\r\n            )}\r\n\r\n            <Text\r\n              style={{\r\n                color:\r\n                  theme?.mode === \"dark\"\r\n                    ? theme?.darkColors?.black\r\n                    : theme?.lightColors?.black,\r\n              }}\r\n            >\r\n              Loading game. Please wait a moment...\r\n            </Text>\r\n          </View>\r\n        </SafeAreaView>\r\n      </ThemeProvider>\r\n    </SafeAreaProvider>\r\n  );\r\n}\r\n\r\nexport default function App() {\r\n  const [playerState, setPlayerState] = useState(PLAYER_INITIAL_STATE);\r\n  const [localUiState, setLocalUiState] = useState<any>({});\r\n\r\n  const [processingBigTime, setProcessingBigTime] = useState(false);\r\n  const [totalTicks, setTotalTicks] = useState(0);\r\n  const [currentTicks, setCurrentTicks] = useState(0);\r\n\r\n  const onLoadingProgress = useCallback(\r\n    (currentTicks: number, totalTicks: number) => {\r\n      setCurrentTicks(currentTicks);\r\n      setTotalTicks(totalTicks);\r\n      if (currentTicks == totalTicks) {\r\n        setProcessingBigTime(false);\r\n      } else {\r\n        setProcessingBigTime(true);\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  const uiContextValue = useMemo(() => {\r\n    return {\r\n      getUIState: (id: string) => {\r\n        return localUiState?.[id];\r\n      },\r\n      setUIState: (id: string, value: any) => {\r\n        localUiState[id] = value;\r\n        setLocalUiState(localUiState);\r\n      },\r\n    };\r\n  }, [localUiState, setLocalUiState]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const playerStateRef = useRef(playerState);\r\n  playerStateRef.current = playerState;\r\n\r\n  const apply = useCallback(\r\n    (transform: PlayerContextTransform) => {\r\n      const newState = applyAllTransforms(playerStateRef.current, transform);\r\n      newState.global.appVersionTimestamp = getCurrentVersionTimestamp() || 0;\r\n      newState.global.isFullVersionSave = !Demo.isDemo();\r\n\r\n      setPlayerState(newState);\r\n    },\r\n    [playerStateRef, setPlayerState],\r\n  );\r\n\r\n  const overwrite = useCallback(\r\n    (transform: PlayerContextTransform) => {\r\n      setPlayerState(transform(playerStateRef.current));\r\n    },\r\n    [playerStateRef, setPlayerState],\r\n  );\r\n\r\n  const playerContextValue = useMemo(() => {\r\n    return {\r\n      ...playerState,\r\n      apply: apply,\r\n      overwrite: overwrite,\r\n    };\r\n  }, [playerState, apply, overwrite]);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const loadedState = await loadData();\r\n        setPlayerState(loadedState);\r\n        await nextFrame();\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error(\"Error loading data\");\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const storeData = async () => {\r\n      try {\r\n        await saveData(playerState);\r\n      } catch (error) {\r\n        console.error(\"Error saving data\", error);\r\n      }\r\n    };\r\n    storeData();\r\n  }, [Math.floor(getSecondsPlayed(playerState) / 5.0)]);\r\n\r\n  const [isTransition, setTransition] = useTransition();\r\n\r\n  const theme = useMemo(() => {\r\n    return createTheme({\r\n      lightColors:\r\n        primaryColorsByElement?.[playerContextValue.primaryElement || \"Default\"]\r\n          ?.lightColors,\r\n      darkColors:\r\n        primaryColorsByElement?.[playerContextValue.primaryElement || \"Default\"]\r\n          ?.darkColors,\r\n\r\n      mode: playerContextValue.global.themeMode,\r\n    });\r\n  }, [\r\n    primaryColorsByElement,\r\n    playerContextValue.primaryElement,\r\n    playerContextValue.global.themeMode,\r\n  ]);\r\n\r\n  const shouldShowIntro =\r\n    playerContextValue.primaryElement == undefined ||\r\n    playerContextValue.primarySchool == undefined;\r\n\r\n  const [showIntro, setShowIntro] = useState(shouldShowIntro);\r\n\r\n  useEffect(() => {\r\n    if (showIntro != shouldShowIntro) {\r\n      setTimeout(() => setShowIntro(shouldShowIntro), 0);\r\n    }\r\n  }, [showIntro, shouldShowIntro, setTransition, setShowIntro]);\r\n\r\n  if (loading || shouldShowIntro != showIntro) {\r\n    return <Loading theme={theme} />;\r\n  }\r\n\r\n  if (showIntro) {\r\n    return (\r\n      <SafeAreaProvider\r\n        initialMetrics={initialWindowMetrics}\r\n        style={{\r\n          backgroundColor:\r\n            theme.mode === \"dark\"\r\n              ? theme.darkColors?.background\r\n              : theme.lightColors?.background,\r\n        }}\r\n      >\r\n        <ThemeProvider theme={theme}>\r\n          <PlayerContext.Provider value={playerContextValue}>\r\n            <UIContext.Provider value={uiContextValue}>\r\n              <ThemeUpdater />\r\n              <IntroContents />\r\n            </UIContext.Provider>\r\n          </PlayerContext.Provider>\r\n        </ThemeProvider>\r\n      </SafeAreaProvider>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <SafeAreaProvider\r\n      initialMetrics={initialWindowMetrics}\r\n      style={{\r\n        backgroundColor:\r\n          theme.mode === \"dark\"\r\n            ? theme.darkColors?.background\r\n            : theme.lightColors?.background,\r\n      }}\r\n    >\r\n      <ThemeProvider theme={theme}>\r\n        <PlayerContext.Provider value={playerContextValue}>\r\n          <UIContext.Provider value={uiContextValue}>\r\n            <OrientationLockManager />\r\n            <ThemeUpdater />\r\n            {showIntro && <IntroContents />}\r\n            <View\r\n              style={[{ flex: 1 }, !processingBigTime && { display: \"none\" }]}\r\n            >\r\n              <SafeAreaView\r\n                style={[styles.safeAreaContainer, styles.centerAligned]}\r\n              >\r\n                <OfflineProgress\r\n                  currentTicks={currentTicks}\r\n                  totalTicks={totalTicks}\r\n                />\r\n              </SafeAreaView>\r\n            </View>\r\n            <View\r\n              style={[{ flex: 1 }, processingBigTime && { display: \"none\" }]}\r\n            >\r\n              <PlayerContextFreezer\r\n                isVisible={!showIntro && !processingBigTime}\r\n              >\r\n                <MainAppContents\r\n                  setPlayerState={setPlayerState}\r\n                  onLoadingProgress={onLoadingProgress}\r\n                />\r\n              </PlayerContextFreezer>\r\n            </View>\r\n          </UIContext.Provider>\r\n        </PlayerContext.Provider>\r\n      </ThemeProvider>\r\n    </SafeAreaProvider>\r\n  );\r\n}\r\n\r\n/*export default function Test() {\r\n  return (\r\n    <Markdown debugPrintTree>\r\n      Focus your thoughts :close: and gather mana. And don't forget to lock the\r\n      door!\r\n    </Markdown>\r\n  );\r\n}*/\r\n\r\nconst headerPadding =\r\n  Platform.OS === \"android\" ? 16 : Platform.OS === \"web\" ? 8 : 0;\r\n\r\nconst styles = StyleSheet.create({\r\n  headerContainer: {\r\n    paddingTop: headerPadding,\r\n  },\r\n  rightHeaderContainer: {\r\n    flexDirection: \"row\",\r\n  },\r\n  rightHeaderIcon: {\r\n    marginLeft: 20,\r\n  },\r\n  gestureRecognizer: {\r\n    flex: 1,\r\n  },\r\n  safeAreaContainer: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n  centerAligned: {\r\n    alignItems: \"center\",\r\n  },\r\n  maxContainer: {\r\n    flex: 1,\r\n  },\r\n  biggerContainer: {\r\n    flex: 1,\r\n    backgroundColor: \"#fff\",\r\n  },\r\n  mainContainerPhone: {\r\n    overflow: \"hidden\",\r\n  },\r\n  introContainer: {\r\n    alignItems: \"center\",\r\n  },\r\n  horizontalContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"stretch\",\r\n    overflow: \"hidden\",\r\n  },\r\n  mainContainer: {\r\n    flex: 1,\r\n  },\r\n  webMenuContainer: {\r\n    width: 284,\r\n    paddingRight: 8,\r\n  },\r\n  webRightMenuContainer: {\r\n    width: 300,\r\n    paddingLeft: 8,\r\n  },\r\n  notificationsBadge: {\r\n    position: \"absolute\",\r\n    top: -8,\r\n    right: -8,\r\n  },\r\n  menuContainer: {\r\n    position: \"absolute\",\r\n  },\r\n  container: {\r\n    padding: 8,\r\n  },\r\n  centerText: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  offlineProgressContainer: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n});\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  ActionBase,\r\n  ActionEffect,\r\n  ActionSubcategory,\r\n  DoActionArgs,\r\n} from \"../Action\";\r\n\r\nclass GatherIron extends ActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return hasFlag(state, \"gather_iron_unlocked\");\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.Iron) <\r\n      getResourceCap(state, Resource.Iron)\r\n    );\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [\r\n      ...super.getTags(),\r\n      TransformationTags.ManualGathering,\r\n      TransformationTags.Production,\r\n      Resource.Iron,\r\n    ];\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Gather Iron\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Gather;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Mine for iron.\";\r\n  }\r\n\r\n  getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      iron: { value: 0.1 },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.iron, {\r\n      showDecimals: true,\r\n    })}:iron:`;\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return { resources: {}, items: {} };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Iron,\r\n      this.getActionEffects(state).iron,\r\n    )(state);\r\n  }\r\n}\r\n\r\nconst message = buildEventMessage(\"gather_iron_unlocked\", \"The Quarry\")\r\n  .setSimpleDescription(\r\n    `Your researcher calls your attention. \"There is a place you should see\", she exclaims, walking outside the campus. \"Follow me.\" You do as instructed.\r\n    \r\nYou end up in what seems to be a fairly rocky cliff. However, you notice the rock in a wall shining a different color. \"That's iron,\" your researcher says. \"This is a sturdy metal. Not too useful for casting magic, but it could be great for buildings... or...\"\r\n\r\nYou agree with her. Learning about this place for the first time, you thank the researcher. You'll be sure to come back prepared next time - this could be useful!\r\n\r\n**You unlocked the ability to gather iron!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"gather_iron_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"gather_iron_unlocked\"),\r\n);\r\n\r\naddContextListener(\"gather_iron_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"gather_iron_unlocked\") &&\r\n    hasFlag(newState, \"apprentice_dorm_event_triggered\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 5000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default new GatherIron();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport {\r\n  ActionBase,\r\n  ActionEffect,\r\n  ActionSubcategory,\r\n  DoActionArgs,\r\n} from \"../Action\";\r\n\r\nclass GatherMana extends ActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(): boolean {\r\n    return true;\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.Mana) <\r\n      getResourceCap(state, Resource.Mana)\r\n    );\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [\r\n      ...super.getTags(),\r\n      TransformationTags.ManualGathering,\r\n      TransformationTags.Production,\r\n      Resource.Mana,\r\n    ];\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Gather Mana\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Gather;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Focus your thoughts and gather mana. *Tip: You can press and hold buttons to auto-press them!*\";\r\n  }\r\n\r\n  getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: { value: 1 },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.mana, {\r\n      showDecimals: true,\r\n    })}:mana:`;\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return { resources: {}, items: {} };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Mana,\r\n      this.getActionEffects(state).mana,\r\n    )(state);\r\n  }\r\n}\r\n\r\nexport default new GatherMana();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  ActionBase,\r\n  ActionEffect,\r\n  ActionSubcategory,\r\n  DoActionArgs,\r\n} from \"../Action\";\r\n\r\nclass GatherWood extends ActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return hasFlag(state, \"gather_wood_unlocked\");\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.Wood) <\r\n      getResourceCap(state, Resource.Wood)\r\n    );\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [\r\n      ...super.getTags(),\r\n      TransformationTags.ManualGathering,\r\n      TransformationTags.Production,\r\n      Resource.Wood,\r\n    ];\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Gather Wood\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Gather;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Collect branches from the nearby forest.\";\r\n  }\r\n\r\n  getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      wood: { value: 1 },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return `+${formatNumber(this.getActionEffects(state).wood, {\r\n      showDecimals: true,\r\n    })}:wood:`;\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return { resources: {}, items: {} };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Wood,\r\n      this.getActionEffects(state).wood,\r\n    )(state);\r\n  }\r\n}\r\n\r\nconst message = buildEventMessage(\r\n  \"gather_wood_unlocked\",\r\n  \"Time to Look Outside\",\r\n)\r\n  .setSimpleDescription(\r\n    `Our studies of magic are starting to become more fruitful! With our recent advances, we are ready to start broadening our horizons. The campus is big, but there is only so much in it!\r\n    \r\nIt seems like there is a nearby forest where we may be able to find wood, which could help us develop our institution even further...\r\n\r\n**You can now gather:wood: Wood!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"gather_wood_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"gather_wood_unlocked\"),\r\n);\r\n\r\naddContextListener(\"gather_wood_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"gather_wood_unlocked\") &&\r\n    newState.primaryElement == \"Nature\"\r\n  ) {\r\n    // If nature element, unlock without the event\r\n    return setFlag(\"gather_wood_unlocked\");\r\n  }\r\n  if (\r\n    !hasFlag(newState, \"gather_wood_unlocked\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 500\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default new GatherWood();\r\n","import { applyTransformations } from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  calculateResearcherCap,\r\n  grantNewResearcher,\r\n} from \"../../research/Researchers\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { ActionBase, DoActionArgs } from \"../Action\";\r\n\r\nclass HireResearcher extends ActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return true;\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Hire Researcher\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Research\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Hire a new researcher to gain magical experience faster.\";\r\n  }\r\n\r\n  getDisplayEffect(): string {\r\n    return \"+1 Researcher\";\r\n  }\r\n\r\n  canAfford(state: PlayerContextState): boolean {\r\n    return (\r\n      super.canAfford(state) &&\r\n      calculateResearcherCap(state) > state.research.totalResearchers\r\n    );\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const fractionAddedPerResearcher = applyTransformations(\r\n      [...this.getTags(), TransformationTags.CostScale],\r\n      state,\r\n      1.0,\r\n    );\r\n    return {\r\n      resources: {\r\n        Coins:\r\n          Math.pow(\r\n            1.0 + fractionAddedPerResearcher,\r\n            state.research.totalResearchers,\r\n          ) * 250,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    state = grantResource(\r\n      Resource.Coins,\r\n      -(this.getCost(state).resources.Coins ?? 0),\r\n    )(state);\r\n    return grantNewResearcher(1)(state);\r\n  }\r\n}\r\n\r\nexport default new HireResearcher();\r\n","import { formatTime } from \"../../../utils/FormattingUtils\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  ActionBase,\r\n  ActionEffect,\r\n  ActionSubcategory,\r\n  DoActionArgs,\r\n} from \"../Action\";\r\n\r\nclass UseTimePiecesWarp extends ActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.TimePieces) > 0 &&\r\n      getTotalElementAndSchoolExp(state) > 10000\r\n    );\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Use Time Pieces (Warp)\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory[\"Use Time Pieces\"];\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Use your time pieces to warp time, affecting every aspect of the game.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      timePiecePerWarpedSec: {\r\n        value: 5,\r\n        tags: [TransformationTags.TimePiecePerWarpedSec],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const cost = this.getCost(state).resources[\"Time Pieces\"] ?? 1;\r\n    const effect = this.getActionEffects(state);\r\n    const totalSecs = cost / effect.timePiecePerWarpedSec;\r\n    return `Warp time forward by ${formatTime(totalSecs, {\r\n      shortForm: false,\r\n      showDecimals: false,\r\n    })} (Real World)`;\r\n  }\r\n\r\n  canAfford(state: PlayerContextState): boolean {\r\n    return (\r\n      super.canAfford(state) &&\r\n      getResourceAmount(state, Resource.TimePieces) >= 3000\r\n    );\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        \"Time Pieces\": 3000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    const cost = this.getCost(state).resources[\"Time Pieces\"] ?? 1;\r\n    const effect = this.getActionEffects(state);\r\n    const totalSecs = cost / effect.timePiecePerWarpedSec;\r\n    state = grantResource(Resource.TimePieces, -cost)(state);\r\n    state.warpTimeSecs = totalSecs;\r\n\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new UseTimePiecesWarp();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport {\r\n  buildEvent,\r\n  buildEventMessage,\r\n} from \"../../events/EventMessageBuilder\";\r\nimport { shouldHideEventsWithTag, triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { getBuildingAmount } from \"../Buildings\";\r\n\r\nclass ApprenticeDorm extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"apprentice_dorm_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Apprentice Dorm\";\r\n  }\r\n\r\n  getArea(): string[] {\r\n    return [\"Autocast\", \"Campus\"];\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Housing;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Housing for apprentices, which can help cast spells.\";\r\n  }\r\n\r\n  getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      apprentices: { value: 1 },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return `+${formatNumber(\r\n      this.getActionEffects(state).apprentices,\r\n    )} Max Apprentices`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 300,\r\n      Wood: 480,\r\n      Stone: 240,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.5,\r\n      Wood: 1.5,\r\n      Stone: 1.5,\r\n    };\r\n  }\r\n}\r\n\r\nconst apprenticeDorm = new ApprenticeDorm();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Apprentice]],\r\n  \"ApprenticeDormApprentice\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, apprenticeDorm) *\r\n    apprenticeDorm.getActionEffects(state).apprentices,\r\n);\r\n\r\nconst message = buildEventMessage(\r\n  \"apprentice_dorm_unlocked\",\r\n  \"Apprentices Need Sleep\",\r\n)\r\n  .setSimpleDescription(\r\n    `Your researcher walks up to you. She is together with a shaky individual, who seems to be barely breaking into adulthood and appears scared at your sight.\r\n\r\n\"I have a great idea!\", she says. \"This is my cousin. He is a wizard-in-training... an apprentice wizard,\" she continues, while gazing at him, before looking at you once more.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"apprentice_dorm_unlocked_1\", \"Apprentices Need Sleep\")\r\n      .setSimpleDescription(\r\n        `\"It is a honor to meet you, headmaster,\" exclaims the apprentice, while bowing at you somewhat too deeply.\r\n\r\nThe researcher continues. \"It'd be great to have him stay here! He could help you cast spells and continue improving our campus. Besides, a magical institution makes no sense without people who'd like to learn. What do you think?\", she asks you.\r\n\r\nYou recall thinking about how tedious it was to cast spells. This could be a big help!`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\r\n          \"apprentice_dorm_unlocked_2\",\r\n          \"Apprentices Need Sleep\",\r\n        )\r\n          .setSimpleDescription(\r\n            `\"There's just a little problem,\" the researcher continues. \"There is nowhere for him to sleep in! We'll need to build something.\"\r\n            \r\nYou saw it coming. Still, you can't wait - you've had enough casting *Create Pebble* manually. You reassure the researcher and her cousin that you will think about it, and you walk away, starting to picture what you would need to construct suitable housing for your first apprentice.\r\n\r\n**You can now build Apprentice Dorms!**`,\r\n          )\r\n          .build(),\r\n        setFlag(\"apprentice_dorm_unlocked\"),\r\n      )\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"apprentice_dorm_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"apprentice_dorm_event_triggered\"),\r\n);\r\n\r\naddContextListener(\"apprentice_dorm_event_triggered\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"apprentice_dorm_event_triggered\") &&\r\n    hasFlag(newState, \"autocast_intro_triggered\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 3000\r\n  ) {\r\n    if (shouldHideEventsWithTag(newState, EventTag.EARLY_GAME)) {\r\n      return (state) => {\r\n        state = setFlag(\"apprentice_dorm_unlocked\")(state);\r\n        state = setFlag(\"apprentice_dorm_event_triggered\")(state);\r\n        return state;\r\n      };\r\n    }\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nconst tournamentEventBuilder = buildEvent(\r\n  \"tournament_of_magic_intro\",\r\n  \"The Tournament of Magic\",\r\n  [EventTag.EARLY_GAME],\r\n);\r\n\r\ntournamentEventBuilder\r\n  .setOnTrigger(setFlag(\"tournament_of_magic_intro_event_triggered\"))\r\n  .createMessage()\r\n  .setSimpleDescription(`Your researcher approaches you and mentions something to you.\r\n  \r\n\"Headmaster, I think you may already be aware, but - now that we have a proper, true magical institution, we should start thinking about the *Tournament of Magic*.\" You are not sure of what she means by that, but she continues: \"The Tournament of Magic is a competition between magical institutions. It is a major event in regards to the research of magic, and those who manage to compete in it - let alone the winner - are sure to get great fame and prosperity.\"\r\n\r\n\"It could really take our school to new heights!\", she exclaims.\r\n\r\nYou talk to her some more, and you start feeling like it is a great goal to have... though you know you are nowhere close to reaching it. At least for now...`);\r\n\r\nconst tournamentEvent = tournamentEventBuilder.build();\r\n\r\naddContextListener(\r\n  \"tournament_of_magic_intro_event_triggered\",\r\n  (oldState, newState) => {\r\n    if (\r\n      !hasFlag(newState, \"tournament_of_magic_intro_event_triggered\") &&\r\n      hasFlag(newState, \"autocast_unlocked\") &&\r\n      getTotalElementAndSchoolExp(newState) >= 8000\r\n    ) {\r\n      return triggerEvent(tournamentEvent);\r\n    }\r\n  },\r\n);\r\n\r\nconst messageBuilt = buildEventMessage(\r\n  \"autocast_unlocked\",\r\n  \"The First Apprentice\",\r\n)\r\n  .setSimpleDescription(\r\n    `Construction for the first apprentice dorm is finished! You celebrate to a small audience. You notice the apprentice from before is still there. You approach him, though he still seems fearful and bows deeply.\r\n    \r\n\"Is that... housing I could use?\", he says, with a timid voice. You nod, and ask him if he'd like to become your first apprentice. He shakes, visibly and clearly nervous.\r\n\r\n\"That would be great... I-It's a honor, to be able to learn from one such as you, headmaster. I'll move in right away.\"\r\n\r\n**You have unlocked Apprentices! Apprentices can automatically cast spells for you after a set amount of time. You may manage them in the Apprentices section, in the left-hand-side menu.**`,\r\n  )\r\n  .build();\r\n\r\nconst eventBuilt = createGameEvent(\r\n  \"autocast_unlocked\",\r\n  messageBuilt,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"autocast_unlocked\"),\r\n);\r\n\r\naddContextListener(\"autocast_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"autocast_unlocked\") &&\r\n    getBuildingAmount(newState, apprenticeDorm) > 0\r\n  ) {\r\n    return triggerEvent(eventBuilt);\r\n  }\r\n});\r\n\r\nexport default apprenticeDorm as ApprenticeDorm;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { isCraftingUnlocked } from \"../../items/Items\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps, Resource } from \"../../Resources\";\r\nimport {\r\n  getTotalElementAndSchoolExp,\r\n  SpellElement,\r\n} from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport {\r\n  buildingAmountsChanged,\r\n  getBuildingAmount,\r\n  getBuildingAmountTurnedOn,\r\n} from \"../Buildings\";\r\n\r\nclass Furnace extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 || hasFlag(state, \"furnace_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Furnace\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Production;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"An oven with a very hot flame. Useful for crafting.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      wood: {\r\n        value: 3,\r\n        tags: [Resource.Wood, TransformationTags.Consumption],\r\n      },\r\n      temperature: {\r\n        value: 1,\r\n        tags: [Resource.Temperature, TransformationTags.Production],\r\n      },\r\n      temperatureCap: {\r\n        value: 500,\r\n        tags: [Resource.Temperature, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.temperature, {\r\n      showDecimals: true,\r\n    })}:temperature:/sec, -${formatNumber(effects.wood, {\r\n      showDecimals: true,\r\n    })}:wood:/sec, +${formatNumber(effects.temperatureCap)} Max:temperature:`;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 1500,\r\n      Stone: 3000,\r\n      Iron: 100,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Stone: 1.3,\r\n      Iron: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst furnace = new Furnace();\r\n\r\nregisterTransformation(\r\n  [[furnace.getId(), Resource.Temperature, TransformationTags.Production]],\r\n  \"FurnaceFireTransform\",\r\n  TransformationType.Multiplier,\r\n  (state) => (state.primaryElement == SpellElement.Fire ? 2.0 : 1.0),\r\n);\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  const furnaces = getBuildingAmountTurnedOn(state, furnace);\r\n  const effects = furnace.getActionEffects(state);\r\n  const woodBase = effects.wood;\r\n  const temperatureBase = effects.temperature;\r\n  return {\r\n    Temperature: temperatureBase * furnaces,\r\n    Wood: -woodBase * furnaces,\r\n  };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"Furnaces\", getResourcesPerSec),\r\n);\r\n\r\naddContextListener(\"furnace_cap_listener\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, furnace)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nregisterTransformation(\r\n  [[Resource.Temperature, TransformationTags.Cap]],\r\n  \"FurnaceTemperatureCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, furnace) *\r\n    furnace.getActionEffects(state).temperatureCap,\r\n);\r\n\r\nconst message = buildEventMessage(\"furnace_unlocked\", \"A Really Hot Oven\")\r\n  .setSimpleDescription(\r\n    `You see your apprentice by the door of your room. You approach him and ask him what is wrong. He shakes a bit, but then finds courage and speaks.\r\n\r\n\"I-I have been thinking about crafting, but it's very hard to shape metal right now,\" he says. \"Maybe if we had a really hot flame, we would be able to be much more effective with crafting... maybe even make real weapons?\"\r\n\r\nYou realize he has a point. You still don't know why your apprentice and your researcher are both eager to make weapons, but building a furnace could make it a lot easier to craft multiple types of items.\r\n\r\n**You can now build Furnaces!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"furnace_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"furnace_unlocked\"),\r\n);\r\n\r\naddContextListener(\"furnace_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"furnace_unlocked\") &&\r\n    isCraftingUnlocked(newState) &&\r\n    getTotalElementAndSchoolExp(newState) >= 13000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default furnace as Furnace;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { getBuildingAmount } from \"../Buildings\";\r\n\r\nclass LumberYard extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"lumber_yard_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Lumber Yard\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Production;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Processes branches and trees, generating wood automatically.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      wood: { value: 1, tags: [Resource.Wood, TransformationTags.Production] },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.wood, { showDecimals: true })}:wood:/sec`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Mana: 200,\r\n      Wood: 25,\r\n      Stone: 10,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Mana: 1.0,\r\n      Wood: 1.3,\r\n      Stone: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst lumberYard = new LumberYard();\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  const lumberYards = getBuildingAmount(state, lumberYard);\r\n  const effects = lumberYard.getActionEffects(state);\r\n  const woodBase = effects.wood;\r\n\r\n  return {\r\n    Wood: woodBase * lumberYards,\r\n  };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"LumberYards\", getResourcesPerSec),\r\n);\r\n\r\nconst message = buildEventMessage(\"lumber_yard_unlocked\", \"Wood Processing\")\r\n  .setSimpleDescription(\r\n    `These trips to the forest are starting to get tedious. You are starting to wonder if there is a way you could make it easier on yourself.\r\n    \r\nPerhaps there is a way? Maybe we can reuse the wood we obtained to make something bigger? You get lost in thought as you walk back to campus.\r\n\r\nBy the time you arrive, you have figured it out. Lumber yards right at the edge of the forest. It can surely work!\r\n\r\n**You can now build Lumber Yards!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"lumber_yard_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"lumber_yard_unlocked\"),\r\n);\r\n\r\naddContextListener(\"lumber_yard_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"lumber_yard_unlocked\") &&\r\n    newState.primaryElement === SpellElement.Nature\r\n  ) {\r\n    return setFlag(\"lumber_yard_unlocked\");\r\n  }\r\n\r\n  if (\r\n    !hasFlag(newState, \"lumber_yard_unlocked\") &&\r\n    getResourceAmount(newState, Resource.Wood) >= 50\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default lumberYard as LumberYard;\r\n","import { ActionBase, DoActionArgs } from \"../actions/Action\";\r\nimport { hasFlag, setFlag } from \"../Flags\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { removeFromInventoryWithAnyParams } from \"../items/Inventory\";\r\nimport { getItemById } from \"../items/Items\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { grantResource, Resource } from \"../Resources\";\r\n\r\nexport abstract class Upgrade extends ActionBase implements Identifiable {\r\n  abstract getName(): string;\r\n  abstract getMonstiumCost(): number;\r\n  abstract getDisplayDescription(state: PlayerContextState): string;\r\n  abstract getDisplayEffect(state: PlayerContextState): string;\r\n\r\n  getId(): string {\r\n    return this.getName();\r\n  }\r\n\r\n  getUpgradeRequirements(): Upgrade[] {\r\n    return [];\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Upgrades\";\r\n  }\r\n\r\n  getCost(state: PlayerContextState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Monstium: this.getMonstiumCost(),\r\n      },\r\n      items: this.getItemCost(),\r\n    };\r\n  }\r\n\r\n  getItemCost(): Record<string, number> {\r\n    return {};\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: PlayerContextState): PlayerContextState {\r\n    state = grantResource(Resource.Monstium, -this.getMonstiumCost())(state);\r\n    const itemsRequired = this.getItemCost();\r\n    for (let itemId in itemsRequired) {\r\n      state = removeFromInventoryWithAnyParams(\r\n        getItemById(itemId),\r\n        itemsRequired[itemId],\r\n        state,\r\n      );\r\n    }\r\n    return setFlag(\"upgrade:\" + this.getName())(state);\r\n  }\r\n\r\n  isPurchased(state: PlayerContextState): boolean {\r\n    return hasFlag(state, \"upgrade:\" + this.getName());\r\n  }\r\n\r\n  isVisibleExtraChecks(state: PlayerContextState): boolean {\r\n    return true;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    if (this.isPurchased(state)) {\r\n      return false;\r\n    }\r\n\r\n    const requirements = this.getUpgradeRequirements();\r\n    if (requirements.some((requirement) => !requirement.isPurchased(state))) {\r\n      return false;\r\n    }\r\n\r\n    if (!this.isVisibleExtraChecks(state)) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, recalculateCaps, Resource } from \"../../Resources\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass Warehouse extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 || hasFlag(state, \"warehouse_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Warehouse\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Storage;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Increases the maximum resources you can store.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      stone: {\r\n        value: 400,\r\n        tags: [Resource.Stone, TransformationTags.PerBuildingCap],\r\n      },\r\n      wood: {\r\n        value: 400,\r\n        tags: [Resource.Wood, TransformationTags.PerBuildingCap],\r\n      },\r\n      iron: {\r\n        value: 200,\r\n        tags: [Resource.Iron, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const resourceEffectMap: Partial<Record<Resource, string>> = {\r\n      Stone: `+${formatNumber(effects.stone)} Max :stone:`,\r\n      Wood: `+${formatNumber(effects.wood)} Max :wood:`,\r\n      Iron: `+${formatNumber(effects.iron)} Max :iron:`,\r\n    };\r\n    return (Object.keys(resourceEffectMap) as Array<Resource>)\r\n      .filter((resource) => state.resources?.[resource] !== undefined)\r\n      .map((resource) => resourceEffectMap[resource])\r\n      .join(\", \");\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 200,\r\n      Stone: 30,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Stone: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst warehouse = new Warehouse();\r\n\r\nfunction calculateStoneCapIncrease(state: PlayerContextState) {\r\n  return warehouse.getActionEffects(state).stone;\r\n}\r\n\r\nfunction calculateWoodCapIncrease(state: PlayerContextState) {\r\n  return warehouse.getActionEffects(state).wood;\r\n}\r\n\r\nfunction calculateIronCapIncrease(state: PlayerContextState) {\r\n  return warehouse.getActionEffects(state).iron;\r\n}\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Stone]],\r\n  \"WarehouseStoneCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, warehouse) * calculateStoneCapIncrease(state),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Wood]],\r\n  \"WarehouseWoodCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, warehouse) * calculateWoodCapIncrease(state),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Iron]],\r\n  \"WarehouseIronCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, warehouse) * calculateIronCapIncrease(state),\r\n);\r\n\r\naddContextListener(\"warehouse_caps_recalculation\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, warehouse)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nconst message = buildEventMessage(\"warehouse_unlocked\", \"Storage Ideas\")\r\n  .setSimpleDescription(\r\n    `Accumulating stone is worthwhile. As you watch your reserves getting closer to full, you start thinking if there might be a way to improve the situation.\r\n    \r\nMaybe you can use the stone to create more room? It seems like a smart, straightforward idea... you could make a stone warehouse.\r\n\r\n**You can now build Warehouses!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"warehouse_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"warehouse_unlocked\"),\r\n);\r\n\r\naddContextListener(\"warehouse_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"warehouse_unlocked\") &&\r\n    getResourceAmount(newState, Resource.Stone) >= 30\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\n// Frozen Warehouse storyline\r\n// Intentionally commented out because balance is unclear\r\n\r\n/*\r\nconst frozenWarehouseEventBuilder = buildEvent(\r\n  \"frozen_warehouse\",\r\n  \"(Storyline) The Frozen Warehouse\",\r\n);\r\n\r\nfrozenWarehouseEventBuilder\r\n  .setOnTrigger(setFlag(\"frozen_warehouse_event_triggered\"))\r\n  .createMessage()\r\n  .setSimpleDescription(\r\n    `Your warehouses look like they're full, but you remember this was not the case at some point. Gathering all those resources took some time and effort.\r\n  \r\nWouldn't it be wonderful if others would never have to do that again? You have an idea about spatially freezing one of your warehouses. You're not sure if you would get any benefit, but you think about giving it a try...`,\r\n  )\r\n  .addOption(\r\n    \"Freeze a Warehouse (Lose 1 Warehouse, 2400 Mana, 400 Stone, 400 Wood, 200 Iron; Requires Lv12 Enchantment)\",\r\n    {\r\n      transform: (state) => {\r\n        state = grantResource(Resource.Mana, -2400)(state);\r\n        state = grantResource(Resource.Stone, -400)(state);\r\n        state = grantResource(Resource.Wood, -400)(state);\r\n        state = grantResource(Resource.Iron, -200)(state);\r\n        const buildingData = state.buildings[\r\n          warehouse.getName()\r\n        ] as BuildingData;\r\n        buildingData.current -= 1;\r\n        state = setGlobalFlagForNextRun(\"frozen_warehouse_finished\")(state);\r\n        return state;\r\n      },\r\n      isEnabled: (state) => {\r\n        return (\r\n          getSchoolLevel(state, School.Enchantment) >= 12 &&\r\n          getBuildingAmount(state, warehouse) >= 1 &&\r\n          getResourceAmount(state, Resource.Mana) >= 2400 &&\r\n          getResourceAmount(state, Resource.Stone) >= 400 &&\r\n          getResourceAmount(state, Resource.Wood) >= 400 &&\r\n          getResourceAmount(state, Resource.Iron) >= 200\r\n        );\r\n      },\r\n    },\r\n    frozenWarehouseEventBuilder.createMessage()\r\n      .setSimpleDescription(`You focus and prepare to cast the spell! A light blue light envelopes the building's walls and becomes more and more solid. The warehouse looks like it is encased by a magical barrier - and with it, its contents.\r\n      \r\nYou will never be able to access that again, but maybe someone eventually will...?\r\n\r\n**You have completed the \"The Frozen Warehouse\" storyline! In future runs, you will begin with 1 Warehouse unlocked - as well as 400 Stone, 400 Wood, and 200 Iron!**`)\r\n  )\r\n  .addOption(\"Maybe later\");\r\n\r\nconst frozenWarehouseEvent = frozenWarehouseEventBuilder.build();\r\n\r\n*/\r\n\r\nexport default warehouse as Warehouse;\r\n","import warehouse from \"../../buildings/campus/Warehouse\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps } from \"../../Resources\";\r\nimport { Upgrade } from \"../Upgrade\";\r\n\r\nclass ReinforcedWarehouses extends Upgrade {\r\n  getName(): string {\r\n    return \"Reinforced Warehouses\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 450;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Strengthen the walls and the structure of your warehouses, allowing it to store more items.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"2.5x Warehouse storage\";\r\n  }\r\n}\r\n\r\nconst reinforcedWarehouses = new ReinforcedWarehouses();\r\n\r\nregisterTransformation(\r\n  [[warehouse.getName(), TransformationTags.PerBuildingCap]],\r\n  \"ReinforcedWarehouses\",\r\n  TransformationType.Multiplier,\r\n  (state) => (reinforcedWarehouses.isPurchased(state) ? 2.5 : 1),\r\n);\r\n\r\naddContextListener(\"ReinforcedWarehousesListener\", (oldState, newState) => {\r\n  if (\r\n    !reinforcedWarehouses.isPurchased(oldState) &&\r\n    reinforcedWarehouses.isPurchased(newState)\r\n  ) {\r\n    return recalculateCaps;\r\n  }\r\n});\r\n\r\nexport default reinforcedWarehouses;\r\n","import { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport reinforcedWarehouses from \"./ReinforcedWarehouses\";\r\n\r\nclass ManaCrystals extends Upgrade {\r\n  getName(): string {\r\n    return \"Mana Crystals\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 3500;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Unlock the ability to build Mana Crystals, which let you store more :mana: than Mana Shards.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"Unlock Mana Crystals\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [reinforcedWarehouses];\r\n  }\r\n}\r\n\r\nconst manaCrystals = new ManaCrystals();\r\n\r\nexport default manaCrystals;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps, Resource } from \"../../Resources\";\r\nimport manaCrystals from \"../../upgrades/storage/ManaCrystals\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass ManaCrystal extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 || manaCrystals.isPurchased(state)\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Mana Crystal\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Mana;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"A larger version of a Mana Shard. Increases the amount of Mana you can store.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: {\r\n        value: 200,\r\n        tags: [Resource.Mana, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.mana)} Max:mana:`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 10000,\r\n      Stone: 8000,\r\n      Iron: 1200,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Stone: 1.3,\r\n      Iron: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst manaCrystal = new ManaCrystal();\r\n\r\nregisterTransformation(\r\n  [[Resource.Mana, TransformationTags.Cap]],\r\n  \"ManaCrystalCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, manaCrystal) *\r\n    manaCrystal.getActionEffects(state).mana,\r\n);\r\n\r\naddContextListener(\"mana_crystal_cap_listener\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, manaCrystal)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nexport default manaCrystal as ManaCrystal;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, Resource } from \"../../Resources\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { getBuildingAmount } from \"../Buildings\";\r\n\r\nclass ManaSpout extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      (hasFlag(state, \"has_gathered_at_least_1_stone\") &&\r\n        hasFlag(state, \"has_gathered_at_least_1_water\"))\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Mana Spout\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Mana;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Automatically generate Mana and refill your supply.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: {\r\n        value: 0.5,\r\n        tags: [Resource.Mana, TransformationTags.Production],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.mana, { showDecimals: true })}:mana:/sec`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Stone: 10,\r\n      Water: 2,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Stone: 1.3,\r\n      Water: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst manaSpout = new ManaSpout();\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  const spouts = getBuildingAmount(state, manaSpout);\r\n  const effects = manaSpout.getActionEffects(state);\r\n  return { Mana: spouts * effects.mana };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"ManaSpout\", getResourcesPerSec),\r\n);\r\n\r\naddContextListener(\"mana_spout_unlocked_1\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"has_gathered_at_least_1_stone\") &&\r\n    getResourceAmount(newState, Resource.Stone) >= 1\r\n  ) {\r\n    return setFlag(\"has_gathered_at_least_1_stone\");\r\n  }\r\n});\r\n\r\naddContextListener(\"mana_spout_unlocked_2\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"has_gathered_at_least_1_water\") &&\r\n    getResourceAmount(newState, Resource.Water) >= 1\r\n  ) {\r\n    return setFlag(\"has_gathered_at_least_1_water\");\r\n  }\r\n});\r\n\r\nexport default manaSpout as ManaSpout;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, Resource } from \"../../Resources\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { getBuildingAmount } from \"../Buildings\";\r\nimport ManaSpout from \"./ManaSpout\";\r\n\r\nclass ManaGeyser extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"mana_geyser_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Mana Geyser\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Mana;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"A metal-reinforced building that produces mana.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: {\r\n        value: 2.0,\r\n        tags: [Resource.Mana, TransformationTags.Production],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.mana, { showDecimals: true })}:mana:/sec`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 600,\r\n      Water: 150,\r\n      Iron: 30,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Water: 1.3,\r\n      Iron: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst manaGeyser = new ManaGeyser();\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  const spouts = getBuildingAmount(state, manaGeyser);\r\n  const effects = manaGeyser.getActionEffects(state);\r\n  return { Mana: spouts * effects.mana };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"ManaGeysers\", getResourcesPerSec),\r\n);\r\n\r\nconst message = buildEventMessage(\"mana_geyser_unlocked\", \"Mana Geysers\")\r\n  .setSimpleDescription(\r\n    `As you slowly start getting more and more iron, you think of a plan to improve on your Mana Spouts. You are thinking that, by adding iron, you should be able to create a structure that can produce mana at a much faster rate than a simple spout.\r\n    \r\nYou will definitely require a lot of iron, but it'll be worth it in the long run, you tell yourself. Mana is the cornerstone of magic!\r\n\r\n**You can now build Mana Geysers!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"mana_geyser_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"mana_geyser_unlocked\"),\r\n);\r\n\r\naddContextListener(\"mana_geyser_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"mana_geyser_unlocked\") &&\r\n    getResourceAmount(newState, Resource.Iron) >= 10 &&\r\n    getBuildingAmount(newState, ManaSpout) >= 1\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default manaGeyser as ManaGeyser;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, recalculateCaps, Resource } from \"../../Resources\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass ManaShard extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"has_gathered_at_least_50_mana\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Mana Shard\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Mana;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Increase the amount of mana you can store.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: {\r\n        value: 100,\r\n        tags: [Resource.Mana, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.mana)} Max:mana:`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 100,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst manaShard = new ManaShard();\r\n\r\nregisterTransformation(\r\n  [[Resource.Mana, TransformationTags.Cap]],\r\n  \"ManaShardCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, manaShard) *\r\n    manaShard.getActionEffects(state).mana,\r\n);\r\n\r\naddContextListener(\"mana_shard_cap_listener\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, manaShard)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nconst message = buildEventMessage(\r\n  \"has_gathered_at_least_50_mana\",\r\n  \"The Mana Shard\",\r\n)\r\n  .setSimpleDescription(\r\n    `The mana reserves of the school are building up. Looking at them, you realize they may soon hit their maximum.\r\n    \r\nIf only you had a way to store more mana... Then you remember what you had learned as an apprentice, that Mana Shards can increase capacity.\r\n    \r\nWe could buy some if we had enough coins... maybe with some Illusion spell?\r\n\r\n**You can now build Mana Shards!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"has_gathered_at_least_50_mana\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"has_gathered_at_least_50_mana\"),\r\n);\r\n\r\naddContextListener(\"mana_shard_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"has_gathered_at_least_50_mana\") &&\r\n    getResourceAmount(newState, Resource.Mana) >= 50\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default manaShard as ManaShard;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { getBuildingAmount } from \"../Buildings\";\r\n\r\nclass Mine extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 || hasFlag(state, \"mine_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Mine\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Production;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"A structured specially designed to harvest stone and ores from the ground.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      stone: {\r\n        value: 27,\r\n        tags: [Resource.Stone, TransformationTags.Production],\r\n      },\r\n      iron: { value: 2, tags: [Resource.Iron, TransformationTags.Production] },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.stone, {\r\n      showDecimals: true,\r\n    })}:stone:/sec, +${formatNumber(effects.iron, {\r\n      showDecimals: true,\r\n    })}:iron:/sec`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Mana: 1000,\r\n      Coins: 12000,\r\n      Wood: 8000,\r\n      Iron: 1500,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Mana: 1.0,\r\n      Coins: 1.3,\r\n      Wood: 1.3,\r\n      Iron: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst mine = new Mine();\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  const mines = getBuildingAmount(state, mine);\r\n  const effects = mine.getActionEffects(state);\r\n  return { Stone: mines * effects.stone, Iron: mines * effects.iron };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"Mines\", getResourcesPerSec),\r\n);\r\n\r\nconst message = buildEventMessage(\"mine_unlocked\", \"Mining\")\r\n  .setSimpleDescription(\r\n    `In one of your trips to the rocky cliff with iron, you start thinking that it would be a lot easier if there was a building that could extract the minerals on its own. You suddenly get an idea for a new building - a way in which you could get stones and iron without the need to manually gather them!\r\n\r\nYou can't wait to try it out.\r\n\r\n**You can now build Mines!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"mine_unlocked\",\r\n  message,\r\n  [],\r\n  setFlag(\"mine_unlocked\"),\r\n);\r\n\r\naddContextListener(\"mine_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"mine_unlocked\") &&\r\n    hasFlag(newState, \"gather_iron_unlocked\") &&\r\n    getTotalElementAndSchoolExp(newState) > 600000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default mine as Mine;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, recalculateCaps, Resource } from \"../../Resources\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass Monstruarium extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"monstruarium_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Monstruarium\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Storage;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Magically infused storage building that can also hold hazardous materials.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      stone: {\r\n        value: 1200,\r\n        tags: [Resource.Stone, TransformationTags.PerBuildingCap],\r\n      },\r\n      wood: {\r\n        value: 1200,\r\n        tags: [Resource.Wood, TransformationTags.PerBuildingCap],\r\n      },\r\n      iron: {\r\n        value: 600,\r\n        tags: [Resource.Iron, TransformationTags.PerBuildingCap],\r\n      },\r\n      monstium: {\r\n        value: 4000,\r\n        tags: [Resource.Monstium, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const resourceEffectMap: Partial<Record<Resource, string>> = {\r\n      Stone: `+${formatNumber(effects.stone)} Max:stone:`,\r\n      Wood: `+${formatNumber(effects.wood)} Max:wood:`,\r\n      Iron: `+${formatNumber(effects.iron)} Max:iron:`,\r\n      Monstium: `+${formatNumber(effects.monstium)} Max:monstium:`,\r\n    };\r\n    return (Object.keys(resourceEffectMap) as Array<Resource>)\r\n      .filter((resource) => state.resources?.[resource] !== undefined)\r\n      .map((resource) => resourceEffectMap[resource])\r\n      .join(\", \");\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Mana: 1100,\r\n      Coins: 8000,\r\n      Iron: 500,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Mana: 1.3,\r\n      Coins: 1.3,\r\n      Iron: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nfunction calculateStoneCapIncrease(state: PlayerContextState) {\r\n  return monstruarium.getActionEffects(state).stone;\r\n}\r\n\r\nfunction calculateWoodCapIncrease(state: PlayerContextState) {\r\n  return monstruarium.getActionEffects(state).wood;\r\n}\r\n\r\nfunction calculateIronCapIncrease(state: PlayerContextState) {\r\n  return monstruarium.getActionEffects(state).iron;\r\n}\r\n\r\nfunction calculateMonstiumCapIncrease(state: PlayerContextState) {\r\n  return monstruarium.getActionEffects(state).monstium;\r\n}\r\n\r\nconst monstruarium = new Monstruarium();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Stone]],\r\n  \"MonstruariumStoneWoodCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, monstruarium) * calculateStoneCapIncrease(state),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Wood]],\r\n  \"MonstruariumStoneWoodCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, monstruarium) * calculateWoodCapIncrease(state),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Iron]],\r\n  \"MonstruariumIronCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, monstruarium) * calculateIronCapIncrease(state),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Monstium]],\r\n  \"MonstruariumMonstiumCap\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, monstruarium) *\r\n    calculateMonstiumCapIncrease(state),\r\n);\r\n\r\naddContextListener(\"monstruarium_caps_recalculation\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, monstruarium)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nconst message = buildEventMessage(\r\n  \"monstruarium_unlocked\",\r\n  \"A New Hazardous Resource\",\r\n)\r\n  .setSimpleDescription(\r\n    `Felling those enemies is interesting, as sometimes you can find useful items afterwards. You have noticed, however, that they also leave behind some material that you have been calling \"Monstium\". You are not sure what it does, but it feels somewhat hazardous.\r\n    \r\nThere might be a way to store more of this... You think for a bit, and devise a larger storage unit, with more capacity than warehouses, and with a special compartment dedicated to potentially dangerous materials. To make it truly work, you think of imbuing it with mana. You are eager to give it a try.\r\n\r\n**You can now build Monstruariums!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"monstruarium_unlocked\",\r\n  message,\r\n  [],\r\n  setFlag(\"monstruarium_unlocked\"),\r\n);\r\n\r\naddContextListener(\"monstruarium_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"monstruarium_unlocked\") &&\r\n    getResourceAmount(newState, Resource.Monstium) >= 200\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default monstruarium as Monstruarium;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps } from \"../../Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass ResearcherCabin extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"researcher_cabin_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Researcher Cabin\";\r\n  }\r\n\r\n  getArea(): string[] {\r\n    return [\"Research\", \"Campus\"];\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Housing;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Housing for researchers to live in campus.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      maxResearchers: {\r\n        value: 1,\r\n        tags: [\r\n          TransformationTags.Researcher,\r\n          TransformationTags.PerBuildingCap,\r\n        ],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.maxResearchers)} Max Researchers`;\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 150,\r\n      Wood: 320,\r\n      Stone: 110,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Wood: 1.3,\r\n      Stone: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst researcherCabin = new ResearcherCabin();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Researcher, TransformationTags.Cap]],\r\n  \"ResearcherCabin\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    getBuildingAmount(state, researcherCabin) *\r\n    researcherCabin.getActionEffects(state).maxResearchers,\r\n);\r\n\r\naddContextListener(\r\n  \"researcher_cabin_cap_recalculation\",\r\n  (oldState, newState) => {\r\n    if (buildingAmountsChanged(oldState, newState, researcherCabin)) {\r\n      return (state) => {\r\n        return recalculateCaps(state);\r\n      };\r\n    }\r\n  },\r\n);\r\n\r\nconst message = buildEventMessage(\r\n  \"researcher_cabin_unlocked\",\r\n  \"Housing for Researchers\",\r\n)\r\n  .setSimpleDescription(\r\n    `Your researcher comes up to you. \"Studying here has been great so far!\", she says. \"But it certainly is somewhat lonely... it would be great to have company. We could get double the work done; imagine how fast we could discover new things!\", she exclaims.\r\n    \r\n\"But there's a problem. There's nowhere for them to stay in. I have an idea for a cabin, but... we'll need to build it, first. Oh well.. back to work,\" she mentions, as she turns away and continues focusing on her research.\r\n\r\nYou ponder her words for some time. Regardless of her feelings, you recognize that double the researchers could greatly speed things up. You think of possibly building a Researcher Cabin as she suggested, and hiring an extra researcher.\r\n\r\n**You can now build Researcher Cabins!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"researcher_cabin_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"researcher_cabin_unlocked\"),\r\n);\r\n\r\naddContextListener(\"researcher_cabin_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"researcher_cabin_unlocked\") &&\r\n    hasFlag(newState, \"research_unlocked\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 1300\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default researcherCabin as ResearcherCabin;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, recalculateCaps, Resource } from \"../../Resources\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\nimport Warehouse from \"./Warehouse\";\r\n\r\nclass Vault extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 || hasFlag(state, \"vault_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Vault\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Storage;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Allows you to store more coins safely.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      coins: {\r\n        value: 20000,\r\n        tags: [Resource.Coins, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const resourceEffectMap: Partial<Record<Resource, string>> = {\r\n      Coins: `+${formatNumber(effects.coins)} Max:coins:`,\r\n    };\r\n    return (Object.keys(resourceEffectMap) as Array<Resource>)\r\n      .filter((resource) => state.resources?.[resource] !== undefined)\r\n      .map((resource) => resourceEffectMap[resource])\r\n      .join(\", \");\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 500,\r\n      Stone: 600,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Stone: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nconst vault = new Vault();\r\n\r\nfunction calculateVaultCap(state: PlayerContextState) {\r\n  return vault.getActionEffects(state).coins;\r\n}\r\n\r\nregisterTransformation(\r\n  [[Resource.Coins, TransformationTags.Cap]],\r\n  \"VaultCoinsCap\",\r\n  TransformationType.Addition,\r\n  (state) => getBuildingAmount(state, vault) * calculateVaultCap(state),\r\n);\r\n\r\naddContextListener(\"vault_coins_cap_recalculation\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, vault)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nconst message = buildEventMessage(\"vault_unlocked\", \"Coin Storage\")\r\n  .setSimpleDescription(\r\n    `You are managing to stockpile large amounts of coins! It would be wise to find a place to put them in.\r\n    \r\nWarehouses have been useful; stone has proven to be a good material for tons of things. You think about using it for a specialized building for money storage. You are concerned about bandits, but are convinced it'll be worth it in the long run.\r\n\r\n**You can now build Vaults!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"vault_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"vault_unlocked\"),\r\n);\r\n\r\naddContextListener(\"vault_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"vault_unlocked\") &&\r\n    getResourceAmount(newState, Resource.Coins) >= 800 &&\r\n    getBuildingAmount(newState, Warehouse) >= 1\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default vault as Vault;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect, ActionSubcategory } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, recalculateCaps, Resource } from \"../../Resources\";\r\nimport { BuildingActionBase } from \"../Building\";\r\nimport { buildingAmountsChanged, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass WaterTank extends BuildingActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      getBuildingAmount(state, this) > 0 ||\r\n      hasFlag(state, \"water_tank_unlocked\")\r\n    );\r\n  }\r\n\r\n  getBuildingName(): string {\r\n    return \"Water Tank\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getSubcategory(): ActionSubcategory | undefined {\r\n    return ActionSubcategory.Storage;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Allows you to stockpile water.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      water: {\r\n        value: 250,\r\n        tags: [Resource.Water, TransformationTags.PerBuildingCap],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const resourceEffectMap: Partial<Record<Resource, string>> = {\r\n      Water: `+${formatNumber(effects.water)} Max:water:`,\r\n    };\r\n    return (Object.keys(resourceEffectMap) as Array<Resource>)\r\n      .filter((resource) => state.resources?.[resource] !== undefined)\r\n      .map((resource) => resourceEffectMap[resource])\r\n      .join(\", \");\r\n  }\r\n\r\n  getBaseResourceCost(): Record<string, number> {\r\n    return {\r\n      Coins: 350,\r\n      Wood: 300,\r\n      Stone: 200,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Record<string, number> {\r\n    return {\r\n      Coins: 1.3,\r\n      Wood: 1.3,\r\n      Stone: 1.3,\r\n    };\r\n  }\r\n}\r\n\r\nfunction calculateWaterTankCap(state: PlayerContextState) {\r\n  return waterTank.getActionEffects(state).water;\r\n}\r\n\r\nconst waterTank = new WaterTank();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Water]],\r\n  \"WaterTankWaterCap\",\r\n  TransformationType.Addition,\r\n  (state) => getBuildingAmount(state, waterTank) * calculateWaterTankCap(state),\r\n);\r\n\r\naddContextListener(\"water_tank_caps_recalculation\", (oldState, newState) => {\r\n  if (buildingAmountsChanged(oldState, newState, waterTank)) {\r\n    return (state) => {\r\n      return recalculateCaps(state);\r\n    };\r\n  }\r\n});\r\n\r\nconst message = buildEventMessage(\"water_tank_unlocked\", \"Water Storage\")\r\n  .setSimpleDescription(\r\n    `You have been struggling with water storage for a while. Creating it is easy, but you have nowhere to place it - it just drops to the ground!\r\n    \r\nYou feel a surge of inspiration, as you realize you could build a container. Then you figure it's downright obvious.\r\n\r\nYou set out to build a water tank with stone and wood.\r\n\r\n**You can now build Water Tanks!**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"water_tank_unlocked\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"water_tank_unlocked\"),\r\n);\r\n\r\naddContextListener(\"water_tank_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"water_tank_unlocked\") &&\r\n    hasFlag(newState, \"gather_wood_unlocked\") &&\r\n    getResourceAmount(newState, Resource.Water) >= 10\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default waterTank as WaterTank;\r\n","import { hasFlag, setFlag } from \"../../Flags\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\r\n  \"Autocast_Intro\",\r\n  \"Casting Spells is Repetitive\",\r\n)\r\n  .setSimpleDescription(\r\n    `How many times have you manually cast a spell by now? You have lost count. It certainly is not difficult for you. However, there is real repetition to these casts.\r\n    \r\nYou wonder if there might be a way to somehow automate this, as it's starting to feel a bit dull. But thinking about it, you can't figure out any solution...`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"Autocast_Intro\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"autocast_intro_triggered\"),\r\n);\r\n\r\naddContextListener(\"autocast_intro_triggered\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"autocast_intro_triggered\") &&\r\n    hasFlag(newState, \"research_unlocked\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 2200\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default event;\r\n","import { hasFlag, setFlag } from \"../../Flags\";\r\nimport { isCraftingUnlocked, isInventoryUnlocked } from \"../../items/Items\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\"crafting_intro_1\", \"Crafting Station\")\r\n  .setSimpleDescription(\r\n    `Your focus is interrupted by your researcher, who yells at you. \"Headmaster!\", she says.\r\n\r\n\"Gathering resources like wood and iron is great\", she continues. \"Wouldn't it even be more interesting if we could make more complex stuff from them?\"`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"crafting_intro_1_2\", \"Crafting Station\")\r\n      .setSimpleDescription(\r\n        `You try to convey to your researcher that we have, in fact, been creating complex things from resources: the buildings. But she frowns.\r\n      \r\n\"No, that's not what I meant\", she says, unhappily. \"Buildings are huge! I'm thinking more of useful, smaller things. Potions? Weapons? Magical items?\"`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"crafting_intro_1_3\", \"Crafting Station\")\r\n          .setSimpleDescription(\r\n            `You continue listening to her.\r\n          \r\n\"If we had a crafting station, we could make a lot of these... if only it wasn't so expensive to build, I could do it myself and learn more about it!\", she says, somewhat frustrated.\r\n\r\nYou aren't sure whether to pay heed to it - why would you need things like weapons in a magical institution? You think about it some more...`,\r\n          )\r\n          .addOption(\r\n            \"Build a Crafting Station (2000 Coins, 2000 Wood, 100 Iron)\",\r\n            buildEventMessage(\"crafting_intro_1_4\", \"Crafting Station\")\r\n              .setSimpleDescription(\r\n                `It was difficult, but the crafting station is finished! Your researcher, filled with joy, runs towards it and examines it from every angle. You notice your apprentice also taking notice of it, and looking at it curiously.\r\n              \r\nA crafting station... You wonder if you might be able to do something with it right away?\r\n\r\n\"Conjuration and Enchantment,\" says your researcher, as she passes by you with the apprentice. \"Focus our research in those schools, and we should be able to make items.\" They head outside together.\r\n\r\n**You have unlocked the \"Inventory\" and \"Crafting\" features! You can access your inventory via the left-side menu. You can craft from the inventory screen.**`,\r\n              )\r\n              .build(),\r\n            (state) => {\r\n              state = grantResource(Resource.Coins, -2000)(state);\r\n              state = grantResource(Resource.Wood, -2000)(state);\r\n              state = grantResource(Resource.Iron, -100)(state);\r\n              state = setFlag(\"new_inventory_unlocked\")(state);\r\n              state = setFlag(\"crafting_unlocked\")(state);\r\n              return state;\r\n            },\r\n            undefined,\r\n            (state) =>\r\n              getResourceAmount(state, Resource.Coins) >= 2000 &&\r\n              getResourceAmount(state, Resource.Wood) >= 2000 &&\r\n              getResourceAmount(state, Resource.Iron) >= 100,\r\n          )\r\n          .addOption(\"Maybe later\")\r\n          .build(),\r\n      )\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"crafting_intro_1\",\r\n  message,\r\n  [],\r\n  setFlag(\"crafting_intro\"),\r\n);\r\n\r\naddContextListener(\"crafting_intro\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"crafting_intro\") &&\r\n    hasFlag(newState, \"gather_iron_unlocked\") &&\r\n    (!isCraftingUnlocked(newState) || !isInventoryUnlocked(newState)) &&\r\n    getTotalElementAndSchoolExp(newState) >= 10000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default event;\r\n","import { hasFlag, setFlag } from \"../../Flags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../items/Equipment\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getTotalElementAndSchoolExp } from \"../../spells/ElementsAndSchools\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\"exploration_intro_1\", \"The School Basement\")\r\n  .setSimpleDescription(\r\n    `\"E-Excuse me, headmaster...?\" You hear a timid voice coming from the door. You gaze up, to find your apprentice at the door, and motion for him to come inside. He walks towards you, looking disheveled and holding a club.\r\n    \r\n\"I found a trap door in the school garden, behind some bushes\", he begins explaining. \"I found it curious, so I decided to see what was below it.\" He glances at you. You can tell that, despite his usual fear of you, he is actually quite enthusiastic about this.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"exploration_intro_2\", \"The School Basement\")\r\n      .setSimpleDescription(\r\n        `\"It's a very spacious basement, with a lot of rooms, and it seems to go very deep!\", he says. \"Headmaster, you should definitely investigate. I feel there's a lot of secrets to be found!\"\r\n  \r\n\"B-but it was, well... dangerous\", he continues, while looking down. \"Please be prepared before going down there. There are scary... ...creatures, roaming around the place.\"`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"exploration_intro_3\", \"The School Basement\")\r\n          .setSimpleDescription(\r\n            `You nod, and bid farewell to the apprentice.\r\n          \r\nYou are aware this is quite the old building, where wizards used to live and study several generations ago. You consider the basement may be full of things that could help expand your knowledge. However, you recall the apprentice's warning: it will probably be dangerous. You strongly consider arming yourself with a weapon and some protection before heading in, though you admit you may already be equipped for it.\r\n\r\nMaybe this is why the researcher was also excited about making weapons...?\r\n\r\n**You have unlocked the \"Exploration\" feature! You can access this feature from the left-side menu. Explore various locations to discover a wide array of new things; but beware, as powerful foes may be lurking behind every corner!**`,\r\n          )\r\n          .build(),\r\n      )\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"exploration_intro_1\",\r\n  message,\r\n  [],\r\n  setFlag(\"exploration_unlocked\"),\r\n);\r\n\r\naddContextListener(\"exploration_intro\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"exploration_unlocked\") &&\r\n    hasFlag(newState, \"wizard_robe_bought\") &&\r\n    getEquippedItem(newState, EquipmentSlot.Hand) &&\r\n    getEquippedItem(newState, EquipmentSlot.Body) &&\r\n    getTotalElementAndSchoolExp(newState) >= 33000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default event;\r\n","import { hasFlag, setFlag } from \"../../Flags\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { grantNewResearcher } from \"../../research/Researchers\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\r\n  \"Research_Intro\",\r\n  \"A wild researcher appeared\",\r\n)\r\n  .setSimpleDescription(\r\n    `An enthusiastic lady looks at your Mana and notices the large amount you have.\r\n\r\n\"Wow, this would be great source material,\" she says.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"Research_Intro_1\", \"A wild researcher appeared\")\r\n      .setSimpleDescription(\r\n        `You look at her, perplexed and somewhat confused. Then she continues explaining.\r\n\r\n\"Large amounts of Mana are hard to come by, and are almost a requirement for the successful study of Magic.\"`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"Research_Intro_2\", \"A wild researcher appeared\")\r\n          .setSimpleDescription(\r\n            `\"Are you trying to study magic here? This is exciting!\r\n            \r\nI'd be willing to work here for a small price... let's say 200 Coins. Of course, you would be the first to learn what I find out, and you would be able to tell me what I should focus on,\" she says earnestly.\r\n\r\n\"So what will it be?\"`,\r\n          )\r\n          .addOption(\r\n            \"Pay 200 Coins\",\r\n            buildEventMessage(\"Research_Intro_3\", \"A wild researcher appeared\")\r\n              .setSimpleDescription(\r\n                `You produce 200 coins out of your pockets, and hand them over to the researcher. She looks at the coins and puts them away in the pockets of her robes.\r\n\r\n\"Perfect! I will get started right away. I'm sure this is the beginning of a very fruitful relationship for us both!,\" she exclaims.\r\n\r\n**You have unlocked the \"Research\" feature! You may find it on the left-side menu.**`,\r\n              )\r\n              .build(),\r\n            (state) => {\r\n              state = grantResource(Resource.Coins, -200)(state);\r\n              state = setFlag(\"research_unlocked\")(state);\r\n              state = grantNewResearcher(1)(state);\r\n              return state;\r\n            },\r\n            undefined,\r\n            (state) => getResourceAmount(state, Resource.Coins) >= 200,\r\n          )\r\n          .addOption(\"Maybe later\")\r\n          .build(),\r\n      )\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"Research_Intro\",\r\n  message,\r\n  [],\r\n  setFlag(\"Research_Intro_Triggered\"),\r\n);\r\n\r\naddContextListener(\"research_intro_triggered_1\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"Research_Intro_Triggered\") &&\r\n    getResourceCap(newState, Resource.Mana) >= 200\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default event;\r\n","import { ItemBase } from \"../Item\";\r\n\r\nclass LightweightChest extends ItemBase {\r\n  getId(): string {\r\n    return \"lightweightChest\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./lightweightChest.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Lightweight Chest\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Quest Item\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A very light wooden chest. Great for carrying items.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 300;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 3, Enchantment: 3 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 750,\r\n        Wood: 4500,\r\n        Iron: 10,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new LightweightChest();\r\n","import { hasFlag, setFlag } from \"../../Flags\";\r\nimport {\r\n  getInventory,\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../items/Inventory\";\r\nimport { isCraftingUnlocked } from \"../../items/Items\";\r\nimport LightweightChest from \"../../items/other/LightweightChest\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport {\r\n  getSchoolLevel,\r\n  getTotalElementAndSchoolExp,\r\n  School,\r\n} from \"../../spells/ElementsAndSchools\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\"shop_intro\", \"Selling Items\")\r\n  .setSimpleDescription(\r\n    `The new crafting table is doing well, but every time you get rid of an item to make room for another, you feel a little bad inside.\r\n    \r\nAs if reading your mind, a fat businessman with gaudy clothes shows up in campus. He grins at you, with a sneaky smile.\r\n\r\n\"Gooooood afternoon, headmaster\", he exclaims to you. He looks at your item collection for a short while, then turns to you again. \"May I interest you in a business propooooosal?\"`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"shop_intro_2\", \"Selling Items\")\r\n      .setSimpleDescription(\r\n        `\"You have some very interesting items here\", he says. \"I would very much like to have them! I'd be happy to even offer you a bit of cooooins for them.\"\r\n        \r\nThat's like music to your ears! But then the businessman continues.\r\n\r\n\"Of cooourse, that is only possible if I can carry them! You are a very talented individual. Would you be able to craft me a :lightweightChest: Lightweight Chest for that purpose? If you dooooo... I'll make sure to come back ooooften and buy your items, multiple times!\"\r\n\r\nYou notice he already has a backpack...`,\r\n      )\r\n      .addOption(\r\n        \"Charm the Businessman (1200 Mana)\",\r\n        buildEventMessage(\"shop_intro_4\", \"Selling Items\")\r\n          .setSimpleDescription(\r\n            `You use your Illusion prowess to charm the businessman; you don't think he actually needs the chest. It seems to work!\r\n            \r\n\"Ah,\" he says with a more relaxed grin. \"I actually doooon't need the chest. I'll be happy just to buy your items, just let me know. I'll come ooooften.\" He gives you a glance, then turns back and leaves.\r\n\r\n**You can now sell items for :coins:!**`,\r\n          )\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Mana, -1200)(state);\r\n          state = setFlag(\"selling_unlocked\")(state);\r\n          return state;\r\n        },\r\n        (state) => getSchoolLevel(state, School.Illusion) >= 5,\r\n        (state) => getResourceAmount(state, Resource.Mana) >= 1200,\r\n      )\r\n      .addOption(\r\n        \"Hand over a Lightweight Chest\",\r\n        buildEventMessage(\"shop_intro_3\", \"Selling Items\")\r\n          .setSimpleDescription(\r\n            `You give the businessman the chest he asked for. His grin widens.\r\n            \r\n\"Thank yoooooou\", he says. \"Let me knoooow if there's anything you would like me to take from you. I'll come ooooften.\" He gives you a glance, then turns back and leaves.\r\n\r\n**You can now sell items for :coins:!**`,\r\n          )\r\n          .build(),\r\n        (state) => {\r\n          state = removeFromInventoryWithAnyParams(LightweightChest, 1, state);\r\n          state = setFlag(\"selling_unlocked\")(state);\r\n          return state;\r\n        },\r\n        undefined,\r\n        (state) => getTotalAmountOfItem(LightweightChest, state) > 0,\r\n      )\r\n      .addOption(\"Maybe later\")\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\"shop_intro\", message, [], setFlag(\"shop_intro\"));\r\n\r\naddContextListener(\"shop_intro_inventory\", (oldState, newState) => {\r\n  if (!hasFlag(newState, \"has_crafted\") && getInventory(newState).length > 0) {\r\n    return setFlag(\"has_crafted\");\r\n  }\r\n});\r\n\r\naddContextListener(\"shop_intro\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"shop_intro\") &&\r\n    isCraftingUnlocked(newState) &&\r\n    hasFlag(newState, \"has_crafted\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 16000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default event;\r\n","import { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport Furnace from \"../../buildings/campus/Furnace\";\r\nimport { getSuccessfulExplorationsForFloor } from \"../../exploration/Exploration\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { isCraftingUnlocked } from \"../../items/Items\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport {\r\n  getUnlockedSchools,\r\n  School,\r\n  unlockSchool,\r\n} from \"../../spells/ElementsAndSchools\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\r\n  \"alchemy_lab_1\",\r\n  \"(Storyline) Cauldron of Potion-Making\",\r\n)\r\n  .setSimpleDescription(\r\n    `You find yourself near your furnace. You can feel the heat emanating from it. It evokes memories of a distant past... of when you were learning about magic. You recall a scene where you gathered around a big cauldron...\r\n    \r\nIt struck you, then. A *cauldron*! Why didn't you think about this before? You head out and look for your researcher. You find her, and start talking to her about the art of making magical beverages.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"alchemy_lab_2\", \"(Storyline) Cauldron of Potion-Making\")\r\n      .setSimpleDescription(\r\n        `\"Magical... beverages? Do you mean potions?\", she says. \"We definitely can't make those with our crafting station...\"\r\n        \r\nShe didn't seem to catch on, so you explain that you want to build a cauldron and start investigating the production of powerful potions.\r\n\r\n\"Oh, of course\", she says. She goes back to studying without paying mind to you. It seems like you will need to show her what you mean.`,\r\n      )\r\n      .addOption(\r\n        \"Build a cauldron (6500 Stone, 500 Iron, 2000 Temperature)\",\r\n        buildEventMessage(\r\n          \"alchemy_lab_3\",\r\n          \"(Storyline) Cauldron of Potion-Making\",\r\n        )\r\n          .setSimpleDescription(\r\n            `That was quite some hard work. The cauldron looks sturdy and prepared for some serious brewing. You have a new robust addition to the campus now!\r\n            \r\nYour researcher is still skeptical.\r\n\r\n\"I can see where this could go\", she says, raising her brow. \"But there's more we need to do. We need a consistent, strong source of flame and tons of water, to keep this boiling. *Then* we'll be able to try to make potions.\" She goes back to her research.\r\n\r\nYou understand this, and you start working towards that goal.`,\r\n          )\r\n          .addOption(\r\n            \"Fill the cauldron and start a fire (2000 Water, 6500 Wood)\",\r\n            buildEventMessage(\r\n              \"alchemy_lab_4\",\r\n              \"(Storyline) Cauldron of Potion-Making\",\r\n            )\r\n              .setSimpleDescription(\r\n                `The sparks of the fire are noisy. You place the cauldron on top of it, and slowly add water in it. It takes a long time, but you eventually finish and wait for the water to boil.\r\n                \r\nThe cauldron starts bubbling. Your researcher finally comes and looks at the cauldron. She observes the flame and the steam coming out from the top of the cauldron, then speaks to you.\r\n\r\n\"This is actually great!\", she exclaims. \"We are definitely prepared now! We should study the art of making potions. I am sure we could make many useful things!\"`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                buildEventMessage(\r\n                  \"alchemy_lab_5\",\r\n                  \"(Storyline) Cauldron of Potion-Making\",\r\n                )\r\n                  .setSimpleDescription(\r\n                    `Your researcher seems eager to try it out. You are more reluctant: you remember how difficult it was to figure out the right formula. Still, with enough research, you have high hopes that you will find plenty of uses for it...\r\n\r\nThen you remember. Your professor was saying how they had kept trying to turn iron into gold, but despite years of work, they found no success. But maybe you could...?\r\n\r\n**You have completed the \"Cauldron of Potion-Making\" storyline and have permanently unlocked the Alchemy school! You may now do research on Alchemy, which will let you craft ever-more-powerful potions with various effects. This will persist even after restarting the game!**`,\r\n                  )\r\n                  .build(),\r\n              )\r\n              .build(),\r\n            (state) => {\r\n              state = grantResource(Resource.Water, -2000)(state);\r\n              state = grantResource(Resource.Wood, -6500)(state);\r\n              state = unlockSchool(School.Alchemy)(state);\r\n              return state;\r\n            },\r\n            undefined,\r\n            (state) =>\r\n              getResourceAmount(state, Resource.Water) >= 2000 &&\r\n              getResourceAmount(state, Resource.Wood) >= 6500,\r\n          )\r\n          .addOption(\"Maybe later\")\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Stone, -6500)(state);\r\n          state = grantResource(Resource.Iron, -500)(state);\r\n          state = grantResource(Resource.Temperature, -2000)(state);\r\n          return state;\r\n        },\r\n        undefined,\r\n        (state) =>\r\n          getResourceAmount(state, Resource.Stone) >= 6500 &&\r\n          getResourceAmount(state, Resource.Iron) >= 500 &&\r\n          getResourceAmount(state, Resource.Temperature) >= 2000,\r\n      )\r\n      .addOption(\"Maybe later\")\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst alchemyLabEvent = createGameEvent(\r\n  \"alchemy_lab\",\r\n  message,\r\n  [EventTag.STORYLINE],\r\n  setFlag(\"alchemy_lab_triggered\"),\r\n);\r\n\r\naddContextListener(\"safeguard_alchemy_lab_trigger\", (oldState, state) => {\r\n  if (\r\n    !hasFlag(state, \"alchemy_lab_triggered\") &&\r\n    getBuildingAmount(state, Furnace) > 0 &&\r\n    !getUnlockedSchools(state).includes(School.Alchemy) &&\r\n    getSuccessfulExplorationsForFloor(state, \"schoolBasementB3\") > 25\r\n  ) {\r\n    // Safeguard unlock the alchemy lab.\r\n    return triggerEvent(alchemyLabEvent, {});\r\n  }\r\n});\r\n\r\nregisterRandomEventTrigger(\r\n  alchemyLabEvent,\r\n  60,\r\n  true,\r\n  (state) =>\r\n    !hasFlag(state, \"alchemy_lab_triggered\") &&\r\n    isCraftingUnlocked(state) &&\r\n    getBuildingAmount(state, Furnace) > 0 &&\r\n    !getUnlockedSchools(state).includes(School.Alchemy),\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Alchemy Lab\",\r\n    1010,\r\n    (state) => getUnlockedSchools(state).includes(School.Alchemy),\r\n    (state) => getUnlockedSchools(state).includes(School.Alchemy),\r\n    \"There's a chance of this happening randomly if you have unlocked your inventory and you have at least a Furnace...\",\r\n    \"Alchemy school unlocked\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nexport default alchemyLabEvent;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { applyTransformations } from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\nimport { addToInventory } from \"../../items/Inventory\";\r\nimport { getItemById } from \"../../items/Items\";\r\nimport {\r\n  PlayerContextState,\r\n  PlayerContextTransform,\r\n} from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { AttackTarget } from \"../AttackTarget\";\r\nimport { CombatStat } from \"../CombatStats\";\r\nimport { pushToCreatureMessageLog } from \"../Creatures\";\r\nimport { pushToMessageLog, standardEnemyAttackEffect } from \"../Exploration\";\r\n\r\nexport interface BattlerStats {\r\n  maxHP: number;\r\n  attack: number;\r\n  attackDelay: number;\r\n  defense: number;\r\n  dodgeChance: number;\r\n  critChance: number;\r\n}\r\n\r\nexport interface BattlerAction {\r\n  name: string;\r\n  delay: number;\r\n  transform: PlayerContextTransform;\r\n}\r\n\r\nexport interface EnemyLoot {\r\n  itemId: string;\r\n  chance: number;\r\n  amount: number;\r\n  params?: any;\r\n}\r\n\r\nexport abstract class Enemy implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getName(): string;\r\n  abstract getBaseStats(): BattlerStats;\r\n  abstract getPicture(state: PlayerContextState): any;\r\n\r\n  getMaxHP(state: PlayerContextState): number {\r\n    return applyTransformations(\r\n      [AttackTarget.Enemy, CombatStat.MaxHP],\r\n      state,\r\n      this.getBaseStats().maxHP,\r\n    );\r\n  }\r\n  getAttack(state: PlayerContextState): number {\r\n    return applyTransformations(\r\n      [AttackTarget.Enemy, CombatStat.Attack],\r\n      state,\r\n      this.getBaseStats().attack,\r\n    );\r\n  }\r\n  getAttackDelay(state: PlayerContextState): number {\r\n    return this.getBaseStats().attackDelay;\r\n  }\r\n  getCriticalChance(state: PlayerContextState): number {\r\n    return applyTransformations(\r\n      [AttackTarget.Enemy, CombatStat.CritChance],\r\n      state,\r\n      this.getBaseStats().critChance,\r\n    );\r\n  }\r\n  getDefense(state: PlayerContextState): number {\r\n    return applyTransformations(\r\n      [AttackTarget.Enemy, CombatStat.Defense],\r\n      state,\r\n      this.getBaseStats().defense,\r\n    );\r\n  }\r\n  getDodgeChance(state: PlayerContextState): number {\r\n    return applyTransformations(\r\n      [AttackTarget.Enemy, CombatStat.Dodge],\r\n      state,\r\n      this.getBaseStats().dodgeChance,\r\n    );\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(\r\n          state,\r\n          1.0,\r\n          this.getAttack(state),\r\n          this.getCriticalChance(state),\r\n        ),\r\n    };\r\n  }\r\n\r\n  abstract getCoinsAwarded(state: PlayerContextState): number;\r\n\r\n  abstract getMonstiumAwarded(state: PlayerContextState): number;\r\n\r\n  getItemsAwarded(state: PlayerContextState): EnemyLoot[] {\r\n    return [];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getBackdropColor(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  onDeath(\r\n    state: PlayerContextState,\r\n    isFromCreatures: boolean,\r\n  ): PlayerContextState {\r\n    const baseCoinsAwarded = this.getCoinsAwarded(state);\r\n    const baseMonstiumAwarded = this.getMonstiumAwarded(state);\r\n    const coinsAwarded = applyTransformations(\r\n      [\r\n        TransformationTags.Loot,\r\n        Resource.Coins,\r\n        isFromCreatures\r\n          ? TransformationTags.FromCreatures\r\n          : TransformationTags.FromExploration,\r\n      ],\r\n      state,\r\n      baseCoinsAwarded,\r\n    );\r\n    const monstiumAwarded = applyTransformations(\r\n      [\r\n        TransformationTags.Loot,\r\n        Resource.Monstium,\r\n        isFromCreatures\r\n          ? TransformationTags.FromCreatures\r\n          : TransformationTags.FromExploration,\r\n      ],\r\n      state,\r\n      baseMonstiumAwarded,\r\n    );\r\n\r\n    state = grantResource(Resource.Coins, coinsAwarded)(state);\r\n    state = grantResource(Resource.Monstium, monstiumAwarded)(state);\r\n    if (!isFromCreatures) {\r\n      state = pushToMessageLog(\r\n        state,\r\n        `You found ${formatNumber(coinsAwarded)} :coins: and ${formatNumber(\r\n          monstiumAwarded,\r\n        )} :monstium:!`,\r\n      );\r\n    } else {\r\n      state = pushToCreatureMessageLog(\r\n        state,\r\n        `A creature found ${formatNumber(\r\n          coinsAwarded,\r\n        )} :coins: and ${formatNumber(monstiumAwarded)} :monstium:!`,\r\n      );\r\n    }\r\n    const itemsAwarded = this.getItemsAwarded(state);\r\n    itemsAwarded.forEach((enemyLoot) => {\r\n      let chance = enemyLoot.chance;\r\n      if (!isFromCreatures) {\r\n        chance = applyTransformations(\r\n          [TransformationTags.LootChance],\r\n          state,\r\n          chance,\r\n        );\r\n      }\r\n      if (Math.random() < chance) {\r\n        const item = getItemById(enemyLoot.itemId);\r\n        const params = enemyLoot.params || {};\r\n        const itemOccurrence = { itemId: enemyLoot.itemId, params };\r\n        const fitsInInventory = item.fitsInInventory(state, params);\r\n        const fitsInInventoryText = fitsInInventory\r\n          ? \"\"\r\n          : \", but your inventory is full!\";\r\n        state = addToInventory(itemOccurrence, enemyLoot.amount, state);\r\n        if (!isFromCreatures) {\r\n          state = pushToMessageLog(\r\n            state,\r\n            `You found ${enemyLoot.amount} ${item.getName(\r\n              params,\r\n            )}${fitsInInventoryText}!`,\r\n          );\r\n        } else {\r\n          state = pushToCreatureMessageLog(\r\n            state,\r\n            `A creature found ${enemyLoot.amount} ${item.getName(\r\n              params,\r\n            )}${fitsInInventoryText}!`,\r\n          );\r\n        }\r\n      }\r\n    });\r\n    return state;\r\n  }\r\n}\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { calculatePlayerDefense } from \"../../CombatStats\";\r\nimport {\r\n  calculateDamage,\r\n  modifyEnemyCurrentHP,\r\n  modifyPlayerCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass BasementBat extends Enemy {\r\n  getId(): string {\r\n    return \"basementBat\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Basement Bat\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./basementBat.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 30,\r\n      defense: 0,\r\n      attack: 11,\r\n      attackDelay: 1.1,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const suckBloodChance = 0.25;\r\n    if (Math.random() < suckBloodChance) {\r\n      return {\r\n        name: \"Suck Blood\",\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state: PlayerContextState) => {\r\n          const damage = calculateDamage(\r\n            this.getAttack(state) * 1.2,\r\n            calculatePlayerDefense(state),\r\n          );\r\n          state = modifyPlayerCurrentHP(state, -damage);\r\n          state = modifyEnemyCurrentHP(state, +damage);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 50;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 6;\r\n  }\r\n\r\n  getItemsAwarded() {\r\n    return [\r\n      { itemId: \"medicinalHerb\", chance: 0.15, amount: 1 },\r\n      { itemId: \"batWing\", chance: 0.25, amount: 2 },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new BasementBat();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass Mouse extends Enemy {\r\n  getId(): string {\r\n    return \"mouse\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Mouse\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./mouse.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 40,\r\n      defense: 2,\r\n      attack: 9,\r\n      attackDelay: 2.0,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 45;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 4;\r\n  }\r\n\r\n  getItemsAwarded() {\r\n    return [\r\n      { itemId: \"medicinalHerb\", chance: 0.1, amount: 1 },\r\n      { itemId: \"ratTail\", chance: 0.25, amount: 2 },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new Mouse();\r\n","import { buildEvent } from \"../../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../../events/Events\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass Skeleton extends Enemy {\r\n  getId(): string {\r\n    return \"skeleton\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Skeleton\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./skeleton.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 500,\r\n      defense: 6,\r\n      attack: 19,\r\n      attackDelay: 3.0,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const strongBlowChance = 0.5;\r\n    if (Math.random() < strongBlowChance) {\r\n      return {\r\n        name: \"Strong Blow\",\r\n        delay: this.getAttackDelay(state) * 2,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, this.getAttack(state) * 2),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 175;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 15;\r\n  }\r\n\r\n  getItemsAwarded() {\r\n    return [{ itemId: \"medicinalHerb\", chance: 0.8, amount: 1 }];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  onDeath(\r\n    state: PlayerContextState,\r\n    isFromCreatures: boolean,\r\n  ): PlayerContextState {\r\n    state = super.onDeath(state, isFromCreatures);\r\n    state = setDungeonFloorCompleted(state, \"schoolBasementB1\");\r\n    if (!hasFlag(state, \"skeleton_defeated_event_triggered\")) {\r\n      state = triggerEvent(skeletonDefeatedEvent)(state);\r\n    }\r\n    return setFlag(\"school_basement_b2_unlocked\")(state);\r\n  }\r\n}\r\n\r\nconst skeletonDefeatedEventBuilder = buildEvent(\r\n  \"skeleton_defeated_event\",\r\n  \"The Frontier of Danger\",\r\n  [],\r\n)\r\n  .setOnTrigger(setFlag(\"skeleton_defeated_event_triggered\"))\r\n  .createMessage()\r\n  .setSimpleDescription(`As you manage to defeat the powerful Skeleton, you notice what it was guarding all along: a staircase down to what seems to be... another floor? What could possibly be down here?\r\n  \r\nThe mysteries abound, and you recall what your researcher told you before. The event called Tournament of Magic. You still feel very far away from that, but through this adventure, you have already managed to discover an entire school of magic. You realize that this might just be the best way forward to actually be able to participate in the event. You arm yourself with more courage before moving on into the unknown...\r\n\r\n**You can now enter the School Basement B2! You can access this floor by pressing the \"Next Floor\" button in the Exploration screen.**`);\r\n\r\nconst skeletonDefeatedEvent = skeletonDefeatedEventBuilder.build();\r\n\r\nexport default new Skeleton();\r\n","import { applyTransformations } from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\nimport {\r\n  PlayerContextState,\r\n  PlayerContextTransform,\r\n} from \"../../PlayerContext\";\r\nimport { pushToCreatureMessageLog } from \"../Creatures\";\r\nimport { Enemy } from \"../enemies/Enemy\";\r\nimport { getSuccessfulExplorationsForFloor, startCombat } from \"../Exploration\";\r\n\r\nexport interface ExplorationPossibility {\r\n  weight: number;\r\n  transforms: ExplorationOutcome;\r\n}\r\n\r\nexport interface ExplorationOutcome {\r\n  enemy?: Enemy;\r\n  normal: PlayerContextTransform;\r\n  breeding: PlayerContextTransform;\r\n}\r\n\r\nexport function encounterEnemy(enemy: Enemy): ExplorationOutcome {\r\n  return {\r\n    enemy: enemy,\r\n    normal: startCombat(enemy),\r\n    breeding: (state) => {\r\n      state = pushToCreatureMessageLog(\r\n        state,\r\n        `A creature defeated ${enemy.getName()}!`,\r\n      );\r\n      state = enemy.onDeath(state, true);\r\n      return state;\r\n    },\r\n  };\r\n}\r\n\r\nexport abstract class DungeonFloor implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getFloorName(): string;\r\n\r\n  getExplorationRequiredTimeSec(): number {\r\n    return 5.0;\r\n  }\r\n\r\n  _getExplorationSuccessesForBoss(): number {\r\n    return 50;\r\n  }\r\n\r\n  getExplorationSuccessesForBoss(state: PlayerContextState): number {\r\n    return Math.ceil(\r\n      applyTransformations(\r\n        [TransformationTags.ExplorationBossRequirement],\r\n        state,\r\n        this._getExplorationSuccessesForBoss(),\r\n        { floor: this },\r\n      ),\r\n    );\r\n  }\r\n\r\n  doExplore(state: PlayerContextState): ExplorationOutcome | null {\r\n    const possibilities = this.getExplorationPossibilities(state);\r\n    const totalWeight = possibilities.reduce(\r\n      (sumToNow, possibility) => sumToNow + possibility.weight,\r\n      0,\r\n    );\r\n    let explorationRoll = Math.random() * totalWeight;\r\n    for (let idx in possibilities) {\r\n      const possibility = possibilities[idx];\r\n      const weight = possibility.weight;\r\n      explorationRoll -= weight;\r\n      if (explorationRoll < 0) {\r\n        return possibility.transforms;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  abstract getBoss(state: PlayerContextState): Enemy | undefined;\r\n\r\n  abstract getBreedingLevel(): number;\r\n\r\n  doFightBoss(state: PlayerContextState): PlayerContextTransform | undefined {\r\n    const boss = this.getBoss(state);\r\n    if (boss) {\r\n      return startCombat(boss);\r\n    }\r\n  }\r\n\r\n  canFightBoss(state: PlayerContextState): boolean {\r\n    return (\r\n      getSuccessfulExplorationsForFloor(state, this.getId()) >=\r\n        this.getExplorationSuccessesForBoss(state) &&\r\n      this.getBoss(state) != undefined\r\n    );\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return false;\r\n  }\r\n\r\n  getNextFloor(): DungeonFloor | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  abstract getExplorationPossibilities(\r\n    state: PlayerContextState,\r\n  ): ExplorationPossibility[];\r\n}\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass AngrySheep extends Enemy {\r\n  getId(): string {\r\n    return \"angrySheep\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Angry Sheep\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./angrySheep.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 120,\r\n      defense: 4,\r\n      attack: 15,\r\n      attackDelay: 4.0,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const doNothingChance = 0.25;\r\n    if (Math.random() < doNothingChance) {\r\n      return {\r\n        name: \"Hop Around\",\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state: PlayerContextState) => {\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    const chargeChance = 0.1;\r\n    if (Math.random() < chargeChance) {\r\n      return {\r\n        name: \"Charge!\",\r\n        delay: this.getAttackDelay(state) * 1.5,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, this.getAttack(state) * 3),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 110;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 8;\r\n  }\r\n\r\n  getItemsAwarded() {\r\n    return [\r\n      { itemId: \"medicinalHerb\", chance: 0.1, amount: 1 },\r\n      { itemId: \"wool\", chance: 1.0, amount: 1 },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new AngrySheep();\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../calculation/Calculation\";\r\nimport { setFlag } from \"../../../Flags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../timetick/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { CombatStat } from \"../../CombatStats\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass LittleDevil extends Enemy {\r\n  getId(): string {\r\n    return \"littleDevil\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Little Devil\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./littleDevil.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 900,\r\n      defense: 14,\r\n      attack: 26,\r\n      attackDelay: 2.7,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const fireBallChance = 0.2;\r\n    if (Math.random() < fireBallChance) {\r\n      return {\r\n        name: \"Fire Ball\",\r\n        delay: 5.0,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, 48),\r\n      };\r\n    }\r\n    const weakenChance = 0.2;\r\n    if (Math.random() < weakenChance) {\r\n      return {\r\n        name: \"Weaken\",\r\n        delay: 5.0,\r\n        transform: grantTemporaryEffect(\r\n          \"Weaken (Little Devil)\",\r\n          \"Weaken (Little Devil)\",\r\n          12,\r\n          {\r\n            isBeneficial: false,\r\n            mode: \"add\",\r\n          },\r\n        ),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 450;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 36;\r\n  }\r\n\r\n  getItemsAwarded() {\r\n    return [{ itemId: \"medicinalHerb\", chance: 1.0, amount: 3 }];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  onDeath(\r\n    state: PlayerContextState,\r\n    isFromCreatures: boolean,\r\n  ): PlayerContextState {\r\n    state = super.onDeath(state, isFromCreatures);\r\n    state = setDungeonFloorCompleted(state, \"schoolBasementB2\");\r\n    return setFlag(\"school_basement_b3_unlocked\")(state);\r\n  }\r\n}\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"LittleDevilWeaken\",\r\n  TransformationType.Addition,\r\n  (state) => (hasTemporaryEffect(state, \"Weaken (Little Devil)\") ? -12 : 0),\r\n);\r\n\r\nexport default new LittleDevil();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass AirSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"airSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./airSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Air Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small green gem. Full of air elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new AirSpeck();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass DarknessSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"darknessSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./darknessSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Darkness Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small black gem. Full of darkness elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new DarknessSpeck();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass EarthSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"earthSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./earthSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Earth Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small brown gem. Full of earth elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new EarthSpeck();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass FireSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"fireSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./fireSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Fire Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small red gem. Full of fire elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new FireSpeck();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass LightningSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"lightningSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./lightningSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Lightning Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small purple gem. Full of lightning elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new LightningSpeck();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass NatureSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"natureSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./natureSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Nature Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small lime green gem. Full of nature elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new NatureSpeck();\r\n","import { ItemBase } from \"../../Item\";\r\n\r\nclass WaterSpeck extends ItemBase {\r\n  getId(): string {\r\n    return \"waterSpeck\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./waterSpeck.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Water Speck\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small blue gem. Full of water elemental power.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new WaterSpeck();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Item } from \"../../Item\";\r\nimport AirSpeck from \"./AirSpeck\";\r\nimport DarknessSpeck from \"./DarknessSpeck\";\r\nimport EarthSpeck from \"./EarthSpeck\";\r\nimport FireSpeck from \"./FireSpeck\";\r\nimport LightningSpeck from \"./LightningSpeck\";\r\nimport NatureSpeck from \"./NatureSpeck\";\r\nimport WaterSpeck from \"./WaterSpeck\";\r\n\r\nexport function generateSpeckForState(state: PlayerContextState): Item {\r\n  switch (state.primaryElement) {\r\n    case \"Fire\":\r\n      return FireSpeck;\r\n    case \"Earth\":\r\n      return EarthSpeck;\r\n    case \"Water\":\r\n      return WaterSpeck;\r\n    case \"Air\":\r\n      return AirSpeck;\r\n    case \"Nature\":\r\n      return NatureSpeck;\r\n    case \"Lightning\":\r\n      return LightningSpeck;\r\n    case \"Darkness\":\r\n      return DarknessSpeck;\r\n    default:\r\n      return FireSpeck;\r\n  }\r\n}\r\n","import { generateSpeckForState } from \"../../../items/other/crystals/Crystals\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport {\r\n  pushToMessageLog,\r\n  standardEnemyAttackEffect,\r\n  startExploration,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass Slime extends Enemy {\r\n  getId(): string {\r\n    return \"slime\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Slime\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./slime.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 200,\r\n      defense: 5,\r\n      attack: 14,\r\n      attackDelay: 2.5,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const runAwayChance = 0.1;\r\n    if (Math.random() < runAwayChance) {\r\n      return {\r\n        name: \"Flee\",\r\n        delay: this.getAttackDelay(state) * 3,\r\n        transform: (state) => {\r\n          state = startExploration(state);\r\n          state = pushToMessageLog(\r\n            state,\r\n            `The ${this.getName()} has run away...`,\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    const fastAttackChance = 0.3;\r\n    if (Math.random() < fastAttackChance) {\r\n      return {\r\n        name: \"Fast Attack\",\r\n        delay: this.getAttackDelay(state) * 0.25,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 90;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 12;\r\n  }\r\n\r\n  getItemsAwarded(state: PlayerContextState) {\r\n    return [\r\n      { itemId: \"medicinalHerb\", chance: 0.2, amount: 1 },\r\n      {\r\n        itemId: generateSpeckForState(state).getId(),\r\n        chance: 0.005,\r\n        amount: 1,\r\n      },\r\n      { itemId: \"goldNugget\", chance: 0.003, amount: 1 },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new Slime();\r\n","import { buildEvent } from \"../EventMessageBuilder\";\r\n\r\nconst headmasterDefeatedDemoEventBuilder = buildEvent(\r\n  \"demo_finished\",\r\n  \"Thanks for playing the Demo\",\r\n  [],\r\n);\r\n\r\nconst headmasterDefeatedDemoEvent = headmasterDefeatedDemoEventBuilder\r\n  .createMessage()\r\n  .setSimpleDescription(\r\n    `You have beaten the Ancient Headmaster! This is the end of the Demo of Magic Research. **Thank you for playing!**\r\n  \r\nIn the full game, you can expect much more content: many new dungeons, new items and features, and countless new secrets... Your progress from the Demo can be easily transferred to the full game.\r\n\r\nAre you talented enough to lead your school to win the Tournament of Magic?\r\n\r\n**Get the full game now for Android in [the Google Play Store](https://play.google.com/store/apps/details?id=com.mcolotto.magicresearchfull)!**`,\r\n  )\r\n  .build();\r\n\r\nexport { headmasterDefeatedDemoEvent };\r\n","import Demo from \"../../../Demo\";\r\nimport { headmasterDefeatedDemoEvent } from \"../../../events/campus/DemoEnd\";\r\nimport {\r\n  buildEvent,\r\n  buildEventMessage,\r\n} from \"../../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../../events/Events\";\r\nimport { EventTag } from \"../../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../../events/SimpleGameEvent\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../../Flags\";\r\nimport { generateSpeckForState } from \"../../../items/other/crystals/Crystals\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { getUnlockedSchools, School } from \"../../../spells/ElementsAndSchools\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  getCurrentEnemyHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass AncientHeadmaster extends Enemy {\r\n  getId(): string {\r\n    return \"ancientHeadmaster\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Ancient Headmaster\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./ancientHeadmaster.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 2200,\r\n      defense: 8,\r\n      attack: 24,\r\n      attackDelay: 4.0,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    if (getCurrentEnemyHP(state) < 550) {\r\n      return {\r\n        name: \"Rock Tomb\",\r\n        delay: 12.0,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, 105),\r\n      };\r\n    }\r\n    if (!hasTemporaryEffect(state, \"SilencePlayer\")) {\r\n      const silenceChance = 0.5;\r\n      if (Math.random() < silenceChance) {\r\n        return {\r\n          name: \"Silence!\",\r\n          delay: 5.0,\r\n          transform: grantTemporaryEffect(\"SilencePlayer\", \"Silence\", 20, {\r\n            isBeneficial: false,\r\n            mode: \"add\",\r\n          }),\r\n        };\r\n      }\r\n    }\r\n    const stalagmiteChance = 0.4;\r\n    if (Math.random() < stalagmiteChance) {\r\n      return {\r\n        name: \"Stalagmite\",\r\n        delay: 5.0,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, 56),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 1200;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 99;\r\n  }\r\n\r\n  getItemsAwarded(state: PlayerContextState) {\r\n    return [\r\n      { itemId: generateSpeckForState(state).getId(), chance: 1, amount: 1 },\r\n    ];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getBackdropColor(): string | undefined {\r\n    return \"#400\";\r\n  }\r\n\r\n  onDeath(\r\n    state: PlayerContextState,\r\n    isFromCreatures: boolean,\r\n  ): PlayerContextState {\r\n    state = super.onDeath(state, isFromCreatures);\r\n    state = setDungeonFloorCompleted(state, \"schoolBasementB3\");\r\n    if (!hasFlag(state, \"headmaster_event_2_triggered\")) {\r\n      state = triggerEvent(headmasterDefeatedEvent)(state);\r\n    }\r\n    if (\r\n      !Demo.isDemo() &&\r\n      getUnlockedSchools(state).includes(School.Divination) &&\r\n      !hasGlobalFlagIncludingNextRun(state, \"headmaster_under_15_minutes\") &&\r\n      getSecondsPlayed(state) < 60 * 12\r\n    ) {\r\n      state = triggerEvent(headmasterDefeatedUnder15MinutesEvent)(state);\r\n    }\r\n    if (Demo.isDemo()) {\r\n      state = triggerEvent(headmasterDefeatedDemoEvent)(state);\r\n    }\r\n    return state;\r\n  }\r\n}\r\n\r\nconst headmasterDefeatedUnder15MinutesEvent = buildEvent(\r\n  \"ancient_headmaster_15_minutes_event\",\r\n  \"(Storyline) Swift Start\",\r\n  [EventTag.STORYLINE],\r\n)\r\n  .setOnTrigger(setGlobalFlagForNextRun(\"headmaster_under_15_minutes\"))\r\n  .createMessage()\r\n  .setSimpleDescription(\r\n    `You felled the Ancient Headmaster, but it doesn't feel like the first time. How many times has this happened? It is so familiar, it is like you are able to do it in nearly no time at all - it hasn't even been 12 minutes since you opened your institution!\r\n  \r\nYou do notice, however, a page that is shining purple on the book you brought back with you. This is new! You quickly copy it, before it disappears into thin air.\r\n\r\nYou don't understand much yet, but you can tell it has instructions on how to build more efficiently. Perhaps future generations could benefit from this.\r\n\r\n**You have defeated the Ancient Headmaster in under 12 minutes and completed the \"Swift Start\" Storyline! In future runs, cost for all buildings will scale 20% slower, enabling you to build much more with the same storage!**`,\r\n  )\r\n  .build();\r\n\r\nconst postHeadmasterEventMessage = buildEventMessage(\r\n  \"ancient_headmaster_event_2\",\r\n  \"History of a Magical School\",\r\n)\r\n  .setSimpleDescription(\r\n    `As you strike the final blow, the old body of the Ancient Headmaster shakes violently, falls to its knees, and finally disintegrates into dark particles. You emerge victorious! You wipe the sweat off your face; that was a difficult battle.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\r\n      \"ancient_headmaster_event_3\",\r\n      \"History of a Magical School\",\r\n    )\r\n      .setSimpleDescription(\r\n        `You examine the room. Several bookshelves line up the walls, with a desk in the middle of the room. It feels like this could have been the study of the being you have just felled, back when they were still alive.\r\n\r\nOn top of the desk lies a single book: \"School Improvement for Novice Headmasters\". You are surprised something like this would be the one thing on the desk of the Ancient Headmaster. You decide to take it with you.`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\r\n          \"ancient_headmaster_event_4\",\r\n          \"History of a Magical School\",\r\n        )\r\n          .setSimpleDescription(\r\n            `Back in campus, you find your researcher and your apprentice chatting with each other. You show them the book and relate what happened at the basement.\r\n          \r\nWith a sigh of relief that you made it back out in one piece, the researcher takes the book from your hands and starts skimming it. Her eyes go wide open.\r\n\r\n\"Th-this is...\", she begins saying. \"This is incredible! This book describes a ton of ideas and plans we could use to improve the school, in a way we haven't thought of before!\"`,\r\n          )\r\n          .addOption(\r\n            \"Continue\",\r\n            buildEventMessage(\r\n              \"ancient_headmaster_event_5\",\r\n              \"History of a Magical School\",\r\n            )\r\n              .setSimpleDescription(\r\n                `\"The one catch, is that all of these require a strange material, the substance we call Monstium.\" She stops and looks at you. \"You have been saving it, haven't you?\"\r\n              \r\nYou nod, and ask for the book back. She gives it to you. \"I'm looking forward to see what we can do next!\", she exclaims.\r\n\r\n**You have unlocked the \"Upgrades\" feature! Spend accumulated :monstium: to improve various aspects of the game until retirement. You can access this feature from the left-side menu.**`,\r\n              )\r\n              .build(),\r\n            setFlag(\"upgrades_unlocked\"),\r\n          )\r\n          .build(),\r\n      )\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst headmasterDefeatedEvent = createGameEvent(\r\n  \"ancient_headmaster_event_2\",\r\n  postHeadmasterEventMessage,\r\n  [],\r\n  setFlag(\"headmaster_event_2_triggered\"),\r\n);\r\n\r\nexport default new AncientHeadmaster();\r\n","import { generateSpeckForState } from \"../../../items/other/crystals/Crystals\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport {\r\n  pushToMessageLog,\r\n  standardEnemyAttackEffect,\r\n  startExploration,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass RedSlime extends Enemy {\r\n  getId(): string {\r\n    return \"redSlime\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Red Slime\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./redSlime.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 250,\r\n      defense: 6,\r\n      attack: 20,\r\n      attackDelay: 2.25,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const runAwayChance = 0.05;\r\n    if (Math.random() < runAwayChance) {\r\n      return {\r\n        name: \"Flee\",\r\n        delay: this.getAttackDelay(state) * 3,\r\n        transform: (state) => {\r\n          state = startExploration(state);\r\n          state = pushToMessageLog(\r\n            state,\r\n            `The ${this.getName()} has run away...`,\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    const fastAttackChance = 0.35;\r\n    if (Math.random() < fastAttackChance) {\r\n      return {\r\n        name: \"Fast Attack\",\r\n        delay: this.getAttackDelay(state) * 0.25,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 160;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 18;\r\n  }\r\n\r\n  getItemsAwarded(state: PlayerContextState) {\r\n    return [\r\n      { itemId: \"medicinalHerb\", chance: 0.3, amount: 1 },\r\n      {\r\n        itemId: generateSpeckForState(state).getId(),\r\n        chance: 0.015,\r\n        amount: 1,\r\n      },\r\n      { itemId: \"goldNugget\", chance: 0.004, amount: 1 },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new RedSlime();\r\n","import { generateSpeckForState } from \"../../../items/other/crystals/Crystals\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass Zombie extends Enemy {\r\n  getId(): string {\r\n    return \"zombie\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Zombie\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./zombie.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 330,\r\n      defense: 0,\r\n      attack: 34,\r\n      attackDelay: 5.0,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 130;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 18;\r\n  }\r\n\r\n  getItemsAwarded(state: PlayerContextState) {\r\n    return [\r\n      { itemId: generateSpeckForState(state).getId(), chance: 0.01, amount: 1 },\r\n      { itemId: \"goldNugget\", chance: 0.005, amount: 1 },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new Zombie();\r\n","import { buildEventMessage } from \"../../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../../events/Events\";\r\nimport { createGameEvent } from \"../../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { addContextListener } from \"../../../PlayerContextListeners\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport AncientHeadmaster from \"../../enemies/schoolbasement/AncientHeadmaster\";\r\nimport AngrySheep from \"../../enemies/schoolbasement/AngrySheep\";\r\nimport RedSlime from \"../../enemies/schoolbasement/RedSlime\";\r\nimport Zombie from \"../../enemies/schoolbasement/Zombie\";\r\nimport { DungeonFloor, encounterEnemy } from \"../DungeonFloor\";\r\n\r\nclass SchoolBasementB3 extends DungeonFloor {\r\n  getId(): string {\r\n    return \"schoolBasementB3\";\r\n  }\r\n\r\n  getFloorName(): string {\r\n    return \"School Basement B3\";\r\n  }\r\n\r\n  getBoss(): Enemy {\r\n    return AncientHeadmaster;\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return hasFlag(state, \"school_basement_b3_unlocked\");\r\n  }\r\n\r\n  getBreedingLevel(): number {\r\n    return 11;\r\n  }\r\n\r\n  getExplorationPossibilities(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        weight: 60,\r\n        transforms: encounterEnemy(AngrySheep),\r\n      },\r\n      {\r\n        weight: 80,\r\n        transforms: encounterEnemy(Zombie),\r\n      },\r\n      {\r\n        weight: 40,\r\n        transforms: encounterEnemy(RedSlime),\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nconst schoolBasementB3 = new SchoolBasementB3();\r\n\r\nconst headmasterEventMessage = buildEventMessage(\r\n  \"ancient_headmaster_event_1\",\r\n  \"The End of the Basement\",\r\n)\r\n  .setSimpleDescription(\r\n    `You have been going deeper and deeper into the basement and it has become more dangerous as you delve into it.\r\n    \r\nThere is one last room you haven't checked. It's very well decorated, with golden patterns lining the door. You have a terrible feeling that something powerful lies beyond that door.\r\n\r\n**You have unlocked the boss fight for School Basement B3!**`,\r\n  )\r\n  .build();\r\n\r\nconst thirdFloorBossUnlockedEvent = createGameEvent(\r\n  \"ancient_headmaster_event_1\",\r\n  headmasterEventMessage,\r\n  [],\r\n  setFlag(\"headmaster_event_1_triggered\"),\r\n);\r\n\r\naddContextListener(\r\n  \"HeadmasterB3SchoolBasementUnlocker\",\r\n  (oldState, newState) => {\r\n    if (\r\n      !hasFlag(newState, \"headmaster_event_1_triggered\") &&\r\n      schoolBasementB3.canFightBoss(newState)\r\n    ) {\r\n      return triggerEvent(thirdFloorBossUnlockedEvent);\r\n    }\r\n  },\r\n);\r\n\r\nexport default schoolBasementB3 as SchoolBasementB3;\r\n","import { hasFlag } from \"../../../Flags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport AngrySheep from \"../../enemies/schoolbasement/AngrySheep\";\r\nimport BasementBat from \"../../enemies/schoolbasement/BasementBat\";\r\nimport LittleDevil from \"../../enemies/schoolbasement/LittleDevil\";\r\nimport Mouse from \"../../enemies/schoolbasement/Mouse\";\r\nimport Slime from \"../../enemies/schoolbasement/Slime\";\r\nimport { DungeonFloor, encounterEnemy } from \"../DungeonFloor\";\r\nimport SchoolBasementB3 from \"./SchoolBasementB3\";\r\n\r\nclass SchoolBasementB2 extends DungeonFloor {\r\n  getId(): string {\r\n    return \"schoolBasementB2\";\r\n  }\r\n\r\n  getFloorName(): string {\r\n    return \"School Basement B2\";\r\n  }\r\n\r\n  getBoss(): Enemy {\r\n    return LittleDevil;\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return hasFlag(state, \"school_basement_b2_unlocked\");\r\n  }\r\n\r\n  getBreedingLevel(): number {\r\n    return 7;\r\n  }\r\n\r\n  getNextFloor(): DungeonFloor {\r\n    return SchoolBasementB3;\r\n  }\r\n\r\n  getExplorationPossibilities(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        weight: 20,\r\n        transforms: encounterEnemy(Mouse),\r\n      },\r\n      {\r\n        weight: 80,\r\n        transforms: encounterEnemy(BasementBat),\r\n      },\r\n      {\r\n        weight: 60,\r\n        transforms: encounterEnemy(Slime),\r\n      },\r\n      {\r\n        weight: 60,\r\n        transforms: encounterEnemy(AngrySheep),\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new SchoolBasementB2();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport BasementBat from \"../../enemies/schoolbasement/BasementBat\";\r\nimport Mouse from \"../../enemies/schoolbasement/Mouse\";\r\nimport Skeleton from \"../../enemies/schoolbasement/Skeleton\";\r\nimport { DungeonFloor, encounterEnemy } from \"../DungeonFloor\";\r\nimport SchoolBasementB2 from \"./SchoolBasementB2\";\r\n\r\nclass SchoolBasementB1 extends DungeonFloor {\r\n  getId(): string {\r\n    return \"schoolBasementB1\";\r\n  }\r\n\r\n  getFloorName(): string {\r\n    return \"School Basement B1\";\r\n  }\r\n\r\n  getBoss(): Enemy {\r\n    return Skeleton;\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return true;\r\n  }\r\n\r\n  getBreedingLevel(): number {\r\n    return 2;\r\n  }\r\n\r\n  getExplorationPossibilities(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        weight: 100,\r\n        transforms: encounterEnemy(Mouse),\r\n      },\r\n      {\r\n        weight: 40,\r\n        transforms: encounterEnemy(BasementBat),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getNextFloor() {\r\n    return SchoolBasementB2;\r\n  }\r\n}\r\n\r\nexport default new SchoolBasementB1();\r\n","import SchoolBasementB1 from \"../../exploration/dungeons/schoolbasement/SchoolBasementB1\";\r\nimport { getSuccessfulExplorationsForFloor } from \"../../exploration/Exploration\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport {\r\n  getUnlockedSchools,\r\n  School,\r\n  unlockSchool,\r\n} from \"../../spells/ElementsAndSchools\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\"evocation_intro_1\", \"(Storyline) Evocation\")\r\n  .setSimpleDescription(\r\n    `As you continue fighting the animals that infest the school basement, you get a sudden realization. What if you actually used magic to fight back? You give it a try, and are easily able to fell one of those mice that pester you as you look around the basement.\r\n    \r\nThat was definitely powerful! You can't wait to go back and ask your researcher to start studying this. This is an entirely new school of magic of its own.\r\n\r\n**You have completed the \"Evocation\" storyline and have permanently unlocked the Evocation school! You may now do research on Evocation, which will let you learn damaging combat spells. This will persist even after restarting the game!**`,\r\n  )\r\n  .build();\r\n\r\nconst evocationEvent = createGameEvent(\r\n  \"evocation_intro\",\r\n  message,\r\n  [EventTag.STORYLINE],\r\n  unlockSchool(School.Evocation),\r\n);\r\n\r\naddContextListener(\"EvocationIntro\", (oldState, newState) => {\r\n  if (\r\n    !getUnlockedSchools(newState).includes(School.Evocation) &&\r\n    getSuccessfulExplorationsForFloor(newState, SchoolBasementB1.getId()) >= 10\r\n  ) {\r\n    return triggerEvent(evocationEvent);\r\n  }\r\n});\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"Evocation\",\r\n    2010,\r\n    (state) => getUnlockedSchools(state).includes(School.Evocation),\r\n    (state) => getUnlockedSchools(state).includes(School.Evocation),\r\n    \"Defeat 10 monsters in School Basement B1\",\r\n    \"Evocation school unlocked\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nexport default evocationEvent;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../Flags\";\r\nimport { isCraftingUnlocked } from \"../../items/Items\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { getSchoolLevel, School } from \"../../spells/ElementsAndSchools\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\r\n  \"headmasters_staff_1\",\r\n  \"(Storyline) The Headmaster's Staff\",\r\n)\r\n  .setSimpleDescription(\r\n    `The researcher and the apprentice approach you. \"We've been thinking\", starts saying the researcher. \"You are the renowned headmaster of this institution, but you certainly don't look the part. You are missing a staff!\", she exclaims. The apprentice nods in agreement.\r\n    \r\n\"We can craft now. We should try our best to build an emblematic item for you. You deserve this!\", she continues.\r\n\r\n\"...Actually,\" interrupts the apprentice, \"we cannot craft this on our own. It seems ironic, but you should definitely craft yourself a staff. I-it is painful for me to say, but a headmaster without a staff... is... somewhat uninspiring.\"`,\r\n  )\r\n  .addOption(\r\n    \"Craft a Headmaster's Staff (1500 Mana, 3500 Wood, Requires Conjuration Lv8)\",\r\n    buildEventMessage(\r\n      \"headmasters_staff_2\",\r\n      \"(Storyline) The Headmaster's Staff\",\r\n    )\r\n      .setSimpleDescription(\r\n        `You put together the staff and infuse it with a lot of mana. The apprentice and researcher watch you in awe. You produce a Headmaster's Staff!\r\n\r\n...Or is it? It still looks just like a normal magic staff.\r\n\r\nYour researcher cheers you on. \"You should enchant it!\", she says. \"I'm sure it will be great once you do!\"`,\r\n      )\r\n      .addOption(\r\n        \"Enchant the Headmaster's Staff (1700 Mana, Requires Enchantment Lv9)\",\r\n        buildEventMessage(\r\n          \"headmasters_staff_3\",\r\n          \"(Storyline) The Headmaster's Staff\",\r\n        )\r\n          .setSimpleDescription(\r\n            `You pool together even more mana. The staff begins to shine! You feel the magical energies starting to roar. The apprentice jumps back as you cast the spell.\r\n            \r\nThe researcher keeps cheering. \"This is working!\", she screams with excitement. \"Just a little more!\"`,\r\n          )\r\n          .addOption(\r\n            \"Enchant the Headmaster's Staff (1900 Mana, Requires Enchantment Lv10)\",\r\n            buildEventMessage(\r\n              \"headmasters_staff_4\",\r\n              \"(Storyline) The Headmaster's Staff\",\r\n            )\r\n              .setSimpleDescription(\r\n                `This time, you focus deeply. You pool a ton of magical energy, and with one swift movement, you enchant the staff.\r\n\r\nA flash of light emanates from the staff for a split second and brightens the room! The staff glows brightly, starts rattling, then it gently begins floating towards you! The researcher and apprentice both look at it, with their mouths wide open.\r\n\r\nYou grip the staff... and somehow the power vanishes, without a trace?`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                buildEventMessage(\r\n                  \"headmasters_staff_5\",\r\n                  \"(Storyline) The Headmaster's Staff\",\r\n                )\r\n                  .setSimpleDescription(\r\n                    `You are confused. You leave the room, without saying anything to the researcher and the apprentice, and go back to your personal chamber. You put away the staff and look at it...\r\n                    \r\n*You are not worthy. You will never be worthy.* The voice resonates through your insides, but you don't know where it's coming from... Somehow, you got the feeling the staff *is* magically enchanted, but why can't you unlock its powers?\r\n\r\nYou decide to store it. Maybe a successor would be able to use it...\r\n\r\n**You have completed \"The Headmaster's Staff\" storyline! You will permanently be four times more efficient when manually gathering in future runs (after restarting the game).**`,\r\n                  )\r\n                  .build(),\r\n              )\r\n              .build(),\r\n            (state) => {\r\n              state = grantResource(Resource.Mana, -1900)(state);\r\n              state = setGlobalFlagForNextRun(\"headmasters_staff_completed\")(\r\n                state,\r\n              );\r\n              return state;\r\n            },\r\n            undefined,\r\n            (state) =>\r\n              getResourceAmount(state, Resource.Mana) >= 1900 &&\r\n              getSchoolLevel(state, School.Enchantment) >= 10,\r\n          )\r\n          .addOption(\"Maybe later\")\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Mana, -1700)(state);\r\n          return state;\r\n        },\r\n        undefined,\r\n        (state) =>\r\n          getResourceAmount(state, Resource.Mana) >= 1700 &&\r\n          getSchoolLevel(state, School.Enchantment) >= 9,\r\n      )\r\n      .addOption(\"Maybe later\")\r\n      .build(),\r\n    (state) => {\r\n      state = grantResource(Resource.Mana, -1500)(state);\r\n      state = grantResource(Resource.Wood, -3500)(state);\r\n      return state;\r\n    },\r\n    undefined,\r\n    (state) =>\r\n      getResourceAmount(state, Resource.Mana) >= 1500 &&\r\n      getResourceAmount(state, Resource.Wood) >= 3500 &&\r\n      getSchoolLevel(state, School.Conjuration) >= 8,\r\n  )\r\n  .addOption(\"Maybe later\")\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"headmasters_staff\",\r\n  message,\r\n  [EventTag.STORYLINE],\r\n  setFlag(\"headmasters_staff_triggered\"),\r\n);\r\n\r\nregisterRandomEventTrigger(\r\n  event,\r\n  20,\r\n  true,\r\n  (state) =>\r\n    isCraftingUnlocked(state) &&\r\n    !hasFlag(state, \"headmasters_staff_triggered\") &&\r\n    !hasGlobalFlag(state, \"headmasters_staff_completed\"),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ManualGathering]],\r\n  \"HeadmastersStaff\",\r\n  TransformationType.Multiplier,\r\n  (state) => (hasGlobalFlag(state, \"headmasters_staff_completed\") ? 4.0 : 1.0),\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Headmaster's Staff\",\r\n    1020,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"headmasters_staff_completed\"),\r\n    (state) => hasGlobalFlag(state, \"headmasters_staff_completed\"),\r\n    \"There's a chance of this happening randomly if you have unlocked your inventory...\",\r\n    \"Manual gathering 4x more effective\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nexport default event;\r\n","import { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport lumberYard from \"../../buildings/campus/LumberYard\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../Flags\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nconst lumberingExpertiseEventBuilder = buildEvent(\r\n  \"lumbering_expertise\",\r\n  \"(Storyline) Lumbering Expertise\",\r\n  [EventTag.STORYLINE],\r\n);\r\nlumberingExpertiseEventBuilder\r\n  .setOnTrigger(setFlag(\"lumbering_expertise_triggered\"))\r\n  .createMessage()\r\n  .setSimpleDescription(\r\n    `As you observe your collection of Lumber Yards produce quite a lot of wood, you start thinking about their inner workings. Should you place a blade here, or perhaps enchant this other thing?\r\n    \r\nYou lose yourself in thought, but then you happen to see the very first one you built, and... you have a realization. You have a great idea on how to build them so that they work much better! But it's too late... they are already built. It would be pretty much impossible to apply the improvements now.\r\n\r\nYou decide to search for your researcher...`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    { transform: setGlobalFlagForNextRun(\"lumbering_expertise_completed\") },\r\n    lumberingExpertiseEventBuilder.createMessage()\r\n      .setSimpleDescription(`When you find her and tell her about your thoughts, she is visibly excited and urges you to write down your thoughts. \"It might be too late now, but it will not be too late for others who come after us!\", she exclaims.\r\n\r\nYou take her up on her offer, and put some effort into documenting your thoughts. Will someone really benefit from this...? Your researcher seems to be sure that someone will, even if you'll never end up seeing it...\r\n\r\n**You have completed the \"Lumbering Expertise\" Storyline! In future runs, Lumber Yards will be three times as effective!**`),\r\n  );\r\n\r\nconst lumberingExpertiseEvent = lumberingExpertiseEventBuilder.build();\r\n\r\naddContextListener(\"LumberingExpertise\", (oldState, newState) => {\r\n  if (\r\n    !hasGlobalFlagIncludingNextRun(newState, \"lumbering_expertise_completed\") &&\r\n    !hasFlag(newState, \"lumbering_expertise_triggered\") &&\r\n    getBuildingAmount(newState, lumberYard) >= 20\r\n  ) {\r\n    return triggerEvent(lumberingExpertiseEvent);\r\n  }\r\n});\r\n\r\nregisterTransformation(\r\n  [[Resource.Wood, lumberYard.getName(), TransformationTags.Production]],\r\n  \"LumberingExpertise\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasGlobalFlag(state, \"lumbering_expertise_completed\") ? 3.0 : 1.0,\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"Lumbering Expertise\",\r\n    2050,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"lumbering_expertise_completed\"),\r\n    (state) => hasGlobalFlag(state, \"lumbering_expertise_completed\"),\r\n    \"Build at least 20 Lumber Yards\",\r\n    \"3x:wood: production from Lumber Yards\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nexport default lumberingExpertiseEvent;\r\n","import { ItemBase } from \"../Item\";\r\n\r\nclass BatWing extends ItemBase {\r\n  getId(): string {\r\n    return \"batWing\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./batWing.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Bat Wing\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"The clipped wing of a bat that you felled.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 36;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new BatWing();\r\n","import { ItemBase } from \"../Item\";\r\n\r\nclass RatTail extends ItemBase {\r\n  getId(): string {\r\n    return \"ratTail\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./ratTail.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Mouse Tail\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"The tail of a mouse that you have slayed. Useful in Alchemy.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 24;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new RatTail();\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport SchoolBasementB1 from \"../../exploration/dungeons/schoolbasement/SchoolBasementB1\";\r\nimport SchoolBasementB2 from \"../../exploration/dungeons/schoolbasement/SchoolBasementB2\";\r\nimport SchoolBasementB3 from \"../../exploration/dungeons/schoolbasement/SchoolBasementB3\";\r\nimport {\r\n  getCurrentDungeonFloor,\r\n  getExplorationStatus,\r\n} from \"../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../Flags\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../items/Inventory\";\r\nimport { isCraftingUnlocked, isInventoryUnlocked } from \"../../items/Items\";\r\nimport BatWing from \"../../items/other/BatWing\";\r\nimport RatTail from \"../../items/other/RatTail\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst finalMessage = buildEventMessage(\r\n  \"magic_library_final\",\r\n  \"(Storyline) The Magic Library\",\r\n)\r\n  .setSimpleDescription(\r\n    `You follow the librarian to one of the furthest shelves in the room. He points to a section of the bookshelf.\r\n\r\n\"These are my most valuable books. Choose one. Choose carefully - the old headmaster enchanted those books, so that the rest will vanish if you take one.\"`,\r\n  )\r\n  .addOption(\r\n    \"Take the Blue Tome\",\r\n    buildEventMessage(\"magic_library_f1\", \"(Storyline) The Magic Library\")\r\n      .setSimpleDescription(\r\n        `You take the Blue Tome from the shelf. The librarian bows at you deeply. \"It was a pleasure to meet you, and to know that my library is now alive again.\" With a swoosh, he vanishes. You look back at the shelf where the tome was at and notice it is now empty.\r\n      \r\nYou pass the tome to your researcher, who opens it and looks at it for a while, but she seems troubled.\r\n\r\n\"This book is way too advanced\", she says. \"It would probably take us a *lifetime* to understand what it says!\"\r\n\r\nYou try to argue back with her, but you quickly realize she's being genuine.`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"magic_library_f1_2\", \"(Storyline) The Magic Library\")\r\n          .setSimpleDescription(\r\n            `You sigh, disappointed by the turn of events. However, you still ask her to look into the matter. You are hopeful that even if it doesn't benefit you, it'll serve a good purpose for someone else in the future...\r\n          \r\n**You have completed \"The Magic Library\" storyline by selecting the Blue Tome! In future runs, the knowledge from the tome will let you start the game with the Inventory, Crafting and Exploration features unlocked from the beginning!**`,\r\n          )\r\n          .build(),\r\n        setGlobalFlagForNextRun(\"magic_library_blue_tome_taken\"),\r\n      )\r\n      .build(),\r\n    undefined,\r\n    (state, params) => !hasGlobalFlag(state, \"magic_library_blue_tome_taken\"),\r\n  )\r\n  .addOption(\r\n    \"Take the Yellow Tome\",\r\n    buildEventMessage(\"magic_library_f2\", \"(Storyline) The Magic Library\")\r\n      .setSimpleDescription(\r\n        `You take the Yellow Tome from the shelf. The librarian bows at you deeply. \"It was a pleasure to meet you, and to know that my library is now alive again.\" With a swoosh, he vanishes. You look back at the shelf where the tome was at and notice it is now empty.\r\n      \r\nYou pass the tome to your researcher, who opens it and looks at it for a while, but she seems troubled.\r\n\r\n\"This book is way too advanced\", she says. \"It would probably take us a *lifetime* to understand what it says!\"\r\n\r\nYou try to argue back with her, but you quickly realize she's being genuine.`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"magic_library_f2_2\", \"(Storyline) The Magic Library\")\r\n          .setSimpleDescription(\r\n            `You sigh, disappointed by the turn of events. However, you still ask her to look into the matter. You are hopeful that even if it doesn't benefit you, it'll serve a good purpose for someone else in the future...\r\n          \r\n**You have completed \"The Magic Library\" storyline by selecting the Yellow Tome! In future runs, the knowledge from the tome will let you be more efficient with storage, allowing you to store 20% more of every resource except :mana:Mana!**`,\r\n          )\r\n          .build(),\r\n        setGlobalFlagForNextRun(\"magic_library_yellow_tome_taken\"),\r\n      )\r\n      .build(),\r\n    undefined,\r\n    (state, params) => !hasGlobalFlag(state, \"magic_library_yellow_tome_taken\"),\r\n  )\r\n  .addOption(\r\n    \"Take the Green Tome\",\r\n    buildEventMessage(\"magic_library_f3\", \"(Storyline) The Magic Library\")\r\n      .setSimpleDescription(\r\n        `You take the Green Tome from the shelf. The librarian bows at you deeply. \"It was a pleasure to meet you, and to know that my library is now alive again.\" With a swoosh, he vanishes. You look back at the shelf where the tome was at and notice it is now empty.\r\n      \r\nYou pass the tome to your researcher, who opens it and looks at it for a while, but she seems troubled.\r\n\r\n\"This book is way too advanced\", she says. \"It would probably take us a *lifetime* to understand what it says!\"\r\n\r\nYou try to argue back with her, but you quickly realize she's being genuine.`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"magic_library_f3_2\", \"(Storyline) The Magic Library\")\r\n          .setSimpleDescription(\r\n            `You sigh, disappointed by the turn of events. However, you still ask her to look into the matter. You are hopeful that even if it doesn't benefit you, it'll serve a good purpose for someone else in the future...\r\n          \r\n**You have completed \"The Magic Library\" storyline by selecting the Green Tome! In future runs, the knowledge from the tome will let you explore twice as fast!**`,\r\n          )\r\n          .build(),\r\n        setGlobalFlagForNextRun(\"magic_library_green_tome_taken\"),\r\n      )\r\n      .build(),\r\n    undefined,\r\n    (state, params) => !hasGlobalFlag(state, \"magic_library_green_tome_taken\"),\r\n  )\r\n  .addOption(\r\n    \"Take the Red Tome\",\r\n    buildEventMessage(\"magic_library_f4\", \"(Storyline) The Magic Library\")\r\n      .setSimpleDescription(\r\n        `You take the Red Tome from the shelf. The librarian bows at you deeply. \"It was a pleasure to meet you, and to know that my library is now alive again.\" With a swoosh, he vanishes. You look back at the shelf where the tome was at and notice it is now empty.\r\n      \r\nYou pass the tome to your researcher, who opens it and looks at it for a while, but she seems troubled.\r\n\r\n\"This book is way too advanced\", she says. \"It would probably take us a *lifetime* to understand what it says!\"\r\n\r\nYou try to argue back with her, but you quickly realize she's being genuine.`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        buildEventMessage(\"magic_library_f4_2\", \"(Storyline) The Magic Library\")\r\n          .setSimpleDescription(\r\n            `You sigh, disappointed by the turn of events. However, you still ask her to look into the matter. You are hopeful that even if it doesn't benefit you, it'll serve a good purpose for someone else in the future...\r\n          \r\n**You have completed \"The Magic Library\" storyline by selecting the Red Tome! In future runs, the knowledge from the tome will grant you a permanent +100 Max:hp: and +0.1:hpRegen:/sec boost!**`,\r\n          )\r\n          .build(),\r\n        setGlobalFlagForNextRun(\"magic_library_red_tome_taken\"),\r\n      )\r\n      .build(),\r\n    undefined,\r\n    (state, params) => !hasGlobalFlag(state, \"magic_library_red_tome_taken\"),\r\n  )\r\n  .build();\r\n\r\nconst message = buildEventMessage(\r\n  \"magic_library_1\",\r\n  \"(Storyline) The Magic Library\",\r\n)\r\n  .setSimpleDescription(\r\n    `As you delve through the corridors of the school basement, you encounter a large room, full of old books. Shelves and shelves of books are assembled in rows across the room.\r\n    \r\nYou walk between the shelves. The dust is thick. You take a peek at one of the books, but can't immediately deduce what it's about.\r\n\r\nYou decide to fetch your researcher and come back; you quickly head out of the basement, interrupt her, and ask her to come see the room.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"magic_library_2\", \"(Storyline) The Magic Library\")\r\n      .setSimpleDescription(\r\n        `The researcher looks around the room, with clear interest.\r\n      \r\n\"This looks like it used to be the library of the school, a very long time ago\", she says. \"There could be a ton of knowledge here, but we need to fix this place. There is just too much dust for this to be any useful.\"\r\n\r\nYou ready yourself to clear the dust with magic...`,\r\n      )\r\n      .addOption(\r\n        \"Conjure a breeze to clear the dust (2400 Mana)\",\r\n        buildEventMessage(\"magic_library_3\", \"(Storyline) The Magic Library\")\r\n          .setSimpleDescription(\r\n            `\"A lot better!\", you hear as you finish the spell, although it sounded quite odd. You turn to face your researcher and see her expression, but you don't find her looking at you. She is instead looking directly at a corner. You follow her gaze...\r\n          \r\n...and you find *a ghost, staring right back at you and moving towards you and your researcher!*`,\r\n          )\r\n          .addOption(\r\n            \"Continue\",\r\n            buildEventMessage(\r\n              \"magic_library_4\",\r\n              \"(Storyline) The Magic Library\",\r\n            )\r\n              .setSimpleDescription(\r\n                `You instinctively spring into a defensive position and ready yourself for combat. The ghost, however, stops in its tracks.\r\n              \r\nThe ghastly figure in front of you looks like the white silhouette of an old man, with a top hat, a mustache and a coat. It (he?) looks at you curiously.\r\n\r\n\"Please, I mean no harm!\", he begins to say. You realize the voice you had heard was actually from this ghost. You try to calm yourself down.`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                buildEventMessage(\r\n                  \"magic_library_5\",\r\n                  \"(Storyline) The Magic Library\",\r\n                )\r\n                  .setSimpleDescription(\r\n                    `\"Let me introduce myself\", he says. \"I am the librarian of this magic school. Or at least, I *used to be,* back when I still had a body...\" He sighs, with a sad expression on his ghastly face.\r\n                  \r\n\"After the headmaster passed away, the place fell into disrepair. The students left. There was nobody left. But I couldn't bring myself to leave. I spent more than half of my life taking care of this very room. And now... this place is so full of monsters.\"`,\r\n                  )\r\n                  .addOption(\r\n                    \"Continue\",\r\n                    buildEventMessage(\r\n                      \"magic_library_6\",\r\n                      \"(Storyline) The Magic Library\",\r\n                    )\r\n                      .setSimpleDescription(\r\n                        `\"Can you do me a favor?\", he asks you. \"It would make me feel at peace to be able to see this place restored to how it was supposed to be. If you can exterminate the mice and bats around here, and bring me their tails and wings as proof, I can show you where some of the most powerful books are in this room.\"\r\n                        \r\n\"100 Mouse Tails and 100 Bat Wings should do the trick.\"`,\r\n                      )\r\n                      .addOption(\r\n                        \"Hand over the tails and wings\",\r\n                        buildEventMessage(\r\n                          \"magic_library_7\",\r\n                          \"(Storyline) The Magic Library\",\r\n                        )\r\n                          .setSimpleDescription(\r\n                            `You hand over the materials. It sure took you a while to accumulate those...\r\n                          \r\nThe librarian ghost seems quite happy.\r\n\r\n\"This is... I feel I can finally rest in peace now\", he exclaims. You hear his voice breaking a bit as he says that.\r\n\r\n\"Very well. Follow me.\"`,\r\n                          )\r\n                          .addOption(\"Continue\", finalMessage)\r\n                          .build(),\r\n                        (state) => {\r\n                          state = removeFromInventoryWithAnyParams(\r\n                            RatTail,\r\n                            100,\r\n                            state,\r\n                          );\r\n                          state = removeFromInventoryWithAnyParams(\r\n                            BatWing,\r\n                            100,\r\n                            state,\r\n                          );\r\n                          return state;\r\n                        },\r\n                        undefined,\r\n                        (state, params) =>\r\n                          getTotalAmountOfItem(RatTail, state) >= 100 &&\r\n                          getTotalAmountOfItem(BatWing, state) >= 100,\r\n                      )\r\n                      .addOption(\"Maybe later\")\r\n                      .build(),\r\n                  )\r\n                  .build(),\r\n              )\r\n              .build(),\r\n          )\r\n          .build(),\r\n        grantResource(Resource.Mana, -2400),\r\n        undefined,\r\n        (state, params) => getResourceAmount(state, Resource.Mana) >= 2400,\r\n      )\r\n      .addOption(\"Maybe later\")\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst magicLibraryEvent = createGameEvent(\r\n  \"magic_library\",\r\n  message,\r\n  [EventTag.STORYLINE],\r\n  setFlag(\"magic_library_event_triggered\"),\r\n);\r\n\r\n// ============== Blue tome ===============\r\n\r\naddContextListener(\"magic_library_blue_tome\", (oldState, newState) => {\r\n  if (\r\n    hasGlobalFlag(newState, \"magic_library_blue_tome_taken\") &&\r\n    (!hasFlag(newState, \"exploration_unlocked\") ||\r\n      !isInventoryUnlocked(newState) ||\r\n      !isCraftingUnlocked(newState))\r\n  ) {\r\n    return (state) => {\r\n      state = setFlag(\"exploration_unlocked\")(state);\r\n      state = setFlag(\"new_inventory_unlocked\")(state);\r\n      state = setFlag(\"crafting_unlocked\")(state);\r\n      return state;\r\n    };\r\n  }\r\n});\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Magic Library (Blue Tome)\",\r\n    2020,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"magic_library_blue_tome_taken\"),\r\n    (state) => hasGlobalFlag(state, \"magic_library_blue_tome_taken\"),\r\n    \"There's a chance of this happening randomly if you are exploring the School Basement...\",\r\n    \"Start game with Inventory, Crafting and Exploration unlocked\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ============== Yellow Tome ===============\r\n\r\nfor (let resource in Resource) {\r\n  if (resource != Resource.Mana) {\r\n    registerTransformation(\r\n      [[resource, TransformationTags.Cap]],\r\n      resource + \"MagicLibraryYellowTome\",\r\n      TransformationType.Multiplier,\r\n      (state) =>\r\n        hasGlobalFlag(state, \"magic_library_yellow_tome_taken\") ? 1.2 : 1.0,\r\n    );\r\n  }\r\n}\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Magic Library (Yellow Tome)\",\r\n    2021,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"magic_library_yellow_tome_taken\"),\r\n    (state) => hasGlobalFlag(state, \"magic_library_yellow_tome_taken\"),\r\n    \"There's a chance of this happening randomly if you are exploring the School Basement...\",\r\n    \"+20% max of every resource except :mana:Mana\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ============== Green Tome ===============\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  \"MagicLibraryGreenTomeExplorationDelay\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasGlobalFlag(state, \"magic_library_green_tome_taken\") ? 0.5 : 1.0,\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Magic Library (Green Tome)\",\r\n    2022,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"magic_library_green_tome_taken\"),\r\n    (state) => hasGlobalFlag(state, \"magic_library_green_tome_taken\"),\r\n    \"There's a chance of this happening randomly if you are exploring the School Basement...\",\r\n    \"-50% Exploration delay\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ============== Red Tome ===============\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.MaxHP]],\r\n  \"MagicLibraryRedTomeMaxHP\",\r\n  TransformationType.Addition,\r\n  (state) => (hasGlobalFlag(state, \"magic_library_red_tome_taken\") ? 100 : 0),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.HPRegen]],\r\n  \"MagicLibraryRedTomeHPRegen\",\r\n  TransformationType.Addition,\r\n  (state) => (hasGlobalFlag(state, \"magic_library_red_tome_taken\") ? 0.1 : 0),\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Magic Library (Red Tome)\",\r\n    2023,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"magic_library_red_tome_taken\"),\r\n    (state) => hasGlobalFlag(state, \"magic_library_red_tome_taken\"),\r\n    \"There's a chance of this happening randomly if you are exploring the School Basement...\",\r\n    \"+100 Max:hp:, +0.1:hpRegen:\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ====================\r\n\r\nregisterRandomEventTrigger(\r\n  magicLibraryEvent,\r\n  30,\r\n  true,\r\n  (state) =>\r\n    !hasFlag(state, \"magic_library_event_triggered\") &&\r\n    getExplorationStatus(state) != ExplorationStatus.None &&\r\n    [\r\n      SchoolBasementB1.getId(),\r\n      SchoolBasementB2.getId(),\r\n      SchoolBasementB3.getId(),\r\n    ].includes(getCurrentDungeonFloor(state).getId()) &&\r\n    (!hasGlobalFlag(state, \"magic_library_blue_tome_taken\") ||\r\n      !hasGlobalFlag(state, \"magic_library_yellow_tome_taken\") ||\r\n      !hasGlobalFlag(state, \"magic_library_green_tome_taken\") ||\r\n      !hasGlobalFlag(state, \"magic_library_red_tome_taken\")),\r\n);\r\n\r\nexport default magicLibraryEvent;\r\n","import {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../Flags\";\r\nimport { isCraftingUnlocked } from \"../../items/Items\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { getSchoolLevel, School } from \"../../spells/ElementsAndSchools\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nconst message = buildEventMessage(\"statue_1\", \"(Storyline) The Statue\")\r\n  .setSimpleDescription(\r\n    `You hear footsteps and turn around to see the researcher and the apprentice walking towards you.\r\n    \r\n\"Good morning!\", exclaims the researcher. \"We were thinking\", she continues, \"that we should build a statue in campus. It would serve as a landmark and a way to make our institution unique.\"\r\n\r\nYou think it could be a great idea, but you know you will need a lot of materials...`,\r\n  )\r\n  .addOption(\r\n    \"Build a statue (Requires Lv11 Conjuration, 7200 Stone, 800 Iron)\",\r\n    buildEventMessage(\"statue_2\", \"(Storyline) The Statue\")\r\n      .setSimpleDescription(\r\n        `You put together all the stones and the iron and ready yourself to cast a spell to shape the new statue. You decide to...`,\r\n      )\r\n      .addOption(\r\n        \"Build a statue of the researcher (2000 Mana)\",\r\n        buildEventMessage(\"statue_3_researcher\", \"(Storyline) The Statue\")\r\n          .setSimpleDescription(\r\n            `You shape the materials creating a splitting image of the researcher. She gasps, surprised, and blushes in embarrassment.\r\n          \r\n\"A statue of *myself*? Why?!\", she pouts. You explain to her that magical research is the cornerstone to any respectable school, and by building a statue of her, you honor and highlight this fact. She is unconvinced by your argument, but you know better.\r\n\r\n**You have completed \"The Statue\" storyline by building a statue of the researcher! In future runs, your researchers will be inspired by this statue and work 50% faster!**`,\r\n          )\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Mana, -2000)(state);\r\n          state = setGlobalFlagForNextRun(\"researcher_statue_built\")(state);\r\n          return state;\r\n        },\r\n        (state) => !hasGlobalFlag(state, \"researcher_statue_built\"),\r\n        (state) => getResourceAmount(state, Resource.Mana) >= 2000,\r\n      )\r\n      .addOption(\r\n        \"Build a statue of the apprentice (2000 Mana)\",\r\n        buildEventMessage(\"statue_3_apprentice\", \"(Storyline) The Statue\")\r\n          .setSimpleDescription(\r\n            `You shape the materials creating a splitting image of the apprentice. He stares at it with his mouth open; thankfully his newly built statue looks a lot more determined!\r\n          \r\n\"W-Wow\", he begins to say, but you can tell he is at a loss of words. Your decision, however, was very clear. Students are the soul of any school, and he was the very first one.\r\n\r\n**You have completed \"The Statue\" storyline by building a statue of the apprentice! In future runs, you will have an extra 2 apprentices right from when you unlock the feature, without the need to build housing!**`,\r\n          )\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Mana, -2000)(state);\r\n          state = setGlobalFlagForNextRun(\"apprentice_statue_built\")(state);\r\n          return state;\r\n        },\r\n        (state) => !hasGlobalFlag(state, \"apprentice_statue_built\"),\r\n        (state) => getResourceAmount(state, Resource.Mana) >= 2000,\r\n      )\r\n      .addOption(\r\n        \"Build a statue of yourself (2000 Mana)\",\r\n        buildEventMessage(\"statue_3_headmaster\", \"(Storyline) The Statue\")\r\n          .setSimpleDescription(\r\n            `You shape the materials creating a splitting image of yourself. You stare at it: it looks glorious and you feel proud of it.\r\n          \r\n\"Amazing\", says the researcher. \"This is the best way to honor our school - what can be better than a statue of our very leader?\" The apprentice bows deeply as a show of respect.\r\n\r\n**You have completed \"The Statue\" storyline by building a statue of yourself! In future runs, the statue's presence will grant you an extra +2:mana:/sec and +200 Max:mana:!**`,\r\n          )\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Mana, -2000)(state);\r\n          state = setGlobalFlagForNextRun(\"headmaster_statue_built\")(state);\r\n          return state;\r\n        },\r\n        (state) => !hasGlobalFlag(state, \"headmaster_statue_built\"),\r\n        (state) => getResourceAmount(state, Resource.Mana) >= 2000,\r\n      )\r\n      .build(),\r\n    (state) => {\r\n      state = grantResource(Resource.Stone, -7200)(state);\r\n      state = grantResource(Resource.Iron, -800)(state);\r\n      return state;\r\n    },\r\n    undefined,\r\n    (state) =>\r\n      getSchoolLevel(state, School.Conjuration) >= 11 &&\r\n      getResourceAmount(state, Resource.Stone) >= 7200 &&\r\n      getResourceAmount(state, Resource.Iron) >= 800,\r\n  )\r\n  .build();\r\n\r\nconst statueEvent = createGameEvent(\r\n  \"statue\",\r\n  message,\r\n  [EventTag.STORYLINE],\r\n  setFlag(\"statue_event_triggered\"),\r\n);\r\n\r\n// ============== Researcher statue ===============\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Research]],\r\n  \"ResearcherStatueResearch\",\r\n  TransformationType.Multiplier,\r\n  (state) => (hasGlobalFlag(state, \"researcher_statue_built\") ? 1.5 : 1.0),\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Statue (Researcher)\",\r\n    1030,\r\n    (state) => hasGlobalFlagIncludingNextRun(state, \"researcher_statue_built\"),\r\n    (state) => hasGlobalFlag(state, \"researcher_statue_built\"),\r\n    \"There's a chance of this happening randomly if your inventory is unlocked...\",\r\n    \"+50% Research speed\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ============== Apprentice statue ===============\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Apprentice]],\r\n  \"ApprenticeStatue\",\r\n  TransformationType.Addition,\r\n  (state) => (hasGlobalFlag(state, \"apprentice_statue_built\") ? 2 : 0),\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Statue (Apprentice)\",\r\n    1031,\r\n    (state) => hasGlobalFlagIncludingNextRun(state, \"apprentice_statue_built\"),\r\n    (state) => hasGlobalFlag(state, \"apprentice_statue_built\"),\r\n    \"There's a chance of this happening randomly if your inventory is unlocked...\",\r\n    \"Start runs with 2 extra apprentices\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ============== Headmaster statue ===============\r\n\r\n// This cap transformation does not need to recalculate caps since\r\n// it doesn't take effect until the game restarts\r\nregisterTransformation(\r\n  [[Resource.Mana, TransformationTags.Cap]],\r\n  \"HeadmasterStatue\",\r\n  TransformationType.Addition,\r\n  (state) => (hasGlobalFlag(state, \"headmaster_statue_built\") ? 200 : 0),\r\n);\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  if (!hasGlobalFlag(state, \"headmaster_statue_built\")) {\r\n    return {};\r\n  }\r\n  const manaPerSec = applyTransformations(\r\n    [Resource.Mana, TransformationTags.Production],\r\n    state,\r\n    2.0,\r\n  );\r\n  return { Mana: manaPerSec };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"TheStatueHeadmaster\", getResourcesPerSec),\r\n);\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Statue (Headmaster)\",\r\n    1032,\r\n    (state) => hasGlobalFlagIncludingNextRun(state, \"headmaster_statue_built\"),\r\n    (state) => hasGlobalFlag(state, \"headmaster_statue_built\"),\r\n    \"There's a chance of this happening randomly if your inventory is unlocked...\",\r\n    \"+200 Max:mana:, +2:mana:/sec\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\n// ====================\r\n\r\nregisterRandomEventTrigger(\r\n  statueEvent,\r\n  20,\r\n  true,\r\n  (state) =>\r\n    !hasFlag(state, \"statue_event_triggered\") &&\r\n    isCraftingUnlocked(state) &&\r\n    (!hasGlobalFlag(state, \"researcher_statue_built\") ||\r\n      !hasGlobalFlag(state, \"apprentice_statue_built\") ||\r\n      !hasGlobalFlag(state, \"headmaster_statue_built\")),\r\n);\r\n\r\nexport default statueEvent;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass TimeDilation extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Time Dilation\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Slow down the passage of time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      duration: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `Time moves at 0.5x speed for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 510;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 14,\r\n    };\r\n  }\r\n}\r\n\r\nconst timeDilation = new TimeDilation();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.GameSpeed]],\r\n  \"TimeDilationGameSpeed\",\r\n  TransformationType.Multiplier,\r\n  (state) => (hasTemporaryEffect(state, \"Time Dilation\") ? 0.5 : 1),\r\n);\r\n\r\nexport default timeDilation;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  hasGlobalFlagIncludingNextRun,\r\n  setFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../Flags\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport TimeDilation from \"../../spells/illusion/TimeDilation\";\r\nimport { Storyline, Storylines } from \"../../storylines/Storylines\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nconst timeRitualEventBuilder = buildEvent(\r\n  \"time_ritual\",\r\n  \"(Storyline) The Time Ritual\",\r\n  [EventTag.STORYLINE],\r\n);\r\n\r\ntimeRitualEventBuilder\r\n  .setOnTrigger(setFlag(\"time_ritual_triggered\"))\r\n  .createMessage()\r\n  .setSimpleDescription(\r\n    `As you look at the :timepiece:Time Pieces you have accumulated, your researcher and apprentice surprise you, holding a large scroll.\r\n  \r\n\"Those t-time pieces... they are the same, aren't they.\" The apprentice is looking at the scroll, pointing at a drawing of something on it.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    timeRitualEventBuilder\r\n      .createMessage()\r\n      .setSimpleDescription(\r\n        `\"Headmaster, we have found instructions for a strange ritual,\" says your researcher, looking at you intently. \"With enough mana and time pieces, it should be possible to bend time to our will.\"\r\n\r\nThe prospect is tempting. You lean over and look at the scroll - and you see there is not just one set of instructions, but five!.\r\n\r\nYou glance at your apprentice. You are going to need help with the ritual.`,\r\n      )\r\n      .addOption(\r\n        \"Continue\",\r\n        timeRitualEventBuilder\r\n          .createMessage()\r\n          .setSimpleDescription(`And then you decide to...`)\r\n          .addOption(\r\n            \"Do the ritual to hoard more time (2500 Mana, 25K Time Pieces)\",\r\n            {\r\n              transform: (state) => {\r\n                state = grantResource(Resource.Mana, -2500)(state);\r\n                state = grantResource(Resource.TimePieces, -25000)(state);\r\n                return state;\r\n              },\r\n              isEnabled: (state) =>\r\n                getResourceAmount(state, Resource.Mana) >= 2500 &&\r\n                getResourceAmount(state, Resource.TimePieces) >= 25000,\r\n              isVisible: (state) =>\r\n                !hasGlobalFlagIncludingNextRun(\r\n                  state,\r\n                  \"hoard_time_ritual_finished\",\r\n                ),\r\n            },\r\n            timeRitualEventBuilder\r\n              .createMessage()\r\n              .setSimpleDescription(\r\n                `You move to a large room while carrying a lot of Time Pieces, together with your apprentice and researcher. You place the Time Pieces in the middle of the room, and together with your apprentice, you start chanting.\r\n\r\nImages of an empty room fill your vision. Then a time piece appears and falls into the room. Then another one. Then two more. Then ten more. And more, and more. So many time pieces. They pile up in the center, reach the ceiling, but they continue to grow until the walls of the room. And they keep coming. You are trapped in between time pieces, and there is no escape. You feel your consciousness fading...`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                {\r\n                  transform: setGlobalFlagForNextRun(\r\n                    \"hoard_time_ritual_finished\",\r\n                  ),\r\n                },\r\n                timeRitualEventBuilder.createMessage()\r\n                  .setSimpleDescription(`When you come to, you are where you started, looking at your Time Pieces. Except there are no time pieces. You feel odd. You hear the researcher calling for you from behind, and turn around to see her and the apprentice calling you for supper, as if nothing had happened.\r\n\r\nDid the ritual work? You aren't sure, but something does seem different...\r\n\r\n**You have completed the \"The Time Ritual\" storyline! In future runs, you will be able to store 70K more :timepiece:Time Pieces!**`),\r\n              ),\r\n          )\r\n          .addOption(\r\n            \"Do the ritual to make time pass faster (3500 Mana, 25K Time Pieces)\",\r\n            {\r\n              transform: (state) => {\r\n                state = grantResource(Resource.Mana, -3500)(state);\r\n                state = grantResource(Resource.TimePieces, -25000)(state);\r\n                return state;\r\n              },\r\n              isEnabled: (state) =>\r\n                getResourceAmount(state, Resource.Mana) >= 3500 &&\r\n                getResourceAmount(state, Resource.TimePieces) >= 25000,\r\n              isVisible: (state) =>\r\n                !hasGlobalFlagIncludingNextRun(\r\n                  state,\r\n                  \"speed_up_time_ritual_finished\",\r\n                ),\r\n            },\r\n            timeRitualEventBuilder\r\n              .createMessage()\r\n              .setSimpleDescription(\r\n                `You move to a large room while carrying a lot of Time Pieces, together with your apprentice and researcher. You place the Time Pieces in the middle of the room, and together with your apprentice, you start chanting.\r\n\r\nImages of all the time you have spent at the campus flash before your eyes. They seem unnaturally sped up. They get more vivid, until you can no longer see anything else except them. They continue getting faster and faster and you start feeling overwhelmed. You feel your consciousness fading...`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                {\r\n                  transform: setGlobalFlagForNextRun(\r\n                    \"speed_up_time_ritual_finished\",\r\n                  ),\r\n                },\r\n                timeRitualEventBuilder.createMessage()\r\n                  .setSimpleDescription(`When you come to, you are where you started, looking at your Time Pieces. Except there are no time pieces. You feel odd. You hear the researcher calling for you from behind, and turn around to see her and the apprentice calling you for supper, as if nothing had happened.\r\n\r\nDid the ritual work? You aren't sure, but something does seem different...\r\n\r\n**You have completed the \"The Time Ritual\" storyline! In future runs, consuming :timepiece:Time Pieces will speed up the time by four times instead of by two times!**`),\r\n              ),\r\n          )\r\n          .addOption(\r\n            \"Do the ritual to make time pass slower (4500 Mana, 25K Time Pieces)\",\r\n            {\r\n              transform: (state) => {\r\n                state = grantResource(Resource.Mana, -4500)(state);\r\n                state = grantResource(Resource.TimePieces, -25000)(state);\r\n                return state;\r\n              },\r\n              isEnabled: (state) =>\r\n                getResourceAmount(state, Resource.Mana) >= 4500 &&\r\n                getResourceAmount(state, Resource.TimePieces) >= 25000,\r\n              isVisible: (state) =>\r\n                TimeDilation.isVisible(state) &&\r\n                !hasGlobalFlagIncludingNextRun(\r\n                  state,\r\n                  \"time_dilation_time_ritual_finished\",\r\n                ),\r\n            },\r\n            timeRitualEventBuilder\r\n              .createMessage()\r\n              .setSimpleDescription(\r\n                `You move to a large room while carrying a lot of Time Pieces, together with your apprentice and researcher. You place the Time Pieces in the middle of the room, and together with your apprentice, you start chanting.\r\n\r\nImages of all the time you have spent at the campus flash before your eyes. Or at least, that's what it seems, because movement seems to be in comically slow motion. You stare at your researcher in those images, who is introducing herself when you first met her, but her mouth moves ever so slow, and it becomes slower and slower. Unbearably slow. You feel your consciousness fading...`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                {\r\n                  transform: setGlobalFlagForNextRun(\r\n                    \"time_dilation_time_ritual_finished\",\r\n                  ),\r\n                },\r\n                timeRitualEventBuilder.createMessage()\r\n                  .setSimpleDescription(`When you come to, you are where you started, looking at your Time Pieces. Except there are no time pieces. You feel odd. You hear the researcher calling for you from behind, and turn around to see her and the apprentice calling you for supper, as if nothing had happened.\r\n\r\nDid the ritual work? You aren't sure, but something does seem different...\r\n\r\n**You have completed the \"The Time Ritual\" storyline! In future runs, the \"Time Dilation\" spell will cost 0:mana:!**`),\r\n              ),\r\n          )\r\n          .addOption(\r\n            \"Do the ritual to increase Time Piece income (6000 Mana, 25K Time Pieces)\",\r\n            {\r\n              transform: (state) => {\r\n                state = grantResource(Resource.Mana, -6000)(state);\r\n                state = grantResource(Resource.TimePieces, -25000)(state);\r\n                return state;\r\n              },\r\n              isEnabled: (state) =>\r\n                getResourceAmount(state, Resource.Mana) >= 6000 &&\r\n                getResourceAmount(state, Resource.TimePieces) >= 25000,\r\n              isVisible: (state) =>\r\n                !hasGlobalFlagIncludingNextRun(\r\n                  state,\r\n                  \"income_time_ritual_finished\",\r\n                ),\r\n            },\r\n            timeRitualEventBuilder\r\n              .createMessage()\r\n              .setSimpleDescription(\r\n                `You move to a large room while carrying a lot of Time Pieces, together with your apprentice and researcher. You place the Time Pieces in the middle of the room, and together with your apprentice, you start chanting.\r\n\r\nIn an odd vision, you see yourself next to a stream of Time Pieces flowing next to you. The stream suddenly begins speeding up. More and more Time Pieces are flowing. The stream floods and grazes your feet. But it doesn't stop, it keeps rising, to your ankles, then to your knees, and then to your waist. You can't move. It covers your shoulders. And your entire head. You feel your consciousness fading...`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                {\r\n                  transform: setGlobalFlagForNextRun(\r\n                    \"income_time_ritual_finished\",\r\n                  ),\r\n                },\r\n                timeRitualEventBuilder.createMessage()\r\n                  .setSimpleDescription(`When you come to, you are where you started, looking at your Time Pieces. Except there are no time pieces. You feel odd. You hear the researcher calling for you from behind, and turn around to see her and the apprentice calling you for supper, as if nothing had happened.\r\n\r\nDid the ritual work? You aren't sure, but something does seem different...\r\n\r\n**You have completed the \"The Time Ritual\" storyline! In future runs, your Time Piece income from time spent offline will increase by 50%!**`),\r\n              ),\r\n          )\r\n          .addOption(\r\n            \"Do the ritual to convert into more research (9000 Mana, 25K Time Pieces)\",\r\n            {\r\n              transform: (state) => {\r\n                state = grantResource(Resource.Mana, -9000)(state);\r\n                state = grantResource(Resource.TimePieces, -25000)(state);\r\n                return state;\r\n              },\r\n              isEnabled: (state) =>\r\n                getResourceAmount(state, Resource.Mana) >= 9000 &&\r\n                getResourceAmount(state, Resource.TimePieces) >= 25000,\r\n              isVisible: (state) =>\r\n                !hasGlobalFlagIncludingNextRun(\r\n                  state,\r\n                  \"research_time_ritual_finished\",\r\n                ),\r\n            },\r\n            timeRitualEventBuilder\r\n              .createMessage()\r\n              .setSimpleDescription(\r\n                `You move to a large room while carrying a lot of Time Pieces, together with your apprentice and researcher. You place the Time Pieces in the middle of the room, and together with your apprentice, you start chanting.\r\n\r\nA room full of books. You spot your researcher. She seems to be frantically doing a lot of work. Faster and faster. The books pile up in front of her as she moves and reads in impossible speeds. It continues to get faster and the books continue to pile up until you can no longer see. You feel your consciousness fading...`,\r\n              )\r\n              .addOption(\r\n                \"Continue\",\r\n                {\r\n                  transform: setGlobalFlagForNextRun(\r\n                    \"research_time_ritual_finished\",\r\n                  ),\r\n                },\r\n                timeRitualEventBuilder.createMessage()\r\n                  .setSimpleDescription(`When you come to, you are where you started, looking at your Time Pieces. Except there are no time pieces. You feel odd. You hear the researcher calling for you from behind, and turn around to see her and the apprentice calling you for supper, as if nothing had happened.\r\n\r\nDid the ritual work? You aren't sure, but something does seem different...\r\n\r\n**You have completed the \"The Time Ritual\" storyline! In future runs, the \"Use Time Pieces\" button under \"Research\" will give 50% more experience!**`),\r\n              ),\r\n          ),\r\n      ),\r\n  );\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Time Ritual (Hoard Time)\",\r\n    1050,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"hoard_time_ritual_finished\"),\r\n    (state) => hasGlobalFlag(state, \"hoard_time_ritual_finished\"),\r\n    \"There's a chance of this happening randomly if you have unlocked Research, Apprentices, and you have some :timepiece:...\",\r\n    \"+70K Max:timepiece:\",\r\n    (state) => true,\r\n  ),\r\n);\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Time Ritual (Speed Up)\",\r\n    1051,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"speed_up_time_ritual_finished\"),\r\n    (state) => hasGlobalFlag(state, \"speed_up_time_ritual_finished\"),\r\n    \"There's a chance of this happening randomly if you have unlocked Research, Apprentices, and you have some :timepiece:...\",\r\n    \"Time Piece speedup is twice as fast and consumes twice the :timepiece:\",\r\n    (state) => true,\r\n  ),\r\n);\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Time Ritual (Slow Down)\",\r\n    1052,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(\r\n        state,\r\n        \"time_dilation_time_ritual_finished\",\r\n      ),\r\n    (state) => hasGlobalFlag(state, \"time_dilation_time_ritual_finished\"),\r\n    \"There's a chance of this happening randomly if you have unlocked Research, Apprentices, and you have some :timepiece:...\",\r\n    '\"Time Dilation\" spell costs 0:mana:',\r\n    (state) => true,\r\n  ),\r\n);\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Time Ritual (Income)\",\r\n    1053,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"income_time_ritual_finished\"),\r\n    (state) => hasGlobalFlag(state, \"income_time_ritual_finished\"),\r\n    \"There's a chance of this happening randomly if you have unlocked Research, Apprentices, and you have some :timepiece:...\",\r\n    \"+50%:timepiece: gain while offline\",\r\n    (state) => true,\r\n  ),\r\n);\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Time Ritual (Research)\",\r\n    1054,\r\n    (state) =>\r\n      hasGlobalFlagIncludingNextRun(state, \"research_time_ritual_finished\"),\r\n    (state) => hasGlobalFlag(state, \"research_time_ritual_finished\"),\r\n    \"There's a chance of this happening randomly if you have unlocked Research, Apprentices, and you have some :timepiece:...\",\r\n    '\"Use Time Pieces (Research)\" gives +50% Exp',\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[Resource.TimePieces, TransformationTags.Cap]],\r\n  \"TimeRitualCap\",\r\n  TransformationType.Addition,\r\n  (state) => (hasGlobalFlag(state, \"hoard_time_ritual_finished\") ? 70000 : 0),\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.GameSpeed]],\r\n  \"TimeRitualGameSpeed\",\r\n  TransformationType.Multiplier,\r\n  (state, params) =>\r\n    hasGlobalFlag(state, \"speed_up_time_ritual_finished\") &&\r\n    hasFlag(state, \"time_piece_speedup_enabled\") &&\r\n    !params?.isWarp\r\n      ? 2\r\n      : 1,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TimeDilation.getName(), TransformationTags.Cost]],\r\n  \"TimeRitualDilationCost\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasGlobalFlag(state, \"time_dilation_time_ritual_finished\") ? 0 : 1.0,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.TimePiecePerResearch]],\r\n  \"TimeRitualResearchCost\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasGlobalFlag(state, \"research_time_ritual_finished\") ? 1 / 1.5 : 1.0,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.OfflineTimePieceGain, Resource.TimePieces]],\r\n  \"TimeRitualIncome\",\r\n  TransformationType.Multiplier,\r\n  (state) => (hasGlobalFlag(state, \"income_time_ritual_finished\") ? 1.5 : 1.0),\r\n);\r\n\r\nconst timeRitualEvent = timeRitualEventBuilder.build();\r\n\r\nregisterRandomEventTrigger(\r\n  timeRitualEvent,\r\n  15,\r\n  true,\r\n  (state) =>\r\n    !hasFlag(state, \"time_ritual_triggered\") &&\r\n    getResourceAmount(state, Resource.TimePieces) > 0 &&\r\n    hasFlag(state, \"research_unlocked\") &&\r\n    hasFlag(state, \"autocast_unlocked\") &&\r\n    (!hasGlobalFlag(state, \"hoard_time_ritual_finished\") ||\r\n      !hasGlobalFlag(state, \"speed_up_time_ritual_finished\") ||\r\n      !hasGlobalFlag(state, \"research_time_ritual_finished\") ||\r\n      !hasGlobalFlag(state, \"income_time_ritual_finished\") ||\r\n      (!hasGlobalFlag(state, \"time_dilation_time_ritual_finished\") &&\r\n        TimeDilation.isVisible(state))),\r\n);\r\n\r\nexport default timeRitualEvent;\r\n","import { loadRandomEventTriggers } from \"./autorandom/RandomEventTrigger\";\r\nimport AutocastIntro from \"./campus/AutocastIntro\";\r\nimport CraftingIntro from \"./campus/CraftingIntro\";\r\nimport ExplorationIntro from \"./campus/ExplorationIntro\";\r\nimport { loadLevelUpEvents } from \"./campus/LevelUp\";\r\nimport { loadRandomOneTimeCampusEvents } from \"./campus/RandomOneTimeCampusEvents\";\r\nimport { loadRepeatableCampusEvents } from \"./campus/RepeatableCampusEvents\";\r\nimport Researcher from \"./campus/Researcher\";\r\nimport ShopIntro from \"./campus/ShopIntro\";\r\nimport { registerGameEvent } from \"./Events\";\r\nimport alchemyLabEvent from \"./storyline/AlchemyLab\";\r\nimport evocationEvent from \"./storyline/EvocationIntro\";\r\nimport HeadmastersStaff from \"./storyline/HeadmastersStaff\";\r\nimport lumberingExpertiseEvent from \"./storyline/LumberingExpertise\";\r\nimport magicLibraryEvent from \"./storyline/MagicLibrary\";\r\nimport memoryChamberEvent from \"./storyline/MemoryChamber\";\r\nimport statueEvent from \"./storyline/Statue\";\r\nimport timeRitualEvent from \"./storyline/TimeRitual\";\r\n\r\nexport function loadGameEventsDemo() {\r\n  registerGameEvent(Researcher);\r\n  registerGameEvent(AutocastIntro);\r\n  registerGameEvent(CraftingIntro);\r\n  registerGameEvent(ShopIntro);\r\n  registerGameEvent(ExplorationIntro);\r\n  registerGameEvent(HeadmastersStaff);\r\n  registerGameEvent(alchemyLabEvent);\r\n  registerGameEvent(statueEvent);\r\n  registerGameEvent(evocationEvent);\r\n  registerGameEvent(magicLibraryEvent);\r\n  registerGameEvent(lumberingExpertiseEvent);\r\n  registerGameEvent(timeRitualEvent);\r\n  registerGameEvent(memoryChamberEvent);\r\n  loadLevelUpEvents();\r\n  loadRandomEventTriggers();\r\n  loadRepeatableCampusEvents();\r\n  loadRandomOneTimeCampusEvents();\r\n}\r\n","import { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport ManaSpout from \"../../buildings/campus/ManaSpout\";\r\nimport Vault from \"../../buildings/campus/Vault\";\r\nimport Warehouse from \"../../buildings/campus/Warehouse\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport {\r\n  getIncrementalExpRequiredForLevel,\r\n  getSchoolLevel,\r\n  getUnlockedSchools,\r\n  grantSchoolExp,\r\n  School,\r\n  SCHOOL_LEVEL_CAP,\r\n} from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEvent, buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nexport function loadRepeatableCampusEvents() {\r\n  const staffEventBuilder = buildEvent(\r\n    \"RandomSpoutEvents_Staff\",\r\n    \"Found a staff!\",\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  );\r\n  staffEventBuilder\r\n    .createMessage()\r\n    .setSimpleDescription(\"A staff was found on the ground.\")\r\n    .addOption(\r\n      \"Pick up\",\r\n      { transform: grantResource(Resource.Mana, -100) },\r\n      staffEventBuilder.createMessage().setSimpleDescription(\r\n        `You pick up the staff. It's cursed! You feel your mana getting drained.\r\n          \r\n**You lose 100:mana:!**`,\r\n      ),\r\n    )\r\n    .addOption(\r\n      \"Destroy\",\r\n      staffEventBuilder\r\n        .createMessage()\r\n        .setSimpleDescription(\r\n          \"You destroy the staff. Wonder what it could have been...\",\r\n        ),\r\n    );\r\n\r\n  const staffEvent = staffEventBuilder.build();\r\n\r\n  registerRandomEventTrigger(staffEvent, 2, false);\r\n\r\n  // ==============\r\n\r\n  const boostedSpoutsEvent = createGameEvent(\r\n    \"RandomSpoutEvents_2\",\r\n    buildEventMessage(\"RandomSpoutEvents_2\", \"The Mana Spouts are Bursting!\")\r\n      .setSimpleDescription(\r\n        \"It looks like our mana spouts are suddenly bursting with activity and producing Mana twice as fast!\",\r\n      )\r\n      .build(),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n    grantTemporaryEffect(\r\n      \"Mana Spouts bursting with activity!\",\r\n      \"Mana Spouts bursting with activity!\",\r\n      180,\r\n      {\r\n        mode: \"add\",\r\n      },\r\n    ),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    boostedSpoutsEvent,\r\n    100,\r\n    false,\r\n    (state) => getBuildingAmount(state, ManaSpout) > 0,\r\n  );\r\n\r\n  registerTransformation(\r\n    [[ManaSpout.getName(), TransformationTags.Production]],\r\n    \"ManaSpoutsBurstingWithActivity\",\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, \"Mana Spouts bursting with activity!\") ? 2 : 1,\r\n  );\r\n\r\n  // ==============\r\n\r\n  const banditsEvent = createGameEvent(\r\n    \"RandomSpoutEvents_3\",\r\n    buildEventMessage(\"RandomSpoutEvents_3\", \"Bandits!\")\r\n      .setSimpleDescription(\r\n        `*Oh no!* It looks like bandits have looted one of your vaults! You notice a significant amount of coins missing. Frustrated, you hope to catch them next time...\r\n        \r\n**You lose {coins}:coins:!**`,\r\n      )\r\n      .build(),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n    (state: PlayerContextState, params) => {\r\n      return grantResource(Resource.Coins, -params.coins)(state);\r\n    },\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    banditsEvent,\r\n    100,\r\n    false,\r\n    (state) => getBuildingAmount(state, Vault) > 0,\r\n    (state) => ({\r\n      coins: Math.floor(\r\n        getResourceAmount(state, Resource.Coins) * (0.15 + Math.random() * 0.2),\r\n      ),\r\n    }),\r\n  );\r\n\r\n  for (let school in School) {\r\n    const schoolOldBook = createGameEvent(\r\n      \"RandomSpoutEvents_8_\" + school,\r\n      buildEventMessage(\r\n        \"RandomSpoutEvents_8_\" + school,\r\n        \"Old Book of \" + school,\r\n      )\r\n        .setSimpleDescription(\r\n          `One of your researchers seems to have come across a dusty book. The book seems to contain knowledge about ${school}. Thrilled, your researchers get back to work with the new knowledge.\r\n  \r\n  **You gain {exp} ${school} experience!**`,\r\n        )\r\n        .build(),\r\n      [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n      (state, params) => grantSchoolExp(school as School, params.exp)(state),\r\n    );\r\n\r\n    registerRandomEventTrigger(\r\n      schoolOldBook,\r\n      30,\r\n      false,\r\n      (state) =>\r\n        hasFlag(state, \"research_unlocked\") &&\r\n        getUnlockedSchools(state).includes(school as School) &&\r\n        getSchoolLevel(state, school as School) < SCHOOL_LEVEL_CAP,\r\n      (state) => ({\r\n        exp: Math.floor(\r\n          (0.6 + Math.random() * 0.2) *\r\n            getIncrementalExpRequiredForLevel(\r\n              state,\r\n              getSchoolLevel(state, school as School) + 1,\r\n              school as School,\r\n            ) *\r\n            Math.pow(0.96, getSchoolLevel(state, school as School)),\r\n        ),\r\n      }),\r\n    );\r\n  }\r\n\r\n  const randomWoodEvent = createGameEvent(\r\n    \"RandomSpoutEvents_9\",\r\n    buildEventMessage(\"RandomSpoutEvents_9\", \"A Pile of Wood\")\r\n      .setSimpleDescription(\r\n        `You stumble upon a pile of wood as you walk through campus. You are not sure why it's there, but it seems misplaced. You decide to take it.\r\n        \r\n**You obtain {amount}:wood:!**`,\r\n      )\r\n      .build(),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n    (state, params) => grantResource(Resource.Wood, params.amount)(state),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    randomWoodEvent,\r\n    100,\r\n    false,\r\n    (state) =>\r\n      hasFlag(state, \"gather_wood_unlocked\") &&\r\n      getBuildingAmount(state, Warehouse) > 0,\r\n    (state) => ({\r\n      amount: Math.floor(\r\n        350 + (getResourceCap(state, Resource.Wood) - 350) * Math.random(),\r\n      ),\r\n    }),\r\n  );\r\n\r\n  const randomStoneEvent = createGameEvent(\r\n    \"RandomSpoutEvents_10\",\r\n    buildEventMessage(\"RandomSpoutEvents_10\", \"A Pile of Stone\")\r\n      .setSimpleDescription(\r\n        `You find a pile of stone as you walk through campus. You are not sure why it's there, but it seems misplaced. You decide to take it.\r\n        \r\n**You obtain {amount}:stone:!**`,\r\n      )\r\n      .build(),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n    (state, params) => grantResource(Resource.Stone, params.amount)(state),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    randomStoneEvent,\r\n    100,\r\n    false,\r\n    (state) => getBuildingAmount(state, Warehouse) > 0,\r\n    (state) => ({\r\n      amount: Math.floor(\r\n        350 + (getResourceCap(state, Resource.Stone) - 350) * Math.random(),\r\n      ),\r\n    }),\r\n  );\r\n\r\n  const travelingMerchantBuysStoneMessage = buildEventMessage(\r\n    \"RandomSpoutEvents_11\",\r\n    \"A traveling merchant appeared\",\r\n  )\r\n    .setSimpleDescription(\r\n      `A traveling merchant crosses the campus doors and waves at you.\r\n\r\n\"Hello!\", he exclaims. \"I'm interested in buying {stoneCost} stones. I'm willing to pay {coinCost} coins for them. Would you like to sell me some?\"`,\r\n    )\r\n    .addOption(\r\n      \"Sell an illusion of {stoneCost} stones (150 Mana)\",\r\n      buildEventMessage(\r\n        \"RandomSpoutEvents_11_1\",\r\n        \"A traveling merchant appeared\",\r\n      )\r\n        .setSimpleDescription(\r\n          `You use your Illusion knowledge to trick the merchant and give him {stoneCost} fake stones. The merchant falls for it!\r\n          \r\n\"Here are your coins\", he says. \"Nice doing business with you!\". He walks away afterwards.\r\n\r\nHe will be in for a surprise later, but you are happy you got the coins!`,\r\n        )\r\n        .build(),\r\n      (state, params) => {\r\n        state = grantResource(Resource.Mana, -150)(state);\r\n        state = grantResource(Resource.Coins, params.coinCost)(state);\r\n        return state;\r\n      },\r\n      (state) => getSchoolLevel(state, School.Illusion) >= 3,\r\n      (state) => getResourceAmount(state, Resource.Mana) >= 150,\r\n    )\r\n    .addOption(\r\n      \"Sell {stoneCost} stones\",\r\n      buildEventMessage(\r\n        \"RandomSpoutEvents_11_2\",\r\n        \"A traveling merchant appeared\",\r\n      )\r\n        .setSimpleDescription(\r\n          `You give the merchant the {stoneCost} stones. He happily takes them.\r\n          \r\n\"Here are your coins\", he says. \"Nice doing business with you!\". He walks away afterwards.`,\r\n        )\r\n        .build(),\r\n      (state, params) => {\r\n        state = grantResource(Resource.Stone, -params.stoneCost)(state);\r\n        state = grantResource(Resource.Coins, params.coinCost)(state);\r\n        return state;\r\n      },\r\n      undefined,\r\n      (state, params) =>\r\n        getResourceAmount(state, Resource.Stone) >= params.stoneCost,\r\n    )\r\n    .addOption(\r\n      \"Decline\",\r\n      buildEventMessage(\r\n        \"RandomSpoutEvents_11_3\",\r\n        \"A traveling merchant appeared\",\r\n      )\r\n        .setSimpleDescription(\r\n          \"You decline the transaction. These stones seem more valuable to you. The traveling merchant acknowledges you, and decides to leave.\",\r\n        )\r\n        .build(),\r\n    )\r\n    .build();\r\n\r\n  const travelingMerchantBuysStoneEvent = createGameEvent(\r\n    \"RandomSpoutEvents_11\",\r\n    travelingMerchantBuysStoneMessage,\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    travelingMerchantBuysStoneEvent,\r\n    50,\r\n    false,\r\n    (state) => getResourceCap(state, Resource.Stone) >= 600,\r\n    (state) => {\r\n      const stoneCost =\r\n        300 +\r\n        Math.floor(\r\n          (getResourceCap(state, Resource.Stone) - 300) * Math.random(),\r\n        );\r\n      const coinCost = Math.floor((stoneCost * 1250) / 300);\r\n      return { stoneCost, coinCost };\r\n    },\r\n  );\r\n\r\n  const boostedResearchEvent = createGameEvent(\r\n    \"RandomSpoutEvents_12\",\r\n    buildEventMessage(\"RandomSpoutEvents_12\", \"Your Researchers are Inspired!\")\r\n      .setSimpleDescription(\r\n        \"Your researchers seem to have a burst of inspiration! They will be studying twice as hard for a short time.\",\r\n      )\r\n      .build(),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n    grantTemporaryEffect(\r\n      \"Your researchers are inspired!\",\r\n      \"Your researchers are inspired!\",\r\n      300,\r\n      {\r\n        mode: \"add\",\r\n      },\r\n    ),\r\n  );\r\n\r\n  registerRandomEventTrigger(boostedResearchEvent, 100, false, (state) =>\r\n    hasFlag(state, \"research_unlocked\"),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Research]],\r\n    \"ResearcherInspiration\",\r\n    TransformationType.Multiplier,\r\n    (state, params) =>\r\n      hasTemporaryEffect(state, \"Your researchers are inspired!\") ? 2.0 : 1.0,\r\n  );\r\n}\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { clearFlag, hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { getSchoolLevel, School } from \"../../spells/ElementsAndSchools\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEventMessage } from \"../EventMessageBuilder\";\r\nimport { createGameEvent } from \"../SimpleGameEvent\";\r\n\r\nexport function loadRandomOneTimeCampusEvents() {\r\n  const crystalBallMessage = buildEventMessage(\r\n    \"RandomOneTimeCampusEvents_1\",\r\n    \"Divine my Future\",\r\n  )\r\n    .setSimpleDescription(\r\n      `A young woman, dressed as a wizarding apprentice shows up on campus with a crystal ball.\r\n    \r\n\"Headmaster, your magical prowess is known far and wide\", she says. \"Crystal balls are important magical artifacts that can be used to know the future. I would like to know my own destiny, but my skill is not strong enough. Perhaps you can help me...?\" she asks, looking at you.`,\r\n    )\r\n    .addOption(\r\n      \"Pretend to read the future (300 Mana)\",\r\n      buildEventMessage(\"RandomOneTimeCampusEvents_1_1\", \"Divine my Future\")\r\n        .setSimpleDescription(\r\n          `You utilize your Illusion prowess to create a fuzzy image inside the crystal ball. You pretend to be focused in divining the future as the apprentice watches in awe.\r\n          \r\nAs the illusion runs its course, you appear to exit your trance. You tell the woman that she is destined to learn magic and refine her powers at your institution. As much of a lie as it was, she falls for it.\r\n\r\n\"Wow... so that's really my destiny\", she says, while lost in thought. \"Then I should comply. ...I-I know that if you go against destiny, you will never be able to be successful... ...Can I stay here and study magic?\", she asks. You nod.\r\n\r\n**You have obtained an extra apprentice!**`,\r\n        )\r\n        .build(),\r\n      (state) => {\r\n        state = grantResource(Resource.Mana, -300)(state);\r\n        state = setFlag(\"RandomOneTimeCampusEvents_1_ResearcherJoined\")(state);\r\n        return state;\r\n      },\r\n      (state) => getSchoolLevel(state, School.Illusion) >= 3,\r\n      (state) => getResourceAmount(state, Resource.Mana) >= 300,\r\n    )\r\n    .addOption(\r\n      \"Decline\",\r\n      buildEventMessage(\"RandomOneTimeCampusEvents_1_2\", \"Divine my Future\")\r\n        .setSimpleDescription(\r\n          \"You decline her request. Sad, she thanks you, and leaves.\",\r\n        )\r\n        .build(),\r\n    )\r\n    .addOption(\"Maybe later\")\r\n    .build();\r\n\r\n  const crystalBallEvent = createGameEvent(\r\n    \"RandomOneTimeCampusEvents_1\",\r\n    crystalBallMessage,\r\n    [],\r\n    setFlag(\"RandomOneTimeCampusEvents_1_triggered\"),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Apprentice]],\r\n    \"RandomOneTimeCampusEvents_1_ApprenticeJoined\",\r\n    TransformationType.Addition,\r\n    (state) =>\r\n      hasFlag(state, \"RandomOneTimeCampusEvents_1_ResearcherJoined\") ? 1 : 0,\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    crystalBallEvent,\r\n    80,\r\n    false,\r\n    (state) =>\r\n      !hasFlag(state, \"RandomOneTimeCampusEvents_1_triggered\") &&\r\n      hasFlag(state, \"autocast_unlocked\"),\r\n  );\r\n\r\n  // ===============================\r\n\r\n  const boughtMessage = buildEventMessage(\r\n    \"RandomOneTimeCampusEvents_1_x_1\",\r\n    \"A traveling merchant appeared\",\r\n  )\r\n    .setSimpleDescription(\r\n      `\"Great doing business with you!\", he exclaims, taking your coins. Placing the pebble back inside the bag, he hands over the bag to you.\r\n      \r\n  This magical stone will come in handy!`,\r\n    )\r\n    .build();\r\n  const rejectMessage = buildEventMessage(\r\n    \"RandomOneTimeCampusEvents_1_x_2\",\r\n    \"A traveling merchant appeared\",\r\n  )\r\n    .setSimpleDescription(\r\n      `\"That's too bad\", he says, putting the stone back in the bag. \"Have a good day!\", he exclaims while turning back and leaving the campus.`,\r\n    )\r\n    .build();\r\n\r\n  const travelingMerchantWaterStoneMessage = buildEventMessage(\r\n    \"RandomOneTimeCampusEvents_2\",\r\n    \"A traveling merchant appeared\",\r\n  )\r\n    .setSimpleDescription(\r\n      `A traveling merchant appears at the campus gates and approaches you. \"Look at this\", he says, while getting a moist bag out from his pockets. He opens the bag, and shows you a small stone. You notice the stone seems to be emanating water.\r\n      \r\n\"This pebble magically produces water\", he says. \"This might be useful to you. It can be yours for 1500 coins. Would you like to purchase it?\"`,\r\n    )\r\n    .addOption(\r\n      \"Charm the merchant (400 Mana)\",\r\n      buildEventMessage(\r\n        \"RandomOneTimeCampusEvents_2_1\",\r\n        \"A traveling merchant appeared\",\r\n      )\r\n        .setSimpleDescription(\r\n          `You use your Illusion prowess to charm the merchant into thinking positively about you. Without noticing, he says: \"Actually... 1500 coins is quite a high price. I'd be happy to give you a *very* good deal. I can't go lower than 150 coins, though. Are you interested?`,\r\n        )\r\n        .addOption(\r\n          \"Buy the pebble\",\r\n          boughtMessage,\r\n          (state) => {\r\n            state = grantResource(Resource.Coins, -150)(state);\r\n            state = setFlag(\"RandomOneTimeCampusEvents_2_bought\")(state);\r\n            return state;\r\n          },\r\n          undefined,\r\n          (state) => getResourceAmount(state, Resource.Coins) >= 150,\r\n        )\r\n        .addOption(\r\n          \"Decline\",\r\n          rejectMessage,\r\n          clearFlag(\"RandomOneTimeCampusEvents_2_bought\"),\r\n        )\r\n        .addOption(\"Maybe later\")\r\n        .build(),\r\n      grantResource(Resource.Mana, -400),\r\n      (state) => getSchoolLevel(state, School.Illusion) >= 3,\r\n      (state) => getResourceAmount(state, Resource.Mana) >= 400,\r\n    )\r\n    .addOption(\r\n      \"Buy the pebble\",\r\n      boughtMessage,\r\n      (state) => {\r\n        state = grantResource(Resource.Coins, -1500)(state);\r\n        state = setFlag(\"RandomOneTimeCampusEvents_2_bought\")(state);\r\n        return state;\r\n      },\r\n      undefined,\r\n      (state) => getResourceAmount(state, Resource.Coins) >= 1500,\r\n    )\r\n    .addOption(\r\n      \"Decline\",\r\n      rejectMessage,\r\n      clearFlag(\"RandomOneTimeCampusEvents_2_bought\"),\r\n    )\r\n    .addOption(\"Maybe later\")\r\n    .build();\r\n\r\n  const travelingMerchantWaterStoneEvent = createGameEvent(\r\n    \"RandomOneTimeCampusEvents_2\",\r\n    travelingMerchantWaterStoneMessage,\r\n    [],\r\n    setFlag(\"RandomOneTimeCampusEvents_2_triggered\"),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    travelingMerchantWaterStoneEvent,\r\n    80,\r\n    false,\r\n    (state) => !hasFlag(state, \"RandomOneTimeCampusEvents_2_triggered\"),\r\n  );\r\n\r\n  function getResourcesPerSecPebble(\r\n    state: PlayerContextState,\r\n  ): Partial<Record<Resource, number>> {\r\n    if (hasFlag(state, \"RandomOneTimeCampusEvents_2_bought\")) {\r\n      return { Water: 1 };\r\n    }\r\n    return {};\r\n  }\r\n\r\n  IncomeOverTimeProducers.register(\r\n    new IncomeOverTimeProducer(\"WaterPebble\", getResourcesPerSecPebble),\r\n  );\r\n}\r\n","import { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\n\r\nclass WoolFarm extends Upgrade {\r\n  getName(): string {\r\n    return \"Wool Farm\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 600;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Adds a section of the school dedicated to raising sheep for wool.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return 'Unlocks \"Wool Farm\" exploration area';\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [];\r\n  }\r\n}\r\n\r\nconst woolFarm = new WoolFarm();\r\n\r\nexport default woolFarm;\r\n","import { Dungeons } from \"../../exploration/dungeons/Dungeons\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport woolFarm from \"./WoolFarm\";\r\n\r\nclass WoolFarmExpansion extends Upgrade {\r\n  getName(): string {\r\n    return \"Wool Farm Expansion\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 17500;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Expands the Wool Farm to be able to find and fight Enchanted Sheep.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return 'Unlocks \"Magical Pen\" exploration area inside \"Wool Farm\"';\r\n  }\r\n\r\n  isVisibleExtraChecks(state: PlayerContextState): boolean {\r\n    return Dungeons.getById(\"thunderTower\").isUnlocked(state);\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [woolFarm];\r\n  }\r\n}\r\n\r\nconst woolFarmExpansion = new WoolFarmExpansion();\r\n\r\nexport default woolFarmExpansion;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass EnchantedSheep extends Enemy {\r\n  getId(): string {\r\n    return \"enchantedSheep\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Enchanted Sheep\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./enchantedSheep.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1600,\r\n      defense: 48,\r\n      attack: 73,\r\n      attackDelay: 1.5,\r\n      dodgeChance: 0.1,\r\n      critChance: 0.02,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const doNothingChance = 0.01;\r\n    if (Math.random() < doNothingChance) {\r\n      return {\r\n        name: \"Hop Around\",\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state: PlayerContextState) => {\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    const chargeChance = 0.1;\r\n    if (Math.random() < chargeChance) {\r\n      return {\r\n        name: \"Charge!\",\r\n        delay: this.getAttackDelay(state) * 2,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(state, 1.0, this.getAttack(state) * 2),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 1660;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 136;\r\n  }\r\n\r\n  getItemsAwarded(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        itemId: \"manaRegenerationPotion\",\r\n        chance: 0.02,\r\n        amount: 1,\r\n      },\r\n      {\r\n        itemId: \"magicWool\",\r\n        chance: 1.0,\r\n        amount: 1,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new EnchantedSheep();\r\n","import { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport woolFarmExpansion from \"./WoolFarmExpansion\";\r\n\r\nclass WoolFarmRemake extends Upgrade {\r\n  getName(): string {\r\n    return \"Wool Farm Remake\";\r\n  }\r\n\r\n  isVisibleExtraChecks(state: PlayerContextState): boolean {\r\n    return hasFlag(state, \"wizards_arena_unlocked\");\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 1000000;\r\n  }\r\n\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      bookOfDivineKnowledge: 20,\r\n    };\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Expands the Wool Farm even more to be able to find and fight Black Sheep.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return 'Unlocks \"Special Stockade\" exploration area inside \"Wool Farm\"';\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [woolFarmExpansion];\r\n  }\r\n}\r\n\r\nconst woolFarmRemake = new WoolFarmRemake();\r\n\r\nexport default woolFarmRemake;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { addContextListener } from \"../../../PlayerContextListeners\";\r\nimport { grantTemporaryEffect } from \"../../../timetick/TemporaryEffects\";\r\nimport {\r\n  getExplorationStatus,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { ExplorationStatus } from \"../../ExplorationStatus\";\r\nimport { getCurrentEnemy } from \"../Enemies\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass BlackSheep extends Enemy {\r\n  getId(): string {\r\n    return \"blackSheep\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Black Sheep\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./blackSheep.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 60000,\r\n      defense: 350,\r\n      attack: 320,\r\n      attackDelay: 1.2,\r\n      dodgeChance: 0.1,\r\n      critChance: 0.02,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    const doNothingChance = 0.01;\r\n    if (Math.random() < doNothingChance) {\r\n      return {\r\n        name: \"Hop Around\",\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state: PlayerContextState) => {\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    const chargeChance = 0.3;\r\n    if (Math.random() < chargeChance) {\r\n      return {\r\n        name: \"Charge!\",\r\n        delay: this.getAttackDelay(state) * 2,\r\n        transform: (state: PlayerContextState) =>\r\n          standardEnemyAttackEffect(\r\n            state,\r\n            1.0,\r\n            this.getAttack(state) * 3,\r\n            this.getCriticalChance(state),\r\n          ),\r\n      };\r\n    }\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(\r\n          state,\r\n          1.0,\r\n          this.getAttack(state),\r\n          this.getCriticalChance(state),\r\n        ),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 99999;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 3500;\r\n  }\r\n\r\n  getItemsAwarded(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        itemId: \"blackWool\",\r\n        chance: 1.0,\r\n        amount: 1,\r\n      },\r\n      {\r\n        itemId: \"bookOfDivineKnowledge\",\r\n        chance: 0.5,\r\n        amount: 1,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\naddContextListener(\"blackSheepEncountered\", (oldState, newState) => {\r\n  if (\r\n    getExplorationStatus(oldState) != ExplorationStatus.Combat &&\r\n    getExplorationStatus(newState) == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(newState).getId() === \"blackSheep\"\r\n  ) {\r\n    return grantTemporaryEffect(\"EnemyStunPrevention\", \"Stun Protection\", 600, {\r\n      combatOnly: true,\r\n      isEnemyTemporaryEffect: true,\r\n    });\r\n  }\r\n});\r\n\r\nexport default new BlackSheep();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport woolFarmRemake from \"../../../upgrades/other/WoolFarmRemake\";\r\nimport BlackSheep from \"../../enemies/wizardsarena/BlackSheep\";\r\nimport { DungeonFloor, encounterEnemy } from \"../DungeonFloor\";\r\n\r\nclass TheSpecialStockade extends DungeonFloor {\r\n  getId(): string {\r\n    return \"theSpecialStockade\";\r\n  }\r\n\r\n  getFloorName(): string {\r\n    return \"The Special Stockade\";\r\n  }\r\n\r\n  getExplorationRequiredTimeSec(): number {\r\n    return 20.0;\r\n  }\r\n\r\n  _getExplorationSuccessesForBoss(): number {\r\n    return 0;\r\n  }\r\n\r\n  getBoss() {\r\n    return undefined;\r\n  }\r\n\r\n  getBreedingLevel(): number {\r\n    return 49;\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return woolFarmRemake.isPurchased(state);\r\n  }\r\n\r\n  getExplorationPossibilities(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        weight: 100,\r\n        transforms: encounterEnemy(BlackSheep),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getNextFloor() {\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport default new TheSpecialStockade();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport woolFarmExpansion from \"../../../upgrades/other/WoolFarmExpansion\";\r\nimport EnchantedSheep from \"../../enemies/thundertower/EnchantedSheep\";\r\nimport { DungeonFloor, encounterEnemy } from \"../DungeonFloor\";\r\nimport TheSpecialStockade from \"./TheSpecialStockade\";\r\n\r\nclass TheMagicalPen extends DungeonFloor {\r\n  getId(): string {\r\n    return \"theMagicalPen\";\r\n  }\r\n\r\n  getFloorName(): string {\r\n    return \"The Magical Pen\";\r\n  }\r\n\r\n  getExplorationRequiredTimeSec(): number {\r\n    return 10.0;\r\n  }\r\n\r\n  _getExplorationSuccessesForBoss(): number {\r\n    return 0;\r\n  }\r\n\r\n  getBoss() {\r\n    return undefined;\r\n  }\r\n\r\n  getBreedingLevel(): number {\r\n    return 28;\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return woolFarmExpansion.isPurchased(state);\r\n  }\r\n\r\n  getExplorationPossibilities(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        weight: 100,\r\n        transforms: encounterEnemy(EnchantedSheep),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getNextFloor() {\r\n    return TheSpecialStockade;\r\n  }\r\n}\r\n\r\nexport default new TheMagicalPen();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport AngrySheep from \"../../enemies/schoolbasement/AngrySheep\";\r\nimport { DungeonFloor, encounterEnemy } from \"../DungeonFloor\";\r\nimport TheMagicalPen from \"./TheMagicalPen\";\r\n\r\nclass TheCorral extends DungeonFloor {\r\n  getId(): string {\r\n    return \"theCorral\";\r\n  }\r\n\r\n  getFloorName(): string {\r\n    return \"The Corral\";\r\n  }\r\n\r\n  getExplorationRequiredTimeSec(): number {\r\n    return 6.0;\r\n  }\r\n\r\n  _getExplorationSuccessesForBoss(): number {\r\n    return 0;\r\n  }\r\n\r\n  getBoss() {\r\n    return undefined;\r\n  }\r\n\r\n  getBreedingLevel(): number {\r\n    return 8;\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return true;\r\n  }\r\n\r\n  getExplorationPossibilities(state: PlayerContextState) {\r\n    return [\r\n      {\r\n        weight: 100,\r\n        transforms: encounterEnemy(AngrySheep),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getNextFloor() {\r\n    return TheMagicalPen;\r\n  }\r\n}\r\n\r\nexport default new TheCorral();\r\n","import { DungeonFloor } from \"./DungeonFloor\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\n\r\nexport abstract class Dungeon implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getName(): string;\r\n  abstract getDungeonFloors(): DungeonFloor[];\r\n  abstract isUnlocked(state: PlayerContextState): boolean;\r\n}\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport woolFarm from \"../../../upgrades/other/WoolFarm\";\r\nimport { Dungeon } from \"../Dungeon\";\r\nimport { DungeonFloor } from \"../DungeonFloor\";\r\nimport TheCorral from \"./TheCorral\";\r\nimport TheMagicalPen from \"./TheMagicalPen\";\r\nimport TheSpecialStockade from \"./TheSpecialStockade\";\r\n\r\nclass WoolFarm extends Dungeon {\r\n  getId(): string {\r\n    return \"woolFarm\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Wool Farm\";\r\n  }\r\n\r\n  getDungeonFloors(): DungeonFloor[] {\r\n    return [TheCorral, TheMagicalPen, TheSpecialStockade];\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return woolFarm.isPurchased(state);\r\n  }\r\n}\r\n\r\nexport default new WoolFarm();\r\n","import { Dungeon } from \"../Dungeon\";\r\nimport { DungeonFloor } from \"../DungeonFloor\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport SchoolBasementB1 from \"./SchoolBasementB1\";\r\nimport SchoolBasementB2 from \"./SchoolBasementB2\";\r\nimport SchoolBasementB3 from \"./SchoolBasementB3\";\r\n\r\nclass SchoolBasement extends Dungeon {\r\n  getId(): string {\r\n    return \"schoolBasement\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"School Basement\";\r\n  }\r\n\r\n  getDungeonFloors(): DungeonFloor[] {\r\n    return [SchoolBasementB1, SchoolBasementB2, SchoolBasementB3];\r\n  }\r\n\r\n  isUnlocked(state: PlayerContextState): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport default new SchoolBasement();\r\n","import { registerRandomEventTrigger } from \"../../../events/autorandom/RandomEventTrigger\";\r\nimport { buildEventMessage } from \"../../../events/EventMessageBuilder\";\r\nimport { addOccurrenceToQueue, triggerEvent } from \"../../../events/Events\";\r\nimport { EventTag } from \"../../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../../events/SimpleGameEvent\";\r\nimport {\r\n  hasFlag,\r\n  hasGlobalFlag,\r\n  setFlag,\r\n  setGlobalFlag,\r\n  setGlobalFlagForNextRun,\r\n} from \"../../../Flags\";\r\nimport {\r\n  EXPLORATION_INITIAL_STATE,\r\n  PlayerContextState,\r\n} from \"../../../PlayerContext\";\r\nimport { addContextListener } from \"../../../PlayerContextListeners\";\r\nimport { getResourceAmount, Resource } from \"../../../Resources\";\r\nimport { Storyline, Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../../timetick/IncomeOverTime\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { addUICommand } from \"../../../UICommands\";\r\nimport SchoolBasementB2 from \"../../dungeons/schoolbasement/SchoolBasementB2\";\r\nimport SchoolBasementB3 from \"../../dungeons/schoolbasement/SchoolBasementB3\";\r\nimport {\r\n  getCurrentDungeonFloor,\r\n  getExplorationStatus,\r\n  standardEnemyAttackEffect,\r\n  startCombat,\r\n} from \"../../Exploration\";\r\nimport { ExplorationStatus } from \"../../ExplorationStatus\";\r\nimport { BattlerAction, BattlerStats, Enemy } from \"../Enemy\";\r\n\r\nclass Mimic extends Enemy {\r\n  getId(): string {\r\n    return \"mimic\";\r\n  }\r\n\r\n  getName(): string {\r\n    return \"Mimic\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./mimic.png\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1200,\r\n      defense: 40,\r\n      attack: 48,\r\n      attackDelay: 2.2,\r\n      dodgeChance: 0,\r\n      critChance: 0,\r\n    };\r\n  }\r\n\r\n  getNextAction(state: PlayerContextState): BattlerAction {\r\n    return {\r\n      name: \"Attack\",\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state: PlayerContextState) =>\r\n        standardEnemyAttackEffect(state, 1.0, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getCoinsAwarded(state: PlayerContextState): number {\r\n    return 1000000;\r\n  }\r\n\r\n  getMonstiumAwarded(state: PlayerContextState): number {\r\n    return 99;\r\n  }\r\n\r\n  getItemsAwarded() {\r\n    return [];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  onDeath(\r\n    state: PlayerContextState,\r\n    isFromCreatures: boolean,\r\n  ): PlayerContextState {\r\n    state = super.onDeath(state, isFromCreatures);\r\n\r\n    const mimicEventOccurrence = Object.values(state.eventOccurrences).find(\r\n      (eventOccurrence) => eventOccurrence.eventId == \"mimic_event_1\",\r\n    );\r\n    if (mimicEventOccurrence) {\r\n      state.eventOccurrences[\r\n        mimicEventOccurrence.eventOccurrenceId\r\n      ].currentMessageId = \"mimic_event_2\";\r\n      state.eventOccurrences[mimicEventOccurrence.eventOccurrenceId].timestamp =\r\n        Date.now();\r\n      state = addOccurrenceToQueue(mimicEventOccurrence.eventOccurrenceId)(\r\n        state,\r\n      );\r\n    }\r\n    return setGlobalFlagForNextRun(\"mimic_defeated\")(state);\r\n  }\r\n}\r\n\r\nconst mimic = new Mimic();\r\n\r\nconst mimicEventMessage = buildEventMessage(\r\n  \"mimic_event_1\",\r\n  \"(Storyline) The Mimic\",\r\n)\r\n  .setSimpleDescription(\r\n    `As you explore through the school basement, you find a peculiar treasure chest. You can see teeth coming out of the opening. It's a mimic!\r\n  \r\nYou know mimics are very dangerous monsters, but you are aware that they also hold amazing treasures inside...`,\r\n  )\r\n  .addOption(\"Fight the Mimic\", undefined, (state) => {\r\n    if (!state.exploration) {\r\n      state.exploration = EXPLORATION_INITIAL_STATE;\r\n    }\r\n    state.exploration.currentDungeonFloorId = SchoolBasementB2.getId();\r\n    state = addUICommand(state, \"goToExploration\");\r\n    state = addUICommand(state, \"closeAllMenus\");\r\n    state = addUICommand(state, \"closeEventOverlay\");\r\n    state = startCombat(mimic)(state);\r\n    return state;\r\n  })\r\n  .addOption(\"Maybe later\")\r\n  .build();\r\n\r\nconst postMimicFightMessage = buildEventMessage(\r\n  \"mimic_event_2\",\r\n  \"(Storyline) The Mimic\",\r\n)\r\n  .setSimpleDescription(\r\n    `You defeat the mimic with your overwhelming strength! You inspect its corpse and manage to loot a vast amount of coins!\r\n  \r\nHowever, before you can finish, the mimic suddenly jumps back and flees at an amazing speed. Your eyes can barely follow where it went! You decide pursuing is fruitless...\r\n\r\nMaybe you will encounter it some other time?`,\r\n  )\r\n  .build();\r\n\r\nconst mimicEvent1 = createGameEvent(\r\n  \"mimic_event_1\",\r\n  mimicEventMessage,\r\n  [EventTag.STORYLINE],\r\n  setFlag(\"mimic_event_1_triggered\"),\r\n);\r\n\r\nregisterRandomEventTrigger(\r\n  mimicEvent1,\r\n  20,\r\n  true,\r\n  (state) =>\r\n    !hasFlag(state, \"mimic_event_1_triggered\") &&\r\n    getExplorationStatus(state) != ExplorationStatus.None &&\r\n    (getCurrentDungeonFloor(state).getId() == SchoolBasementB2.getId() ||\r\n      getCurrentDungeonFloor(state).getId() == SchoolBasementB3.getId()) &&\r\n    !hasGlobalFlag(state, \"mimic_defeated\"),\r\n);\r\n\r\nconst finalMimicMessage = buildEventMessage(\r\n  \"mimic_event_3\",\r\n  \"(Storyline) The Mimic\",\r\n)\r\n  .setSimpleDescription(\r\n    `You enter the new campus building, only to find a toothed treasure chest right in the middle of the main hall! As you prepare to run or fight, the chest... starts speaking!\r\n  \r\n\"M-M-Massssster\", it says, with a hideous voice. \"You are sssssstrong... pleassssse don't hurt me again. I can help you...\" Then, it spits out a small amount of coins.\r\n\r\n\"I will make coinssssss... for you...\"\r\n\r\nIt's odd, but the mimic doesn't seem to be aggressive. You cautiously pick up the coins and nod to the mimic. A treasure chest that creates coins... this might be helpful!\r\n\r\n**You have completed \"The Mimic\" storyline! You will permanently gain +5:coins:/sec. This will persist even after restarting the game!**`,\r\n  )\r\n  .build();\r\n\r\nconst mimicEvent2 = createGameEvent(\r\n  \"mimic_event_2\",\r\n  finalMimicMessage,\r\n  [EventTag.STORYLINE],\r\n  setGlobalFlag(\"mimic_event_finished\"),\r\n);\r\n\r\naddContextListener(\"mimic_event_2\", (oldState, newState) => {\r\n  if (\r\n    !hasGlobalFlag(newState, \"mimic_event_finished\") &&\r\n    hasGlobalFlag(newState, \"mimic_defeated\") &&\r\n    getResourceAmount(newState, Resource.Mana) > 0 &&\r\n    getSecondsPlayed(newState) > 5.0\r\n  ) {\r\n    return triggerEvent(mimicEvent2);\r\n  }\r\n});\r\n\r\nStorylines.register(\r\n  new Storyline(\r\n    \"The Mimic\",\r\n    2030,\r\n    (state) => hasGlobalFlag(state, \"mimic_event_finished\"),\r\n    (state) => hasGlobalFlag(state, \"mimic_event_finished\"),\r\n    \"There's a chance of this happening randomly if you are exploring the School Basement B2 or B3...\",\r\n    \"+5:coins:/sec\",\r\n    (state) => true,\r\n  ),\r\n);\r\n\r\nfunction getResourcesPerSec(\r\n  state: PlayerContextState,\r\n): Partial<Record<Resource, number>> {\r\n  if (!hasGlobalFlag(state, \"mimic_event_finished\")) {\r\n    return {};\r\n  }\r\n  return { Coins: 5 };\r\n}\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"Mimic\", getResourcesPerSec),\r\n);\r\n\r\nexport default mimic;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { buildEventMessage } from \"../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../events/Events\";\r\nimport { EventTag } from \"../../events/GameEvent\";\r\nimport { createGameEvent } from \"../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateStone extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      super.isVisible(state) && hasFlag(state, \"has_gathered_at_least_10_mana\")\r\n    );\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Pebble\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Convert Mana into a few pebbles.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      stone: {\r\n        value: 5,\r\n        tags: [Resource.Stone],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.stone)}:stone:`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 10;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 1,\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Stone,\r\n      this.getActionEffects(state).stone,\r\n    )(state);\r\n  }\r\n}\r\n\r\nconst message = buildEventMessage(\r\n  \"has_gathered_at_least_10_mana\",\r\n  \"You are a Wizard\",\r\n)\r\n  .setSimpleDescription(\r\n    `Gathering Mana is useful, but why would you do it if you had nothing to use it for?\r\n\r\nYou slowly recall how to cast spells and remember a basic Conjuration spell, *Create Pebble*. You think of trying it soon!\r\n\r\n**You have unlocked the ability to cast spells! You can cast spells by pressing the wand icon at the top right or bottom right corner of the screen.**`,\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"has_gathered_at_least_10_mana\",\r\n  message,\r\n  [EventTag.EARLY_GAME],\r\n  setFlag(\"has_gathered_at_least_10_mana\"),\r\n);\r\n\r\naddContextListener(\"create_stone_unlocked\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"has_gathered_at_least_10_mana\") &&\r\n    getResourceAmount(newState, Resource.Mana) >= 10\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default new CreateStone();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateWater extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      super.isVisible(state) && hasFlag(state, \"has_gathered_at_least_10_mana\")\r\n    );\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Water\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Convert Mana into some drops of water.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      water: {\r\n        value: 2,\r\n        tags: [Resource.Water],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.water)}:water:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Water,\r\n      this.getActionEffects(state).water,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 20;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 1,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new CreateWater();\r\n","import { getBuildingAmount } from \"../buildings/Buildings\";\r\nimport apprenticeDorm from \"../buildings/campus/ApprenticeDorm\";\r\nimport manaSpout from \"../buildings/campus/ManaSpout\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { isCraftingUnlocked } from \"../items/Items\";\r\nimport { getResourceAmount, Resource } from \"../Resources\";\r\nimport CreateStone from \"../spells/conjuration/CreateStone\";\r\nimport CreateWater from \"../spells/conjuration/CreateWater\";\r\nimport {\r\n  getSchoolLevel,\r\n  getTotalElementAndSchoolExp,\r\n  School,\r\n} from \"../spells/ElementsAndSchools\";\r\nimport { clearAllHints, pushHint } from \"./Hints\";\r\n\r\nexport function loadHintsDemo() {\r\n  clearAllHints();\r\n  pushHint({\r\n    description: \"Gather more Mana\",\r\n    isCompleted: (state) =>\r\n      CreateStone.isVisible(state) && CreateWater.isVisible(state),\r\n    progress: (state) => getResourceAmount(state, Resource.Mana) / 20.0,\r\n  });\r\n  pushHint({\r\n    description: \"Create more Stone and Water\",\r\n    isCompleted: (state) => manaSpout.isVisible(state),\r\n  });\r\n  pushHint({\r\n    description: \"Gather more Mana\",\r\n    isCompleted: (state) => hasFlag(state, \"has_gathered_at_least_50_mana\"),\r\n    progress: (state) => getResourceAmount(state, Resource.Mana) / 50.0,\r\n  });\r\n  pushHint({\r\n    description: \"Build a Mana Shard\",\r\n    isCompleted: (state) => hasFlag(state, \"Research_Intro_Triggered\"),\r\n  });\r\n  pushHint({\r\n    description: \"Hire the Researcher\",\r\n    isCompleted: (state) => hasFlag(state, \"research_unlocked\"),\r\n  });\r\n  pushHint({\r\n    description: \"Continue doing research\",\r\n    isCompleted: (state) => hasFlag(state, \"apprentice_dorm_event_triggered\"),\r\n    progress: (state) => getTotalElementAndSchoolExp(state) / 3000.0,\r\n  });\r\n  pushHint({\r\n    description: 'Finish the \"Apprentices Need Sleep\" event',\r\n    isCompleted: (state) => hasFlag(state, \"apprentice_dorm_unlocked\"),\r\n  });\r\n  pushHint({\r\n    description: \"Build an Apprentice Dorm\",\r\n    isCompleted: (state) => getBuildingAmount(state, apprenticeDorm) >= 1,\r\n  });\r\n  pushHint({\r\n    description: \"Gather 800 coins\",\r\n    isCompleted: (state) => hasFlag(state, \"vault_unlocked\"),\r\n    progress: (state) => getResourceAmount(state, Resource.Coins) / 800.0,\r\n  });\r\n  pushHint({\r\n    description: \"Continue doing research\",\r\n    isCompleted: (state) =>\r\n      hasFlag(state, \"crafting_intro\") || isCraftingUnlocked(state),\r\n    progress: (state) => getTotalElementAndSchoolExp(state) / 10000.0,\r\n  });\r\n  pushHint({\r\n    description: \"Build the crafting station\",\r\n    isCompleted: (state) => isCraftingUnlocked(state),\r\n  });\r\n  pushHint({\r\n    description: \"Craft an item\",\r\n    isCompleted: (state) => hasFlag(state, \"has_crafted\"),\r\n  });\r\n  pushHint({\r\n    description: \"Continue doing research\",\r\n    isCompleted: (state) => hasFlag(state, \"shop_intro\"),\r\n    progress: (state) => getTotalElementAndSchoolExp(state) / 16000.0,\r\n  });\r\n  pushHint({\r\n    description: \"Raise Conjuration and Enchantment to Lv3 or above\",\r\n    isCompleted: (state) =>\r\n      getSchoolLevel(state, School.Conjuration) >= 3 &&\r\n      getSchoolLevel(state, School.Enchantment) >= 3,\r\n  });\r\n  pushHint({\r\n    description: \"Appease the businessman\",\r\n    isCompleted: (state) => hasFlag(state, \"selling_unlocked\"),\r\n  });\r\n  pushHint({\r\n    description: \"Continue doing research\",\r\n    isCompleted: (state) => hasFlag(state, \"wizard_robe_triggered\"),\r\n    progress: (state) => getTotalElementAndSchoolExp(state) / 24000.0,\r\n  });\r\n  pushHint({\r\n    description: \"Purchase the Wizard's Robe\",\r\n    isCompleted: (state) => hasFlag(state, \"wizard_robe_bought\"),\r\n  });\r\n  pushHint({\r\n    description: \"Continue doing research\",\r\n    isCompleted: (state) => getTotalElementAndSchoolExp(state) >= 33000,\r\n    progress: (state) => getTotalElementAndSchoolExp(state) / 33000.0,\r\n  });\r\n  pushHint({\r\n    description: \"Equip a hand item and a body item\",\r\n    isCompleted: (state) => hasFlag(state, \"exploration_unlocked\"),\r\n  });\r\n  pushHint({\r\n    description: \"Explore the School Basement\",\r\n    isCompleted: (state) => hasFlag(state, \"upgrades_unlocked\"),\r\n  });\r\n  pushHint({\r\n    description:\r\n      \"You have completed the demo! Please purchase the full game to continue, or retire to start again\",\r\n    isCompleted: (state) => false,\r\n  });\r\n}\r\n","import mem from \"mem\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { getExplorationStatus } from \"../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { hasTemporaryEffect } from \"../../timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { getAmountOfItem, removeFromInventory } from \"../Inventory\";\r\nimport { ItemAction, ItemBase, ItemParams, ItemTag } from \"../Item\";\r\nimport { getItemById } from \"../Items\";\r\n\r\nconst memoizedPrimary = mem(\r\n  (\r\n    cooldownLeft: number,\r\n    numberInInventory: number,\r\n    isStunned: boolean,\r\n    active: boolean,\r\n    id: string,\r\n    params: ItemParams,\r\n  ) => {\r\n    const enabled = cooldownLeft <= 0 && numberInInventory > 0 && !isStunned;\r\n    return {\r\n      description: enabled\r\n        ? \"Use\"\r\n        : `Use (${formatNumber(cooldownLeft, { showDecimals: true })} sec)`,\r\n      isEnabled: enabled,\r\n      isActive: active,\r\n      transform: (state: PlayerContextState) => {\r\n        state = removeFromInventory({ itemId: id, params }, 1, state);\r\n        state.lastItemUsedTimes[id] = getSecondsPlayed(state);\r\n        state = (getItemById(id) as ConsumableItem).doConsumableItemEffect(\r\n          state,\r\n          params,\r\n        );\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nexport abstract class ConsumableItem extends ItemBase {\r\n  abstract doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState;\r\n\r\n  getTags(state: PlayerContextState, params: ItemParams): ItemTag[] {\r\n    return [{ tag: \"Consumable\" }];\r\n  }\r\n\r\n  getCooldownSec(state: PlayerContextState): number {\r\n    return 10.0;\r\n  }\r\n\r\n  getCooldownLeftSec(state: PlayerContextState): number {\r\n    const lastUsedTime = state.lastItemUsedTimes[this.getId()] || 0;\r\n    const cooldownLeft =\r\n      lastUsedTime + this.getCooldownSec(state) - getSecondsPlayed(state);\r\n    const enabled =\r\n      getExplorationStatus(state) != ExplorationStatus.Combat ||\r\n      cooldownLeft <= 0;\r\n    return enabled ? 0 : cooldownLeft;\r\n  }\r\n\r\n  getPrimaryAction(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    const cooldownLeft = this.getCooldownLeftSec(state);\r\n    const numberInInventory = getAmountOfItem(\r\n      { itemId: this.getId(), params },\r\n      state,\r\n    );\r\n    const isStunned = hasTemporaryEffect(state, \"PlayerStun\");\r\n    const active = this.isActive(state);\r\n    return memoizedPrimary(\r\n      cooldownLeft,\r\n      numberInInventory,\r\n      isStunned,\r\n      active,\r\n      this.getId(),\r\n      params,\r\n    );\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return hasTemporaryEffect(state, this.getId());\r\n  }\r\n}\r\n\r\nregisterTransformation(\r\n  [[\"Consumable\", TransformationTags.ItemEffect]],\r\n  \"ConsumableItemQuality\",\r\n  TransformationType.Multiplier,\r\n  (state, params) => {\r\n    const quality = params?.params?.itemQuality || 0;\r\n    return Math.pow(1.02, quality);\r\n  },\r\n);\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass DefensePotion extends ConsumableItem {\r\n  getId(): string {\r\n    return \"defensePotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./defensePotion.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Defense Potion\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A potion that hardens your skin. Temporarily raises :defense:.\";\r\n  }\r\n\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const effects = this.getItemEffects(state, params);\r\n    return grantTemporaryEffect(\r\n      \"Defense Potion\",\r\n      \"Defense Potion\",\r\n      effects.duration,\r\n      {\r\n        params: { commonBuff: { Player: { Defense: effects.magnitude } } },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return hasTemporaryEffect(state, \"Defense Potion\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 8,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 180,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n\r\n    return `+${formatNumber(effects.magnitude)} :defense: for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 300;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Alchemy: 6 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        Water: 150,\r\n        Stone: 1200,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new DefensePotion();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { modifyPlayerCurrentHP } from \"../../exploration/Exploration\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass HealthPotion extends ConsumableItem {\r\n  getId(): string {\r\n    return \"healthPotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./healthPotion.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Health Potion\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small red potion. Restores :hp:.\";\r\n  }\r\n\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const healAmt = this.getItemEffects(state, params).magnitude;\r\n    state = modifyPlayerCurrentHP(state, healAmt);\r\n    const actionResult = {\r\n      id: Math.random().toString(),\r\n      damage: -healAmt,\r\n      isCrit: false,\r\n      isHit: true,\r\n      time: getSecondsPlayed(state),\r\n      target: AttackTarget.Player,\r\n      tags: [],\r\n    };\r\n    state.exploration.lastEnemyActionResult = actionResult;\r\n    state.exploration.actionResultQueue.push(actionResult);\r\n    return state;\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 80,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    return `+${formatNumber(effects.magnitude)}:hp:`;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 96;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Alchemy: 3 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n        Water: 100,\r\n      },\r\n      items: { medicinalHerb: 1 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new HealthPotion();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass ManaPotion extends ConsumableItem {\r\n  getId(): string {\r\n    return \"manaPotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./manaPotion.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Mana Potion\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small blue potion. Restores :mana:.\";\r\n  }\r\n\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const healAmt = this.getItemEffects(state, params).magnitude;\r\n    return grantResource(Resource.Mana, healAmt)(state);\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 200,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    return `+${formatNumber(effects.magnitude)}:mana:`;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 50;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Alchemy: 1 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        Water: 50,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new ManaPotion();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { modifyPlayerCurrentHP } from \"../../exploration/Exploration\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass MedicinalHerb extends ConsumableItem {\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const healAmt = this.getItemEffects(state, params).magnitude;\r\n    state = modifyPlayerCurrentHP(state, healAmt);\r\n    const actionResult = {\r\n      id: Math.random().toString(),\r\n      damage: -healAmt,\r\n      isCrit: false,\r\n      isHit: true,\r\n      time: getSecondsPlayed(state),\r\n      target: AttackTarget.Player,\r\n      tags: [],\r\n    };\r\n    state.exploration.lastEnemyActionResult = actionResult;\r\n    state.exploration.actionResultQueue.push(actionResult);\r\n    return state;\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 20,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n    };\r\n  }\r\n\r\n  getId(): string {\r\n    return \"medicinalHerb\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./medicinalHerb.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Medicinal Herb\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A bundle of herbs. Restores a little :hp:.\";\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    return `+${formatNumber(effects.magnitude)}:hp:`;\r\n  }\r\n\r\n  getTags(state: PlayerContextState, params: Record<string, any>) {\r\n    return super.getTags(state, params).concat([{ tag: \"Material\" }]);\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 25;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new MedicinalHerb();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass SpeedPotion extends ConsumableItem {\r\n  getId(): string {\r\n    return \"speedPotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./speedPotion.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Speed Potion\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A potion that makes you attack quicker. Reduces :attackDelay: temporarily.\";\r\n  }\r\n\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const effects = this.getItemEffects(state, params);\r\n    return grantTemporaryEffect(\r\n      \"Speed Potion\",\r\n      \"Speed Potion\",\r\n      effects.duration,\r\n      {\r\n        params: {\r\n          commonBuff: {\r\n            Player: { AttackDelayMultiplier: 1 / (1 + effects.magnitude) },\r\n          },\r\n        },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return hasTemporaryEffect(state, \"Speed Potion\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.1764,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 180,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n\r\n    return `-${formatNumber(\r\n      Math.abs(1 - 1 / (effects.magnitude + 1)) * 100,\r\n    )}%:attackDelay: for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 300;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Alchemy: 7 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        Water: 150,\r\n      },\r\n      items: { batWing: 3 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new SpeedPotion();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass StrengthPotion extends ConsumableItem {\r\n  getId(): string {\r\n    return \"strengthPotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./strengthPotion.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Strength Potion\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A potion that makes your attacks more damaging. Boosts :attack: temporarily.\";\r\n  }\r\n\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const effects = this.getItemEffects(state, params);\r\n    return grantTemporaryEffect(\r\n      \"Strength Potion\",\r\n      \"Strength Potion\",\r\n      effects.duration,\r\n      {\r\n        params: { commonBuff: { Player: { Attack: effects.magnitude } } },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return hasTemporaryEffect(state, \"Strength Potion\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 10,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 180,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n\r\n    return `+${formatNumber(effects.magnitude)} :attack: for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 240;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Alchemy: 4 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        Water: 150,\r\n      },\r\n      items: { ratTail: 3 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new StrengthPotion();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { ItemParams } from \"../Item\";\r\nimport { ConsumableItem } from \"./ConsumableItem\";\r\n\r\nclass VitalityPotion extends ConsumableItem {\r\n  getId(): string {\r\n    return \"vitalityPotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./vitalityPotion.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Vitality Potion\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A potion that fills you with vigor. Temporarily raises Max:hp:.\";\r\n  }\r\n\r\n  doConsumableItemEffect(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): PlayerContextState {\r\n    const effects = this.getItemEffects(state, params);\r\n    return grantTemporaryEffect(\r\n      \"Vitality Potion\",\r\n      \"Vitality Potion\",\r\n      effects.duration,\r\n      {\r\n        params: { commonBuff: { Player: { MaxHP: effects.magnitude } } },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return hasTemporaryEffect(state, \"Vitality Potion\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 100,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 180,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n\r\n    return `+${formatNumber(effects.magnitude)} Max:hp: for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 300;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Alchemy: 5 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        Water: 200,\r\n        Monstium: 50,\r\n      },\r\n      items: { medicinalHerb: 1 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new VitalityPotion();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Cloak extends EquippableItem {\r\n  getId(): string {\r\n    return \"cloak\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./cloak.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Cloak\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A basic cloak made out of cloth.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 4;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Conjuration: 7,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: { cloth: 4 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Cloak();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass CloakOfRegeneration extends EquippableItem {\r\n  getId(): string {\r\n    return \"cloakOfRegeneration\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./cloakOfRegeneration.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Cloak of Regeneration\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A special cloak that slowly restores the wielder's life when worn.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 4;\r\n  }\r\n\r\n  getHPRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 0.3;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 3600;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Enchantment: 11,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: { Mana: 2800 },\r\n      items: { cloak: 1, cloth: 20 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new CloakOfRegeneration();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass ClothShoes extends EquippableItem {\r\n  getId(): string {\r\n    return \"clothShoes\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./clothShoes.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Cloth Shoes\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"Basic shoes made out of cloth. Makes walking somewhat easier.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 1;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return -10;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Conjuration: 7,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: { cloth: 8 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new ClothShoes();\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass CrystallizedMana extends EquippableItem {\r\n  getId(): string {\r\n    return \"crystallizedMana\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./crystallizedMana.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Crystallized Mana\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A small rock made out of condensed :mana:.\";\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      2.0,\r\n    );\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 3 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Mana: 1000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst crystallizedMana = new CrystallizedMana();\r\n\r\nexport default crystallizedMana;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass EnchantedCloak extends EquippableItem {\r\n  getId(): string {\r\n    return \"enchantedCloak\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./enchantedCloak.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Enchanted Cloak\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A cloak that has been reformed and enhanced with magic.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 9;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 2400;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Enchantment: 8,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: { Mana: 2200 },\r\n      items: { cloak: 1, cloth: 8 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new EnchantedCloak();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass WoodenSandals extends EquippableItem {\r\n  getId(): string {\r\n    return \"woodenSandals\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./woodenSandals.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Wooden Sandals\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A pair of uncomfortable, clunky sandals.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 3;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 10;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 160;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Conjuration: 4,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: { Wood: 750 },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new WoodenSandals();\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass ElderWizardRobe extends EquippableItem {\r\n  getId(): string {\r\n    return \"elderWizardRobe\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./elderWizardRobe.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Elder Wizard's Robe\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"Strong magically infused clothing, to be worn by powerful spellcasters.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 10;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      20.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 600;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 4000;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Conjuration: 7,\r\n      Enchantment: 9,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: { Mana: 2400 },\r\n      items: { cloth: 16 },\r\n    };\r\n  }\r\n}\r\n\r\nconst elderWizardRobe = new ElderWizardRobe();\r\n\r\nexport default elderWizardRobe;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass IronMail extends EquippableItem {\r\n  getId(): string {\r\n    return \"ironArmor\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./ironMail.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Iron Mail\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"Heavy chest protection, to withstand tough blows.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 16;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 2500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 7 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 300,\r\n        Temperature: 1200,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new IronMail();\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../../../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../../events/Events\";\r\nimport { createGameEvent } from \"../../../events/SimpleGameEvent\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { addContextListener } from \"../../../PlayerContextListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport {\r\n  getSchoolLevel,\r\n  getTotalElementAndSchoolExp,\r\n  School,\r\n} from \"../../../spells/ElementsAndSchools\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { addToInventory } from \"../../Inventory\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass WizardRobe extends EquippableItem {\r\n  getId(): string {\r\n    return \"wizardRobe\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./wizardRobe.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Wizard's Robe\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"Magically infused clothing, for those who favor spellcasting.\";\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 6;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      10.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 2000;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Conjuration: 6,\r\n      Enchantment: 8,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: { Mana: 1600 },\r\n      items: { cloth: 12 },\r\n    };\r\n  }\r\n}\r\n\r\nconst wizardRobe = new WizardRobe();\r\n\r\nconst message = buildEventMessage(\r\n  \"WizardRobe_Merchant\",\r\n  \"Clothing for a Wizard\",\r\n)\r\n  .setSimpleDescription(\r\n    `You hear a familiar voice. \"You won't believe the deal I have for yoooooou.\"\r\n    \r\nYou turn around, only to see the familiar face of the businessman who has been buying your items.`,\r\n  )\r\n  .addOption(\r\n    \"Continue\",\r\n    buildEventMessage(\"WizardRobe_Merchant_1\", \"Clothing for a Wizard\")\r\n      .setSimpleDescription(\r\n        `He shows you a finely crafted :wizardRobe:*Wizard's Robe*. You inspect it and find no fault with it; it is magically infused and you can feel a faint power coming from it.\r\n        \r\n\"Would you want to buy it? It can be yooooours... for the *bargain* price of 30000 coins. And I'm sure it would look great on you...\"`,\r\n      )\r\n      .addOption(\r\n        \"Charm the Businessman (1400 Mana)\",\r\n        buildEventMessage(\"WizardRobe_Merchant_4\", \"Clothing for a Wizard\")\r\n          .setSimpleDescription(\r\n            `You use your Illusion prowess to charm the businessman; the price is too high. You attempt to barter for the robe...\r\n            \r\n\"Hmm...\" He observes you, top to bottom. \"Ok. I will go lower. How about... 5000 coins?\"\r\n\r\n*Now* you think the price is more fair.`,\r\n          )\r\n          .addOption(\r\n            \"Pay 5000 Coins\",\r\n            buildEventMessage(\"WizardRobe_Merchant_5\", \"Clothing for a Wizard\")\r\n              .setSimpleDescription(\r\n                `You hand over the coins and buy the robe. The businessman grins slightly. \"Great doooooing business with you!\", he exclaims, before handing the robe to you.\r\n                \r\n**You have obtained a :wizardRobe:Wizard's Robe!**`,\r\n              )\r\n              .build(),\r\n            (state) => {\r\n              state = grantResource(Resource.Coins, -5000)(state);\r\n              state = addToInventory(\r\n                { itemId: wizardRobe.getId(), params: {} },\r\n                1,\r\n                state,\r\n              );\r\n              state = setFlag(\"wizard_robe_bought\")(state);\r\n              return state;\r\n            },\r\n            undefined,\r\n            (state) => getResourceAmount(state, Resource.Coins) >= 5000,\r\n          )\r\n          .addOption(\"Maybe later\")\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Mana, -1400)(state);\r\n          return state;\r\n        },\r\n        (state) => getSchoolLevel(state, School.Illusion) >= 6,\r\n        (state) => getResourceAmount(state, Resource.Mana) >= 1400,\r\n      )\r\n      .addOption(\r\n        \"Pay 30000 Coins\",\r\n        buildEventMessage(\"WizardRobe_Merchant_2\", \"Clothing for a Wizard\")\r\n          .setSimpleDescription(\r\n            `You hand over the coins and buy the robe. The businessman grins. \"Great doooooing business with you!\", he exclaims, before handing the robe to you.\r\n\r\n**You have obtained a :wizardRobe:Wizard's Robe!**`,\r\n          )\r\n          .build(),\r\n        (state) => {\r\n          state = grantResource(Resource.Coins, -30000)(state);\r\n          state = addToInventory(\r\n            { itemId: wizardRobe.getId(), params: {} },\r\n            1,\r\n            state,\r\n          );\r\n          state = setFlag(\"wizard_robe_bought\")(state);\r\n          return state;\r\n        },\r\n        undefined,\r\n        (state) => getResourceAmount(state, Resource.Coins) >= 30000,\r\n      )\r\n      .addOption(\"Maybe later\")\r\n      .build(),\r\n  )\r\n  .build();\r\n\r\nconst event = createGameEvent(\r\n  \"Wizard_Robe\",\r\n  message,\r\n  [],\r\n  setFlag(\"wizard_robe_triggered\"),\r\n);\r\n\r\naddContextListener(\"wizard_robe\", (oldState, newState) => {\r\n  if (\r\n    !hasFlag(newState, \"wizard_robe_triggered\") &&\r\n    hasFlag(newState, \"selling_unlocked\") &&\r\n    getTotalElementAndSchoolExp(newState) >= 24000\r\n  ) {\r\n    return triggerEvent(event);\r\n  }\r\n});\r\n\r\nexport default new WizardRobe();\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass AirWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"airWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./airWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Air Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Air. It is very swift.\";\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      16.0,\r\n    );\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 15;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return -50;\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Air\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        airSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst airWand = new AirWand();\r\n\r\nexport default airWand;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass AssassinsDagger extends EquippableItem {\r\n  getId(): string {\r\n    return \"assassinsDagger\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./assassinsDagger.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Assassin's Dagger\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A dagger that's particularly sharp and solid.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 30;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return -55;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 5400;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 12 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 2500,\r\n        Temperature: 3000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst assassinsDagger = new AssassinsDagger();\r\n\r\nexport default assassinsDagger;\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Branch extends EquippableItem {\r\n  getId(): string {\r\n    return \"branch\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./branch.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Branch\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A magically infused branch. Produces a small amount of :mana:.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 5;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      2.0,\r\n    );\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 4, Enchantment: 4 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 300,\r\n        Mana: 1000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst branch = new Branch();\r\n\r\nexport default branch;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Club extends EquippableItem {\r\n  getId(): string {\r\n    return \"club\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./club.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Club\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wooden club. Slightly heavy.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 20;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 20;\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return \"+20:attack:, +20%:attackDelay:\";\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 4 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 900,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst club = new Club();\r\n\r\nexport default club;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Dagger extends EquippableItem {\r\n  getId(): string {\r\n    return \"dagger\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./dagger.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Dagger\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"An agile, lightweight weapon.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 10;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return -50;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 600;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 4 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 60,\r\n        Wood: 40,\r\n        Temperature: 300,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Dagger();\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass DarknessWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"darknessWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./darknessWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Darkness Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Darkness. Very powerful.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 45;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      32.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 800;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Darkness\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        darknessSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst darknessWand = new DarknessWand();\r\n\r\nexport default darknessWand;\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass EarthWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"earthWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./earthWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Earth Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Earth. Has defensive powers.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 15;\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 15;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      16.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Earth\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        earthSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst earthWand = new EarthWand();\r\n\r\nexport default earthWand;\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass FireWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"fireWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./fireWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Fire Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Fire. Can be an effective weapon!\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 35;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      16.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Fire\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        fireSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst fireWand = new FireWand();\r\n\r\nexport default fireWand;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Glaive extends EquippableItem {\r\n  getId(): string {\r\n    return \"glaive\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./glaive.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Glaive\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"An effective weapon, similar to a spear, for dealing large amounts of damage.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 50;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return -15;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 4500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 11 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 1500,\r\n        Wood: 4500,\r\n        Temperature: 2400,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst glaive = new Glaive();\r\n\r\nexport default glaive;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass HandAxe extends EquippableItem {\r\n  getId(): string {\r\n    return \"handAxe\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./handAxe.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Hand Axe\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"An axe. Slow, but very damaging.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 50;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 50;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1500;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 6 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 150,\r\n        Wood: 300,\r\n        Temperature: 600,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new HandAxe();\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerAttackListeners } from \"../../../exploration/AttackListeners\";\r\nimport { getLastPlayerActionResult } from \"../../../exploration/Exploration\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { grantTemporaryEffect } from \"../../../timetick/TemporaryEffects\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass LightningWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"lightningWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./lightningWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Lightning Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Lightning. May stun.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 15;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      16.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const amountPerSec = this.getManaRegenBonus(state, params);\r\n    return `+15:attack:, +${formatNumber(amountPerSec, {\r\n      showDecimals: true,\r\n    })}:mana:/sec, +400 Max:mana:, +10% chance to apply \"Stunned\"`;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Lightning\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        lightningSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst lightningWand = new LightningWand();\r\n\r\nPlayerAttackListeners.register((oldState, state) => {\r\n  if (\r\n    getLastPlayerActionResult(state)?.isHit &&\r\n    getEquippedItem(state, EquipmentSlot.Hand)?.itemId == \"lightningWand\"\r\n  ) {\r\n    const isStun = Math.random() < 0.1;\r\n    if (isStun) {\r\n      state = grantTemporaryEffect(\"EnemyStun\", \"Stunned!\", 1.0, {\r\n        isBeneficial: false,\r\n        combatOnly: true,\r\n        isEnemyTemporaryEffect: true,\r\n      })(state);\r\n    }\r\n  }\r\n  return state;\r\n});\r\n\r\nexport default lightningWand;\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { modifyEnemyCurrentHP } from \"../../../exploration/Exploration\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { registerTimeTickListener } from \"../../../timetick/TimeTick\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass NatureWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"natureWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./natureWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Nature Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Nature. Drains enemy life.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 15;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      16.0,\r\n    );\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getEffect(state: PlayerContextState, params: ItemParams): string | undefined {\r\n    const amountPerSec = this.getManaRegenBonus(state, params);\r\n    return `+15:attack:, -8 enemy :hp:/sec, +${formatNumber(amountPerSec, {\r\n      showDecimals: true,\r\n    })}:mana:/sec, +400 Max:mana:`;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Nature\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        natureSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst natureWand = new NatureWand();\r\n\r\nregisterTimeTickListener(\"NatureWand\", (state, timeElapsedSec) => {\r\n  if (\r\n    getEquippedItem(state, EquipmentSlot.Hand)?.itemId === natureWand.getId()\r\n  ) {\r\n    state = modifyEnemyCurrentHP(state, -8 * timeElapsedSec);\r\n  }\r\n  return state;\r\n});\r\n\r\nexport default natureWand;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Scimitar extends EquippableItem {\r\n  getId(): string {\r\n    return \"scimitar\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./scimitar.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Scimitar\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A defensive sword with a curved, wider blade.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 43;\r\n  }\r\n\r\n  getDefenseBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 10;\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return \"+43:attack:, +10:defense:\";\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 4200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 11 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 1600,\r\n        Wood: 2500,\r\n        Temperature: 2100,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst scimitar = new Scimitar();\r\n\r\nexport default scimitar;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Sickle extends EquippableItem {\r\n  getId(): string {\r\n    return \"sickle\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./sickle.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Sickle\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A weapon often used by farmers... or by reapers.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 45;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 2400;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 9 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 1100,\r\n        Wood: 3000,\r\n        Temperature: 1500,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Sickle();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Spear extends EquippableItem {\r\n  getId(): string {\r\n    return \"spear\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./spear.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Spear\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A sharp, dangerous weapon for attacking at a distance.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 30;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return -15;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1200;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Air\";\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 5 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 80,\r\n        Wood: 500,\r\n        Temperature: 500,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Spear();\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass SpikedClub extends EquippableItem {\r\n  getId(): string {\r\n    return \"spikedClub\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./spikedClub.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Spiked Club\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A club with a wooden base, but reinforced with spikes for a more destructive punch.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 55;\r\n  }\r\n\r\n  getAttackDelayBonusPct(\r\n    state: PlayerContextState,\r\n    params: ItemParams,\r\n  ): number {\r\n    return 20;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 3600;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 10 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 6500,\r\n        Iron: 600,\r\n        Temperature: 1800,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nconst spikedClub = new SpikedClub();\r\n\r\nexport default spikedClub;\r\n","import { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass Sword extends EquippableItem {\r\n  getId(): string {\r\n    return \"sword\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./sword.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Sword\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A sword: a mighty weapon in the hands of an expert.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 30;\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 5 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 120,\r\n        Wood: 200,\r\n        Temperature: 600,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Sword();\r\n","import { applyTransformations } from \"../../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../../PlayerContext\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { EquipmentSlot } from \"../../Equipment\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\n\r\nclass WaterWand extends EquippableItem {\r\n  getId(): string {\r\n    return \"waterWand\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./waterWand.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Water Wand\";\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A wizard's magical wand with the power of Water. Boosts vitality.\";\r\n  }\r\n\r\n  getAttackBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 15;\r\n  }\r\n\r\n  getMaxHPBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 80;\r\n  }\r\n\r\n  getMaxManaBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getManaRegenBonus(state: PlayerContextState, params: ItemParams): number {\r\n    return applyTransformations(\r\n      [this.getId(), Resource.Mana, TransformationTags.Production],\r\n      state,\r\n      16.0,\r\n    );\r\n  }\r\n\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n\r\n  isCraftable(state: PlayerContextState): boolean {\r\n    return super.isCraftable(state) && state.primaryElement == \"Water\";\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 8, Enchantment: 8 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Wood: 3000,\r\n        Mana: 2500,\r\n      },\r\n      items: {\r\n        waterSpeck: 1,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst waterWand = new WaterWand();\r\n\r\nexport default waterWand;\r\n","import { ItemBase } from \"../Item\";\r\n\r\nclass Cloth extends ItemBase {\r\n  getId(): string {\r\n    return \"cloth\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./cloth.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Cloth\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A basic material for a lot of equipment, especially for spellcasters.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 200;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return { Conjuration: 1 };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: { wool: 4 },\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Cloth();\r\n","import { ItemBase } from \"../Item\";\r\n\r\nclass GoldNugget extends ItemBase {\r\n  getId(): string {\r\n    return \"goldNugget\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./goldNugget.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Gold Nugget\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"A tiny piece of solid gold. Very valuable, and might be useful for certain crafting.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 1000;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {\r\n      Alchemy: 20,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {\r\n        Iron: 5000,\r\n        Mana: 3500,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new GoldNugget();\r\n","import { ItemBase } from \"../Item\";\r\n\r\nclass Wool extends ItemBase {\r\n  getId(): string {\r\n    return \"wool\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./wool.png\");\r\n  }\r\n\r\n  getBaseName(): string {\r\n    return \"Wool\";\r\n  }\r\n\r\n  getTags() {\r\n    return [{ tag: \"Material\" }];\r\n  }\r\n\r\n  getDescription(): string | undefined {\r\n    return \"Wool. Can be used to make cloth.\";\r\n  }\r\n\r\n  getEffect(): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSalePrice(): number {\r\n    return 16;\r\n  }\r\n\r\n  getCraftingSchoolLevelRequirements() {\r\n    return {};\r\n  }\r\n\r\n  getCraftingMaterialsBase() {\r\n    return {\r\n      resources: {},\r\n      items: {},\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Wool();\r\n","import DefensePotion from \"./consumable/DefensePotion\";\r\nimport HealthPotion from \"./consumable/HealthPotion\";\r\nimport ManaPotion from \"./consumable/ManaPotion\";\r\nimport MedicinalHerb from \"./consumable/MedicinalHerb\";\r\nimport SpeedPotion from \"./consumable/SpeedPotion\";\r\nimport StrengthPotion from \"./consumable/StrengthPotion\";\r\nimport VitalityPotion from \"./consumable/VitalityPotion\";\r\nimport Cloak from \"./equipment/accessory/Cloak\";\r\nimport CloakOfRegeneration from \"./equipment/accessory/CloakOfRegeneration\";\r\nimport ClothShoes from \"./equipment/accessory/ClothShoes\";\r\nimport CrystallizedMana from \"./equipment/accessory/CrystallizedMana\";\r\nimport EnchantedCloak from \"./equipment/accessory/EnchantedCloak\";\r\nimport WoodenSandals from \"./equipment/accessory/WoodenSandals\";\r\nimport ElderWizardRobe from \"./equipment/body/ElderWizardRobe\";\r\nimport IronArmor from \"./equipment/body/IronMail\";\r\nimport WizardRobe from \"./equipment/body/WizardRobe\";\r\nimport airWand from \"./equipment/hand/AirWand\";\r\nimport assassinsDagger from \"./equipment/hand/AssassinsDagger\";\r\nimport branch from \"./equipment/hand/Branch\";\r\nimport Club from \"./equipment/hand/Club\";\r\nimport Dagger from \"./equipment/hand/Dagger\";\r\nimport darknessWand from \"./equipment/hand/DarknessWand\";\r\nimport earthWand from \"./equipment/hand/EarthWand\";\r\nimport fireWand from \"./equipment/hand/FireWand\";\r\nimport glaive from \"./equipment/hand/Glaive\";\r\nimport HandAxe from \"./equipment/hand/HandAxe\";\r\nimport lightningWand from \"./equipment/hand/LightningWand\";\r\nimport natureWand from \"./equipment/hand/NatureWand\";\r\nimport scimitar from \"./equipment/hand/Scimitar\";\r\nimport Sickle from \"./equipment/hand/Sickle\";\r\nimport Spear from \"./equipment/hand/Spear\";\r\nimport spikedClub from \"./equipment/hand/SpikedClub\";\r\nimport Sword from \"./equipment/hand/Sword\";\r\nimport waterWand from \"./equipment/hand/WaterWand\";\r\nimport { loadInventoryListener } from \"./Inventory\";\r\nimport { registerItem } from \"./Items\";\r\nimport BatWing from \"./other/BatWing\";\r\nimport Cloth from \"./other/Cloth\";\r\nimport AirSpeck from \"./other/crystals/AirSpeck\";\r\nimport DarknessSpeck from \"./other/crystals/DarknessSpeck\";\r\nimport EarthSpeck from \"./other/crystals/EarthSpeck\";\r\nimport FireSpeck from \"./other/crystals/FireSpeck\";\r\nimport LightningSpeck from \"./other/crystals/LightningSpeck\";\r\nimport NatureSpeck from \"./other/crystals/NatureSpeck\";\r\nimport WaterSpeck from \"./other/crystals/WaterSpeck\";\r\nimport GoldNugget from \"./other/GoldNugget\";\r\nimport LightweightChest from \"./other/LightweightChest\";\r\nimport RatTail from \"./other/RatTail\";\r\nimport Wool from \"./other/Wool\";\r\n\r\nexport function loadItemsDemo() {\r\n  // TODO: sort this list in an order that makes sense\r\n  registerItem(ManaPotion);\r\n  registerItem(CrystallizedMana);\r\n  registerItem(Club);\r\n  registerItem(LightweightChest);\r\n  registerItem(branch);\r\n  registerItem(Dagger);\r\n  registerItem(HandAxe);\r\n  registerItem(IronArmor);\r\n  registerItem(Spear);\r\n  registerItem(Sword);\r\n  registerItem(WizardRobe);\r\n  registerItem(ElderWizardRobe);\r\n  registerItem(MedicinalHerb);\r\n  registerItem(RatTail);\r\n  registerItem(HealthPotion);\r\n  registerItem(BatWing);\r\n  registerItem(StrengthPotion);\r\n  registerItem(SpeedPotion);\r\n  registerItem(Wool);\r\n  registerItem(Cloth);\r\n  registerItem(Cloak);\r\n  registerItem(EnchantedCloak);\r\n  registerItem(CloakOfRegeneration);\r\n  registerItem(WoodenSandals);\r\n  registerItem(ClothShoes);\r\n  registerItem(GoldNugget);\r\n  registerItem(FireSpeck);\r\n  registerItem(EarthSpeck);\r\n  registerItem(WaterSpeck);\r\n  registerItem(AirSpeck);\r\n  registerItem(NatureSpeck);\r\n  registerItem(LightningSpeck);\r\n  registerItem(DarknessSpeck);\r\n  registerItem(Sickle);\r\n  registerItem(spikedClub);\r\n  registerItem(scimitar);\r\n  registerItem(glaive);\r\n  registerItem(assassinsDagger);\r\n  registerItem(fireWand);\r\n  registerItem(earthWand);\r\n  registerItem(waterWand);\r\n  registerItem(airWand);\r\n  registerItem(natureWand);\r\n  registerItem(lightningWand);\r\n  registerItem(darknessWand);\r\n  registerItem(DefensePotion);\r\n  registerItem(VitalityPotion);\r\n\r\n  loadInventoryListener();\r\n}\r\n","import { addContextListener } from \"../PlayerContextListeners\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  wasTemporaryEffectCleared,\r\n} from \"../timetick/TemporaryEffects\";\r\nimport { modifyPlayerCurrentHP } from \"./Exploration\";\r\n\r\nexport function loadDoom() {\r\n  // If the doom timer runs out, the player dies automatically.\r\n  // Everything will be handled by one listener.\r\n  addContextListener(\"PlayerDoom\", (oldState, newState) => {\r\n    if (\r\n      hasTemporaryEffect(oldState, \"PlayerDoom\") &&\r\n      !hasTemporaryEffect(newState, \"PlayerDoom\")\r\n    ) {\r\n      // Player's Doom status has disappeared.\r\n      // If it was explicitly cleared, do nothing.\r\n      // If it wasn't explicitly cleared, kill the player.\r\n      if (!wasTemporaryEffectCleared(newState, \"PlayerDoom\")) {\r\n        // Kill the player!\r\n        return (state) => modifyPlayerCurrentHP(state, -Infinity);\r\n      }\r\n    }\r\n  });\r\n}\r\n","import {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { addContextListener } from \"../PlayerContextListeners\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../timetick/TemporaryEffects\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\nimport { CombatStat } from \"./CombatStats\";\r\nimport { getExplorationStatus, resetEnemyNextAction } from \"./Exploration\";\r\nimport { ExplorationStatus } from \"./ExplorationStatus\";\r\n\r\nexport function loadStunning() {\r\n  // While stunned, enemies and players both have a giant attack delay\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n    \"PlayerStunAttackDelay\",\r\n    TransformationType.Addition,\r\n    (state) => (hasTemporaryEffect(state, \"PlayerStun\") ? +Infinity : 0),\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Enemy, CombatStat.AttackDelay]],\r\n    \"EnemyStunAttackDelay\",\r\n    TransformationType.Addition,\r\n    (state) => (hasTemporaryEffect(state, \"EnemyStun\") ? +Infinity : 0),\r\n  );\r\n\r\n  addContextListener(\"PlayerStunning\", (oldState, newState) => {\r\n    if (\r\n      hasTemporaryEffect(newState, \"PlayerStun\") &&\r\n      !hasTemporaryEffect(oldState, \"PlayerStun\")\r\n    ) {\r\n      // Player's been stunned, but does it have temporary immunity?\r\n      if (hasTemporaryEffect(newState, \"PlayerStunPrevention\")) {\r\n        return clearTemporaryEffect(\"PlayerStun\");\r\n      }\r\n\r\n      // Player's stun has been set. Set attack timer start time to estimated stun end\r\n      // so that on heal we don't immediately attack.\r\n      return (state) => {\r\n        state.exploration.playerActionProgress = 0.0;\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n\r\n  addContextListener(\"PlayerStunningRecovery\", (oldState, newState) => {\r\n    if (\r\n      !hasTemporaryEffect(newState, \"PlayerStun\") &&\r\n      hasTemporaryEffect(oldState, \"PlayerStun\") &&\r\n      !hasTemporaryEffect(newState, \"PlayerStunPrevention\")\r\n    ) {\r\n      // Player's stun has run out, so restart the attack timer and give stun prevention\r\n      return (state) => {\r\n        state.exploration.playerActionProgress = 0.0;\r\n        state = grantTemporaryEffect(\r\n          \"PlayerStunPrevention\",\r\n          \"Stun Protection\",\r\n          applyTransformations(\r\n            [\r\n              AttackTarget.Player,\r\n              TransformationTags.PostStunProtectionDuration,\r\n            ],\r\n            newState,\r\n            6.0,\r\n          ),\r\n          { combatOnly: true },\r\n        )(state);\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n\r\n  addContextListener(\"EnemyStunning\", (oldState, newState) => {\r\n    if (\r\n      hasTemporaryEffect(newState, \"EnemyStun\") &&\r\n      !hasTemporaryEffect(oldState, \"EnemyStun\")\r\n    ) {\r\n      // Enemy's been stunned, but does it have temporary immunity?\r\n      if (hasTemporaryEffect(newState, \"EnemyStunPrevention\")) {\r\n        return clearTemporaryEffect(\"EnemyStun\");\r\n      }\r\n\r\n      // Enemy's stun has been set. Set attack timer start time to estimated stun end\r\n      // so that on heal we don't immediately attack.\r\n      return (state) => {\r\n        state.exploration.enemyActionProgress = 0.0;\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n\r\n  addContextListener(\"EnemyStunningRecovery\", (oldState, newState) => {\r\n    if (\r\n      !hasTemporaryEffect(newState, \"EnemyStun\") &&\r\n      hasTemporaryEffect(oldState, \"EnemyStun\") &&\r\n      !hasTemporaryEffect(newState, \"EnemyStunPrevention\")\r\n    ) {\r\n      // Enemy's stun has run out, so restart the attack timer\r\n      return (state) => {\r\n        resetEnemyNextAction();\r\n        state.exploration.enemyActionProgress = 0.0;\r\n        if (getExplorationStatus(state) === ExplorationStatus.Combat) {\r\n          state = grantTemporaryEffect(\r\n            \"EnemyStunPrevention\",\r\n            \"Stun Protection\",\r\n            applyTransformations(\r\n              [\r\n                AttackTarget.Enemy,\r\n                TransformationTags.PostStunProtectionDuration,\r\n              ],\r\n              newState,\r\n              6.0,\r\n            ),\r\n            { combatOnly: true, isEnemyTemporaryEffect: true },\r\n          )(state);\r\n        }\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport { buildEventMessage } from \"../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../events/Events\";\r\nimport { createGameEvent } from \"../events/SimpleGameEvent\";\r\nimport { clearFlag, hasFlag, hasGlobalFlag, setGlobalFlag } from \"../Flags\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../Resources\";\r\nimport { OfflineTickListener } from \"./OfflineTickListeners\";\r\nimport { registerTimeTickListener } from \"./TimeTick\";\r\n\r\nconst timePieceEvent = createGameEvent(\r\n  \"TimePieceEvent\",\r\n  buildEventMessage(\"TimePieceEvent\", \"Offline Progress\")\r\n    .setSimpleDescription(\r\n      `Welcome back to Magic Research!\r\n      \r\n**You obtained {amount}:timepiece: Time Pieces!**`,\r\n    )\r\n    .build(),\r\n  [],\r\n  (state, _params) => state,\r\n);\r\n\r\nconst timePieceEventFirstTime = createGameEvent(\r\n  \"TimePieceEventFirstTime\",\r\n  buildEventMessage(\"TimePieceEventFirstTime\", \"Offline Progress\")\r\n    .setSimpleDescription(\r\n      `Welcome back to Magic Research!\r\n      \r\n**You obtained {amount}:timepiece: Time Pieces! Time Pieces allow you to make time pass faster for a duration. You can do so from the left side menu!**`,\r\n    )\r\n    .build(),\r\n  [],\r\n  setGlobalFlag(\"has_seen_offline_progress\"),\r\n);\r\n\r\nexport const timePieceGranter = new OfflineTickListener(\r\n  \"TimePieceGranter\",\r\n  (totalSecs) => {\r\n    return (state) => {\r\n      const transformedSecs = applyTransformations(\r\n        [TransformationTags.OfflineTimePieceGain, Resource.TimePieces],\r\n        state,\r\n        totalSecs,\r\n      );\r\n      const oldTimePieces = getResourceAmount(state, Resource.TimePieces);\r\n      state = grantResource(Resource.TimePieces, transformedSecs)(state);\r\n      const newTimePieces = getResourceAmount(state, Resource.TimePieces);\r\n      const amount = newTimePieces - oldTimePieces;\r\n      if (amount > 0) {\r\n        if (hasGlobalFlag(state, \"has_seen_offline_progress\")) {\r\n          if (amount > 60) {\r\n            state = triggerEvent(timePieceEvent, {\r\n              amount: formatNumber(amount),\r\n            })(state);\r\n          }\r\n        } else {\r\n          state = triggerEvent(timePieceEventFirstTime, {\r\n            amount: formatNumber(amount),\r\n          })(state);\r\n        }\r\n      }\r\n      return state;\r\n    };\r\n  },\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.GameSpeed]],\r\n  \"TimePieceGameSpeed\",\r\n  TransformationType.Multiplier,\r\n  (state, params) =>\r\n    hasFlag(state, \"time_piece_speedup_enabled\") && !params?.isWarp ? 2 : 1,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.GameSpeed]],\r\n  \"Debug2xGameSpeed\",\r\n  TransformationType.Multiplier,\r\n  (state, params) =>\r\n    hasFlag(state, \"debug_2x_speed\") && !params?.isWarp ? 2 : 1,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.GameSpeed]],\r\n  \"Debug0xGameSpeed\",\r\n  TransformationType.Multiplier,\r\n  (state, params) =>\r\n    hasFlag(state, \"debug_0x_speed\") && !params?.isWarp ? 0 : 1,\r\n);\r\n\r\nregisterTimeTickListener(\r\n  \"TimePieceConsumer\",\r\n  (state, timeElapsedSec, isWarp) => {\r\n    if (hasFlag(state, \"time_piece_speedup_enabled\") && !isWarp) {\r\n      // times 1.5 only because time is going at 2x speed if enabled.\r\n      // Actual cost is 3 time pieces per extra second gained.\r\n      state = grantResource(Resource.TimePieces, -timeElapsedSec * 1.5)(state);\r\n      if (getResourceAmount(state, Resource.TimePieces) <= 0) {\r\n        state = clearFlag(\"time_piece_speedup_enabled\")(state);\r\n      }\r\n    }\r\n    return state;\r\n  },\r\n);\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateBoulder extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Boulder\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a giant rock and boost your Stone reserves.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      stone: {\r\n        value: 1200,\r\n        tags: [Resource.Stone],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.stone)}:stone:`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 440;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 5,\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Stone,\r\n      this.getActionEffects(state).stone,\r\n    )(state);\r\n  }\r\n}\r\n\r\nexport default new CreateBoulder();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateIronBar extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"gather_iron_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Iron Bar\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Materialize an iron bar.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      iron: {\r\n        value: 80,\r\n        tags: [Resource.Iron],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.iron)}:iron:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Iron,\r\n      this.getActionEffects(state).iron,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 320;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 7,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new CreateIronBar();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateIronOre extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"gather_iron_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Iron Ore\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Materialize a piece of iron ore.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      iron: {\r\n        value: 5,\r\n        tags: [Resource.Iron],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.iron)}:iron:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Iron,\r\n      this.getActionEffects(state).iron,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 40;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 4,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new CreateIronOre();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateRock extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Rock\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a larger rock to get plenty of Stone.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      stone: {\r\n        value: 90,\r\n        tags: [Resource.Stone],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.stone)}:stone:`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 80;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 2,\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Stone,\r\n      this.getActionEffects(state).stone,\r\n    )(state);\r\n  }\r\n}\r\n\r\nexport default new CreateRock();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateWaterII extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Water II\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Convert Mana into a larger chunk of water.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      water: {\r\n        value: 35,\r\n        tags: [Resource.Water],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.water)}:water:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Water,\r\n      this.getActionEffects(state).water,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 180;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 3,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new CreateWaterII();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass CreateWaterIII extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Create Water III\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Convert Mana into a large amount of water.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      water: {\r\n        value: 420,\r\n        tags: [Resource.Water],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.water)}:water:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return grantResource(\r\n      Resource.Water,\r\n      this.getActionEffects(state).water,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1060;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Conjuration: 6,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new CreateWaterIII();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport Furnace from \"../../buildings/campus/Furnace\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass EnchantFurnaces extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && getBuildingAmount(state, Furnace) > 0;\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Enchant Furnaces\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Magically alter your Furnaces to produce (and consume) faster for a limited time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `${formatNumber(effects.magnitude, {\r\n      showDecimals: true,\r\n    })}x:temperature: production and ${formatNumber(effects.magnitude, {\r\n      showDecimals: true,\r\n    })}x:wood: consumption by Furnaces for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec.`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 90;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 3,\r\n    };\r\n  }\r\n}\r\n\r\nconst enchantFurnaces = new EnchantFurnaces();\r\n\r\nregisterTransformation(\r\n  [\r\n    [Furnace.getName(), TransformationTags.Production],\r\n    [Furnace.getName(), TransformationTags.Consumption],\r\n  ],\r\n  \"EnchantFurnaces\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Enchant Furnaces\")\r\n      ? enchantFurnaces.getActionEffects(state).magnitude\r\n      : 1,\r\n);\r\n\r\nexport default enchantFurnaces;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport LumberYard from \"../../buildings/campus/LumberYard\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass EnchantLumberYards extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && getBuildingAmount(state, LumberYard) > 0;\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Enchant Lumber Yards\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Magically alter your Lumber Yards to work faster for a limited time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `${formatNumber(effects.magnitude, {\r\n      showDecimals: true,\r\n    })}x:wood: produced by Lumber Yards for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec.`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 80;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 2,\r\n    };\r\n  }\r\n}\r\n\r\nconst enchantLumberYards = new EnchantLumberYards();\r\n\r\nregisterTransformation(\r\n  [[LumberYard.getName(), TransformationTags.Production]],\r\n  \"EnchantLumberYards\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Enchant Lumber Yards\")\r\n      ? enchantLumberYards.getActionEffects(state).magnitude\r\n      : 1.0,\r\n);\r\n\r\nexport default enchantLumberYards;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport ManaGeyser from \"../../buildings/campus/ManaGeyser\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass EnchantManaGeysers extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && getBuildingAmount(state, ManaGeyser) > 0;\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Enchant Mana Geysers\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Magically alter your Mana Geysers to produce more mana for a limited time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 20.4,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `${formatNumber(effects.magnitude, {\r\n      showDecimals: true,\r\n    })}x:mana: produced by Mana Geysers for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec.`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 160;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 9,\r\n    };\r\n  }\r\n}\r\n\r\nconst enchantManaGeysers = new EnchantManaGeysers();\r\n\r\nregisterTransformation(\r\n  [[ManaGeyser.getName(), TransformationTags.Production]],\r\n  \"EnchantManaGeysers\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Enchant Mana Geysers\")\r\n      ? enchantManaGeysers.getActionEffects(state).magnitude\r\n      : 1,\r\n);\r\n\r\nexport default new EnchantManaGeysers();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport ManaSpout from \"../../buildings/campus/ManaSpout\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass EnchantManaSpouts extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && getBuildingAmount(state, ManaSpout) > 0;\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Enchant Mana Spouts\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Magically alter your Mana Spouts to produce more mana for a limited time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 30.4,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `${formatNumber(effects.magnitude, {\r\n      showDecimals: true,\r\n    })}x:mana: produced by Mana Spouts for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec.`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 60;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 1,\r\n    };\r\n  }\r\n}\r\n\r\nconst enchantManaSpouts = new EnchantManaSpouts();\r\n\r\nregisterTransformation(\r\n  [[ManaSpout.getName(), TransformationTags.Production]],\r\n  \"EnchantManaSpouts\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Enchant Mana Spouts\")\r\n      ? enchantManaSpouts.getActionEffects(state).magnitude\r\n      : 1,\r\n);\r\n\r\nexport default enchantManaSpouts;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport Mine from \"../../buildings/campus/Mine\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass EnchantMines extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && getBuildingAmount(state, Mine) > 0;\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Enchant Mines\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Magically alter your Mines to work faster for a limited time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `${formatNumber(effects.magnitude, {\r\n      showDecimals: true,\r\n    })}x:stone: and :iron: produced by Mines for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec.`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 300;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 12,\r\n    };\r\n  }\r\n}\r\n\r\nconst enchantMines = new EnchantMines();\r\n\r\nregisterTransformation(\r\n  [[Mine.getName(), TransformationTags.Production]],\r\n  \"EnchantMines\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Enchant Mines\")\r\n      ? enchantMines.getActionEffects(state).magnitude\r\n      : 1.0,\r\n);\r\n\r\nexport default new EnchantMines();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass Levitation extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Levitation\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Allows you to float a short distance from the ground. Makes you more efficient at exploration.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `-${formatNumber(\r\n      (1 - 1.0 / effects.magnitude) * 100,\r\n    )}% exploration time for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1300;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 13,\r\n    };\r\n  }\r\n}\r\n\r\nconst levitation = new Levitation();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  \"Levitation\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Levitation\")\r\n      ? 1.0 / levitation.getActionEffects(state).magnitude\r\n      : 1.0,\r\n);\r\n\r\nexport default levitation;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass Quickness extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Quickness\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Make yourself move and attack faster.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `-${formatNumber(\r\n      Math.abs(1 - 1 / (effects.magnitude + 1)) * 100,\r\n    )}%:attackDelay: for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 580;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 7,\r\n    };\r\n  }\r\n}\r\n\r\nconst quickness = new Quickness();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n  \"Quickness\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Quickness\")\r\n      ? 1.0 / (1 + quickness.getActionEffects(state).magnitude)\r\n      : 1.0,\r\n);\r\n\r\nexport default quickness;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass Stoneskin extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Stoneskin\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Harden your skin to render yourself stronger against attacks.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 10,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.magnitude)}:defense: for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 480;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 6,\r\n    };\r\n  }\r\n}\r\n\r\nconst stoneskin = new Stoneskin();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Defense]],\r\n  \"Stoneskin\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Stoneskin\")\r\n      ? stoneskin.getActionEffects(state).magnitude\r\n      : 0,\r\n);\r\n\r\nexport default stoneskin;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass Strength extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Strength\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Fill yourself with magical strength and increase your damage.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 9,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.magnitude)}:attack: for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 640;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 8,\r\n    };\r\n  }\r\n}\r\n\r\nconst strength = new Strength();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"Strength\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Strength\")\r\n      ? strength.getActionEffects(state).magnitude\r\n      : 0,\r\n);\r\n\r\nexport default strength;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass VigorOfHealth extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Vigor of Health\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Increase your maximum :hp: by enchanting yourself.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 80,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(effects.magnitude)} Max:hp: for ${formatNumber(\r\n      Math.floor(effects.duration),\r\n    )} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 120;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 5,\r\n    };\r\n  }\r\n}\r\n\r\nconst vigorOfHealth = new VigorOfHealth();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.MaxHP]],\r\n  \"VigorOfHealth\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Vigor of Health\")\r\n      ? vigorOfHealth.getActionEffects(state).magnitude\r\n      : 0,\r\n);\r\n\r\nexport default vigorOfHealth;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\nimport quickness from \"./Quickness\";\r\nimport stoneskin from \"./Stoneskin\";\r\nimport strength from \"./Strength\";\r\nimport vigorOfHealth from \"./VigorOfHealth\";\r\n\r\nclass PhysicalAugment extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Physical Augment\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Equivalent to Vigor of Health, Stoneskin, Quickness and Strength all at once.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const hpEffects = vigorOfHealth.getActionEffects(state);\r\n    const defEffects = stoneskin.getActionEffects(state);\r\n    const atkDelayEffects = quickness.getActionEffects(state);\r\n    const atkEffects = strength.getActionEffects(state);\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(hpEffects.magnitude)} Max:hp:, +${formatNumber(\r\n      defEffects.magnitude,\r\n    )}:defense:, -${formatNumber(\r\n      Math.abs(1 - 1 / (atkDelayEffects.magnitude + 1)) * 100,\r\n    )}%:attackDelay: and +${formatNumber(\r\n      atkEffects.magnitude,\r\n    )}:attack: for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1820;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Enchantment: 14,\r\n    };\r\n  }\r\n\r\n  isActive(state: PlayerContextState): boolean {\r\n    return (\r\n      hasTemporaryEffect(state, \"Vigor of Health\") &&\r\n      hasTemporaryEffect(state, \"Stoneskin\") &&\r\n      hasTemporaryEffect(state, \"Quickness\") &&\r\n      hasTemporaryEffect(state, \"Strength\")\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const duration = this.getActionEffects(state).duration;\r\n    state = grantTemporaryEffect(\r\n      \"Vigor of Health\",\r\n      \"Vigor of Health\",\r\n      duration,\r\n      {},\r\n    )(state);\r\n    state = grantTemporaryEffect(\"Stoneskin\", \"Stoneskin\", duration, {})(state);\r\n    state = grantTemporaryEffect(\"Quickness\", \"Quickness\", duration, {})(state);\r\n    state = grantTemporaryEffect(\"Strength\", \"Strength\", duration, {})(state);\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new PhysicalAugment();\r\n","import { getExplorationStatus } from \"../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { SpellActionBase } from \"./Spell\";\r\n\r\nexport abstract class CombatSpellBase extends SpellActionBase {\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  isEnabled(state: PlayerContextState): boolean {\r\n    return (\r\n      super.isEnabled(state) &&\r\n      getExplorationStatus(state) == ExplorationStatus.Combat\r\n    );\r\n  }\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { standardPlayerAttackEffect } from \"../exploration/Exploration\";\r\nimport { hasGlobalFlag } from \"../Flags\";\r\nimport { PlayerContextState } from \"../PlayerContext\";\r\nimport { grantTemporaryEffect } from \"../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"./Spell\";\r\n\r\nexport function getStandardRangeEffectText(\r\n  average: number,\r\n  variance: number,\r\n): string {\r\n  const min = average - variance,\r\n    max = average + variance;\r\n  return `${formatNumber(min)}~${formatNumber(max)}`;\r\n}\r\n\r\nexport function getStandardAttackEffectText(\r\n  average: number,\r\n  variance: number,\r\n): string {\r\n  return `${getStandardRangeEffectText(average, variance)}:attack:`;\r\n}\r\n\r\nexport function getStandardAirAttackEffect(\r\n  state: PlayerContextState,\r\n  spell: SpellActionBase,\r\n): PlayerContextState {\r\n  const effects = spell.getActionEffects(state);\r\n  return standardPlayerAttackEffect(\r\n    state,\r\n    effects.average + (Math.random() - 0.5) * effects.variance * 2,\r\n    hasGlobalFlag(state, \"advanced_evocation_unlocked\") ? 4.0 : 1.0,\r\n    undefined,\r\n    spell.getTags(),\r\n  );\r\n}\r\n\r\nexport function getStandardWaterAttackEffect(\r\n  state: PlayerContextState,\r\n  spell: SpellActionBase,\r\n): PlayerContextState {\r\n  const effects = spell.getActionEffects(state);\r\n  state = standardPlayerAttackEffect(\r\n    state,\r\n    effects.average + (Math.random() - 0.5) * effects.variance * 2,\r\n    undefined,\r\n    undefined,\r\n    spell.getTags(),\r\n  );\r\n  if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n    state = grantTemporaryEffect(\r\n      \"Chilled\",\r\n      \"WaterChill\",\r\n      effects.slowDuration,\r\n      {\r\n        isEnemyTemporaryEffect: true,\r\n        combatOnly: true,\r\n        isBeneficial: false,\r\n        params: { commonBuff: { Enemy: { AttackDelayMultiplier: 1.2 } } },\r\n      },\r\n    )(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getStandardFireAttackEffect(\r\n  state: PlayerContextState,\r\n  spell: SpellActionBase,\r\n): PlayerContextState {\r\n  const effects = spell.getActionEffects(state);\r\n  state = standardPlayerAttackEffect(\r\n    state,\r\n    effects.average + (Math.random() - 0.5) * effects.variance * 2,\r\n    undefined,\r\n    undefined,\r\n    spell.getTags(),\r\n  );\r\n  if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n    state = grantTemporaryEffect(\r\n      spell.getSpellName() + \"_dot\",\r\n      spell.getSpellName(),\r\n      effects.dotDuration,\r\n      {\r\n        mode: \"add\",\r\n        isBeneficial: false,\r\n        combatOnly: true,\r\n        isEnemyTemporaryEffect: true,\r\n        params: { commonDoTAmount: effects.dotStrength },\r\n      },\r\n    )(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getStandardSpellAttackEffect(\r\n  state: PlayerContextState,\r\n  spell: SpellActionBase,\r\n): PlayerContextState {\r\n  const effects = spell.getActionEffects(state);\r\n  state = standardPlayerAttackEffect(\r\n    state,\r\n    effects.average + (Math.random() - 0.5) * effects.variance * 2,\r\n    undefined,\r\n    undefined,\r\n    spell.getTags(),\r\n  );\r\n  return state;\r\n}\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAirAttackEffect,\r\n  getStandardAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass AirCutter extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Air Cutter\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Slice an enemy with small blades of condensed wind.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 33,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 3,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const extraEffect = hasGlobalFlag(state, \"advanced_evocation_unlocked\")\r\n      ? \", extra accurate\"\r\n      : \"\";\r\n    return (\r\n      getStandardAttackEffectText(effects.average, effects.variance) +\r\n      extraEffect\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardAirAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 1.0;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Air\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 75;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 3,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new AirCutter();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardWaterAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Blizzard extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Blizzard\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Materialize a bitter cold blizzard to damage your enemy.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 175,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 15,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      slowDuration: {\r\n        value: 2.5,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n      return (\r\n        getStandardAttackEffectText(effects.average, effects.variance) +\r\n        `, +20%:attackDelay: for ${formatNumber(effects.slowDuration, {\r\n          showDecimals: true,\r\n        })} sec`\r\n      );\r\n    }\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardWaterAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 4.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Water\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 520;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 13,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Blizzard();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardFireAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass ConeOfFire extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Cone of Fire\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Hit an enemy with a cone-shaped burst of flames.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 240,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 10,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      dotStrength: {\r\n        value: 10,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      dotDuration: {\r\n        value: 3.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n      return (\r\n        getStandardAttackEffectText(effects.average, effects.variance) +\r\n        `, -${formatNumber(effects.dotStrength)}:hp:/sec for ${formatNumber(\r\n          effects.dotDuration,\r\n          {\r\n            showDecimals: true,\r\n          },\r\n        )} sec`\r\n      );\r\n    }\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardFireAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 3.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Fire\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1400;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 8,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new ConeOfFire();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardFireAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass FireBall extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Fire Ball\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a ball of pure hot flames and hurl it at an enemy.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 115,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      dotStrength: {\r\n        value: 5,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      dotDuration: {\r\n        value: 3.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n      return (\r\n        getStandardAttackEffectText(effects.average, effects.variance) +\r\n        `, -${formatNumber(effects.dotStrength)}:hp:/sec for ${formatNumber(\r\n          effects.dotDuration,\r\n          {\r\n            showDecimals: true,\r\n          },\r\n        )} sec`\r\n      );\r\n    }\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardFireAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 2.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Fire\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 500;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 3,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new FireBall();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAirAttackEffect,\r\n  getStandardAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass Gale extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Gale\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Blast an enemy with a strong gust of wind.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 75,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const extraEffect = hasGlobalFlag(state, \"advanced_evocation_unlocked\")\r\n      ? \", extra accurate\"\r\n      : \"\";\r\n    return (\r\n      getStandardAttackEffectText(effects.average, effects.variance) +\r\n      extraEffect\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardAirAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 1.0;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Air\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 200;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 8,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Gale();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardWaterAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass IceNeedle extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Ice Needle\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a needle out of solid ice and launch it at an enemy.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 55,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      slowDuration: {\r\n        value: 1.5,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n      return (\r\n        getStandardAttackEffectText(effects.average, effects.variance) +\r\n        `, +20%:attackDelay: for ${formatNumber(effects.slowDuration, {\r\n          showDecimals: true,\r\n        })} sec`\r\n      );\r\n    }\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardWaterAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 2.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Water\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 140;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 3,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new IceNeedle();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardFireAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass InfernalBlaze extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Infernal Blaze\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Sear an enemy with powerful flames.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 400,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 20,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      dotStrength: {\r\n        value: 20,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      dotDuration: {\r\n        value: 3.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n      return (\r\n        getStandardAttackEffectText(effects.average, effects.variance) +\r\n        `, -${formatNumber(effects.dotStrength)}:hp:/sec for ${formatNumber(\r\n          effects.dotDuration,\r\n          {\r\n            showDecimals: true,\r\n          },\r\n        )} sec`\r\n      );\r\n    }\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardFireAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 4.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Fire\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 2300;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 13,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new InfernalBlaze();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Landslide extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Landslide\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Crush an enemy with the power of a landslide.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 300,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 80,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 4.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Earth\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1500;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 13,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Landslide();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass ManaSpike extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Mana Spike\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Condense :mana: into a sharp spike, then thrust it at an enemy.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 42.5,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 2.5,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 1.0;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 250;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 1,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new ManaSpike();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass RockTomb extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Rock Tomb\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Bury an enemy below a pile of heavy stones.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 185,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 50,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 3.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Earth\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 800;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 8,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new RockTomb();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Stalagmite extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Stalagmite\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Impale an enemy with a spike appearing right below them.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 90,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 25,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 2.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Earth\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 300;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 3,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Stalagmite();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAirAttackEffect,\r\n  getStandardAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass Twister extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Twister\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a small tornado to rip through the enemy.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 130,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 10,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const extraEffect = hasGlobalFlag(state, \"advanced_evocation_unlocked\")\r\n      ? \", extra accurate\"\r\n      : \"\";\r\n    return (\r\n      getStandardAttackEffectText(effects.average, effects.variance) +\r\n      extraEffect\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardAirAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 1.0;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Air\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 340;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 13,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new Twister();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasGlobalFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardWaterAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass WaterBomb extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Water Bomb\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Put a large ball of water together, then strike an enemy with it.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 110,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 10,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      slowDuration: {\r\n        value: 2,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    if (hasGlobalFlag(state, \"advanced_evocation_unlocked\")) {\r\n      return (\r\n        getStandardAttackEffectText(effects.average, effects.variance) +\r\n        `, +20%:attackDelay: for ${formatNumber(effects.slowDuration, {\r\n          showDecimals: true,\r\n        })} sec`\r\n      );\r\n    }\r\n    return getStandardAttackEffectText(effects.average, effects.variance);\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    return getStandardWaterAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 3.5;\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && state.primaryElement == \"Water\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 330;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Evocation: 8,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new WaterBomb();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass Blur extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Blur\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Alter your physical appearance to make yourself more blurry, increasing your dodge chance.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 40,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {},\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(\r\n      effects.magnitude * 100,\r\n    )}%:dodge: for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 850;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 9,\r\n    };\r\n  }\r\n}\r\n\r\nconst blur = new Blur();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Dodge]],\r\n  \"Blur\",\r\n  TransformationType.Addition,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Blur\")\r\n      ? blur.getActionEffects(state).magnitude\r\n      : 0,\r\n);\r\n\r\nexport default blur;\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass BubbleShow extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Bubble Show\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a fun entertainment show based on bubbles.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 400,\r\n        tags: [Resource.Coins, TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 50,\r\n        tags: [Resource.Coins, TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${getStandardRangeEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n    )}:coins:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantResource(\r\n      Resource.Coins,\r\n      effects.average + (Math.random() - 0.5) * effects.variance,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 150;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 3,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new BubbleShow();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\n\r\nclass Dazzle extends CombatSpellBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Dazzle\";\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 8.0;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Temporarily confuse an enemy's senses, reducing their :accuracy: for a short time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 1.5385,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 5,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {\r\n        isEnemyTemporaryEffect: true,\r\n        combatOnly: true,\r\n        isBeneficial: false,\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `-${formatNumber(\r\n      100 - (1.0 / effects.magnitude) * 100,\r\n    )}%:accuracy: for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1100;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 11,\r\n    };\r\n  }\r\n}\r\n\r\nconst dazzle = new Dazzle();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Enemy, CombatStat.Accuracy]],\r\n  \"Dazzle\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Dazzle\")\r\n      ? 1.0 / dazzle.getActionEffects(state).magnitude\r\n      : 1.0,\r\n);\r\n\r\nexport default dazzle;\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass FlameShow extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Flame Show\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create an impressive entertainment show based on fire.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 2400,\r\n        tags: [Resource.Coins, TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 400,\r\n        tags: [Resource.Coins, TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${getStandardRangeEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n    )}:coins:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantResource(\r\n      Resource.Coins,\r\n      effects.average + (Math.random() - 0.5) * effects.variance,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 580;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 4,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new FlameShow();\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport {\r\n  EXPLORATION_INITIAL_STATE,\r\n  PlayerContextState,\r\n} from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\n\r\nclass Getaway extends CombatSpellBase {\r\n  getSpellName(): string {\r\n    return \"Getaway\";\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 1.0;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create an illusion of yourself to trick the enemy.\";\r\n  }\r\n\r\n  getDisplayEffect(): string {\r\n    return \"Immediately exit combat and explore again much quicker.\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 320;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 6,\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    if (!state.exploration) {\r\n      state.exploration = EXPLORATION_INITIAL_STATE;\r\n    }\r\n    state = grantTemporaryEffect(this.getId(), \"Getaway\", 3, {\r\n      mode: \"replace\",\r\n    })(state);\r\n    state.exploration.explorationStatus = ExplorationStatus.Exploring;\r\n    state.exploration.explorationStartTime = getSecondsPlayed(state);\r\n    return state;\r\n  }\r\n}\r\n\r\nconst getaway = new Getaway();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  \"GetawaySpeedup\",\r\n  TransformationType.Multiplier,\r\n  (state, params) => (hasTemporaryEffect(state, getaway.getId()) ? 0.1 : 1.0),\r\n);\r\n\r\naddContextListener(\"GetawayBuffCleaning\", (oldState, newState) => {\r\n  if (\r\n    oldState.exploration.explorationStatus != ExplorationStatus.Combat &&\r\n    newState.exploration.explorationStatus == ExplorationStatus.Combat\r\n  ) {\r\n    return clearTemporaryEffect(getaway.getId());\r\n  }\r\n});\r\n\r\nexport default getaway;\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellActionBase } from \"../Spell\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass MagicShow extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return (\r\n      super.isVisible(state) && hasFlag(state, \"has_gathered_at_least_10_mana\")\r\n    );\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Magic Show\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create a basic entertainment show based on petty illusions.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 33,\r\n        tags: [Resource.Coins, TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 3,\r\n        tags: [Resource.Coins, TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${getStandardRangeEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n    )}:coins:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantResource(\r\n      Resource.Coins,\r\n      effects.average + (Math.random() - 0.5) * effects.variance,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 30;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 1,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new MagicShow();\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellActionBase } from \"../Spell\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass RainbowShow extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Rainbow Show\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create an astounding entertainment show with rainbows.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 16000,\r\n        tags: [Resource.Coins, TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 2000,\r\n        tags: [Resource.Coins, TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${getStandardRangeEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n    )}:coins:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantResource(\r\n      Resource.Coins,\r\n      effects.average + (Math.random() - 0.5) * effects.variance,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 2450;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 10,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new RainbowShow();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { ActionEffect } from \"../../actions/Action\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\n\r\nclass Slow extends CombatSpellBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: PlayerContextState): boolean {\r\n    return super.isVisible(state) && hasFlag(state, \"exploration_unlocked\");\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Slow\";\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 8.0;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Make an enemy move more sluggishly for a period of time.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.2,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 15,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      this.getId(),\r\n      this.getSpellName(),\r\n      effects.duration,\r\n      {\r\n        isEnemyTemporaryEffect: true,\r\n        combatOnly: true,\r\n        isBeneficial: false,\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${formatNumber(\r\n      effects.magnitude * 100,\r\n    )}%:attackDelay: for ${formatNumber(Math.floor(effects.duration))} sec`;\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 1350;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 12,\r\n    };\r\n  }\r\n}\r\n\r\nconst slow = new Slow();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Enemy, CombatStat.AttackDelay]],\r\n  \"Slow\",\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, \"Slow\")\r\n      ? 1.0 + slow.getActionEffects(state).magnitude\r\n      : 1.0,\r\n);\r\n\r\nexport default slow;\r\n","import { ActionEffect } from \"../../actions/Action\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { grantResource, Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../ElementsAndSchools\";\r\nimport { SpellActionBase } from \"../Spell\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass WindShow extends SpellActionBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return \"Wind Show\";\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Campus\";\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Create an entertainment show based on wind gusts.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 125,\r\n        tags: [Resource.Coins, TransformationTags.ActionMagnitude],\r\n      },\r\n      variance: {\r\n        value: 25,\r\n        tags: [Resource.Coins, TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return `+${getStandardRangeEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n    )}:coins:`;\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantResource(\r\n      Resource.Coins,\r\n      effects.average + (Math.random() - 0.5) * effects.variance,\r\n    )(state);\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 70;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Illusion: 2,\r\n    };\r\n  }\r\n}\r\n\r\nexport default new WindShow();\r\n","import { PlayerContextState } from \"../../PlayerContext\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  getTemporaryEffects,\r\n} from \"../../timetick/TemporaryEffects\";\r\nimport { SpellActionBase } from \"../Spell\";\r\n\r\nclass DispelSelf extends SpellActionBase {\r\n  getSpellName(): string {\r\n    return \"Dispel Self\";\r\n  }\r\n\r\n  getArea(): string {\r\n    return \"Exploration\";\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 1.0;\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Get rid of any negative status effects affecting you.\";\r\n  }\r\n\r\n  getDisplayEffect(): string {\r\n    return \"Heals all :debuff:debuffs\";\r\n  }\r\n\r\n  getManaCost(): number {\r\n    return 4700;\r\n  }\r\n\r\n  getSchoolLevelRequirements(): Record<string, number> {\r\n    return {\r\n      Protection: 19,\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: PlayerContextState): PlayerContextState {\r\n    const temporaryEffects = getTemporaryEffects(state);\r\n    temporaryEffects.forEach((effect) => {\r\n      if (!effect.isBeneficial && !effect.isEnemyTemporaryEffect) {\r\n        state = clearTemporaryEffect(effect.id)(state);\r\n      }\r\n    });\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new DispelSelf();\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\n\r\nclass HealthBoost extends Upgrade {\r\n  getName(): string {\r\n    return \"Health Boost\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 450;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Condition your body in order to be able to withstand more blows.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"+40 Max:hp:\";\r\n  }\r\n}\r\n\r\nconst healthBoost = new HealthBoost();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.MaxHP]],\r\n  \"HealthBoost\",\r\n  TransformationType.Addition,\r\n  (state) => (healthBoost.isPurchased(state) ? 40 : 0),\r\n);\r\n\r\nexport default healthBoost;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport healthBoost from \"./HealthBoost\";\r\n\r\nclass ExplorationTraining extends Upgrade {\r\n  getName(): string {\r\n    return \"Exploration Training\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 1200;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Train yourself on techniques that can make exploration more effective.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"-20% Exploration time\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [healthBoost];\r\n  }\r\n}\r\n\r\nconst explorationTraining = new ExplorationTraining();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  \"ExplorationTraining\",\r\n  TransformationType.Multiplier,\r\n  (state) => (explorationTraining.isPurchased(state) ? 0.8 : 1.0),\r\n);\r\n\r\nexport default explorationTraining;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport healthBoost from \"./HealthBoost\";\r\n\r\nclass InnateRegeneration extends Upgrade {\r\n  getName(): string {\r\n    return \"Innate Regeneration\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 1800;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Alter your body so that it's slightly more effective at healing itself.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"+0.1:hpRegen:\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [healthBoost];\r\n  }\r\n}\r\n\r\nconst innateRegeneration = new InnateRegeneration();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.HPRegen]],\r\n  \"InnateRegeneration\",\r\n  TransformationType.Addition,\r\n  (state) => (innateRegeneration.isPurchased(state) ? 0.1 : 0),\r\n);\r\n\r\nexport default innateRegeneration;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport healthBoost from \"./HealthBoost\";\r\n\r\nclass LargerHealthBoost extends Upgrade {\r\n  getName(): string {\r\n    return \"Larger Health Boost\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 3000;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Further condition your body in order to be able to withstand more blows.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"+60 Max:hp:\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [healthBoost];\r\n  }\r\n}\r\n\r\nconst largerHealthBoost = new LargerHealthBoost();\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.MaxHP]],\r\n  \"LargerHealthBoost\",\r\n  TransformationType.Addition,\r\n  (state) => (largerHealthBoost.isPurchased(state) ? 60 : 0),\r\n);\r\n\r\nexport default largerHealthBoost;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\n\r\nclass LargePouch extends Upgrade {\r\n  getName(): string {\r\n    return \"Large Pouch\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 600;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Increases the size of the pouch you use to store items, allowing you to store more items.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"+5 Inventory slots\";\r\n  }\r\n}\r\n\r\nconst largePouch = new LargePouch();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.InventorySlot]],\r\n  \"LargePouch\",\r\n  TransformationType.Addition,\r\n  (state) => (largePouch.isPurchased(state) ? 5 : 0),\r\n);\r\n\r\nexport default largePouch;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport largePouch from \"./LargePouch\";\r\n\r\nclass EnchantedPouch extends Upgrade {\r\n  getName(): string {\r\n    return \"Enchanted Pouch\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 2000;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Further increases the size of the pouch you use to store items, allowing you to store even more items.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"+5 Inventory slots\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [largePouch];\r\n  }\r\n}\r\n\r\nconst enchantedPouch = new EnchantedPouch();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.InventorySlot]],\r\n  \"EnchantedPouch\",\r\n  TransformationType.Addition,\r\n  (state) => (enchantedPouch.isPurchased(state) ? 5 : 0),\r\n);\r\n\r\nexport default enchantedPouch;\r\n","import HireResearcher from \"../../actions/campus/HireResearcher\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\n\r\nclass ResearchFair extends Upgrade {\r\n  getName(): string {\r\n    return \"Research Fair\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 600;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Host a research fair in campus, to advertise the magical research the school is doing.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"Reduces the cost to hire researchers.\";\r\n  }\r\n}\r\n\r\nconst researchFair = new ResearchFair();\r\n\r\nregisterTransformation(\r\n  [[HireResearcher.getName(), TransformationTags.CostScale]],\r\n  \"ResearchFairCostScale\",\r\n  TransformationType.Multiplier,\r\n  (state) => (researchFair.isPurchased(state) ? 2.0 / 3.0 : 1.0),\r\n);\r\n\r\nexport default researchFair;\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport researchFair from \"./ResearchFair\";\r\n\r\nclass ResearcherFocus extends Upgrade {\r\n  getName(): string {\r\n    return \"Researcher Focus\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 2000;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Train your researchers so that they can focus better, to increase their effectivity.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"+50% Research speed\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [researchFair];\r\n  }\r\n}\r\n\r\nconst researcherFocus = new ResearcherFocus();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Research]],\r\n  \"ResearcherFocus\",\r\n  TransformationType.Multiplier,\r\n  (state) => (researcherFocus.isPurchased(state) ? 1.5 : 1.0),\r\n);\r\n\r\nexport default researcherFocus;\r\n","import HireResearcher from \"../../actions/campus/HireResearcher\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport researchFair from \"./ResearchFair\";\r\n\r\nclass ResearchPublication extends Upgrade {\r\n  getName(): string {\r\n    return \"Research Publication\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 4250;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Publish the results of your research to increase the prestige of your institution.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"Reduces the cost to hire researchers.\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [researchFair];\r\n  }\r\n}\r\n\r\nconst researchPublication = new ResearchPublication();\r\n\r\nregisterTransformation(\r\n  [[HireResearcher.getName(), TransformationTags.CostScale]],\r\n  \"ResearchPublicationCostScale\",\r\n  TransformationType.Multiplier,\r\n  (state) => (researchPublication.isPurchased(state) ? 2.0 / 3.0 : 1.0),\r\n);\r\n\r\nexport default researchPublication;\r\n","import lumberYard from \"../../buildings/campus/LumberYard\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { Upgrade } from \"../Upgrade\";\r\n\r\nclass ReinforcedLumberYards extends Upgrade {\r\n  getName(): string {\r\n    return \"Reinforced Lumber Yards\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 350;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Increase the effectivity of the blades in your Lumber Yards, making them work faster.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"2x:wood: production from Lumber Yards\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [];\r\n  }\r\n}\r\n\r\nconst reinforcedLumberYards = new ReinforcedLumberYards();\r\n\r\nregisterTransformation(\r\n  [[Resource.Wood, lumberYard.getName(), TransformationTags.Production]],\r\n  \"ReinforcedLumberYards\",\r\n  TransformationType.Multiplier,\r\n  (state) => (reinforcedLumberYards.isPurchased(state) ? 2.0 : 1.0),\r\n);\r\n\r\nexport default reinforcedLumberYards;\r\n","import waterTank from \"../../buildings/campus/WaterTank\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps } from \"../../Resources\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport reinforcedWarehouses from \"./ReinforcedWarehouses\";\r\n\r\nclass ReinforcedWaterTanks extends Upgrade {\r\n  getName(): string {\r\n    return \"Reinforced Water Tanks\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 450;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Renew your water tanks, allowing them to store plenty more water.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"5x Water Tank storage\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [reinforcedWarehouses];\r\n  }\r\n}\r\n\r\nconst reinforcedWaterTanks = new ReinforcedWaterTanks();\r\n\r\nregisterTransformation(\r\n  [[waterTank.getName(), TransformationTags.PerBuildingCap]],\r\n  \"ReinforcedWaterTanks\",\r\n  TransformationType.Multiplier,\r\n  (state) => (reinforcedWaterTanks.isPurchased(state) ? 5 : 1),\r\n);\r\n\r\naddContextListener(\"ReinforcedWaterTanksListener\", (oldState, newState) => {\r\n  if (\r\n    !reinforcedWaterTanks.isPurchased(oldState) &&\r\n    reinforcedWaterTanks.isPurchased(newState)\r\n  ) {\r\n    return recalculateCaps;\r\n  }\r\n});\r\n\r\nexport default reinforcedWaterTanks;\r\n","import vault from \"../../buildings/campus/Vault\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../calculation/Calculation\";\r\nimport { TransformationTags } from \"../../calculation/TransformationTags\";\r\nimport { PlayerContextState } from \"../../PlayerContext\";\r\nimport { addContextListener } from \"../../PlayerContextListeners\";\r\nimport { recalculateCaps, Resource } from \"../../Resources\";\r\nimport { Upgrade } from \"../Upgrade\";\r\nimport reinforcedWaterTanks from \"./ReinforcedWaterTanks\";\r\n\r\nclass ReinforcedVaults extends Upgrade {\r\n  getName(): string {\r\n    return \"Reinforced Vaults\";\r\n  }\r\n\r\n  getMonstiumCost(): number {\r\n    return 2000;\r\n  }\r\n\r\n  getDisplayDescription(state: PlayerContextState): string {\r\n    return \"Add an extra layer of iron to your vaults, allowing you to store twice as much :coins:.\";\r\n  }\r\n\r\n  getDisplayEffect(state: PlayerContextState): string {\r\n    return \"2x Vault storage\";\r\n  }\r\n\r\n  getUpgradeRequirements() {\r\n    return [reinforcedWaterTanks];\r\n  }\r\n}\r\n\r\nconst reinforcedVaults = new ReinforcedVaults();\r\n\r\nregisterTransformation(\r\n  [[vault.getName(), TransformationTags.PerBuildingCap, Resource.Coins]],\r\n  \"Reinforced Vaults\",\r\n  TransformationType.Multiplier,\r\n  (state) => (reinforcedVaults.isPurchased(state) ? 2.0 : 1.0),\r\n);\r\n\r\naddContextListener(\"ReinforcedVaultsListener\", (oldState, newState) => {\r\n  if (\r\n    !reinforcedVaults.isPurchased(oldState) &&\r\n    reinforcedVaults.isPurchased(newState)\r\n  ) {\r\n    return recalculateCaps;\r\n  }\r\n});\r\n\r\nexport default reinforcedVaults;\r\n","import { loadActionsDemo } from \"./backend/actions/ActionLoaderDemo\";\r\nimport { loadAutocast } from \"./backend/autocast/Autocast\";\r\nimport { loadBuildingsDemo } from \"./backend/buildings/BuildingLoaderDemo\";\r\nimport Demo from \"./backend/Demo\";\r\nimport { loadGameEventsDemo } from \"./backend/events/GameEventLoaderDemo\";\r\nimport { loadDungeonsDemo } from \"./backend/exploration/dungeons/DungeonLoaderDemo\";\r\nimport { loadEnemiesDemo } from \"./backend/exploration/enemies/EnemyLoaderDemo\";\r\nimport { loadExploration } from \"./backend/exploration/Exploration\";\r\nimport { loadHelpsDemo } from \"./backend/help/HelpLoaderDemo\";\r\nimport { loadHintsDemo } from \"./backend/hints/HintLoaderDemo\";\r\nimport { loadItemsDemo } from \"./backend/items/ItemLoaderDemo\";\r\nimport { loadMisc } from \"./backend/MiscLoader\";\r\nimport { loadResearchers } from \"./backend/research/Researchers\";\r\nimport { loadSecretsDemo } from \"./backend/secrets/SecretLoaderDemo\";\r\nimport { loadSpellsDemo } from \"./backend/spells/SpellLoaderDemo\";\r\nimport { loadCommonTemporaryEffects } from \"./backend/timetick/CommonTemporaryEffects\";\r\nimport { loadTotalTimePlayed } from \"./backend/timetick/TotalTimePlayed\";\r\nimport { loadUpgradesDemo } from \"./backend/upgrades/UpgradesLoaderDemo\";\r\nimport { loadAnalytics } from \"./utils/GameAnalytics\";\r\n\r\nexport function loadAllDemo() {\r\n  Demo.setDemoMode(true);\r\n  loadActionsDemo();\r\n  loadAutocast();\r\n  loadBuildingsDemo();\r\n  loadSpellsDemo();\r\n  loadGameEventsDemo();\r\n  loadResearchers();\r\n  loadTotalTimePlayed();\r\n  loadItemsDemo();\r\n  loadDungeonsDemo();\r\n  loadEnemiesDemo();\r\n  loadExploration();\r\n  loadUpgradesDemo();\r\n  loadCommonTemporaryEffects();\r\n  loadHintsDemo();\r\n  loadSecretsDemo();\r\n  loadHelpsDemo();\r\n  loadMisc();\r\n  loadAnalytics();\r\n}\r\n","import { registerAction } from \"./Actions\";\r\nimport GatherIron from \"./campus/GatherIron\";\r\nimport GatherMana from \"./campus/GatherMana\";\r\nimport GatherWood from \"./campus/GatherWood\";\r\nimport HireResearcher from \"./campus/HireResearcher\";\r\nimport UseTimePiecesResearch from \"./campus/UseTimePiecesResearch\";\r\nimport UseTimePiecesWarp from \"./campus/UseTimePiecesWarp\";\r\n\r\nexport function loadActionsDemo() {\r\n  registerAction(GatherMana);\r\n  registerAction(GatherWood);\r\n  registerAction(GatherIron);\r\n  registerAction(HireResearcher);\r\n  registerAction(UseTimePiecesResearch);\r\n  registerAction(UseTimePiecesWarp);\r\n}\r\n","import { registerBuilding } from \"./Buildings\";\r\nimport ApprenticeDorm from \"./campus/ApprenticeDorm\";\r\nimport Furnace from \"./campus/Furnace\";\r\nimport LumberYard from \"./campus/LumberYard\";\r\nimport ManaCrystal from \"./campus/ManaCrystal\";\r\nimport ManaGeyser from \"./campus/ManaGeyser\";\r\nimport ManaShard from \"./campus/ManaShard\";\r\nimport ManaSpout from \"./campus/ManaSpout\";\r\nimport Mine from \"./campus/Mine\";\r\nimport Monstruarium from \"./campus/Monstruarium\";\r\nimport ResearcherCabin from \"./campus/ResearcherCabin\";\r\nimport Vault from \"./campus/Vault\";\r\nimport Warehouse from \"./campus/Warehouse\";\r\nimport WaterTank from \"./campus/WaterTank\";\r\n\r\nexport function loadBuildingsDemo() {\r\n  registerBuilding(ManaSpout);\r\n  registerBuilding(ManaGeyser);\r\n  registerBuilding(LumberYard);\r\n  registerBuilding(Mine);\r\n  registerBuilding(ManaShard);\r\n  registerBuilding(ManaCrystal);\r\n  registerBuilding(Warehouse);\r\n  registerBuilding(Monstruarium);\r\n  registerBuilding(WaterTank);\r\n  registerBuilding(Vault);\r\n  registerBuilding(Furnace);\r\n  registerBuilding(ResearcherCabin);\r\n  registerBuilding(ApprenticeDorm);\r\n}\r\n","import ConjureBuilding from \"./conjuration/ConjureBuilding\";\r\nimport CreateBoulder from \"./conjuration/CreateBoulder\";\r\nimport CreateIronBar from \"./conjuration/CreateIronBar\";\r\nimport CreateIronOre from \"./conjuration/CreateIronOre\";\r\nimport CreateRock from \"./conjuration/CreateRock\";\r\nimport CreateStone from \"./conjuration/CreateStone\";\r\nimport CreateWater from \"./conjuration/CreateWater\";\r\nimport CreateWaterII from \"./conjuration/CreateWaterII\";\r\nimport CreateWaterIII from \"./conjuration/CreateWaterIII\";\r\nimport EnchantFurnaces from \"./enchantment/EnchantFurnaces\";\r\nimport EnchantLumberYards from \"./enchantment/EnchantLumberYards\";\r\nimport EnchantManaGeysers from \"./enchantment/EnchantManaGeysers\";\r\nimport EnchantManaSpouts from \"./enchantment/EnchantManaSpouts\";\r\nimport EnchantMines from \"./enchantment/EnchantMines\";\r\nimport Levitation from \"./enchantment/Levitation\";\r\nimport PhysicalAugment from \"./enchantment/PhysicalAugment\";\r\nimport Quickness from \"./enchantment/Quickness\";\r\nimport Stoneskin from \"./enchantment/Stoneskin\";\r\nimport Strength from \"./enchantment/Strength\";\r\nimport VigorOfHealth from \"./enchantment/VigorOfHealth\";\r\nimport AirCutter from \"./evocation/AirCutter\";\r\nimport Blizzard from \"./evocation/Blizzard\";\r\nimport ConeOfFire from \"./evocation/ConeOfFire\";\r\nimport FireBall from \"./evocation/FireBall\";\r\nimport Gale from \"./evocation/Gale\";\r\nimport IceNeedle from \"./evocation/IceNeedle\";\r\nimport InfernalBlaze from \"./evocation/InfernalBlaze\";\r\nimport Landslide from \"./evocation/Landslide\";\r\nimport ManaSpike from \"./evocation/ManaSpike\";\r\nimport RockTomb from \"./evocation/RockTomb\";\r\nimport Stalagmite from \"./evocation/Stalagmite\";\r\nimport Twister from \"./evocation/Twister\";\r\nimport WaterBomb from \"./evocation/WaterBomb\";\r\nimport Blur from \"./illusion/Blur\";\r\nimport BubbleShow from \"./illusion/BubbleShow\";\r\nimport Dazzle from \"./illusion/Dazzle\";\r\nimport FlameShow from \"./illusion/FlameShow\";\r\nimport Getaway from \"./illusion/Getaway\";\r\nimport MagicShow from \"./illusion/MagicShow\";\r\nimport RainbowShow from \"./illusion/RainbowShow\";\r\nimport Slow from \"./illusion/Slow\";\r\nimport TimeDilation from \"./illusion/TimeDilation\";\r\nimport WindShow from \"./illusion/WindShow\";\r\nimport { registerSpell } from \"./Spells\";\r\n\r\nexport function loadSpellsDemo() {\r\n  // ======== Conjuration\r\n\r\n  registerSpell(CreateStone);\r\n  registerSpell(CreateRock);\r\n  registerSpell(CreateBoulder);\r\n  registerSpell(CreateWater);\r\n  registerSpell(CreateWaterII);\r\n  registerSpell(CreateWaterIII);\r\n  registerSpell(CreateIronOre);\r\n  registerSpell(CreateIronBar);\r\n  registerSpell(ConjureBuilding);\r\n\r\n  // ======== Enchantment\r\n\r\n  registerSpell(EnchantManaSpouts);\r\n  registerSpell(EnchantLumberYards);\r\n  registerSpell(EnchantFurnaces);\r\n  registerSpell(EnchantManaGeysers);\r\n  registerSpell(EnchantMines);\r\n  registerSpell(VigorOfHealth);\r\n  registerSpell(Stoneskin);\r\n  registerSpell(Quickness);\r\n  registerSpell(Strength);\r\n  registerSpell(Levitation);\r\n  registerSpell(PhysicalAugment);\r\n\r\n  // ======== Illusion\r\n\r\n  registerSpell(MagicShow);\r\n  registerSpell(WindShow);\r\n  registerSpell(BubbleShow);\r\n  registerSpell(FlameShow);\r\n  registerSpell(Getaway);\r\n  registerSpell(Blur);\r\n  registerSpell(RainbowShow);\r\n  registerSpell(Dazzle);\r\n  registerSpell(Slow);\r\n  registerSpell(TimeDilation);\r\n\r\n  // ======== Evocation\r\n\r\n  registerSpell(ManaSpike);\r\n  registerSpell(FireBall);\r\n  registerSpell(ConeOfFire);\r\n  registerSpell(InfernalBlaze);\r\n  registerSpell(Stalagmite);\r\n  registerSpell(RockTomb);\r\n  registerSpell(Landslide);\r\n  registerSpell(IceNeedle);\r\n  registerSpell(WaterBomb);\r\n  registerSpell(Blizzard);\r\n  registerSpell(AirCutter);\r\n  registerSpell(Gale);\r\n  registerSpell(Twister);\r\n}\r\n","import { DungeonFloors, Dungeons } from \"./Dungeons\";\r\nimport TheCorral from \"./farming/TheCorral\";\r\nimport TheMagicalPen from \"./farming/TheMagicalPen\";\r\nimport TheSpecialStockade from \"./farming/TheSpecialStockade\";\r\nimport WoolFarm from \"./farming/WoolFarm\";\r\nimport SchoolBasement from \"./schoolbasement/SchoolBasement\";\r\nimport SchoolBasementB1 from \"./schoolbasement/SchoolBasementB1\";\r\nimport SchoolBasementB2 from \"./schoolbasement/SchoolBasementB2\";\r\nimport SchoolBasementB3 from \"./schoolbasement/SchoolBasementB3\";\r\n\r\nexport function loadDungeonsDemo() {\r\n  Dungeons.register(SchoolBasement);\r\n  DungeonFloors.register(SchoolBasementB1);\r\n  DungeonFloors.register(SchoolBasementB2);\r\n  DungeonFloors.register(SchoolBasementB3);\r\n  Dungeons.register(WoolFarm);\r\n  DungeonFloors.register(TheCorral);\r\n  DungeonFloors.register(TheMagicalPen);\r\n  DungeonFloors.register(TheSpecialStockade);\r\n}\r\n","import { Enemies } from \"./Enemies\";\r\nimport AncientHeadmaster from \"./schoolbasement/AncientHeadmaster\";\r\nimport AngrySheep from \"./schoolbasement/AngrySheep\";\r\nimport BasementBat from \"./schoolbasement/BasementBat\";\r\nimport LittleDevil from \"./schoolbasement/LittleDevil\";\r\nimport mimic from \"./schoolbasement/Mimic\";\r\nimport Mouse from \"./schoolbasement/Mouse\";\r\nimport RedSlime from \"./schoolbasement/RedSlime\";\r\nimport Skeleton from \"./schoolbasement/Skeleton\";\r\nimport Slime from \"./schoolbasement/Slime\";\r\nimport Zombie from \"./schoolbasement/Zombie\";\r\n\r\nexport function loadEnemiesDemo() {\r\n  // School Basement\r\n  Enemies.register(Mouse);\r\n  Enemies.register(BasementBat);\r\n  Enemies.register(Skeleton);\r\n  Enemies.register(AngrySheep);\r\n  Enemies.register(Slime);\r\n  Enemies.register(LittleDevil);\r\n  Enemies.register(mimic);\r\n  Enemies.register(Zombie);\r\n  Enemies.register(RedSlime);\r\n  Enemies.register(AncientHeadmaster);\r\n}\r\n","import { registerAction } from \"../actions/Actions\";\r\nimport explorationTraining from \"./exploration/ExplorationTraining\";\r\nimport healthBoost from \"./exploration/HealthBoost\";\r\nimport innateRegeneration from \"./exploration/InnateRegeneration\";\r\nimport largerHealthBoost from \"./exploration/LargerHealthBoost\";\r\nimport enchantedPouch from \"./inventory/EnchantedPouch\";\r\nimport largePouch from \"./inventory/LargePouch\";\r\nimport woolFarm from \"./other/WoolFarm\";\r\nimport researcherFocus from \"./research/ResearcherFocus\";\r\nimport researchFair from \"./research/ResearchFair\";\r\nimport researchPublication from \"./research/ResearchPublication\";\r\nimport manaCrystals from \"./storage/ManaCrystals\";\r\nimport reinforcedLumberYards from \"./storage/ReinforcedLumberYards\";\r\nimport reinforcedVaults from \"./storage/ReinforcedVaults\";\r\nimport reinforcedWarehouses from \"./storage/ReinforcedWarehouses\";\r\nimport reinforcedWaterTanks from \"./storage/ReinforcedWaterTanks\";\r\n\r\nexport function loadUpgradesDemo() {\r\n  // Research\r\n  registerAction(researchFair);\r\n  registerAction(researchPublication);\r\n  registerAction(researcherFocus);\r\n\r\n  // Inventory\r\n  registerAction(largePouch);\r\n  registerAction(enchantedPouch);\r\n\r\n  // Storage\r\n  registerAction(reinforcedLumberYards);\r\n  registerAction(reinforcedWarehouses);\r\n  registerAction(reinforcedWaterTanks);\r\n  registerAction(manaCrystals);\r\n  registerAction(reinforcedVaults);\r\n\r\n  // Exploration\r\n  registerAction(healthBoost);\r\n  registerAction(largerHealthBoost);\r\n  registerAction(innateRegeneration);\r\n  registerAction(explorationTraining);\r\n\r\n  // Other\r\n  registerAction(woolFarm);\r\n}\r\n","import {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../calculation/Calculation\";\r\nimport { TransformationTags } from \"../calculation/TransformationTags\";\r\nimport {\r\n  PlayerAttackListeners,\r\n  SummonAttackListeners,\r\n} from \"../exploration/AttackListeners\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport {\r\n  getCurrentSummonHP,\r\n  getLastPlayerActionResult,\r\n  modifyEnemyCurrentHP,\r\n  modifyPlayerCurrentHP,\r\n  modifySummonCurrentHP,\r\n} from \"../exploration/Exploration\";\r\nimport { addContextListener } from \"../PlayerContextListeners\";\r\nimport { School } from \"../spells/ElementsAndSchools\";\r\nimport DispelSelf from \"../spells/protection/DispelSelf\";\r\nimport {\r\n  getTemporaryEffects,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n} from \"./TemporaryEffects\";\r\nimport { registerTimeTickListener } from \"./TimeTick\";\r\nimport { getSecondsPlayed } from \"./TotalTimePlayed\";\r\n\r\nexport function loadCommonTemporaryEffects() {\r\n  registerTimeTickListener(\"CommonDoT\", (state, timeElapsedSec) => {\r\n    const temporaryEffects = getTemporaryEffects(state).filter(\r\n      (effect) => effect.params?.commonDoTAmount != null,\r\n    );\r\n    temporaryEffects.forEach((effect) => {\r\n      if (effect.isEnemyTemporaryEffect) {\r\n        state = modifyEnemyCurrentHP(\r\n          state,\r\n          -effect.params.commonDoTAmount * timeElapsedSec,\r\n        );\r\n      } else {\r\n        state = modifyPlayerCurrentHP(\r\n          state,\r\n          -effect.params.commonDoTAmount * timeElapsedSec,\r\n        );\r\n      }\r\n    });\r\n    return state;\r\n  });\r\n\r\n  Object.keys(AttackTarget).forEach((target) => {\r\n    Object.keys(CombatStat).forEach((stat) => {\r\n      registerTransformation(\r\n        [[target, stat]],\r\n        \"CommonBuff\" + target + stat,\r\n        TransformationType.Addition,\r\n        (state) => {\r\n          const temporaryEffects = getTemporaryEffects(state).filter(\r\n            (effect) => effect.params?.commonBuff?.[target]?.[stat] != null,\r\n          );\r\n          let totalValue = 0;\r\n          temporaryEffects.forEach((effect) => {\r\n            totalValue += effect.params?.commonBuff?.[target]?.[stat] ?? 0;\r\n          });\r\n          return totalValue;\r\n        },\r\n      );\r\n      registerTransformation(\r\n        [[target, stat]],\r\n        \"CommonBuffMultiplication\" + target + stat,\r\n        TransformationType.Multiplier,\r\n        (state) => {\r\n          const temporaryEffects = getTemporaryEffects(state).filter(\r\n            (effect) =>\r\n              effect.params?.commonBuff?.[target]?.[stat + \"Multiplier\"] !=\r\n              null,\r\n          );\r\n          let totalValue = 1.0;\r\n          temporaryEffects.forEach((effect) => {\r\n            totalValue *=\r\n              effect.params?.commonBuff?.[target]?.[stat + \"Multiplier\"] ?? 1.0;\r\n          });\r\n          return totalValue;\r\n        },\r\n      );\r\n    });\r\n  });\r\n\r\n  Object.keys(School).forEach((school) => {\r\n    registerTransformation(\r\n      [\r\n        [school, TransformationTags.CanCastSpell],\r\n        // All selective silence blocks dispel\r\n        [DispelSelf.getId(), TransformationTags.CanCastSpell],\r\n      ],\r\n      \"SelectiveSilence\" + school,\r\n      TransformationType.Multiplier,\r\n      (state, params) =>\r\n        hasTemporaryEffect(state, \"SelectiveSilence\" + school) ? 0 : 1,\r\n    );\r\n  });\r\n\r\n  registerTimeTickListener(\"PlayerPoison\", (state, timeElapsedSec) => {\r\n    if (hasTemporaryEffect(state, \"PlayerPoison\")) {\r\n      state = modifyPlayerCurrentHP(\r\n        state,\r\n        -(state.temporaryEffects[\"PlayerPoison\"] as TemporaryEffectData).params\r\n          .amount * timeElapsedSec,\r\n      );\r\n    }\r\n    return state;\r\n  });\r\n  registerTimeTickListener(\"Enemy\", (state, timeElapsedSec) => {\r\n    if (hasTemporaryEffect(state, \"EnemyRegeneration\")) {\r\n      state = modifyEnemyCurrentHP(\r\n        state,\r\n        (state.temporaryEffects[\"EnemyRegeneration\"] as TemporaryEffectData)\r\n          .params.amount * timeElapsedSec,\r\n      );\r\n    }\r\n    if (hasTemporaryEffect(state, \"EnemyPoison\")) {\r\n      state = modifyEnemyCurrentHP(\r\n        state,\r\n        -(state.temporaryEffects[\"EnemyPoison\"] as TemporaryEffectData).params\r\n          .amount * timeElapsedSec,\r\n      );\r\n    }\r\n    return state;\r\n  });\r\n  registerTimeTickListener(\"Summon\", (state, timeElapsedSec) => {\r\n    if (\r\n      hasTemporaryEffect(state, \"SummonRegeneration\") &&\r\n      getCurrentSummonHP(state) > 0\r\n    ) {\r\n      state = modifySummonCurrentHP(\r\n        state,\r\n        (state.temporaryEffects[\"SummonRegeneration\"] as TemporaryEffectData)\r\n          .params.amount * timeElapsedSec,\r\n      );\r\n    }\r\n    return state;\r\n  });\r\n  PlayerAttackListeners.register((oldState, state) => {\r\n    if (hasTemporaryEffect(state, \"CloakOfFlames\")) {\r\n      const damage = getLastPlayerActionResult(state)?.damage;\r\n      if (damage && damage > 0) {\r\n        state = modifyPlayerCurrentHP(state, -damage * 0.3);\r\n\r\n        const actionResult = {\r\n          id: Math.random().toString(),\r\n          damage: damage * 0.3,\r\n          isHit: true,\r\n          isCrit: false,\r\n          time: getSecondsPlayed(state),\r\n          target: AttackTarget.Player,\r\n          tags: [],\r\n        };\r\n        state.exploration.lastEnemyActionResult = actionResult;\r\n        state.exploration.actionResultQueue.push(actionResult);\r\n      }\r\n    }\r\n    return state;\r\n  });\r\n  SummonAttackListeners.register((oldState, state) => {\r\n    if (hasTemporaryEffect(state, \"CloakOfFlames\")) {\r\n      const damage = getLastPlayerActionResult(state)?.damage;\r\n      if (damage && damage > 0) {\r\n        state = modifySummonCurrentHP(state, -damage * 0.3);\r\n\r\n        const actionResult = {\r\n          id: Math.random().toString(),\r\n          damage,\r\n          isHit: true,\r\n          isCrit: false,\r\n          time: getSecondsPlayed(state),\r\n          target: AttackTarget.Summon,\r\n          tags: [],\r\n        };\r\n        state.exploration.lastEnemyActionResult = actionResult;\r\n        state.exploration.actionResultQueue.push(actionResult);\r\n      }\r\n    }\r\n    return state;\r\n  });\r\n\r\n  addContextListener(\"EnemyReflect\", (oldState, newState) => {\r\n    if (!hasTemporaryEffect(newState, \"EnemyReflect\")) {\r\n      return;\r\n    }\r\n    const hasNewAttack =\r\n      newState.exploration?.lastPlayerActionResult?.id !==\r\n      oldState.exploration?.lastPlayerActionResult?.id;\r\n    if (!hasNewAttack) {\r\n      return;\r\n    }\r\n    const isSpellAttack =\r\n      newState.exploration?.lastPlayerActionResult?.tags?.includes(\r\n        TransformationTags.Spell,\r\n      );\r\n    const damage = newState.exploration?.lastPlayerActionResult?.damage || 0;\r\n    if (isSpellAttack && damage > 0) {\r\n      return (state) => {\r\n        state = modifyPlayerCurrentHP(state, -damage);\r\n\r\n        const actionResult = {\r\n          id: Math.random().toString(),\r\n          damage: damage,\r\n          isHit: true,\r\n          isCrit: false,\r\n          time: getSecondsPlayed(state),\r\n          target: AttackTarget.Player,\r\n          tags: [],\r\n        };\r\n        state.exploration.lastEnemyActionResult = actionResult;\r\n        state.exploration.actionResultQueue.push(actionResult);\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n}\r\n","import { Storylines } from \"../storylines/Storylines\";\r\nimport { Secret, SecretsByType, SecretType } from \"./Secrets\";\r\n\r\nexport function loadSecretsDemo() {\r\n  // Storyline secrets\r\n  Storylines.getAll().forEach((storyline) => {\r\n    SecretsByType.Storyline.register(\r\n      new Secret(\r\n        storyline.name,\r\n        SecretType.Storyline,\r\n        storyline.hintDescription,\r\n        storyline.isHintUnlockable,\r\n        storyline.isCompleted,\r\n      ),\r\n    );\r\n  });\r\n}\r\n","import { hasFlag } from \"../Flags\";\r\nimport { isCraftingUnlocked } from \"../items/Items\";\r\nimport { getTotalElementAndSchoolExp } from \"../spells/ElementsAndSchools\";\r\nimport { Helps } from \"./Helps\";\r\n\r\nexport function loadHelpsDemo() {\r\n  Helps.register({\r\n    title: \"Introduction\",\r\n    isVisible: (state) => true,\r\n    order: 0,\r\n    description: `**Welcome to Magic Research!**\r\n      \r\nIn Magic Research, you are the headmaster of a magical institution. Cast spells, accumulate resources, create buildings, and much more to gain prestige and build the best magical school in the world!\r\n\r\nIn the top left corner, you will find **the menu button** which shows you a breakdown of your current resources and let you access various areas of the game.\r\n\r\nIn the top right corner, you will find two buttons. **The notification bell button** takes you to the list of events that have happened recently and allows you to see more information about them or interact with them. In this menu, you can also see **your current Goal** - if you are not sure of what to do next, you can follow what it says.\r\n\r\nThe other button in the top right corner is **the magic wand button**. This will take you to the magic menu, where you can cast any spell you may have learned.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Events\",\r\n    isVisible: (state) => true,\r\n    order: 10,\r\n    description: `Events are occurrences that happen either randomly with the passage of time or when something specific happens. You will know an event has happened because a dialog will show up and cover the screen.\r\n\r\nYou can see a list of events by going to **the event list menu**, by pressing the notification bell button at the top right of the screen. Pressing on any event will let you see the last message of the event, and you can check out the previous messages by using the arrows at the top of the dialog.    \r\n\r\nEvents are **very important** in the game, as most progress ends up happening via events that trigger when certain actions are done.\r\n\r\nEvents can be either *Completed* or *Ongoing*. Completed events require no further action on your part. Ongoing events, on the other hand, mean that you haven't reached the end of the event for some reason. If possible, you should strive to complete all ongoing events. If you have ongoing events, the notification bell icon will show a number in red indicating this fact.\r\n\r\nThere is a special kind of event called **Storyline**. These events are particularly important; keep an eye for them and aim to complete as many as possible.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Spells\",\r\n    isVisible: (state) => true,\r\n    order: 20,\r\n    description: `Spells are your primary way of interacting with the game. You can cast them usually from **the cast spell menu** and they cost a certain amount of :mana:. Because of this reason, :mana: is the most important resource in the game. You can obtain Mana by gathering it manually in your Campus, or via buildings like the Mana Spouts.\r\n    \r\nSpells are divided into **schools of magic**. These roughly group spells by a theme. There are three schools of magic: **Conjuration**, which mostly allows you to create resources such as :stone: and :water:; **Enchantment** that allows you to improve the performance of your buildings; and **Illusion** which allows you to obtain more :coins:. (Or are there really just these three...?)\r\n\r\nUsing spells from a certain school will give you experience on that school. Eventually, the school level will increase, which will usually unlock new spells.\r\n\r\nAt the beginning of the game, you selected a *primary school of magic*. It will be easier to level this primary school, which means you will likely unlock more advanced spells for this school quicker than for the other schools.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Campus\",\r\n    isVisible: (state) => true,\r\n    order: 100,\r\n    description: `In the **Campus** screen, you can do a limited set of actions such as **Gather Mana**, or use your resources to **construct Buildings**.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Research\",\r\n    isVisible: (state) => hasFlag(state, \"research_unlocked\"),\r\n    order: 110,\r\n    description: `In the **Research** screen, you can assign the researchers that you have hired to do research on schools of magic. Each researcher generates a set amount of school experience per second.\r\n    \r\nResearch is a much more effective way of raising school levels than casting spells, and it becomes even more effective the more you progress in the game.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Apprentices\",\r\n    isVisible: (state) => hasFlag(state, \"autocast_unlocked\"),\r\n    order: 120,\r\n    description: `In the **Apprentices** screen, you can order the apprentices from the school to cast spells automatically for you. This is very useful for **automating** several of the actions you typically do. One example: ordering apprentices to cast *Enchant Mana Spouts* will let you get the vastly improved :mana: production without having to make a clear effort to cast the enchantment over and over.\r\n    \r\nIn order for an apprentice to be able to cast a spell, your school level for that spell needs to be one level higher than the level required to unlock it. For example, for *Enchant Mana Spouts*, you need Enchantment Lv1 to cast it - but you need Enchantment Lv2 for apprentices to be able to cast it for you.\r\n\r\n**Apprentices cast each spell once every 60 seconds.** If you want apprentices to cast a spell faster, you can **assign multiple apprentices to the same spell** which will increase the frequency of the spell proportionally. For example, **2 apprentices would cast the spell twice per minute (once every 30 seconds)**, 3 apprentices would cast it three times per minute (once every 20 seconds), 4 apprentices would be 4 times per minute (once every 15 seconds), and so on.\r\n\r\nIf a spell cannot be cast when an apprentice attempts to cast it, usually because there is not enough :mana:Mana, the apprentice will cast the spell as soon as it is able to.\r\n\r\nSometimes, it can be useful to have apprentices stop casting spells temporarily. You can pause apprentices with the **Pause Apprentices** button at the bottom of this screen.\r\n\r\nIn addition, as you play the game you will face different situations which means you will want to have different spells being cast automatically. You can use **Loadouts** for this, at the bottom of the Apprentices screen. Saving to a loadout will record your current apprentice assignment to the specified slot. You can then load it later to go back to that assignment.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Inventory and Crafting\",\r\n    isVisible: (state) => isCraftingUnlocked(state),\r\n    order: 130,\r\n    description: `In the **Inventory** screen, you are able to see the *items* you have accumulated and crafted. Items are objects that have various effects. Some of them can be *equipped* on yourself, which will provide various bonuses. Others can be used directly from this screen. You may also throw away (or later, sell) unwanted items.\r\n    \r\nOn the top right of this screen is a **Craft Items** button, that opens the crafting interface. From that interface, you can select an item and, if you have the materials, you can create the item. The materials are either resources or other items.\r\n\r\nYou can unlock new items to craft by increasing your school levels. Conjuration and Enchantment typically unlock new items to craft, but other schools may also unlock new items. In some cases, some items may require a certain level from multiple schools at once. For example, the item \"Branch\" requires Lv4 Conjuration and Lv4 Enchantment.\r\n\r\nThe **Sort Inventory** button in this screen places items in this order: Consumables, Hand, Body, Accessory, and the rest. Use it to keep your most important items at the top, for ease of access.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Exploration\",\r\n    isVisible: (state) => hasFlag(state, \"exploration_unlocked\"),\r\n    order: 140,\r\n    description: `In the **Exploration** screen, you can let your headmaster travel to various areas and brave dangers - and find untold knowledge. Maybe something you find while exploring will decisively bring prestige to the school!\r\n    \r\nSelect a destination or dungeon to explore, and the headmaster will begin exploring. Once the exploration finishes, the headmaster will begin combat against an enemy. \r\n\r\nIf combat is successful, you will earn :coins:, :monstium: and possibly some items. The stronger the enemy, the bigger the rewards typically are. These rewards are shown on the Exploration screen as they are obtained.\r\n\r\nIf combat is unsuccessful, the headmaster will be defeated and will wait until its health is fully recovered before exploring again.\r\n\r\nAfter succeeding in combat a certain number of times, a *Boss* is unlocked for the area, which is exceptionally strong. Defeating the Boss will let you move on to the next floor of the destination you are in. You can do this by pressing the \"Next Floor\" button.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Combat\",\r\n    isVisible: (state) => hasFlag(state, \"exploration_unlocked\"),\r\n    order: 150,\r\n    description: `During **Combat**, your headmaster fights an enemy head-on. The goal is to reduce the enemy's :hp: (health, or HP), to zero, before letting your own :hp: drop to zero.\r\n    \r\nYour headmaster will automatically attack using the hand item it is equipped with, while the enemy can act in different ways, often attacking back. You can see the progress of the current combat in the **Exploration** screen.\r\n\r\nMost of combat relies upon two stats: :attack:Attack, :defense:Defense. The general damage calculation for any attack is: Attack's :attack: - 0.5x Target's :defense:. A little extra :defense: can be pretty effective at reducing damage, especially for weaker attacks. Likewise, against an enemy with high :defense:, even just a little more :attack: can increase the total damage drastically. \r\n\r\nThere are two additional combat stats: :attackDelay:Attack Delay affects how often you (or the enemy) attack, while :hpRegen:HP Regen automatically recovers your :hp: over time.\r\n\r\nYou can also manually use items or cast spells from the bottom of the **Combat** screen, which can help give you an edge. You can add often-used items or spells to the **Quickbar**, which is a separate screen that conveniently allows you to do so without having to search for each item or spell. In the Quickbar you can also see your current temporary effects (positive and negative).`,\r\n  });\r\n  Helps.register({\r\n    title: \"Upgrades\",\r\n    isVisible: (state) => hasFlag(state, \"upgrades_unlocked\"),\r\n    order: 160,\r\n    description: `In the **Upgrades** screen, you can spend your accumulated :monstium: into various improvements to several areas of the game, from buildings in your campus, inventory size, combat attributes, among others.\r\n    \r\nUpgrades do not persist through retirement and must be purchased again every time.`,\r\n  });\r\n\r\n  Helps.register({\r\n    title: \"Retirement\",\r\n    isVisible: (state) => getTotalElementAndSchoolExp(state) >= 10000,\r\n    order: 500,\r\n    description: `**Retirement** is one of the most powerful features in the game. In essence, retiring allows you to restart the game from the beginning, including choosing a new primary school and element. However, there are strong benefits to retirement which are detailed below.\r\n    \r\nWhen you retire, the level your primary school is currently at is permanently recorded. This level is called the **Maximum Primary Level**, or **MPL**. The MPL for a school can never go down - if you re-select a school as your primary and then retire again without reaching your previous MPL, you will keep the previous value.\r\n\r\nAfter you retire, you will get a **Global Research Multiplier**. This multiplier is very important, as it can vastly improve the effectiveness of research, letting you unlock stronger spells much, much quicker.\r\n\r\nIn addition, there is a similar **Global Production Multiplier** which will affect all resource production you have from buildings and other features in the game. This includes Mana, which means after retirement it should be much easier to cast stronger spells or cast spells more often. This also affects loot.\r\n\r\nBoth of the multipliers above are determined based on two factors. The first is the maximum MPL you have ever achieved, regardless of school. This is the main factor impacting the two multipliers. The second is the sum of all the MPLs you have across all the schools. This is a secondary factor and it will impact the multipliers, but not as much.\r\n\r\nOne last benefit from retirement is related to Storylines. Any **benefits acquired from Storylines will persist through retirements**, meaning progress will become faster. In addition, some Storylines only provide their benefit after you retire once - retiring is encouraged in order to get the full benefit in those cases.\r\n\r\nDeciding when to retire is very important. One suggestion is to retire if progress has gotten slower or achieving the next Goal (see: **Introduction** help section) appears impossible. Another is to retire if the research and production multipliers will substantially increase, or if you complete a Storyline with powerful effects that only appear after retirement.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Storylines\",\r\n    isVisible: (state) => true,\r\n    order: 510,\r\n    description: `**Storylines** are special events. Like other events, they can happen randomly or once a certain action happens, but they are often rarer and harder to come by. Storylines are mostly independent from each other, so even if you have a pending Storyline event you haven't completed yet, you may still encounter other Storylines, randomly or otherwise.\r\n    \r\nStorylines provide powerful permanent benefits when completed. If you happen to come across a Storyline event, you should complete it if possible, as the benefits can often significantly change how the game plays.\r\n\r\nStorylines only provide benefits and there are no drawbacks. If there is a choice inside a Storyline, you will be able to make a different choice later if you encounter the Storyline again after retirement, and possibly reach a different ending that provides a different benefit. Bonuses from completed Storylines never go away, even if you finish the same Storyline again with a different ending.\r\n\r\nStorylines represent progress through the game, and as a player one of the goals of the game is to complete every Storyline. You can see the progress in completing all Storylines in the Stats menu.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Stats\",\r\n    isVisible: (state) => true,\r\n    order: 900,\r\n    description: `In the **Stats** screen, you can see a set of statistics about your game, such as the total amount of played time, the Maximum Primary Levels for every school, or the amount of completed Storylines.`,\r\n  });\r\n  Helps.register({\r\n    title: \"Options / Save Data\",\r\n    isVisible: (state) => true,\r\n    order: 910,\r\n    description: `In the **Options** screen, you can access a few configuration options for the game and you can export or import your save data. You can use this feature to transfer your progress from the demo of Magic Research to the full game.\r\n    \r\nTo export your save data, press the **Copy save data to clipboard** button. Once you have done this, paste this in some text document. This text is your current save data. You can share this with other people or store it somewhere safe as a backup. You can also press \"Save to file\" to obtain a file that you can later use to load your game.\r\n\r\nTo import new save data, you can paste the text that was exported on the previous step into the text field. In mobile, you may also load a save file that you exported to a file. If the import is successful, the interface will instantly change and reflect the new data. **Note: you will lose your old save data once this happens, so make sure to export and store it somewhere first!**`,\r\n  });\r\n}\r\n","import { loadDoom } from \"./exploration/Doom\";\r\nimport { loadStunning } from \"./exploration/Stunning\";\r\nimport { OfflineTickListeners } from \"./timetick/OfflineTickListeners\";\r\nimport { timePieceGranter } from \"./timetick/TimePieces\";\r\n\r\nexport function loadMisc() {\r\n  OfflineTickListeners.register(timePieceGranter);\r\n  loadStunning();\r\n  loadDoom();\r\n}\r\n","import { registerRootComponent } from \"expo\";\r\nimport { useEffect } from \"react\";\r\nimport App from \"./AppContents\";\r\nimport { loadAllDemo } from \"./DemoLoader\";\r\n\r\nfunction DemoMain() {\r\n  useEffect(() => {\r\n    loadAllDemo();\r\n  }, []);\r\n  return <App />;\r\n}\r\n\r\nregisterRootComponent(DemoMain);\r\n"],"sourceRoot":""}